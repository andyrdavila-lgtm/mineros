{% extends "inicio.html" %}

{% block content %}
<div class="estrategias-fullscreen-expandido">
    <!-- HEADER SUPERIOR COMPACTO -->
    <div class="header-completo">
        <div class="header-titulo">
            <h1>
                <i class="fas fa-chess-queen"></i>
                Planificaci√≥n Estrat√©gica
            </h1>
            <p class="subtitulo">Sistema integral de gesti√≥n de estrategias, t√°cticas y actividades</p>
        </div>
        
        <div class="estadisticas-globales">
            <div class="estadistica-card">
                <div class="estadistica-icono">
                    <i class="fas fa-bullseye"></i>
                </div>
                <div class="estadistica-content">
                    <span class="estadistica-valor" id="total-estrategias">0</span>
                    <span class="estadistica-label">Estrategias</span>
                </div>
            </div>
            
            <div class="estadistica-card">
                <div class="estadistica-icono">
                    <i class="fas fa-tasks"></i>
                </div>
                <div class="estadistica-content">
                    <span class="estadistica-valor" id="estrategias-con-tacticas">0</span>
                    <span class="estadistica-label">Con T√°cticas</span>
                </div>
            </div>
            
            <div class="estadistica-card">
                <div class="estadistica-icono">
                    <i class="fas fa-project-diagram"></i>
                </div>
                <div class="estadistica-content">
                    <span class="estadistica-valor" id="total-tacticas">0</span>
                    <span class="estadistica-label">T√°cticas Totales</span>
                </div>
            </div>
            
            <div class="estadistica-card">
                <div class="estadistica-icono">
                    <i class="fas fa-check-circle"></i>
                </div>
                <div class="estadistica-content">
                    <span class="estadistica-valor" id="total-actividades">0</span>
                    <span class="estadistica-label">Actividades</span>
                </div>
            </div>
            
            <div class="estadistica-card">
                <div class="estadistica-icono">
                    <i class="fas fa-user-tie"></i>
                </div>
                <div class="estadistica-content">
                    <span class="estadistica-valor" id="total-responsables">0</span>
                    <span class="estadistica-label">Responsables</span>
                </div>
            </div>
            
            <div class="estadistica-card">
                <div class="estadistica-icono">
                    <i class="fas fa-sync-alt"></i>
                </div>
                <div class="estadistica-content">
                    <button class="btn-refresh-completo" onclick="cargarEstrategias()">
                        <i class="fas fa-sync-alt"></i>
                        Actualizar Todo
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- CONTENEDOR PRINCIPAL SIN DIVISIONES -->
    <div class="contenedor-principal-expandido">
        
        <!-- SECCI√ìN DE FILTROS Y B√öSQUEDA -->
        <div class="seccion-filtros-expandida">
            <div class="filtros-header">
                <h3><i class="fas fa-sliders-h"></i> Filtros y B√∫squeda Avanzada</h3>
            </div>
            
            <div class="filtros-grid-expandido">
                <div class="filtro-item-expandido">
                    <label><i class="fas fa-filter"></i> Eje Estrat√©gico</label>
                    <select id="filtro-eje" class="select-expandido" onchange="filtrarEstrategiasTabla()">
                        <option value="all">Todos los ejes estrat√©gicos</option>
                        <option value="educacion">üéì Educaci√≥n y Capacitaci√≥n</option>
                        <option value="salud">üè• Salud y Bienestar</option>
                        <option value="empleabilidad">üíº Empleabilidad y Desarrollo Laboral</option>
                        <option value="desarrollo_economico">üìà Desarrollo Econ√≥mico Sostenible</option>
                        <option value="sostenibilidad_ambiental">üíß Sostenibilidad Ambiental</option>
                        <option value="comunicacion">üì¢ Comunicaci√≥n y Relaciones P√∫blicas</option>
                        <option value="institucional">üèõÔ∏è Fortalecimiento Institucional</option>
                    </select>
                </div>
                
                <div class="filtro-item-expandido">
                    <label><i class="fas fa-crosshairs"></i> Tipo de Estrategia</label>
                    <select id="filtro-tipo" class="select-expandido" onchange="filtrarEstrategiasTabla()">
                        <option value="all">Todos los tipos de estrategia</option>
                        <option value="FO" style="color: #2ecc71;">FO - Fortalezas + Oportunidades</option>
                        <option value="DO" style="color: #3498db;">DO - Debilidades + Oportunidades</option>
                        <option value="FA" style="color: #e67e22;">FA - Fortalezas + Amenazas</option>
                        <option value="DA" style="color: #9b59b6;">DA - Debilidades + Amenazas</option>
                    </select>
                </div>
                
                <div class="filtro-item-expandido">
                    <label><i class="fas fa-search"></i> B√∫squeda por Texto</label>
                    <input type="text" id="buscar-estrategia" class="input-expandido" 
                           placeholder="Buscar en el texto de las estrategias..." onkeyup="buscarEstrategias()">
                </div>
                
                <div class="filtro-item-expandido">
                    <label><i class="fas fa-sort-amount-down"></i> Ordenar por</label>
                    <select id="ordenar-por" class="select-expandido" onchange="ordenarEstrategias()">
                        <option value="eje">Eje Estrat√©gico (A-Z)</option>
                        <option value="tipo">Tipo de Estrategia</option>
                        <option value="fecha_desc">Fecha de Creaci√≥n (M√°s reciente)</option>
                        <option value="fecha_asc">Fecha de Creaci√≥n (M√°s antigua)</option>
                    </select>
                </div>
                
                <div class="filtro-item-expandido">
                    <label><i class="fas fa-calendar-alt"></i> Rango de Fechas</label>
                    <div class="fecha-rango">
                        <input type="date" id="fecha-desde" class="input-expandido fecha-input" 
                               placeholder="Desde" onchange="filtrarEstrategiasTabla()">
                        <span class="separador-fecha">a</span>
                        <input type="date" id="fecha-hasta" class="input-expandido fecha-input" 
                               placeholder="Hasta" onchange="filtrarEstrategiasTabla()">
                    </div>
                </div>
                
                <div class="filtro-item-expandido">
                    <label><i class="fas fa-tasks"></i> Con T√°cticas</label>
                    <select id="filtro-tacticas" class="select-expandido" onchange="filtrarEstrategiasTabla()">
                        <option value="all">Todas las estrategias</option>
                        <option value="con_tacticas">Solo con t√°cticas</option>
                        <option value="sin_tacticas">Sin t√°cticas</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- TABLA DE ESTRATEGIAS - ALTURA AJUSTABLE -->
        <div class="seccion-tabla-expandida">
            <div class="tabla-header-expandido">
                <div class="tabla-titulo">
                    <h2><i class="fas fa-layer-group"></i> Estrategias Generadas</h2>
                    <p class="tabla-subtitulo">Seleccione una estrategia para desglosarla en t√°cticas y actividades</p>
                </div>
                <div class="tabla-controles">
                    <div class="resultados-info">
                        Mostrando <span id="estrategias-mostradas">0</span> de <span id="estrategias-totales">0</span> estrategias
                    </div>
                    <button class="btn-exportar" onclick="exportarEstrategias()">
                        <i class="fas fa-file-export"></i> Exportar
                    </button>
                </div>
            </div>
            
            <div class="tabla-contenedor-expandido">
                <table class="tabla-estrategias-expandida">
                    <thead>
                        <tr>
                            <th width="20%">Eje Estrat√©gico</th>
                            <th width="12%">Tipo</th>
                            <th width="48%">Descripci√≥n de la Estrategia</th>
                            <th width="8%">T√°cticas</th>
                            <th width="12%">Fecha</th>
                        </tr>
                    </thead>
                    <tbody id="cuerpo-tabla-estrategias">
                        <!-- Las estrategias se cargar√°n aqu√≠ -->
                    </tbody>
                </table>
            </div>
            
            <div class="tabla-footer">
                <div class="paginacion">
                    <button class="btn-pagina" onclick="cambiarPagina(-1)">
                        <i class="fas fa-chevron-left"></i> Anterior
                    </button>
                    <span class="pagina-actual">P√°gina <span id="pagina-actual">1</span></span>
                    <button class="btn-pagina" onclick="cambiarPagina(1)">
                        Siguiente <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- DETALLE DE ESTRATEGIA - SE EXPANDE SEG√öN CONTENIDO -->
        <div class="seccion-detalle-expandida" id="seccion-detalle" style="display: none;">
            <div class="detalle-header-expandido">
                <div class="detalle-titulo-completo">
                    <h2><i class="fas fa-project-diagram"></i> Desglose de Estrategia</h2>
                    <div class="estrategia-seleccionada-info">
                        <div class="estrategia-header-completo">
                            <span class="estrategia-eje" id="nombre-eje-seleccionado">Seleccione una estrategia</span>
                            <span class="estrategia-tipo-badge" id="tipo-estrategia-seleccionada">--</span>
                        </div>
                        <div class="estrategia-metadata-completo">
                            <span class="metadata-item"><i class="fas fa-tasks"></i> <span id="contador-tacticas">0</span> t√°cticas</span>
                            <span class="metadata-item"><i class="fas fa-check-circle"></i> <span id="contador-actividades">0</span> actividades</span>
                            <span class="metadata-item"><i class="fas fa-calendar"></i> <span id="fecha-creacion-estrategia">--</span></span>
                        </div>
                    </div>
                </div>
                <div class="detalle-acciones">
                    <button class="btn-imprimir" onclick="imprimirEstrategia()">
                        <i class="fas fa-print"></i> Imprimir
                    </button>
                    <button class="btn-compartir" onclick="compartirEstrategia()">
                        <i class="fas fa-share-alt"></i> Compartir
                    </button>
                </div>
            </div>
            
            <div class="detalle-contenido-expandido">
                <!-- TEXTO COMPLETO DE LA ESTRATEGIA -->
                <div class="estrategia-texto-completo">
                    <div class="estrategia-texto-header">
                        <h3><i class="fas fa-quote-left"></i> Texto Completo de la Estrategia</h3>
                        <span class="contador-caracteres" id="estrategia-len">0 caracteres</span>
                    </div>
                    <div class="estrategia-texto-body" id="estrategia-texto">
                        <!-- El texto de la estrategia se cargar√° aqu√≠ -->
                    </div>
                </div>
                
                <!-- FORMULARIO PARA AGREGAR T√ÅCTICA - ESPACIO AMPLIO -->
                <div class="formulario-tactica-completo">
                    <div class="form-header-completo">
                        <h3><i class="fas fa-plus-circle"></i> Agregar Nueva T√°ctica</h3>
                        <p class="form-subtitle">Desglose operativo de la estrategia seleccionada en acciones concretas y medibles</p>
                    </div>
                    
                    <div class="form-grid-completo">
                        <div class="form-row-completo">
                            <div class="form-group-completo">
                                <label for="tactica-nombre" class="form-label-completo">
                                    <i class="fas fa-heading"></i> Nombre de la T√°ctica
                                    <span class="requerido">*</span>
                                </label>
                                <input type="text" id="tactica-nombre" class="form-input-completo" 
                                       placeholder="Describa el nombre completo y espec√≠fico de la t√°ctica...">
                                <div class="form-hint">Ej: "Implementar programa de capacitaci√≥n continua en seguridad industrial para todo el personal"</div>
                            </div>
                        </div>
                        
                        <div class="form-row-completo">
                            <div class="form-group-completo">
                                <label for="tactica-descripcion" class="form-label-completo">
                                    <i class="fas fa-align-left"></i> Descripci√≥n Detallada
                                    <span class="requerido">*</span>
                                </label>
                                <textarea id="tactica-descripcion" class="form-textarea-completo" rows="8" 
                                          placeholder="Describa en detalle los alcances, objetivos espec√≠ficos, metodolog√≠a, recursos necesarios, criterios de √©xito y resultados esperados de esta t√°ctica..."></textarea>
                            </div>
                        </div>
                        
                        <div class="form-row-completo triple-columnas">
                            <div class="form-group-completo">
                                <label for="tactica-responsable" class="form-label-completo">
                                    <i class="fas fa-user-tie"></i> Responsable Principal
                                </label>
                                <input type="text" id="tactica-responsable" class="form-input-completo" 
                                       placeholder="Nombre del l√≠der responsable, cargo, departamento...">
                            </div>
                            
                            <div class="form-group-completo">
                                <label for="tactica-fecha-inicio" class="form-label-completo">
                                    <i class="fas fa-calendar-plus"></i> Fecha de Inicio
                                </label>
                                <input type="date" id="tactica-fecha-inicio" class="form-input-completo">
                            </div>
                            
                            <div class="form-group-completo">
                                <label for="tactica-fecha-fin" class="form-label-completo">
                                    <i class="fas fa-calendar-check"></i> Fecha de Finalizaci√≥n
                                </label>
                                <input type="date" id="tactica-fecha-fin" class="form-input-completo">
                            </div>
                        </div>
                        
                        <div class="form-row-completo">
                            <div class="form-group-completo">
                                <label for="tactica-presupuesto" class="form-label-completo">
                                    <i class="fas fa-money-bill-wave"></i> Presupuesto Estimado
                                </label>
                                <div class="presupuesto-input">
                                    <span class="presupuesto-prefijo">$</span>
                                    <input type="number" id="tactica-presupuesto" class="form-input-completo" 
                                           placeholder="0.00" step="0.01" min="0">
                                    <select id="tactica-moneda" class="moneda-select">
                                        <option value="USD">USD</option>
                                        <option value="EUR">EUR</option>
                                        <option value="GBP">GBP</option>
                                        <option value="JPY">JPY</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-group-completo">
                                <label for="tactica-prioridad" class="form-label-completo">
                                    <i class="fas fa-exclamation-circle"></i> Nivel de Prioridad
                                </label>
                                <select id="tactica-prioridad" class="form-select-completo">
                                    <option value="alta">üî¥ Alta - Cr√≠tica para el √©xito</option>
                                    <option value="media" selected>üü° Media - Importante</option>
                                    <option value="baja">üü¢ Baja - Complementaria</option>
                                    <option value="opcional">‚ö™ Opcional - Si hay recursos</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-actions-completo">
                        <button class="btn-limpiar" onclick="limpiarFormularioTactica()">
                            <i class="fas fa-eraser"></i> Limpiar Formulario
                        </button>
                        <button class="btn-agregar-tactica-completo" onclick="agregarTactica()">
                            <i class="fas fa-plus"></i> Agregar T√°ctica a la Estrategia
                        </button>
                    </div>
                </div>
                
                <!-- LISTA DE T√ÅCTICAS EXISTENTES -->
                <div class="lista-tacticas-completa" id="lista-tacticas-container">
                    <div class="lista-header-completo">
                        <h3><i class="fas fa-list-ul"></i> T√°cticas Asignadas a esta Estrategia</h3>
                        <div class="lista-controles">
                            <div class="filtros-tacticas">
                                <button class="btn-filtro-tactica activo" data-filtro="todas">Todas</button>
                                <button class="btn-filtro-tactica" data-filtro="pendientes">Pendientes</button>
                                <button class="btn-filtro-tactica" data-filtro="en-progreso">En Progreso</button>
                                <button class="btn-filtro-tactica" data-filtro="completadas">Completadas</button>
                                <button class="btn-filtro-tactica" data-filtro="alta">Prioridad Alta</button>
                            </div>
                            <div class="orden-tacticas">
                                <select class="select-orden" onchange="ordenarTacticas(this.value)">
                                    <option value="fecha">Ordenar por fecha</option>
                                    <option value="nombre">Ordenar por nombre</option>
                                    <option value="prioridad">Ordenar por prioridad</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="tacticas-contenedor-completo" id="tacticas-container">
                        <!-- Las t√°cticas se cargar√°n aqu√≠ -->
                    </div>
                </div>
            </div>
        </div>

        <!-- ESTADO INICIAL (CUANDO NO HAY ESTRATEGIA SELECCIONADA) -->
        <div class="estado-inicial-expandido" id="estado-inicial">
            <div class="estado-inicial-contenido">
                <div class="ilustracion-estado">
                    <div class="circulo-ilustracion">
                        <i class="fas fa-chess-board"></i>
                    </div>
                </div>
                <div class="mensaje-estado">
                    <h3>¬°Comience a planificar sus estrategias!</h3>
                    <p class="descripcion-estado">
                        Seleccione una estrategia de la tabla superior para comenzar a desglosarla en t√°cticas espec√≠ficas y actividades operativas. 
                        Este sistema le permite transformar sus estrategias en planes de acci√≥n concretos.
                    </p>
                    <div class="caracteristicas-sistema">
                        <div class="caracteristica">
                            <div class="caracteristica-icono">
                                <i class="fas fa-mouse-pointer"></i>
                            </div>
                            <div class="caracteristica-texto">
                                <h4>Selecci√≥n Intuitiva</h4>
                                <p>Haga clic en cualquier estrategia para ver sus detalles completos</p>
                            </div>
                        </div>
                        <div class="caracteristica">
                            <div class="caracteristica-icono">
                                <i class="fas fa-plus-square"></i>
                            </div>
                            <div class="caracteristica-texto">
                                <h4>T√°cticas Detalladas</h4>
                                <p>Agregue t√°cticas espec√≠ficas con responsables, fechas y presupuestos</p>
                            </div>
                        </div>
                        <div class="caracteristica">
                            <div class="caracteristica-icono">
                                <i class="fas fa-tasks"></i>
                            </div>
                            <div class="caracteristica-texto">
                                <h4>Actividades Concretas</h4>
                                <p>Cada t√°ctica puede desglosarse en m√∫ltiples actividades medibles</p>
                            </div>
                        </div>
                        <div class="caracteristica">
                            <div class="caracteristica-icono">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <div class="caracteristica-texto">
                                <h4>Seguimiento Completo</h4>
                                <p>Monitoree el progreso, prioridades y estados de cada elemento</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- MODAL PARA AGREGAR ACTIVIDADES - TAMA√ëO COMPLETO -->
<div class="modal-completo" id="modal-actividad">
    <div class="modal-overlay-completo" onclick="cerrarModalActividad()"></div>
    <div class="modal-container-completo">
        <div class="modal-header-completo">
            <div class="modal-icono-completo">
                <i class="fas fa-tasks"></i>
            </div>
            <div class="modal-titulo-completo">
                <h3>Agregar Nueva Actividad</h3>
                <p class="modal-subtitulo">Acci√≥n espec√≠fica y medible dentro de la t√°ctica seleccionada</p>
            </div>
            <button class="modal-cerrar-completo" onclick="cerrarModalActividad()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="modal-body-completo">
            <div class="modal-grid-completo">
                <div class="modal-row-completo">
                    <div class="modal-group-completo">
                        <label for="actividad-nombre" class="modal-label-completo">
                            <i class="fas fa-heading"></i> Nombre de la Actividad
                            <span class="requerido">*</span>
                        </label>
                        <input type="text" id="actividad-nombre" class="modal-input-completo" 
                               placeholder="Describa el nombre espec√≠fico y completo de la actividad...">
                        <div class="modal-hint">Ej: "Contactar y contratar facilitadores certificados para capacitaci√≥n en primeros auxilios industriales"</div>
                    </div>
                </div>
                
                <div class="modal-row-completo">
                    <div class="modal-group-completo">
                        <label for="actividad-descripcion" class="modal-label-completo">
                            <i class="fas fa-align-left"></i> Descripci√≥n Detallada
                            <span class="requerido">*</span>
                        </label>
                        <textarea id="actividad-descripcion" class="modal-textarea-completo" rows="10" 
                                  placeholder="Describa paso a paso la actividad, incluyendo metodolog√≠a, procedimientos, recursos espec√≠ficos, criterios de calidad y resultados esperados..."></textarea>
                    </div>
                </div>
                
                <div class="modal-row-completo triple-columnas">
                    <div class="modal-group-completo">
                        <label for="actividad-responsable" class="modal-label-completo">
                            <i class="fas fa-user-check"></i> Responsable Directo
                        </label>
                        <input type="text" id="actividad-responsable" class="modal-input-completo" 
                               placeholder="Nombre del ejecutor principal, cargo, contacto...">
                    </div>
                    
                    <div class="modal-group-completo">
                        <label for="actividad-fecha-inicio" class="modal-label-completo">
                            <i class="fas fa-play-circle"></i> Inicio Planificado
                        </label>
                        <input type="date" id="actividad-fecha-inicio" class="modal-input-completo">
                    </div>
                    
                    <div class="modal-group-completo">
                        <label for="actividad-fecha-fin" class="modal-label-completo">
                            <i class="fas fa-flag-checkered"></i> Finalizaci√≥n Estimada
                        </label>
                        <input type="date" id="actividad-fecha-fin" class="modal-input-completo">
                    </div>
                </div>
                
                <div class="modal-row-completo">
                    <div class="modal-group-completo">
                        <label for="actividad-estado" class="modal-label-completo">
                            <i class="fas fa-chart-line"></i> Estado Actual
                        </label>
                        <select id="actividad-estado" class="modal-select-completo">
                            <option value="pendiente">üü° Pendiente - Por iniciar</option>
                            <option value="planificada">üìã Planificada - Preparativos en curso</option>
                            <option value="en_progreso">üîµ En Progreso - En ejecuci√≥n activa</option>
                            <option value="revision">üîÑ En Revisi√≥n - Evaluando resultados</option>
                            <option value="completada">üü¢ Completada - Finalizada con √©xito</option>
                            <option value="atrasada">üî¥ Atrasada - Requiere atenci√≥n urgente</option>
                            <option value="suspendida">‚è∏Ô∏è Suspendida - Pausada temporalmente</option>
                            <option value="cancelada">‚ùå Cancelada - No se realizar√°</option>
                        </select>
                    </div>
                    
                    <div class="modal-group-completo">
                        <label for="actividad-prioridad" class="modal-label-completo">
                            <i class="fas fa-exclamation-triangle"></i> Nivel de Prioridad
                        </label>
                        <select id="actividad-prioridad" class="modal-select-completo">
                            <option value="critica">üî¥ Cr√≠tica - Impacta directamente los objetivos</option>
                            <option value="alta">üü† Alta - Muy importante para el √©xito</option>
                            <option value="media" selected>üü° Media - Importante</option>
                            <option value="baja">üü¢ Baja - Complementaria</option>
                        </select>
                    </div>
                    
                    <div class="modal-group-completo">
                        <label for="actividad-dificultad" class="modal-label-completo">
                            <i class="fas fa-mountain"></i> Nivel de Dificultad
                        </label>
                        <select id="actividad-dificultad" class="modal-select-completo">
                            <option value="muy_facil">üü¢ Muy F√°cil - Poco esfuerzo requerido</option>
                            <option value="facil">üü° F√°cil - Esfuerzo moderado</option>
                            <option value="media" selected>üü† Media - Esfuerzo considerable</option>
                            <option value="dificil">üî¥ Dif√≠cil - Alto esfuerzo requerido</option>
                            <option value="muy_dificil">‚ö´ Muy Dif√≠cil - Esfuerzo significativo</option>
                        </select>
                    </div>
                </div>
                
                <div class="modal-row-completo">
                    <div class="modal-group-completo">
                        <label for="actividad-recursos" class="modal-label-completo">
                            <i class="fas fa-toolbox"></i> Recursos Requeridos
                        </label>
                        <textarea id="actividad-recursos" class="modal-textarea-completo" rows="6" 
                                  placeholder="Liste detalladamente todos los recursos necesarios:
‚Ä¢ Recursos humanos (personal, especialistas, consultores)
‚Ä¢ Recursos materiales (equipos, herramientas, suministros)
‚Ä¢ Recursos financieros (presupuesto espec√≠fico)
‚Ä¢ Recursos tecnol√≥gicos (software, hardware, plataformas)
‚Ä¢ Recursos log√≠sticos (transporte, alojamiento, alimentaci√≥n)
‚Ä¢ Recursos de infraestructura (espacios f√≠sicos, instalaciones)..."></textarea>
                    </div>
                </div>
                
                <div class="modal-row-completo">
                    <div class="modal-group-completo">
                        <label for="actividad-indicadores" class="modal-label-completo">
                            <i class="fas fa-chart-bar"></i> Indicadores de √âxito y M√©tricas
                        </label>
                        <textarea id="actividad-indicadores" class="modal-textarea-completo" rows="5" 
                                  placeholder="Defina los indicadores que medir√°n el √©xito de esta actividad:
‚Ä¢ M√©tricas cuantitativas (cantidades, porcentajes, tiempos)
‚Ä¢ M√©tricas cualitativas (calidad, satisfacci√≥n, percepci√≥n)
‚Ä¢ Criterios de aceptaci√≥n
‚Ä¢ Puntos de verificaci√≥n
‚Ä¢ M√©todos de evaluaci√≥n..."></textarea>
                    </div>
                </div>
                
                <div class="modal-row-completo">
                    <div class="modal-group-completo">
                        <label for="actividad-riesgos" class="modal-label-completo">
                            <i class="fas fa-exclamation-triangle"></i> Riesgos Identificados y Mitigaciones
                        </label>
                        <textarea id="actividad-riesgos" class="modal-textarea-completo" rows="5" 
                                  placeholder="Identifique posibles riesgos y sus planes de mitigaci√≥n:
‚Ä¢ Riesgos potenciales (t√©cnicos, operativos, financieros)
‚Ä¢ Probabilidad de ocurrencia
‚Ä¢ Impacto potencial
‚Ä¢ Planes de contingencia
‚Ä¢ Medidas preventivas..."></textarea>
                    </div>
                </div>
                
                <div class="modal-row-completo">
                    <div class="modal-group-completo">
                        <label for="actividad-colaboradores" class="modal-label-completo">
                            <i class="fas fa-users"></i> Equipo y Colaboradores
                        </label>
                        <textarea id="actividad-colaboradores" class="modal-textarea-completo" rows="4" 
                                  placeholder="Liste el equipo de trabajo y colaboradores involucrados:
‚Ä¢ Nombre y cargo de cada miembro
‚Ä¢ Responsabilidades espec√≠ficas
‚Ä¢ Horas/d√≠as comprometidos
‚Ä¢ Forma de coordinaci√≥n..."></textarea>
                    </div>
                </div>
                
                <div class="modal-row-completo">
                    <div class="modal-group-completo">
                        <label for="actividad-documentacion" class="modal-label-completo">
                            <i class="fas fa-file-alt"></i> Documentaci√≥n y Entregables
                        </label>
                        <textarea id="actividad-documentacion" class="modal-textarea-completo" rows="4" 
                                  placeholder="Especifique la documentaci√≥n requerida y entregables esperados:
‚Ä¢ Reportes a generar
‚Ä¢ Formatos a completar
‚Ä¢ Certificados requeridos
‚Ä¢ Archivos digitales
‚Ä¢ Evidencias f√≠sicas..."></textarea>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="modal-footer-completo">
            <button class="btn-modal-secundario" onclick="cerrarModalActividad()">
                <i class="fas fa-times"></i> Cancelar
            </button>
            <button class="btn-modal-guardar-borrador" onclick="guardarBorradorActividad()">
                <i class="fas fa-save"></i> Guardar Borrador
            </button>
            <button class="btn-modal-primario" onclick="guardarActividad()">
                <i class="fas fa-check-circle"></i> Guardar Actividad
            </button>
        </div>
    </div>
</div>

<style>
/* RESET Y CONFIGURACIONES BASE */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', sans-serif;
    background: #f8fafc;
}

.estrategias-fullscreen-expandido {
    width: 100%;
    min-height: 100vh;
    background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
    display: flex;
    flex-direction: column;
}

/* HEADER COMPLETO M√ÅS COMPACTO */
.header-completo {
    background: linear-gradient(135deg, #0c2461 0%, #1e3799 100%);
    color: white;
    padding: 15px 30px !important;
    box-shadow: 0 4px 15px rgba(12, 36, 97, 0.2);
    position: sticky;
    top: 0;
    z-index: 1000;
    backdrop-filter: blur(15px);
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    min-height: auto !important;
}

.header-titulo {
    margin-bottom: 15px !important;
}

.header-titulo h1 {
    font-size: 24px !important;
    font-weight: 700 !important;
    margin-bottom: 4px !important;
    display: flex;
    align-items: center;
    gap: 12px !important;
    background: linear-gradient(135deg, #ffffff 0%, #dbeafe 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.subtitulo {
    font-size: 13px !important;
    opacity: 0.85;
    margin-left: 40px !important;
    font-weight: 400;
    max-width: 600px;
    line-height: 1.4;
}

.estadisticas-globales {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
    gap: 12px !important;
    margin-top: 10px !important;
}

.estadistica-card {
    background: rgba(255, 255, 255, 0.12);
    backdrop-filter: blur(8px);
    border-radius: 10px !important;
    padding: 12px 15px !important;
    border: 1px solid rgba(255, 255, 255, 0.15);
    display: flex;
    align-items: center;
    gap: 12px !important;
    transition: all 0.2s ease;
    cursor: default;
    min-height: 60px !important;
}

.estadistica-card:hover {
    background: rgba(255, 255, 255, 0.18);
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.estadistica-icono {
    width: 40px !important;
    height: 40px !important;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 8px !important;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px !important;
    flex-shrink: 0;
}

.estadistica-content {
    flex: 1;
    min-width: 0;
}

.estadistica-valor {
    font-size: 22px !important;
    font-weight: 700 !important;
    display: block;
    line-height: 1;
    margin-bottom: 2px !important;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.estadistica-label {
    font-size: 11px !important;
    opacity: 0.85;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.3px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.btn-refresh-completo {
    width: 100%;
    padding: 10px 12px !important;
    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    color: white;
    border: none;
    border-radius: 8px !important;
    font-size: 12px !important;
    font-weight: 600;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px !important;
    transition: all 0.2s ease;
    box-shadow: 0 3px 10px rgba(16, 185, 129, 0.2);
    white-space: nowrap;
    min-height: 40px;
}

.btn-refresh-completo:hover {
    background: linear-gradient(135deg, #059669 0%, #10b981 100%);
    transform: translateY(-1px);
    box-shadow: 0 5px 15px rgba(16, 185, 129, 0.25);
}

/* CONTENEDOR PRINCIPAL */
.contenedor-principal-expandido {
    flex: 1;
    padding: 20px 30px !important;
    display: flex;
    flex-direction: column;
    gap: 20px !important;
    overflow-y: auto;
}

/* SECCI√ìN DE FILTROS EXPANDIDA */
.seccion-filtros-expandida {
    background: white;
    border-radius: 16px;
    padding: 25px;
    box-shadow: 0 8px 30px rgba(12, 36, 97, 0.1);
    border: 1px solid #e2e8f0;
}

.filtros-header {
    margin-bottom: 25px;
}

.filtros-header h3 {
    font-size: 20px;
    color: #0c2461;
    font-weight: 700;
    display: flex;
    align-items: center;
    gap: 15px;
}

.filtros-grid-expandido {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 20px;
}

.filtro-item-expandido {
    display: flex;
    flex-direction: column;
}

.filtro-item-expandido label {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 10px;
    font-weight: 600;
    color: #475569;
    font-size: 13px;
}

.filtro-item-expandido label i {
    color: #3b82f6;
    font-size: 14px;
}

.select-expandido, .input-expandido {
    width: 100%;
    padding: 14px 18px;
    border: 2px solid #e2e8f0;
    border-radius: 10px;
    font-size: 14px;
    background: white;
    color: #334155;
    transition: all 0.3s;
}

.select-expandido:focus, .input-expandido:focus {
    border-color: #3b82f6;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.15);
    outline: none;
}

.fecha-rango {
    display: flex;
    align-items: center;
    gap: 12px;
}

.fecha-input {
    flex: 1;
}

.separador-fecha {
    color: #94a3b8;
    font-weight: 600;
    font-size: 13px;
}

/* SECCI√ìN DE TABLA EXPANDIDA */
.seccion-tabla-expandida {
    background: white;
    border-radius: 16px;
    overflow: hidden;
    box-shadow: 0 8px 30px rgba(12, 36, 97, 0.1);
    border: 1px solid #e2e8f0;
    display: flex;
    flex-direction: column;
    min-height: 450px;
    max-height: 600px;
}

.tabla-header-expandido {
    padding: 20px 25px;
    border-bottom: 1px solid #f1f5f9;
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
}

.tabla-titulo h2 {
    font-size: 22px;
    color: #0c2461;
    font-weight: 700;
    display: flex;
    align-items: center;
    gap: 15px;
    margin-bottom: 6px;
}

.tabla-subtitulo {
    color: #64748b;
    font-size: 14px;
    margin-left: 38px;
}

.tabla-controles {
    display: flex;
    align-items: center;
    gap: 20px;
}

.resultados-info {
    font-size: 13px;
    color: #475569;
    font-weight: 500;
    padding: 8px 16px;
    background: white;
    border-radius: 10px;
    border: 1px solid #e2e8f0;
}

.btn-exportar {
    padding: 10px 20px;
    background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
    color: white;
    border: none;
    border-radius: 10px;
    font-size: 13px;
    font-weight: 600;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: all 0.3s;
}

.btn-exportar:hover {
    background: linear-gradient(135deg, #1d4ed8 0%, #3b82f6 100%);
    transform: translateY(-1px);
    box-shadow: 0 5px 15px rgba(59, 130, 246, 0.2);
}

.tabla-contenedor-expandido {
    flex: 1;
    overflow-y: auto;
    padding: 0;
}

.tabla-estrategias-expandida {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0;
    font-size: 13px;
}

.tabla-estrategias-expandida thead {
    background: linear-gradient(135deg, #0c2461 0%, #1e3799 100%);
    color: white;
    position: sticky;
    top: 0;
    z-index: 100;
}

.tabla-estrategias-expandida th {
    padding: 16px 20px;
    text-align: left;
    font-weight: 600;
    font-size: 12px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    border-bottom: none;
}

.tabla-estrategias-expandida tbody tr {
    border-bottom: 1px solid #f1f5f9;
    transition: all 0.3s;
    cursor: pointer;
    height: 75px;
}

.tabla-estrategias-expandida tbody tr:hover {
    background: linear-gradient(90deg, rgba(12, 36, 97, 0.05) 0%, rgba(12, 36, 97, 0.02) 100%);
    transform: translateX(3px);
}

.tabla-estrategias-expandida tbody tr.selected {
    background: linear-gradient(90deg, rgba(12, 36, 97, 0.1) 0%, rgba(12, 36, 97, 0.05) 100%);
    border-left: 4px solid #0c2461;
}

.tabla-estrategias-expandida td {
    padding: 18px 20px;
    vertical-align: middle;
    border-bottom: 1px solid #f1f5f9;
    color: #334155;
}

.tabla-estrategias-expandida td:nth-child(3) {
    line-height: 1.6;
    max-height: 75px;
    overflow: hidden;
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    font-size: 14px;
}

.badge-eje-tabla {
    display: inline-block;
    padding: 8px 16px;
    border-radius: 16px;
    font-size: 12px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.3px;
    background: #f8fafc;
    border: 2px solid #e2e8f0;
    color: #475569;
    min-width: 140px;
    text-align: center;
}

.badge-tipo-tabla {
    display: inline-block;
    padding: 8px 16px;
    border-radius: 16px;
    font-size: 12px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: white;
    min-width: 50px;
    text-align: center;
}

.contador-tacticas-tabla {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 32px;
    height: 32px;
    background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
    color: white;
    border-radius: 50%;
    font-size: 13px;
    font-weight: 700;
    margin: 0 auto;
}

.tabla-footer {
    padding: 18px 25px;
    border-top: 1px solid #f1f5f9;
    background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
    display: flex;
    justify-content: center;
}

.paginacion {
    display: flex;
    align-items: center;
    gap: 20px;
}

.btn-pagina {
    padding: 10px 20px;
    background: white;
    border: 2px solid #e2e8f0;
    border-radius: 10px;
    color: #475569;
    font-size: 13px;
    font-weight: 600;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: all 0.3s;
}

.btn-pagina:hover {
    background: #f1f5f9;
    border-color: #cbd5e1;
}

.pagina-actual {
    font-size: 13px;
    color: #475569;
    font-weight: 600;
    padding: 8px 16px;
    background: white;
    border-radius: 10px;
    border: 1px solid #e2e8f0;
}

/* SECCI√ìN DE DETALLE EXPANDIDA */
.seccion-detalle-expandida {
    background: white;
    border-radius: 16px;
    overflow: hidden;
    box-shadow: 0 8px 30px rgba(12, 36, 97, 0.1);
    border: 1px solid #e2e8f0;
    display: flex;
    flex-direction: column;
}

.detalle-header-expandido {
    padding: 20px 25px;
    border-bottom: 1px solid #f1f5f9;
    background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.detalle-titulo-completo h2 {
    font-size: 22px;
    color: #0c2461;
    font-weight: 700;
    display: flex;
    align-items: center;
    gap: 15px;
    margin-bottom: 12px;
}

.estrategia-seleccionada-info {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.estrategia-header-completo {
    display: flex;
    align-items: center;
    gap: 18px;
}

.estrategia-eje {
    font-size: 18px;
    font-weight: 700;
    color: #0c2461;
}

.estrategia-tipo-badge {
    padding: 6px 16px;
    border-radius: 16px;
    font-size: 13px;
    font-weight: 700;
    text-transform: uppercase;
    color: white;
    letter-spacing: 0.5px;
}

.estrategia-metadata-completo {
    display: flex;
    gap: 15px;
}

.metadata-item {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 6px 14px;
    background: white;
    border-radius: 10px;
    border: 1px solid #e2e8f0;
    font-size: 13px;
    color: #475569;
    font-weight: 500;
}

.metadata-item i {
    color: #3b82f6;
}

.detalle-acciones {
    display: flex;
    gap: 12px;
}

.btn-imprimir, .btn-compartir {
    padding: 10px 20px;
    border: 2px solid #e2e8f0;
    border-radius: 10px;
    background: white;
    color: #475569;
    font-size: 13px;
    font-weight: 600;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: all 0.3s;
}

.btn-imprimir:hover, .btn-compartir:hover {
    background: #f1f5f9;
    border-color: #cbd5e1;
}

/* CONTENIDO DEL DETALLE */
.detalle-contenido-expandido {
    padding: 25px;
    display: flex;
    flex-direction: column;
    gap: 25px;
}

/* TEXTO DE ESTRATEGIA */
.estrategia-texto-completo {
    background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
    border-radius: 14px;
    padding: 20px;
    border: 2px solid #e2e8f0;
}

.estrategia-texto-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16px;
}

.estrategia-texto-header h3 {
    font-size: 16px;
    color: #0c2461;
    font-weight: 700;
    display: flex;
    align-items: center;
    gap: 10px;
}

.contador-caracteres {
    font-size: 12px;
    color: #64748b;
    font-weight: 600;
    padding: 5px 10px;
    background: white;
    border-radius: 16px;
    border: 1px solid #e2e8f0;
}

.estrategia-texto-body {
    color: #334155;
    font-size: 15px;
    line-height: 1.7;
    white-space: pre-wrap;
    word-wrap: break-word;
    max-height: 350px;
    overflow-y: auto;
    padding: 18px;
    background: white;
    border-radius: 10px;
    border: 1px solid #e2e8f0;
}

/* FORMULARIO DE T√ÅCTICA COMPLETO */
.formulario-tactica-completo {
    background: white;
    border-radius: 14px;
    padding: 25px;
    border: 2px solid #e2e8f0;
    transition: all 0.3s;
}

.formulario-tactica-completo:hover {
    border-color: #dbeafe;
    box-shadow: 0 12px 40px rgba(12, 36, 97, 0.08);
}

.form-header-completo {
    margin-bottom: 25px;
}

.form-header-completo h3 {
    font-size: 20px;
    color: #0c2461;
    font-weight: 700;
    margin-bottom: 6px;
    display: flex;
    align-items: center;
    gap: 15px;
}

.form-subtitle {
    color: #64748b;
    font-size: 14px;
    margin: 0;
    line-height: 1.6;
}

.form-grid-completo {
    display: flex;
    flex-direction: column;
    gap: 25px;
    margin-bottom: 25px;
}

.form-row-completo {
    display: flex;
    flex-direction: column;
    gap: 25px;
}

.form-row-completo.triple-columnas {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 25px;
}

@media (max-width: 1200px) {
    .form-row-completo.triple-columnas {
        grid-template-columns: 1fr;
    }
}

.form-group-completo {
    display: flex;
    flex-direction: column;
    flex: 1;
}

.form-label-completo {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 10px;
    font-weight: 700;
    color: #475569;
    font-size: 14px;
}

.form-label-completo i {
    color: #3b82f6;
    font-size: 15px;
}

.requerido {
    color: #ef4444;
    font-weight: 700;
    margin-left: 5px;
}

.form-input-completo, .form-textarea-completo, .form-select-completo {
    padding: 16px 20px;
    border: 2px solid #e2e8f0;
    border-radius: 10px;
    font-size: 15px;
    transition: all 0.3s;
    background: white;
    font-family: inherit;
    width: 100%;
}

.form-input-completo:focus, .form-textarea-completo:focus, .form-select-completo:focus {
    border-color: #3b82f6;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
    outline: none;
}

.form-textarea-completo {
    resize: vertical;
    min-height: 180px;
    line-height: 1.6;
}

.form-hint {
    font-size: 12px;
    color: #94a3b8;
    margin-top: 6px;
    font-style: italic;
    line-height: 1.5;
}

.presupuesto-input {
    display: flex;
    align-items: center;
    gap: 8px;
}

.presupuesto-prefijo {
    color: #475569;
    font-weight: 600;
    font-size: 15px;
}

.moneda-select {
    padding: 16px 20px;
    border: 2px solid #e2e8f0;
    border-radius: 10px;
    font-size: 15px;
    background: white;
    color: #334155;
    font-weight: 500;
    min-width: 90px;
}

.form-actions-completo {
    display: flex;
    gap: 16px;
    justify-content: flex-end;
}

.btn-limpiar {
    padding: 14px 24px;
    background: #f1f5f9;
    border: 2px solid #e2e8f0;
    border-radius: 10px;
    color: #475569;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: all 0.3s;
}

.btn-limpiar:hover {
    background: #e2e8f0;
}

.btn-agregar-tactica-completo {
    padding: 16px 28px;
    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    color: white;
    border: none;
    border-radius: 10px;
    font-size: 15px;
    font-weight: 700;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    transition: all 0.3s;
    box-shadow: 0 6px 20px rgba(16, 185, 129, 0.2);
    min-width: 280px;
}

.btn-agregar-tactica-completo:hover {
    background: linear-gradient(135deg, #059669 0%, #10b981 100%);
    transform: translateY(-2px);
    box-shadow: 0 10px 25px rgba(16, 185, 129, 0.3);
}

/* LISTA DE T√ÅCTICAS COMPLETA */
.lista-tacticas-completa {
    flex: 1;
    display: flex;
    flex-direction: column;
    min-height: 450px;
}

.lista-header-completo {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding-bottom: 18px;
    border-bottom: 2px solid #f1f5f9;
}

.lista-header-completo h3 {
    font-size: 20px;
    color: #0c2461;
    font-weight: 700;
    display: flex;
    align-items: center;
    gap: 15px;
}

.lista-controles {
    display: flex;
    align-items: center;
    gap: 20px;
}

.filtros-tacticas {
    display: flex;
    gap: 8px;
}

.btn-filtro-tactica {
    padding: 8px 16px;
    background: #f1f5f9;
    border: 2px solid #e2e8f0;
    border-radius: 8px;
    color: #64748b;
    font-size: 12px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
    white-space: nowrap;
}

.btn-filtro-tactica:hover {
    background: #e2e8f0;
}

.btn-filtro-tactica.activo {
    background: #0c2461;
    border-color: #0c2461;
    color: white;
}

.orden-tacticas select {
    padding: 8px 16px;
    border: 2px solid #e2e8f0;
    border-radius: 8px;
    background: white;
    color: #475569;
    font-size: 12px;
    font-weight: 600;
    cursor: pointer;
}

.tacticas-contenedor-completo {
    flex: 1;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 20px;
    padding-right: 8px;
}

/* T√ÅCTICA INDIVIDUAL */
.tactica-item-completo {
    background: white;
    border-radius: 14px;
    padding: 20px;
    border: 2px solid #e2e8f0;
    transition: all 0.3s;
}

.tactica-item-completo:hover {
    border-color: #dbeafe;
    box-shadow: 0 8px 25px rgba(12, 36, 97, 0.1);
}

.tactica-header-completo {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 16px;
}

.tactica-titulo-completo {
    font-size: 18px;
    font-weight: 700;
    color: #0c2461;
    margin: 0;
    flex: 1;
    line-height: 1.5;
}

.tactica-acciones-completo {
    display: flex;
    gap: 10px;
}

.btn-agregar-actividad-completo,
.btn-editar-tactica-completo,
.btn-eliminar-tactica-completo,
.btn-expandir-tactica-completo {
    padding: 10px 16px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: 13px;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 6px;
    transition: all 0.3s;
}

.btn-agregar-actividad-completo {
    background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
    color: white;
}

.btn-agregar-actividad-completo:hover {
    background: linear-gradient(135deg, #1d4ed8 0%, #3b82f6 100%);
    transform: scale(1.05);
}

.btn-editar-tactica-completo {
    background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
    color: white;
}

.btn-editar-tactica-completo:hover {
    background: linear-gradient(135deg, #d97706 0%, #f59e0b 100%);
    transform: scale(1.05);
}

.btn-eliminar-tactica-completo {
    background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
    color: white;
}

.btn-eliminar-tactica-completo:hover {
    background: linear-gradient(135deg, #dc2626 0%, #ef4444 100%);
    transform: scale(1.05);
}

.btn-expandir-tactica-completo {
    background: #f1f5f9;
    color: #475569;
    border: 2px solid #e2e8f0;
}

.btn-expandir-tactica-completo:hover {
    background: #e2e8f0;
}

.tactica-detalle-completo {
    color: #64748b;
    font-size: 15px;
    line-height: 1.7;
    margin: 16px 0;
    padding: 18px;
    background: #f8fafc;
    border-radius: 10px;
    border-left: 6px solid #3b82f6;
    max-height: 200px;
    overflow-y: auto;
}

.tactica-metadata-completo {
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    margin-bottom: 16px;
}

.metadata-item-tactica {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 13px;
    color: #475569;
    padding: 6px 14px;
    background: #f1f5f9;
    border-radius: 16px;
    min-height: 32px;
}

.metadata-item-tactica i {
    color: #64748b;
    font-size: 13px;
}

.lista-actividades-completo {
    margin-top: 16px;
    max-height: 400px;
    overflow-y: auto;
    border-top: 2px solid #f1f5f9;
    padding-top: 16px;
}

/* ACTIVIDADES */
.actividad-item-completo {
    background: white;
    border-radius: 10px;
    padding: 16px;
    margin-bottom: 12px;
    border-left: 6px solid #10b981;
    border: 2px solid #e2e8f0;
    display: grid;
    grid-template-columns: 1fr auto;
    gap: 20px;
    align-items: start;
    transition: all 0.3s;
}

.actividad-item-completo:hover {
    transform: translateX(3px);
    border-color: #d1fae5;
}

.actividad-info-completo {
    flex: 1;
}

.actividad-info-completo h4 {
    margin: 0 0 10px 0;
    font-size: 16px;
    color: #334155;
    font-weight: 700;
    line-height: 1.4;
}

.actividad-info-completo p {
    margin: 0 0 12px 0;
    color: #64748b;
    font-size: 14px;
    line-height: 1.6;
}

.actividad-detalles-completo {
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
    font-size: 12px;
    color: #94a3b8;
}

.actividad-estado-completo {
    padding: 8px 16px;
    border-radius: 16px;
    font-size: 11px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    min-width: 120px;
    text-align: center;
    height: fit-content;
}

.actividad-estado-completo.pendiente {
    background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
    color: #78350f;
}

.actividad-estado-completo.planificada {
    background: linear-gradient(135deg, #60a5fa 0%, #3b82f6 100%);
    color: white;
}

.actividad-estado-completo.en_progreso {
    background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
    color: white;
}

.actividad-estado-completo.revision {
    background: linear-gradient(135deg, #f472b6 0%, #db2777 100%);
    color: white;
}

.actividad-estado-completo.completada {
    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    color: white;
}

.actividad-estado-completo.atrasada {
    background: linear-gradient(135deg, #f87171 0%, #ef4444 100%);
    color: white;
}

.actividad-estado-completo.suspendida {
    background: linear-gradient(135deg, #94a3b8 0%, #64748b 100%);
    color: white;
}

.actividad-estado-completo.cancelada {
    background: linear-gradient(135deg, #475569 0%, #334155 100%);
    color: white;
}

.contador-actividades-completo {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-width: 28px;
    height: 28px;
    background: #3b82f6;
    color: white;
    border-radius: 50%;
    font-size: 13px;
    font-weight: 700;
    margin-left: 10px;
}

/* ESTADO INICIAL EXPANDIDO */
.estado-inicial-expandido {
    background: white;
    border-radius: 16px;
    padding: 40px 25px;
    text-align: center;
    box-shadow: 0 8px 30px rgba(12, 36, 97, 0.1);
    border: 2px dashed #e2e8f0;
    margin-top: 16px;
}

.estado-inicial-contenido {
    max-width: 1000px;
    margin: 0 auto;
}

.ilustracion-estado {
    margin-bottom: 30px;
}

.circulo-ilustracion {
    width: 120px;
    height: 120px;
    background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto;
}

.circulo-ilustracion i {
    font-size: 60px;
    color: #94a3b8;
}

.mensaje-estado h3 {
    color: #0c2461;
    font-size: 28px;
    margin-bottom: 16px;
    font-weight: 700;
}

.descripcion-estado {
    color: #64748b;
    font-size: 16px;
    line-height: 1.7;
    max-width: 700px;
    margin: 0 auto 40px;
}

.caracteristicas-sistema {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 25px;
    max-width: 900px;
    margin: 0 auto;
}

.caracteristica {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    padding: 20px;
    background: #f8fafc;
    border-radius: 14px;
    border: 1px solid #e2e8f0;
    transition: all 0.3s;
}

.caracteristica:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 25px rgba(12, 36, 97, 0.1);
    border-color: #dbeafe;
}

.caracteristica-icono {
    width: 60px;
    height: 60px;
    background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 16px;
}

.caracteristica-icono i {
    font-size: 26px;
    color: white;
}

.caracteristica-texto h4 {
    color: #0c2461;
    font-size: 16px;
    margin-bottom: 8px;
    font-weight: 700;
}

.caracteristica-texto p {
    color: #64748b;
    font-size: 13px;
    line-height: 1.6;
}

/* MODAL COMPLETO */
.modal-completo {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: 5000;
}

.modal-completo.active {
    display: block;
}

.modal-overlay-completo {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(12, 36, 97, 0.9);
    backdrop-filter: blur(15px);
}

.modal-container-completo {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: white;
    border-radius: 16px;
    width: 95%;
    max-width: 1100px;
    max-height: 90vh;
    overflow: hidden;
    box-shadow: 0 30px 60px rgba(12, 36, 97, 0.4);
    animation: modalEntrada 0.4s cubic-bezier(0.16, 1, 0.3, 1);
}

@keyframes modalEntrada {
    from {
        opacity: 0;
        transform: translate(-50%, -60%);
    }
    to {
        opacity: 1;
        transform: translate(-50%, -50%);
    }
}

.modal-header-completo {
    padding: 25px;
    border-bottom: 1px solid #f1f5f9;
    display: flex;
    align-items: center;
    gap: 20px;
    background: linear-gradient(135deg, #0c2461 0%, #1e3799 100%);
    color: white;
}

.modal-icono-completo {
    width: 60px;
    height: 60px;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 14px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 26px;
}

.modal-titulo-completo h3 {
    margin: 0 0 8px 0;
    font-size: 24px;
    font-weight: 700;
}

.modal-subtitulo {
    margin: 0;
    font-size: 14px;
    opacity: 0.9;
}

.modal-cerrar-completo {
    margin-left: auto;
    background: rgba(255, 255, 255, 0.2);
    border: none;
    color: white;
    width: 45px;
    height: 45px;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    transition: all 0.3s;
}

.modal-cerrar-completo:hover {
    background: rgba(255, 255, 255, 0.3);
    transform: rotate(90deg);
}

.modal-body-completo {
    padding: 25px;
    max-height: calc(90vh - 160px);
    overflow-y: auto;
}

.modal-grid-completo {
    display: flex;
    flex-direction: column;
    gap: 25px;
}

.modal-row-completo {
    display: flex;
    flex-direction: column;
    gap: 25px;
}

.modal-row-completo.triple-columnas {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 25px;
}

@media (max-width: 1200px) {
    .modal-row-completo.triple-columnas {
        grid-template-columns: 1fr;
    }
}

.modal-group-completo {
    display: flex;
    flex-direction: column;
    flex: 1;
}

.modal-label-completo {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 12px;
    font-weight: 700;
    color: #475569;
    font-size: 15px;
}

.modal-label-completo i {
    color: #3b82f6;
    font-size: 16px;
}

.modal-input-completo, .modal-textarea-completo, .modal-select-completo {
    padding: 16px 20px;
    border: 2px solid #e2e8f0;
    border-radius: 10px;
    font-size: 15px;
    transition: all 0.3s;
    background: white;
    font-family: inherit;
    width: 100%;
}

.modal-input-completo:focus, .modal-textarea-completo:focus, .modal-select-completo:focus {
    border-color: #3b82f6;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
    outline: none;
}

.modal-textarea-completo {
    resize: vertical;
    min-height: 100px;
    line-height: 1.6;
}

.modal-hint {
    font-size: 12px;
    color: #94a3b8;
    margin-top: 8px;
    font-style: italic;
    line-height: 1.5;
}

.modal-footer-completo {
    padding: 20px 25px;
    border-top: 1px solid #f1f5f9;
    display: flex;
    gap: 12px;
    justify-content: flex-end;
}

.btn-modal-secundario, .btn-modal-guardar-borrador, .btn-modal-primario {
    padding: 14px 24px;
    border: none;
    border-radius: 10px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 10px;
    transition: all 0.3s;
}

.btn-modal-secundario {
    background: #f1f5f9;
    color: #475569;
    border: 2px solid #e2e8f0;
}

.btn-modal-secundario:hover {
    background: #e2e8f0;
}

.btn-modal-guardar-borrador {
    background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
    color: white;
}

.btn-modal-guardar-borrador:hover {
    background: linear-gradient(135deg, #d97706 0%, #f59e0b 100%);
    transform: translateY(-1px);
}

.btn-modal-primario {
    background: linear-gradient(135deg, #0c2461 0%, #1e3799 100%);
    color: white;
}

.btn-modal-primario:hover {
    background: linear-gradient(135deg, #1e3799 0%, #0c2461 100%);
    transform: translateY(-1px);
    box-shadow: 0 6px 20px rgba(12, 36, 97, 0.2);
}

/* SCROLLBARS PERSONALIZADOS */
.tabla-contenedor-expandido::-webkit-scrollbar,
.tacticas-contenedor-completo::-webkit-scrollbar,
.lista-actividades-completo::-webkit-scrollbar,
.estrategia-texto-body::-webkit-scrollbar,
.modal-body-completo::-webkit-scrollbar {
    width: 10px;
}

.tabla-contenedor-expandido::-webkit-scrollbar-track,
.tacticas-contenedor-completo::-webkit-scrollbar-track,
.lista-actividades-completo::-webkit-scrollbar-track,
.estrategia-texto-body::-webkit-scrollbar-track,
.modal-body-completo::-webkit-scrollbar-track {
    background: #f1f5f9;
    border-radius: 5px;
}

.tabla-contenedor-expandido::-webkit-scrollbar-thumb,
.tacticas-contenedor-completo::-webkit-scrollbar-thumb,
.lista-actividades-completo::-webkit-scrollbar-thumb,
.estrategia-texto-body::-webkit-scrollbar-thumb,
.modal-body-completo::-webkit-scrollbar-thumb {
    background: #cbd5e1;
    border-radius: 5px;
}

.tabla-contenedor-expandido::-webkit-scrollbar-thumb:hover,
.tacticas-contenedor-completo::-webkit-scrollbar-thumb:hover,
.lista-actividades-completo::-webkit-scrollbar-thumb:hover,
.estrategia-texto-body::-webkit-scrollbar-thumb:hover,
.modal-body-completo::-webkit-scrollbar-thumb:hover {
    background: #94a3b8;
}

/* RESPONSIVE */
@media (max-width: 1400px) {
    .header-completo {
        padding: 12px 20px !important;
    }
    
    .header-titulo h1 {
        font-size: 20px !important;
        gap: 10px !important;
    }
    
    .subtitulo {
        font-size: 12px !important;
        margin-left: 32px !important;
    }
    
    .estadisticas-globales {
        grid-template-columns: repeat(3, 1fr);
        gap: 10px !important;
    }
    
    .estadistica-card {
        padding: 10px 12px !important;
        min-height: 55px !important;
    }
    
    .estadistica-icono {
        width: 36px !important;
        height: 36px !important;
        font-size: 16px !important;
    }
    
    .estadistica-valor {
        font-size: 20px !important;
    }
    
    .estadistica-label {
        font-size: 10px !important;
    }
    
    .contenedor-principal-expandido {
        padding: 16px 20px !important;
    }
}

@media (max-width: 1200px) {
    .estadisticas-globales {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .filtros-grid-expandido {
        grid-template-columns: 1fr;
    }
    
    .tabla-header-expandido {
        flex-direction: column;
        align-items: flex-start;
        gap: 16px;
    }
    
    .tabla-controles {
        width: 100%;
        justify-content: space-between;
    }
    
    .detalle-header-expandido {
        flex-direction: column;
        align-items: flex-start;
        gap: 16px;
    }
    
    .detalle-acciones {
        width: 100%;
        justify-content: flex-end;
    }
    
    .lista-header-completo {
        flex-direction: column;
        align-items: flex-start;
        gap: 16px;
    }
    
    .lista-controles {
        width: 100%;
        justify-content: space-between;
    }
}

@media (max-width: 768px) {
    .header-completo {
        padding: 10px 15px !important;
    }
    
    .header-titulo h1 {
        font-size: 18px !important;
        gap: 8px !important;
    }
    
    .subtitulo {
        font-size: 11px !important;
        margin-left: 28px !important;
    }
    
    .estadisticas-globales {
        grid-template-columns: 1fr;
        gap: 8px !important;
    }
    
    .estadistica-card {
        padding: 8px 10px !important;
        min-height: 50px !important;
    }
    
    .estadistica-icono {
        width: 32px !important;
        height: 32px !important;
        font-size: 14px !important;
    }
    
    .estadistica-valor {
        font-size: 18px !important;
    }
    
    .estadistica-label {
        font-size: 9px !important;
    }
    
    .btn-refresh-completo {
        font-size: 11px !important;
        padding: 8px 10px !important;
        min-height: 35px;
    }
    
    .contenedor-principal-expandido {
        padding: 12px 15px !important;
        gap: 16px !important;
    }
    
    .seccion-filtros-expandida {
        padding: 16px;
    }
    
    .filtros-header h3 {
        font-size: 18px;
    }
    
    .seccion-tabla-expandida {
        max-height: 450px;
    }
    
    .tabla-header-expandido {
        padding: 12px 16px;
    }
    
    .tabla-titulo h2 {
        font-size: 18px;
    }
    
    .tabla-controles {
        flex-direction: column;
        gap: 12px;
    }
    
    .resultados-info {
        width: 100%;
        text-align: center;
    }
    
    .modal-container-completo {
        width: 98%;
        border-radius: 14px;
    }
    
    .modal-header-completo {
        padding: 16px;
        flex-direction: column;
        text-align: center;
        gap: 12px;
    }
    
    .modal-cerrar-completo {
        position: absolute;
        top: 16px;
        right: 16px;
    }
    
    .modal-footer-completo {
        flex-direction: column;
    }
    
    .btn-modal-secundario, .btn-modal-guardar-borrador, .btn-modal-primario {
        width: 100%;
        justify-content: center;
    }
    
    .tactica-header-completo {
        flex-direction: column;
        gap: 12px;
    }
    
    .tactica-acciones-completo {
        width: 100%;
        justify-content: flex-start;
    }
}

/* ANIMACIONES */
@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.tactica-item-completo {
    animation: fadeInUp 0.4s ease forwards;
}

.actividad-item-completo {
    animation: fadeInUp 0.3s ease forwards;
}

/* ESTADOS DE EXPANSI√ìN */
.tactica-item-completo.expanded .tactica-detalle-completo {
    max-height: none;
}

.tactica-item-completo.expanded .lista-actividades-completo {
    max-height: none;
}

/* BOT√ìN EXPANDIR */
.btn-expandir-tactica-completo {
    background: none;
    border: none;
    color: #64748b;
    cursor: pointer;
    padding: 8px;
    font-size: 12px;
    display: flex;
    align-items: center;
    gap: 6px;
    margin-top: 8px;
    font-weight: 600;
}

.btn-expandir-tactica-completo:hover {
    color: #0c2461;
}

/* Para pantallas muy grandes, mantener compacto pero ajustar */
@media (min-width: 1920px) {
    .estadisticas-globales {
        grid-template-columns: repeat(6, 1fr);
    }
}
</style>

<script>
// Variables globales
let estrategias = [];
let estrategiasUnicas = [];
let estrategiaSeleccionadaId = null;
let tacticaActualParaActividad = null;
let tacticas = {};
let actividadesCache = {};
let paginaActual = 1;
const estrategiasPorPagina = 20;
let estadisticasGlobales = {
    totalTacticas: 0,
    totalActividades: 0,
    totalResponsables: 0
};

// Mapeo de ejes
const mapEjes = {
    'educacion': 'üéì Educaci√≥n y Capacitaci√≥n',
    'salud': 'üè• Salud y Bienestar',
    'empleabilidad': 'üíº Empleabilidad y Desarrollo Laboral',
    'desarrollo_economico': 'üìà Desarrollo Econ√≥mico Sostenible',
    'sostenibilidad_ambiental': 'üíß Sostenibilidad Ambiental',
    'comunicacion': 'üì¢ Comunicaci√≥n y Relaciones P√∫blicas',
    'institucional': 'üèõÔ∏è Fortalecimiento Institucional'
};

// Colores para tipos de estrategia
const tipoColors = {
    'FO': '#2ecc71',
    'DO': '#3498db',
    'FA': '#e67e22',
    'DA': '#9b59b6'
};

// Inicializar al cargar
document.addEventListener('DOMContentLoaded', function() {
    cargarEstrategias();
    configurarEventListeners();
    configurarFiltrosTacticas();
    
    // Mostrar estado inicial
    mostrarEstadoInicial();
});

// Configurar event listeners
function configurarEventListeners() {
    // Textareas auto-expansibles
    document.querySelectorAll('.form-textarea-completo, .modal-textarea-completo').forEach(textarea => {
        textarea.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = (this.scrollHeight) + 'px';
        });
        
        // Ajustar altura inicial
        setTimeout(() => {
            this.style.height = 'auto';
            this.style.height = (this.scrollHeight) + 'px';
        }, 100);
    });
    
    // Buscar en tiempo real
    document.getElementById('buscar-estrategia').addEventListener('input', buscarEstrategias);
    
    // Configurar fecha m√≠nima para fecha fin
    document.getElementById('tactica-fecha-inicio').addEventListener('change', function() {
        document.getElementById('tactica-fecha-fin').min = this.value;
    });
    
    document.getElementById('actividad-fecha-inicio').addEventListener('change', function() {
        document.getElementById('actividad-fecha-fin').min = this.value;
    });
}

// Configurar filtros de t√°cticas
function configurarFiltrosTacticas() {
    document.querySelectorAll('.btn-filtro-tactica').forEach(btn => {
        btn.addEventListener('click', function() {
            document.querySelectorAll('.btn-filtro-tactica').forEach(b => b.classList.remove('activo'));
            this.classList.add('activo');
            filtrarTacticas(this.dataset.filtro);
        });
    });
}

// Mostrar estado inicial
function mostrarEstadoInicial() {
    document.getElementById('estado-inicial').style.display = 'block';
    document.getElementById('seccion-detalle').style.display = 'none';
}

// Cargar estrategias
function cargarEstrategias() {
    const btnRefresh = document.querySelector('.btn-refresh-completo');
    const originalHTML = btnRefresh.innerHTML;
    btnRefresh.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Cargando...';
    btnRefresh.disabled = true;

    fetch('/api/estrategias_foda_con_eje')
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                estrategias = data.estrategias;
                procesarEstrategiasUnicas();
                actualizarTablaEstrategias();
                actualizarEstadisticas();
                cargarEstadisticasGlobales();
                mostrarNotificacion('‚úÖ Estrategias cargadas correctamente', 'success');
            } else {
                mostrarNotificacion('‚ùå Error al cargar estrategias', 'error');
            }
            
            btnRefresh.innerHTML = originalHTML;
            btnRefresh.disabled = false;
        })
        .catch(error => {
            console.error('Error:', error);
            mostrarNotificacion('‚ùå Error de conexi√≥n al servidor', 'error');
            btnRefresh.innerHTML = originalHTML;
            btnRefresh.disabled = false;
        });
}

// Procesar estrategias √∫nicas
function procesarEstrategiasUnicas() {
    const estrategiasMap = new Map();
    
    estrategias.forEach(estrategia => {
        const clave = `${estrategia.eje_id}_${estrategia.tipo_cruce}_${estrategia.estrategia}`;
        
        if (!estrategiasMap.has(clave)) {
            estrategiasMap.set(clave, {
                ...estrategia,
                ids_relacionados: [estrategia.id],
                elementos_internos: [{
                    id: estrategia.elemento_interno_id,
                    tipo: estrategia.elemento_interno_tipo,
                    texto: estrategia.elemento_interno_texto
                }],
                elementos_externos: [{
                    id: estrategia.elemento_externo_id,
                    tipo: estrategia.elemento_externo_tipo,
                    texto: estrategia.elemento_externo_texto
                }]
            });
        } else {
            const existente = estrategiasMap.get(clave);
            existente.ids_relacionados.push(estrategia.id);
            
            const internoExiste = existente.elementos_internos.some(
                e => e.id === estrategia.elemento_interno_id
            );
            if (!internoExiste) {
                existente.elementos_internos.push({
                    id: estrategia.elemento_interno_id,
                    tipo: estrategia.elemento_interno_tipo,
                    texto: estrategia.elemento_interno_texto
                });
            }
            
            const externoExiste = existente.elementos_externos.some(
                e => e.id === estrategia.elemento_externo_id
            );
            if (!externoExiste) {
                existente.elementos_externos.push({
                    id: estrategia.elemento_externo_id,
                    tipo: estrategia.elemento_externo_tipo,
                    texto: estrategia.elemento_externo_texto
                });
            }
        }
    });
    
    estrategiasUnicas = Array.from(estrategiasMap.values());
}

// Cargar estad√≠sticas globales
function cargarEstadisticasGlobales() {
    let totalTacticas = 0;
    let totalActividades = 0;
    let responsablesSet = new Set();
    
    // Cargar t√°cticas de todas las estrategias
    const promesas = estrategiasUnicas.map(estrategia => {
        return fetch(`/api/actividades_estrategia/${estrategia.ids_relacionados[0]}`)
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    totalTacticas += data.actividades.length;
                    
                    // Agregar responsables
                    data.actividades.forEach(tactica => {
                        if (tactica.responsable) {
                            responsablesSet.add(tactica.responsable.trim().toLowerCase());
                        }
                    });
                    
                    // Contar actividades
                    const promesasActividades = data.actividades.map(tactica => {
                        return fetch(`/api/tareas_actividad/${tactica.id}`)
                            .then(response => response.json())
                            .then(dataAct => {
                                if (dataAct.success) {
                                    totalActividades += dataAct.tareas.length;
                                    
                                    // Agregar responsables de actividades
                                    dataAct.tareas.forEach(actividad => {
                                        if (actividad.responsable) {
                                            responsablesSet.add(actividad.responsable.trim().toLowerCase());
                                        }
                                    });
                                }
                            })
                            .catch(() => {});
                    });
                    
                    return Promise.all(promesasActividades);
                }
            })
            .catch(() => {});
    });
    
    Promise.all(promesas).then(() => {
        estadisticasGlobales.totalTacticas = totalTacticas;
        estadisticasGlobales.totalActividades = totalActividades;
        estadisticasGlobales.totalResponsables = responsablesSet.size;
        
        // Actualizar estad√≠sticas en el header
        document.getElementById('total-tacticas').textContent = totalTacticas;
        document.getElementById('total-actividades').textContent = totalActividades;
        document.getElementById('total-responsables').textContent = responsablesSet.size;
    });
}

// Actualizar estad√≠sticas
function actualizarEstadisticas() {
    document.getElementById('total-estrategias').textContent = estrategiasUnicas.length;
    
    let conTacticas = 0;
    Object.values(tacticas).forEach(t => {
        if (t && t.length > 0) conTacticas++;
    });
    document.getElementById('estrategias-con-tacticas').textContent = conTacticas;
    
    // Actualizar contador en tabla
    const estrategiasMostradas = document.querySelectorAll('#cuerpo-tabla-estrategias tr:not([style*="display: none"])').length;
    document.getElementById('estrategias-mostradas').textContent = estrategiasMostradas;
    document.getElementById('estrategias-totales').textContent = estrategiasUnicas.length;
    document.getElementById('pagina-actual').textContent = paginaActual;
}

// Actualizar tabla de estrategias
function actualizarTablaEstrategias() {
    const cuerpoTabla = document.getElementById('cuerpo-tabla-estrategias');
    cuerpoTabla.innerHTML = '';

    if (estrategiasUnicas.length === 0) {
        cuerpoTabla.innerHTML = `
            <tr>
                <td colspan="5" style="text-align: center; padding: 80px;">
                    <div style="text-align: center; color: #94a3b8;">
                        <i class="fas fa-inbox" style="font-size: 70px; margin-bottom: 25px; opacity: 0.5;"></i>
                        <p style="font-size: 20px; font-weight: 700; margin-bottom: 15px;">No hay estrategias disponibles</p>
                        <p style="font-size: 16px; max-width: 600px; margin: 0 auto;">Configure primero la matriz FODA para generar estrategias y comenzar la planificaci√≥n.</p>
                    </div>
                </td>
            </tr>
        `;
        return;
    }

    // Calcular √≠ndices de paginaci√≥n
    const inicio = (paginaActual - 1) * estrategiasPorPagina;
    const fin = inicio + estrategiasPorPagina;
    const estrategiasPagina = estrategiasUnicas.slice(inicio, fin);

    estrategiasPagina.forEach(estrategia => {
        const fila = document.createElement('tr');
        fila.dataset.id = estrategia.ids_relacionados[0];
        fila.onclick = () => seleccionarEstrategia(estrategia.ids_relacionados[0]);

        const tipoColor = tipoColors[estrategia.tipo_cruce] || '#0c2461';
        const ejeTexto = mapEjes[estrategia.eje_id] || estrategia.eje_id;
        const fechaFormateada = new Date(estrategia.fecha_creacion).toLocaleDateString('es-ES', {
            day: 'numeric',
            month: 'short',
            year: 'numeric'
        });

        fila.innerHTML = `
            <td>
                <div class="badge-eje-tabla" style="background: ${tipoColor}15; border-color: ${tipoColor}30; color: ${tipoColor};">
                    ${ejeTexto}
                </div>
            </td>
            <td>
                <span class="badge-tipo-tabla" style="background: ${tipoColor}">
                    ${estrategia.tipo_cruce}
                </span>
            </td>
            <td>
                <div style="font-weight: 500; line-height: 1.8; color: #334155; font-size: 15px;">
                    ${estrategia.estrategia.substring(0, 250)}${estrategia.estrategia.length > 250 ? '...' : ''}
                    ${estrategia.ids_relacionados.length > 1 ? 
                      `<div style="margin-top: 10px; font-size: 13px; color: #64748b;">
                        <i class="fas fa-layer-group"></i> Combinada de ${estrategia.ids_relacionados.length} elementos FODA
                      </div>` : ''}
                </div>
            </td>
            <td>
                <div class="contador-tacticas-tabla" id="tacticas-count-${estrategia.ids_relacionados[0]}">0</div>
            </td>
            <td>
                <div style="font-size: 14px; color: #64748b; font-weight: 500;">${fechaFormateada}</div>
            </td>
        `;

        cuerpoTabla.appendChild(fila);
        
        // Cargar contador de t√°cticas
        cargarContadorTacticas(estrategia.ids_relacionados[0]);
    });

    if (estrategiaSeleccionadaId) {
        seleccionarEstrategia(estrategiaSeleccionadaId);
    }
}

// Cargar contador de t√°cticas
function cargarContadorTacticas(estrategiaId) {
    fetch(`/api/actividades_estrategia/${estrategiaId}`)
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                const countElement = document.getElementById(`tacticas-count-${estrategiaId}`);
                if (countElement) {
                    countElement.textContent = data.actividades.length;
                }
            }
        })
        .catch(() => {
            const countElement = document.getElementById(`tacticas-count-${estrategiaId}`);
            if (countElement) {
                countElement.textContent = '0';
            }
        });
}

// Filtrar estrategias
function filtrarEstrategiasTabla() {
    const filtroEje = document.getElementById('filtro-eje').value;
    const filtroTipo = document.getElementById('filtro-tipo').value;
    const fechaDesde = document.getElementById('fecha-desde').value;
    const fechaHasta = document.getElementById('fecha-hasta').value;
    const filtroTacticas = document.getElementById('filtro-tacticas').value;
    
    const estrategiasFiltradas = estrategiasUnicas.filter(estrategia => {
        // Filtro por eje
        if (filtroEje !== 'all' && estrategia.eje_id !== filtroEje) return false;
        
        // Filtro por tipo
        if (filtroTipo !== 'all' && estrategia.tipo_cruce !== filtroTipo) return false;
        
        // Filtro por fecha
        if (fechaDesde) {
            const fechaCreacion = new Date(estrategia.fecha_creacion);
            const fechaDesdeDate = new Date(fechaDesde);
            if (fechaCreacion < fechaDesdeDate) return false;
        }
        
        if (fechaHasta) {
            const fechaCreacion = new Date(estrategia.fecha_creacion);
            const fechaHastaDate = new Date(fechaHasta);
            fechaHastaDate.setHours(23, 59, 59, 999);
            if (fechaCreacion > fechaHastaDate) return false;
        }
        
        // Filtro por t√°cticas
        if (filtroTacticas !== 'all') {
            // Aqu√≠ necesitar√≠amos cargar las t√°cticas para verificar
            // Por ahora, dejamos este filtro pendiente
        }
        
        return true;
    });
    
    // Actualizar paginaci√≥n
    paginaActual = 1;
    
    // Mostrar estrategias filtradas (simulaci√≥n)
    // En una implementaci√≥n real, esto ser√≠a m√°s complejo
    actualizarEstadisticas();
}

// Buscar estrategias
function buscarEstrategias() {
    const texto = document.getElementById('buscar-estrategia').value.toLowerCase();
    const filas = document.querySelectorAll('#cuerpo-tabla-estrategias tr');

    filas.forEach(fila => {
        if (fila.dataset.id) {
            const estrategia = buscarEstrategiaPorId(fila.dataset.id);
            if (!estrategia) return;

            const contieneTexto = estrategia.estrategia.toLowerCase().includes(texto) ||
                                 (mapEjes[estrategia.eje_id] || '').toLowerCase().includes(texto);
            
            // Tambi√©n aplicar otros filtros activos
            const filtroEje = document.getElementById('filtro-eje').value;
            const filtroTipo = document.getElementById('filtro-tipo').value;
            const pasaEje = filtroEje === 'all' || estrategia.eje_id === filtroEje;
            const pasaTipo = filtroTipo === 'all' || estrategia.tipo_cruce === filtroTipo;

            fila.style.display = (contieneTexto && pasaEje && pasaTipo) ? '' : 'none';
        }
    });
    
    actualizarEstadisticas();
}

// Ordenar estrategias
function ordenarEstrategias() {
    const criterio = document.getElementById('ordenar-por').value;
    
    estrategiasUnicas.sort((a, b) => {
        switch(criterio) {
            case 'eje':
                return (mapEjes[a.eje_id] || '').localeCompare(mapEjes[b.eje_id] || '');
            case 'tipo':
                return a.tipo_cruce.localeCompare(b.tipo_cruce);
            case 'fecha_desc':
                return new Date(b.fecha_creacion) - new Date(a.fecha_creacion);
            case 'fecha_asc':
                return new Date(a.fecha_creacion) - new Date(b.fecha_creacion);
            default:
                return 0;
        }
    });
    
    paginaActual = 1;
    actualizarTablaEstrategias();
}

// Cambiar p√°gina
function cambiarPagina(direccion) {
    const totalPaginas = Math.ceil(estrategiasUnicas.length / estrategiasPorPagina);
    const nuevaPagina = paginaActual + direccion;
    
    if (nuevaPagina >= 1 && nuevaPagina <= totalPaginas) {
        paginaActual = nuevaPagina;
        actualizarTablaEstrategias();
    }
}

// Buscar estrategia por ID
function buscarEstrategiaPorId(id) {
    return estrategiasUnicas.find(e => e.ids_relacionados.includes(parseInt(id)));
}

// Seleccionar estrategia
function seleccionarEstrategia(id) {
    estrategiaSeleccionadaId = id;
    const estrategia = buscarEstrategiaPorId(id);

    if (!estrategia) return;

    // Actualizar UI
    document.querySelectorAll('#cuerpo-tabla-estrategias tr').forEach(fila => {
        fila.classList.remove('selected');
    });
    const filaSeleccionada = document.querySelector(`tr[data-id="${id}"]`);
    if (filaSeleccionada) {
        filaSeleccionada.classList.add('selected');
    }

    // Mostrar informaci√≥n
    const tipoColor = tipoColors[estrategia.tipo_cruce] || '#0c2461';
    document.getElementById('nombre-eje-seleccionado').textContent = 
        mapEjes[estrategia.eje_id] || estrategia.eje_id;
    document.getElementById('tipo-estrategia-seleccionada').textContent = estrategia.tipo_cruce;
    document.getElementById('tipo-estrategia-seleccionada').style.background = tipoColor;
    
    const fechaFormateada = new Date(estrategia.fecha_creacion).toLocaleDateString('es-ES', {
        day: 'numeric',
        month: 'long',
        year: 'numeric'
    });
    document.getElementById('fecha-creacion-estrategia').textContent = fechaFormateada;

    // Mostrar secci√≥n de detalle
    document.getElementById('estado-inicial').style.display = 'none';
    document.getElementById('seccion-detalle').style.display = 'block';
    
    // Mostrar texto de estrategia
    let textoCompleto = estrategia.estrategia;
    
    if (estrategia.ids_relacionados.length > 1) {
        textoCompleto += "\n\n--- Elementos FODA relacionados ---\n";
        
        if (estrategia.elementos_internos.length > 0) {
            textoCompleto += "\nüîç Elementos Internos:\n";
            estrategia.elementos_internos.forEach((elem) => {
                textoCompleto += `‚Ä¢ ${elem.tipo === 'fortaleza' ? '‚úÖ' : '‚ö†Ô∏è'} ${elem.texto}\n`;
            });
        }
        
        if (estrategia.elementos_externos.length > 0) {
            textoCompleto += "\nüåê Elementos Externos:\n";
            estrategia.elementos_externos.forEach((elem) => {
                textoCompleto += `‚Ä¢ ${elem.tipo === 'oportunidad' ? 'üéØ' : '‚ö†Ô∏è'} ${elem.texto}\n`;
            });
        }
    }
    
    document.getElementById('estrategia-texto').textContent = textoCompleto;
    document.getElementById('estrategia-len').textContent = `${estrategia.estrategia.length} caracteres`;

    // Cargar t√°cticas
    cargarTacticasCombinadas(estrategia.ids_relacionados);
}

// Cargar t√°cticas combinadas
function cargarTacticasCombinadas(idsEstrategia) {
    const promesasTacticas = idsEstrategia.map(id => 
        fetch(`/api/actividades_estrategia/${id}`)
            .then(response => response.json())
            .then(data => data.success ? data.actividades : [])
            .catch(() => [])
    );

    Promise.all(promesasTacticas)
        .then(resultados => {
            const todasTacticas = resultados.flat();
            const tacticasUnicas = [];
            const tacticasVistas = new Set();
            
            todasTacticas.forEach(tactica => {
                const clave = tactica.nombre.toLowerCase().trim();
                if (!tacticasVistas.has(clave)) {
                    tacticasVistas.add(clave);
                    tacticasUnicas.push(tactica);
                }
            });
            
            tacticas[idsEstrategia[0]] = tacticasUnicas;
            actualizarListaTacticas(idsEstrategia[0]);
            actualizarContadores(idsEstrategia[0]);
        })
        .catch(() => {
            tacticas[idsEstrategia[0]] = [];
            actualizarListaTacticas(idsEstrategia[0]);
            actualizarContadores(idsEstrategia[0]);
        });
}

// Actualizar contadores
function actualizarContadores(estrategiaId) {
    const tacticasCount = tacticas[estrategiaId] ? tacticas[estrategiaId].length : 0;
    document.getElementById('contador-tacticas').textContent = tacticasCount;
    
    let actividadesCount = 0;
    if (tacticas[estrategiaId]) {
        tacticas[estrategiaId].forEach(t => {
            if (actividadesCache[t.id]) {
                actividadesCount += actividadesCache[t.id].length;
            }
        });
    }
    document.getElementById('contador-actividades').textContent = actividadesCount;
}

// Actualizar lista de t√°cticas
function actualizarListaTacticas(estrategiaId) {
    const container = document.getElementById('tacticas-container');
    container.innerHTML = '';

    if (!tacticas[estrategiaId] || tacticas[estrategiaId].length === 0) {
        container.innerHTML = `
            <div class="tactica-vacia-completo" style="text-align: center; padding: 80px; color: #94a3b8;">
                <i class="fas fa-project-diagram" style="font-size: 70px; margin-bottom: 25px; opacity: 0.5;"></i>
                <h4 style="font-size: 20px; font-weight: 700; margin-bottom: 15px;">No hay t√°cticas definidas</h4>
                <p style="font-size: 16px; max-width: 500px; margin: 0 auto;">Utilice el formulario superior para agregar la primera t√°ctica a esta estrategia.</p>
            </div>
        `;
        return;
    }

    tacticas[estrategiaId].forEach(tactica => {
        const tacticaDiv = document.createElement('div');
        tacticaDiv.className = 'tactica-item-completo';
        tacticaDiv.dataset.id = tactica.id;
        tacticaDiv.innerHTML = crearHTMLTactica(tactica);

        container.appendChild(tacticaDiv);
        
        // Cargar actividades
        cargarActividades(tactica.id);
    });
}

// Crear HTML de t√°ctica
function crearHTMLTactica(tactica) {
    const actividadesCount = actividadesCache[tactica.id] ? actividadesCache[tactica.id].length : 0;
    const fechaInicio = tactica.fecha_inicio ? 
        new Date(tactica.fecha_inicio).toLocaleDateString('es-ES', { day: 'numeric', month: 'short', year: 'numeric' }) : 
        'No definida';
    const fechaFin = tactica.fecha_fin ? 
        new Date(tactica.fecha_fin).toLocaleDateString('es-ES', { day: 'numeric', month: 'short', year: 'numeric' }) : 
        'No definida';
    
    // Determinar color de prioridad
    let colorPrioridad = '#3b82f6';
    switch(tactica.prioridad || 'media') {
        case 'alta': colorPrioridad = '#ef4444'; break;
        case 'media': colorPrioridad = '#f59e0b'; break;
        case 'baja': colorPrioridad = '#10b981'; break;
        case 'opcional': colorPrioridad = '#94a3b8'; break;
    }

    return `
        <div class="tactica-header-completo">
            <div style="flex: 1;">
                <h3 class="tactica-titulo-completo">
                    ${tactica.nombre}
                    ${actividadesCount > 0 ? 
                      `<span class="contador-actividades-completo">${actividadesCount}</span>` : ''}
                </h3>
                <button class="btn-expandir-tactica-completo" onclick="toggleExpandirTactica(${tactica.id})">
                    <i class="fas fa-chevron-down"></i>
                    <span>${actividadesCount} actividades</span>
                </button>
            </div>
            <div class="tactica-acciones-completo">
                <button class="btn-agregar-actividad-completo" onclick="abrirModalActividad(${tactica.id})">
                    <i class="fas fa-plus"></i> Actividad
                </button>
                <button class="btn-editar-tactica-completo" onclick="editarTactica(${tactica.id})">
                    <i class="fas fa-edit"></i>
                </button>
                <button class="btn-eliminar-tactica-completo" onclick="eliminarTactica(${tactica.id})">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
        </div>
        <div class="tactica-detalle-completo">
            ${tactica.descripcion || '<em style="color: #94a3b8; font-style: italic;">Sin descripci√≥n detallada</em>'}
        </div>
        <div class="tactica-metadata-completo">
            <div class="metadata-item-tactica">
                <i class="fas fa-user-tie"></i>
                <span>${tactica.responsable || 'Sin responsable'}</span>
            </div>
            <div class="metadata-item-tactica">
                <i class="fas fa-calendar-alt"></i>
                <span>${fechaInicio} ‚Üí ${fechaFin}</span>
            </div>
            <div class="metadata-item-tactica">
                <i class="fas fa-exclamation-circle"></i>
                <span style="color: ${colorPrioridad};">${(tactica.prioridad || 'media').charAt(0).toUpperCase() + (tactica.prioridad || 'media').slice(1)}</span>
            </div>
            ${tactica.presupuesto ? `
            <div class="metadata-item-tactica">
                <i class="fas fa-money-bill-wave"></i>
                <span>${tactica.presupuesto} ${tactica.moneda || 'USD'}</span>
            </div>` : ''}
        </div>
        <div class="lista-actividades-completo" id="actividades-tactica-${tactica.id}">
            <!-- Las actividades se cargar√°n aqu√≠ -->
        </div>
    `;
}

// Toggle expandir t√°ctica
function toggleExpandirTactica(tacticaId) {
    const tacticaItem = document.querySelector(`.tactica-item-completo[data-id="${tacticaId}"]`);
    if (tacticaItem) {
        tacticaItem.classList.toggle('expanded');
        const btn = tacticaItem.querySelector('.btn-expandir-tactica-completo i');
        if (btn) {
            if (tacticaItem.classList.contains('expanded')) {
                btn.className = 'fas fa-chevron-up';
            } else {
                btn.className = 'fas fa-chevron-down';
            }
        }
    }
}

// Filtrar t√°cticas
function filtrarTacticas(filtro) {
    const tacticasItems = document.querySelectorAll('.tactica-item-completo');
    
    tacticasItems.forEach(item => {
        if (filtro === 'todas') {
            item.style.display = 'flex';
            item.style.flexDirection = 'column';
        } else {
            // Implementar l√≥gica de filtrado seg√∫n estado
            item.style.display = 'flex';
            item.style.flexDirection = 'column';
        }
    });
}

// Ordenar t√°cticas
function ordenarTacticas(criterio) {
    const estrategia = buscarEstrategiaPorId(estrategiaSeleccionadaId);
    if (!estrategia || !tacticas[estrategia.ids_relacionados[0]]) return;
    
    const tacticasArray = tacticas[estrategia.ids_relacionados[0]];
    
    switch(criterio) {
        case 'nombre':
            tacticasArray.sort((a, b) => a.nombre.localeCompare(b.nombre));
            break;
        case 'prioridad':
            const prioridadOrden = { 'alta': 1, 'media': 2, 'baja': 3, 'opcional': 4 };
            tacticasArray.sort((a, b) => {
                const prioridadA = prioridadOrden[a.prioridad || 'media'] || 2;
                const prioridadB = prioridadOrden[b.prioridad || 'media'] || 2;
                return prioridadA - prioridadB;
            });
            break;
        case 'fecha':
        default:
            tacticasArray.sort((a, b) => new Date(a.fecha_inicio || 0) - new Date(b.fecha_inicio || 0));
            break;
    }
    
    actualizarListaTacticas(estrategia.ids_relacionados[0]);
}

// Agregar t√°ctica
function agregarTactica() {
    if (!estrategiaSeleccionadaId) {
        mostrarNotificacion('‚ùå Primero seleccione una estrategia', 'error');
        return;
    }

    const nombre = document.getElementById('tactica-nombre').value.trim();
    const descripcion = document.getElementById('tactica-descripcion').value.trim();
    const responsable = document.getElementById('tactica-responsable').value.trim();
    const fechaInicio = document.getElementById('tactica-fecha-inicio').value;
    const fechaFin = document.getElementById('tactica-fecha-fin').value;
    const presupuesto = document.getElementById('tactica-presupuesto').value;
    const moneda = document.getElementById('tactica-moneda').value;
    const prioridad = document.getElementById('tactica-prioridad').value.split(' ')[0];

    if (!nombre) {
        mostrarNotificacion('‚ùå El nombre de la t√°ctica es obligatorio', 'error');
        return;
    }

    const estrategia = buscarEstrategiaPorId(estrategiaSeleccionadaId);
    if (!estrategia) {
        mostrarNotificacion('‚ùå Error: Estrategia no encontrada', 'error');
        return;
    }

    const tactica = {
        estrategia_id: estrategia.ids_relacionados[0],
        nombre: nombre,
        descripcion: descripcion,
        responsable: responsable,
        fecha_inicio: fechaInicio,
        fecha_fin: fechaFin,
        presupuesto: presupuesto,
        moneda: moneda,
        prioridad: prioridad
    };

    fetch('/api/agregar_actividad', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-Requested-With': 'XMLHttpRequest'
        },
        body: JSON.stringify(tactica)
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            mostrarNotificacion('‚úÖ T√°ctica agregada correctamente', 'success');
            limpiarFormularioTactica();
            cargarTacticasCombinadas(estrategia.ids_relacionados);
            actualizarEstadisticas();
            cargarEstadisticasGlobales();
            cargarContadorTacticas(estrategia.ids_relacionados[0]);
        } else {
            mostrarNotificacion('‚ùå Error: ' + data.message, 'error');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        mostrarNotificacion('‚ùå Error de conexi√≥n al servidor', 'error');
    });
}

// Limpiar formulario de t√°ctica
function limpiarFormularioTactica() {
    document.getElementById('tactica-nombre').value = '';
    document.getElementById('tactica-descripcion').value = '';
    document.getElementById('tactica-responsable').value = '';
    document.getElementById('tactica-fecha-inicio').value = '';
    document.getElementById('tactica-fecha-fin').value = '';
    document.getElementById('tactica-presupuesto').value = '';
    document.getElementById('tactica-prioridad').value = 'media';
    
    // Resetear altura de textarea
    const textarea = document.getElementById('tactica-descripcion');
    textarea.style.height = 'auto';
}

// Editar t√°ctica
function editarTactica(tacticaId) {
    // Implementar l√≥gica de edici√≥n
    mostrarNotificacion('‚ö†Ô∏è Funci√≥n de edici√≥n en desarrollo', 'warning');
}

// Eliminar t√°ctica
function eliminarTactica(tacticaId) {
    if (!confirm('¬øEst√° seguro de eliminar esta t√°ctica y todas sus actividades?\nEsta acci√≥n no se puede deshacer.')) {
        return;
    }

    fetch(`/api/eliminar_actividad/${tacticaId}`, {
        method: 'DELETE',
        headers: {
            'X-Requested-With': 'XMLHttpRequest'
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            mostrarNotificacion('‚úÖ T√°ctica eliminada correctamente', 'success');
            
            const estrategia = buscarEstrategiaPorId(estrategiaSeleccionadaId);
            if (estrategia) {
                cargarTacticasCombinadas(estrategia.ids_relacionados);
                actualizarEstadisticas();
                cargarEstadisticasGlobales();
                cargarContadorTacticas(estrategia.ids_relacionados[0]);
            }
        } else {
            mostrarNotificacion('‚ùå Error: ' + data.message, 'error');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        mostrarNotificacion('‚ùå Error de conexi√≥n al servidor', 'error');
    });
}

// Abrir modal de actividad
function abrirModalActividad(tacticaId) {
    tacticaActualParaActividad = tacticaId;
    document.getElementById('modal-actividad').classList.add('active');
    document.body.style.overflow = 'hidden';
    
    // Configurar textareas
    setTimeout(() => {
        document.querySelectorAll('.modal-textarea-completo').forEach(textarea => {
            textarea.style.height = 'auto';
            textarea.style.height = (textarea.scrollHeight) + 'px';
        });
    }, 200);
}

// Cerrar modal de actividad
function cerrarModalActividad() {
    document.getElementById('modal-actividad').classList.remove('active');
    document.body.style.overflow = 'auto';
    
    // Limpiar formulario
    document.getElementById('actividad-nombre').value = '';
    document.getElementById('actividad-descripcion').value = '';
    document.getElementById('actividad-responsable').value = '';
    document.getElementById('actividad-fecha-inicio').value = '';
    document.getElementById('actividad-fecha-fin').value = '';
    document.getElementById('actividad-estado').value = 'pendiente';
    document.getElementById('actividad-prioridad').value = 'media';
    document.getElementById('actividad-dificultad').value = 'media';
    document.getElementById('actividad-recursos').value = '';
    document.getElementById('actividad-indicadores').value = '';
    document.getElementById('actividad-riesgos').value = '';
    document.getElementById('actividad-colaboradores').value = '';
    document.getElementById('actividad-documentacion').value = '';
}

// Guardar borrador de actividad
function guardarBorradorActividad() {
    mostrarNotificacion('üìù Borrador guardado temporalmente', 'info');
}

// Guardar actividad
function guardarActividad() {
    if (!tacticaActualParaActividad) {
        mostrarNotificacion('‚ùå No hay t√°ctica seleccionada', 'error');
        return;
    }

    const nombre = document.getElementById('actividad-nombre').value.trim();
    const descripcion = document.getElementById('actividad-descripcion').value.trim();
    const responsable = document.getElementById('actividad-responsable').value.trim();
    const fechaInicio = document.getElementById('actividad-fecha-inicio').value;
    const fechaFin = document.getElementById('actividad-fecha-fin').value;
    const estado = document.getElementById('actividad-estado').value.split(' ')[0];
    const prioridad = document.getElementById('actividad-prioridad').value.split(' ')[0];
    const dificultad = document.getElementById('actividad-dificultad').value.split(' ')[0];
    const recursos = document.getElementById('actividad-recursos').value.trim();
    const indicadores = document.getElementById('actividad-indicadores').value.trim();
    const riesgos = document.getElementById('actividad-riesgos').value.trim();
    const colaboradores = document.getElementById('actividad-colaboradores').value.trim();
    const documentacion = document.getElementById('actividad-documentacion').value.trim();

    if (!nombre) {
        mostrarNotificacion('‚ùå El nombre de la actividad es obligatorio', 'error');
        return;
    }

    const actividad = {
        actividad_id: tacticaActualParaActividad,
        nombre: nombre,
        descripcion: descripcion,
        responsable: responsable,
        fecha_inicio: fechaInicio,
        fecha_fin: fechaFin,
        estado: estado,
        prioridad: prioridad,
        dificultad: dificultad,
        recursos: recursos,
        indicadores: indicadores,
        riesgos: riesgos,
        colaboradores: colaboradores,
        documentacion: documentacion
    };

    fetch('/api/agregar_tarea', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-Requested-With': 'XMLHttpRequest'
        },
        body: JSON.stringify(actividad)
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            mostrarNotificacion('‚úÖ Actividad agregada correctamente', 'success');
            cerrarModalActividad();
            cargarActividades(tacticaActualParaActividad);
            actualizarContadores(estrategiaSeleccionadaId);
            cargarEstadisticasGlobales();
        } else {
            mostrarNotificacion('‚ùå Error: ' + data.message, 'error');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        mostrarNotificacion('‚ùå Error de conexi√≥n al servidor', 'error');
    });
}

// Cargar actividades
function cargarActividades(tacticaId) {
    fetch(`/api/tareas_actividad/${tacticaId}`)
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                actividadesCache[tacticaId] = data.tareas;
                actualizarListaActividades(tacticaId);
                actualizarContadores(estrategiaSeleccionadaId);
                
                // Actualizar HTML de la t√°ctica
                const tacticaItem = document.querySelector(`.tactica-item-completo[data-id="${tacticaId}"]`);
                if (tacticaItem) {
                    const estrategia = buscarEstrategiaPorId(estrategiaSeleccionadaId);
                    if (estrategia && tacticas[estrategia.ids_relacionados[0]]) {
                        const tactica = tacticas[estrategia.ids_relacionados[0]].find(t => t.id == tacticaId);
                        if (tactica) {
                            tacticaItem.innerHTML = crearHTMLTactica(tactica);
                        }
                    }
                }
            }
        })
        .catch(() => {
            actividadesCache[tacticaId] = [];
            actualizarListaActividades(tacticaId);
        });
}

// Actualizar lista de actividades
function actualizarListaActividades(tacticaId) {
    const container = document.getElementById(`actividades-tactica-${tacticaId}`);
    if (!container) return;

    container.innerHTML = '';

    if (!actividadesCache[tacticaId] || actividadesCache[tacticaId].length === 0) {
        container.innerHTML = `
            <div class="actividad-vacia-completo" style="text-align: center; padding: 40px; color: #94a3b8; font-size: 15px;">
                <i class="fas fa-tasks" style="margin-right: 12px; font-size: 18px;"></i> No hay actividades registradas
            </div>
        `;
        return;
    }

    actividadesCache[tacticaId].forEach(actividad => {
        const actividadDiv = document.createElement('div');
        actividadDiv.className = 'actividad-item-completo';

        const fechaInicio = actividad.fecha_inicio ? 
            new Date(actividad.fecha_inicio).toLocaleDateString('es-ES', { day: 'numeric', month: 'short', year: 'numeric' }) : 
            'No definida';
        const fechaFin = actividad.fecha_fin ? 
            new Date(actividad.fecha_fin).toLocaleDateString('es-ES', { day: 'numeric', month: 'short', year: 'numeric' }) : 
            'No definida';

        let estadoTexto = '';
        switch(actividad.estado) {
            case 'pendiente': estadoTexto = 'üü° Pendiente'; break;
            case 'planificada': estadoTexto = 'üìã Planificada'; break;
            case 'en_progreso': estadoTexto = 'üîµ En Progreso'; break;
            case 'revision': estadoTexto = 'üîÑ En Revisi√≥n'; break;
            case 'completada': estadoTexto = 'üü¢ Completada'; break;
            case 'atrasada': estadoTexto = 'üî¥ Atrasada'; break;
            case 'suspendida': estadoTexto = '‚è∏Ô∏è Suspendida'; break;
            case 'cancelada': estadoTexto = '‚ùå Cancelada'; break;
            default: estadoTexto = 'üü° Pendiente';
        }

        let prioridadIcon = '';
        switch(actividad.prioridad || 'media') {
            case 'critica': prioridadIcon = 'üî¥'; break;
            case 'alta': prioridadIcon = 'üü†'; break;
            case 'media': prioridadIcon = 'üü°'; break;
            case 'baja': prioridadIcon = 'üü¢'; break;
        }

        let dificultadIcon = '';
        switch(actividad.dificultad || 'media') {
            case 'muy_facil': dificultadIcon = 'üü¢'; break;
            case 'facil': dificultadIcon = 'üü°'; break;
            case 'media': dificultadIcon = 'üü†'; break;
            case 'dificil': dificultadIcon = 'üî¥'; break;
            case 'muy_dificil': dificultadIcon = '‚ö´'; break;
        }

        actividadDiv.innerHTML = `
            <div class="actividad-info-completo">
                <h4>${actividad.nombre}</h4>
                <p>${actividad.descripcion || 'Sin descripci√≥n detallada'}</p>
                <div class="actividad-detalles-completo">
                    <span><i class="fas fa-user-check"></i> ${actividad.responsable || 'Sin responsable'}</span>
                    <span><i class="fas fa-calendar"></i> ${fechaInicio} - ${fechaFin}</span>
                    <span><i class="fas fa-exclamation-triangle"></i> ${prioridadIcon} ${(actividad.prioridad || 'media').charAt(0).toUpperCase() + (actividad.prioridad || 'media').slice(1)}</span>
                    <span><i class="fas fa-mountain"></i> ${dificultadIcon} ${(actividad.dificultad || 'media').replace('_', ' ').charAt(0).toUpperCase() + (actividad.dificultad || 'media').slice(1)}</span>
                    ${actividad.recursos ? `<span><i class="fas fa-toolbox"></i> Recursos</span>` : ''}
                    ${actividad.indicadores ? `<span><i class="fas fa-chart-bar"></i> Indicadores</span>` : ''}
                </div>
            </div>
            <div class="actividad-estado-completo ${actividad.estado}">${estadoTexto}</div>
        `;

        container.appendChild(actividadDiv);
    });
}

// Exportar estrategias
function exportarEstrategias() {
    mostrarNotificacion('üìä Exportando estrategias...', 'info');
    // Implementar l√≥gica de exportaci√≥n
}

// Imprimir estrategia
function imprimirEstrategia() {
    window.print();
}

// Compartir estrategia
function compartirEstrategia() {
    mostrarNotificacion('üîó Funci√≥n de compartir en desarrollo', 'warning');
}

// Mostrar notificaci√≥n
function mostrarNotificacion(mensaje, tipo) {
    let alerta = document.getElementById('alerta-flotante');
    
    if (!alerta) {
        alerta = document.createElement('div');
        alerta.id = 'alerta-flotante';
        alerta.style.cssText = `
            position: fixed;
            top: 30px;
            right: 30px;
            padding: 20px 25px;
            border-radius: 16px;
            color: white;
            font-weight: 700;
            z-index: 6000;
            box-shadow: 0 20px 50px rgba(0,0,0,0.25);
            transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            transform: translateX(100%);
            opacity: 0;
            max-width: 500px;
            backdrop-filter: blur(15px);
            border-left: 6px solid;
            display: flex;
            align-items: center;
            gap: 20px;
            font-size: 16px;
        `;
        document.body.appendChild(alerta);
    }
    
    let background = '';
    let borderColor = '';
    
    if (tipo === 'success') {
        background = 'linear-gradient(135deg, rgba(16, 185, 129, 0.95) 0%, rgba(5, 150, 105, 0.95) 100%)';
        borderColor = '#059669';
    } else if (tipo === 'error') {
        background = 'linear-gradient(135deg, rgba(239, 68, 68, 0.95) 0%, rgba(220, 38, 38, 0.95) 100%)';
        borderColor = '#dc2626';
    } else if (tipo === 'warning') {
        background = 'linear-gradient(135deg, rgba(245, 158, 11, 0.95) 0%, rgba(217, 119, 6, 0.95) 100%)';
        borderColor = '#d97706';
    } else if (tipo === 'info') {
        background = 'linear-gradient(135deg, rgba(59, 130, 246, 0.95) 0%, rgba(29, 78, 216, 0.95) 100%)';
        borderColor = '#1d4ed8';
    } else {
        background = 'linear-gradient(135deg, rgba(12, 36, 97, 0.95) 0%, rgba(30, 55, 153, 0.95) 100%)';
        borderColor = '#0c2461';
    }
    
    alerta.style.background = background;
    alerta.style.borderLeftColor = borderColor;
    
    const icon = tipo === 'success' ? 'check-circle' : 
                tipo === 'error' ? 'exclamation-circle' : 
                tipo === 'warning' ? 'exclamation-triangle' : 'info-circle';
    
    alerta.innerHTML = `
        <i class="fas fa-${icon}" style="font-size: 28px;"></i>
        <div style="flex: 1;">${mensaje}</div>
    `;
    
    setTimeout(() => {
        alerta.style.transform = 'translateX(0)';
        alerta.style.opacity = '1';
    }, 10);
    
    setTimeout(() => {
        alerta.style.transform = 'translateX(100%)';
        alerta.style.opacity = '0';
    }, 5000);
}
</script>
{% endblock %}
