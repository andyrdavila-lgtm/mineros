{% extends "inicio.html" %}

{% block content %}
<div class="estrategias-main-container">
    <div class="estrategias-header">
        <h1 class="content-title">
            <i class="fas fa-chess-queen"></i> Planificaci√≥n de Estrategias
        </h1>
        <p class="content-subtitle">Desglose estrat√©gico: De ejes a t√°cticas y actividades operativas</p>
    </div>

    <!-- Contenedor principal con dise√±o vertical -->
    <div class="estrategias-container-vertical">
        
        <!-- Panel superior: Tabla de Ejes y Estrategias -->
        <div class="panel-superior">
            <div class="panel-header">
                <div class="panel-title-container">
                    <div class="panel-icon-badge">
                        <i class="fas fa-layer-group"></i>
                    </div>
                    <div>
                        <h2>Ejes y Estrategias</h2>
                        <p class="panel-subtitle">Seleccione una estrategia para desglosarla</p>
                    </div>
                </div>
                <div class="panel-header-right">
                    <div class="estadisticas-header">
                        <span class="estadistica-header-item">
                            <i class="fas fa-bullseye"></i>
                            <span id="total-estrategias">0</span> estrategias
                        </span>
                        <span class="estadistica-header-item">
                            <i class="fas fa-check-circle"></i>
                            <span id="estrategias-con-tacticas">0</span> con t√°cticas
                        </span>
                    </div>
                    <div class="panel-actions">
                        <button class="btn-refresh" onclick="cargarEstrategias()">
                            <i class="fas fa-sync-alt"></i> Actualizar
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="filtros-panel">
                <div class="filtro-group">
                    <label class="filtro-label"><i class="fas fa-filter"></i> Filtrar por Eje</label>
                    <select id="filtro-eje" class="filtro-select" onchange="filtrarEstrategiasTabla()">
                        <option value="all">Todos los ejes</option>
                        <option value="educacion">üéì Educaci√≥n</option>
                        <option value="salud">üè• Salud</option>
                        <option value="empleabilidad">üíº Empleabilidad</option>
                        <option value="desarrollo_economico">üìà Desarrollo Econ√≥mico</option>
                        <option value="sostenibilidad_ambiental">üíß Sostenibilidad Ambiental</option>
                        <option value="comunicacion">üì¢ Comunicaci√≥n</option>
                        <option value="institucional">üèõÔ∏è Institucional</option>
                    </select>
                </div>
                <div class="filtro-group">
                    <label class="filtro-label"><i class="fas fa-crosshairs"></i> Tipo de Estrategia</label>
                    <select id="filtro-tipo" class="filtro-select" onchange="filtrarEstrategiasTabla()">
                        <option value="all">Todos los tipos</option>
                        <option value="FO" style="color: #2ecc71;">FO - Fortaleza + Oportunidad</option>
                        <option value="DO" style="color: #3498db;">DO - Debilidad + Oportunidad</option>
                        <option value="FA" style="color: #e67e22;">FA - Fortaleza + Amenaza</option>
                        <option value="DA" style="color: #9b59b6;">DA - Debilidad + Amenaza</option>
                    </select>
                </div>
            </div>

            <div class="tabla-container">
                <table class="tabla-estrategias">
                    <thead>
                        <tr>
                            <th width="25%">Eje Estrat√©gico</th>
                            <th width="15%">Tipo</th>
                            <th width="45%">Estrategia</th>
                            <th width="15%">Acci√≥n</th>
                        </tr>
                    </thead>
                    <tbody id="cuerpo-tabla-estrategias">
                        <!-- Las estrategias se cargar√°n aqu√≠ din√°micamente -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Panel inferior: T√°cticas y Actividades -->
        <div class="panel-inferior">
            <div class="panel-header">
                <div class="panel-title-container">
                    <div class="panel-icon-badge bg-blue">
                        <i class="fas fa-project-diagram"></i>
                    </div>
                    <div>
                        <h2>T√°cticas y Actividades</h2>
                        <p class="panel-subtitle">Desglose operativo de la estrategia</p>
                    </div>
                </div>
                <div class="estrategia-seleccionada-info" id="estrategia-seleccionada-info">
                    <div class="estrategia-header">
                        <div class="estrategia-titulo">
                            <span id="nombre-eje-seleccionado">Seleccione una estrategia</span>
                            <span id="tipo-estrategia-seleccionada" class="badge-tipo">--</span>
                        </div>
                        <div class="estrategia-metadata">
                            <span class="metadata-chips">
                                <span class="chip"><i class="fas fa-tasks"></i> <span id="contador-tacticas">0</span> t√°cticas</span>
                                <span class="chip"><i class="fas fa-check-circle"></i> <span id="contador-actividades">0</span> actividades</span>
                            </span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="estrategia-detalle" id="estrategia-detalle">
                <div class="estrategia-vacia" id="estrategia-vacia">
                    <div class="vacia-illustration">
                        <i class="fas fa-chess-board"></i>
                    </div>
                    <h3>Estrategia no seleccionada</h3>
                    <p>Seleccione una estrategia de la tabla superior para comenzar a planificar t√°cticas y actividades.</p>
                    <div class="vacia-tips">
                        <div class="tip">
                            <i class="fas fa-lightbulb"></i>
                            <span>Haga clic en cualquier estrategia para desglosarla</span>
                        </div>
                        <div class="tip">
                            <i class="fas fa-plus-circle"></i>
                            <span>Agregue t√°cticas espec√≠ficas para cada estrategia</span>
                        </div>
                    </div>
                </div>

                <div class="estrategia-contenido" id="estrategia-contenido" style="display: none;">
                    <!-- Estrategia seleccionada -->
                    <div class="estrategia-texto-container">
                        <div class="estrategia-texto-header">
                            <h3><i class="fas fa-quote-left"></i> Estrategia Seleccionada</h3>
                            <span class="estrategia-len" id="estrategia-len">0 caracteres</span>
                        </div>
                        <div class="estrategia-texto" id="estrategia-texto"></div>
                    </div>
                    
                    <!-- Contenedor principal para t√°cticas y actividades -->
                    <div class="tacticas-actividades-container">
                        
                        <!-- Formulario para agregar t√°ctica -->
                        <div class="formulario-tactica">
                            <div class="form-header">
                                <h3><i class="fas fa-plus-circle"></i> Agregar Nueva T√°ctica</h3>
                                <p class="form-subtitle">Desglose operativo de la estrategia en acciones concretas</p>
                            </div>
                            <div class="form-grid-expanded">
                                <div class="form-group-expanded">
                                    <label for="tactica-nombre" class="form-label">
                                        <i class="fas fa-heading"></i> Nombre de la T√°ctica
                                    </label>
                                    <input type="text" id="tactica-nombre" class="form-input-expanded" 
                                           placeholder="Ej: Implementar programa de capacitaci√≥n continua para fortalecer habilidades t√©cnicas">
                                    <div class="form-hint">Describa la t√°ctica de forma clara y concisa</div>
                                </div>
                                <div class="form-row-expanded">
                                    <div class="form-group-expanded">
                                        <label for="tactica-descripcion" class="form-label">
                                            <i class="fas fa-align-left"></i> Descripci√≥n Detallada
                                        </label>
                                        <textarea id="tactica-descripcion" class="form-textarea-expanded" rows="4" 
                                                  placeholder="Describa los alcances, metodolog√≠a y objetivos espec√≠ficos de esta t√°ctica..."></textarea>
                                    </div>
                                </div>
                                <div class="form-row-expanded">
                                    <div class="form-group-expanded">
                                        <label for="tactica-responsable" class="form-label">
                                            <i class="fas fa-user-tie"></i> Responsable Principal
                                        </label>
                                        <input type="text" id="tactica-responsable" class="form-input-expanded" 
                                               placeholder="Nombre del l√≠der responsable y equipo involucrado">
                                    </div>
                                    <div class="form-group-expanded">
                                        <label for="tactica-fecha-inicio" class="form-label">
                                            <i class="fas fa-calendar-plus"></i> Fecha de Inicio
                                        </label>
                                        <input type="date" id="tactica-fecha-inicio" class="form-input-expanded">
                                    </div>
                                    <div class="form-group-expanded">
                                        <label for="tactica-fecha-fin" class="form-label">
                                            <i class="fas fa-calendar-check"></i> Fecha de Finalizaci√≥n
                                        </label>
                                        <input type="date" id="tactica-fecha-fin" class="form-input-expanded">
                                    </div>
                                </div>
                            </div>
                            <button class="btn-agregar-tactica" onclick="agregarTactica()">
                                <i class="fas fa-plus"></i> Agregar T√°ctica
                            </button>
                        </div>

                        <!-- Lista de t√°cticas con m√°s espacio -->
                        <div class="lista-tacticas-expanded">
                            <div class="lista-header">
                                <h3><i class="fas fa-list-ul"></i> T√°cticas Asignadas</h3>
                                <div class="lista-filtros">
                                    <button class="btn-filtro activo" data-filtro="todas">Todas</button>
                                    <button class="btn-filtro" data-filtro="vigentes">Vigentes</button>
                                    <button class="btn-filtro" data-filtro="completadas">Completadas</button>
                                </div>
                            </div>
                            <div class="tacticas-container-expanded" id="tacticas-container">
                                <!-- Las t√°cticas se cargar√°n aqu√≠ -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal para agregar actividades -->
<div class="modal" id="modal-actividad">
    <div class="modal-overlay" onclick="cerrarModalActividad()"></div>
    <div class="modal-container-expanded">
        <div class="modal-header">
            <div class="modal-icon">
                <i class="fas fa-tasks"></i>
            </div>
            <div class="modal-title">
                <h3>Agregar Nueva Actividad</h3>
                <p class="modal-subtitle">Acci√≥n espec√≠fica dentro de la t√°ctica seleccionada</p>
            </div>
            <button class="modal-close" onclick="cerrarModalActividad()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body-expanded">
            <div class="form-grid-modal">
                <div class="form-group-expanded">
                    <label for="actividad-nombre" class="form-label">
                        <i class="fas fa-heading"></i> Nombre de la Actividad
                    </label>
                    <input type="text" id="actividad-nombre" class="form-input-expanded" 
                           placeholder="Ej: Contactar y contratar facilitadores certificados para capacitaci√≥n t√©cnica">
                </div>
                <div class="form-group-expanded">
                    <label for="actividad-descripcion" class="form-label">
                        <i class="fas fa-align-left"></i> Descripci√≥n Detallada
                    </label>
                    <textarea id="actividad-descripcion" class="form-textarea-expanded" rows="4" 
                              placeholder="Describa la actividad paso a paso, incluyendo recursos necesarios, metodolog√≠a y resultados esperados..."></textarea>
                </div>
                <div class="form-row-expanded">
                    <div class="form-group-expanded">
                        <label for="actividad-responsable" class="form-label">
                            <i class="fas fa-user-check"></i> Responsable
                        </label>
                        <input type="text" id="actividad-responsable" class="form-input-expanded" 
                               placeholder="Nombre del ejecutor principal y equipo de apoyo">
                    </div>
                    <div class="form-group-expanded">
                        <label for="actividad-fecha-inicio" class="form-label">
                            <i class="fas fa-play-circle"></i> Inicio Planificado
                        </label>
                        <input type="date" id="actividad-fecha-inicio" class="form-input-expanded">
                    </div>
                    <div class="form-group-expanded">
                        <label for="actividad-fecha-fin" class="form-label">
                            <i class="fas fa-flag-checkered"></i> Finalizaci√≥n Estimada
                        </label>
                        <input type="date" id="actividad-fecha-fin" class="form-input-expanded">
                    </div>
                </div>
                <div class="form-row-expanded">
                    <div class="form-group-expanded">
                        <label for="actividad-estado" class="form-label">
                            <i class="fas fa-chart-line"></i> Estado de Avance
                        </label>
                        <select id="actividad-estado" class="form-select-expanded">
                            <option value="pendiente">üü° Pendiente - Por iniciar</option>
                            <option value="en_progreso">üîµ En Progreso - En ejecuci√≥n</option>
                            <option value="completada">üü¢ Completada - Finalizada</option>
                            <option value="atrasada">üî¥ Atrasada - Requiere atenci√≥n</option>
                        </select>
                    </div>
                    <div class="form-group-expanded">
                        <label for="actividad-recursos" class="form-label">
                            <i class="fas fa-toolbox"></i> Recursos Requeridos
                        </label>
                        <textarea id="actividad-recursos" class="form-textarea-expanded" rows="3" 
                                  placeholder="Liste los recursos necesarios (humanos, materiales, financieros)..."></textarea>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="cerrarModalActividad()">
                Cancelar
            </button>
            <button class="btn btn-primary" onclick="guardarActividad()">
                <i class="fas fa-save"></i> Guardar Actividad
            </button>
        </div>
    </div>
</div>

<style>
    .estrategias-main-container {
        padding: 20px;
        background: linear-gradient(135deg, #f5f7fa 0%, #e4e8f0 100%);
        min-height: calc(100vh - 60px);
        height: auto;
        display: flex;
        flex-direction: column;
    }

    .estrategias-header {
        margin-bottom: 20px;
        flex-shrink: 0;
    }

    .content-title {
        color: #0c2461;
        margin-bottom: 8px;
        font-size: 28px;
        font-weight: 700;
        display: flex;
        align-items: center;
        gap: 15px;
        background: linear-gradient(135deg, #0c2461 0%, #1e3799 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .content-subtitle {
        color: #64748b;
        font-size: 15px;
        margin-left: 50px;
        font-weight: 500;
    }

    /* Dise√±o vertical principal */
    .estrategias-container-vertical {
        display: flex;
        flex-direction: column;
        gap: 20px;
        flex: 1;
        min-height: 0; /* Importante para el scroll interno */
    }

    /* Panel superior - Tabla de estrategias */
    .panel-superior {
        background: white;
        border-radius: 16px;
        box-shadow: 0 10px 25px rgba(12, 36, 97, 0.08);
        display: flex;
        flex-direction: column;
        overflow: hidden;
        border: 1px solid #e2e8f0;
        flex: 0 0 40%; /* 40% de la altura */
        min-height: 300px;
        max-height: 50vh;
    }

    /* Panel inferior - T√°cticas y actividades */
    .panel-inferior {
        background: white;
        border-radius: 16px;
        box-shadow: 0 10px 25px rgba(12, 36, 97, 0.08);
        display: flex;
        flex-direction: column;
        overflow: hidden;
        border: 1px solid #e2e8f0;
        flex: 0 0 60%; /* 60% de la altura */
        min-height: 400px;
        max-height: 60vh;
    }

    /* Cabeceras comunes */
    .panel-header {
        padding: 20px;
        border-bottom: 1px solid #f1f5f9;
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
        flex-shrink: 0;
    }

    .panel-header-right {
        display: flex;
        flex-direction: column;
        align-items: flex-end;
        gap: 10px;
    }

    .estadisticas-header {
        display: flex;
        gap: 20px;
    }

    .estadistica-header-item {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 13px;
        color: #475569;
        font-weight: 500;
        background: white;
        padding: 6px 12px;
        border-radius: 20px;
        border: 1px solid #e2e8f0;
    }

    .estadistica-header-item i {
        color: #0c2461;
        font-size: 14px;
    }

    .panel-title-container {
        display: flex;
        align-items: center;
        gap: 15px;
    }

    .panel-icon-badge {
        width: 48px;
        height: 48px;
        background: linear-gradient(135deg, #0c2461 0%, #1e3799 100%);
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 20px;
    }

    .panel-icon-badge.bg-blue {
        background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
    }

    .panel-title-container h2 {
        margin: 0;
        font-size: 18px;
        color: #0c2461;
        font-weight: 700;
    }

    .panel-subtitle {
        margin: 5px 0 0 0;
        font-size: 13px;
        color: #64748b;
    }

    .panel-actions {
        display: flex;
        gap: 12px;
    }

    .btn-refresh {
        padding: 10px 18px;
        background: linear-gradient(135deg, #0c2461 0%, #1e3799 100%);
        color: white;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 14px;
        font-weight: 600;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: 0 4px 12px rgba(12, 36, 97, 0.15);
    }

    .btn-refresh:hover {
        background: linear-gradient(135deg, #1e3799 0%, #0c2461 100%);
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(12, 36, 97, 0.2);
    }

    .btn-refresh:active {
        transform: translateY(0);
    }

    /* Filtros */
    .filtros-panel {
        padding: 15px 20px;
        border-bottom: 1px solid #f1f5f9;
        display: flex;
        gap: 15px;
        background: white;
        flex-shrink: 0;
    }

    .filtro-group {
        flex: 1;
    }

    .filtro-label {
        display: block;
        margin-bottom: 8px;
        font-size: 12px;
        font-weight: 600;
        color: #475569;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        display: flex;
        align-items: center;
        gap: 6px;
    }

    .filtro-select {
        width: 100%;
        padding: 11px 14px;
        border: 2px solid #e2e8f0;
        border-radius: 10px;
        font-size: 13px;
        background: white;
        cursor: pointer;
        transition: all 0.3s;
        color: #334155;
        font-weight: 500;
    }

    .filtro-select:focus {
        border-color: #3b82f6;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        outline: none;
    }

    /* Tabla de estrategias */
    .tabla-container {
        flex: 1;
        overflow-y: auto;
        padding: 0;
        min-height: 200px;
    }

    .tabla-estrategias {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
        font-size: 13px;
    }

    .tabla-estrategias thead {
        background: linear-gradient(135deg, #0c2461 0%, #1e3799 100%);
        color: white;
        position: sticky;
        top: 0;
        z-index: 10;
    }

    .tabla-estrategias th {
        padding: 15px 16px;
        text-align: left;
        font-weight: 600;
        font-size: 12px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        border-bottom: none;
    }

    .tabla-estrategias tbody tr {
        border-bottom: 1px solid #f1f5f9;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        cursor: pointer;
        height: 70px;
    }

    .tabla-estrategias tbody tr:hover {
        background: linear-gradient(90deg, rgba(12, 36, 97, 0.03) 0%, rgba(12, 36, 97, 0.01) 100%);
        transform: translateX(2px);
    }

    .tabla-estrategias tbody tr.selected {
        background: linear-gradient(90deg, rgba(12, 36, 97, 0.08) 0%, rgba(12, 36, 97, 0.04) 100%);
        border-left: 4px solid #0c2461;
        position: relative;
    }

    .tabla-estrategias td {
        padding: 16px;
        vertical-align: middle;
        border-bottom: 1px solid #f1f5f9;
    }

    .tabla-estrategias td:nth-child(3) {
        white-space: normal;
        max-height: 60px;
        overflow: hidden;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        line-height: 1.4;
        word-wrap: break-word;
        text-overflow: ellipsis;
    }

    .eje-badge {
        display: inline-block;
        padding: 5px 10px;
        border-radius: 20px;
        font-size: 11px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.3px;
        background: #f8fafc;
        border: 1px solid #e2e8f0;
        color: #475569;
    }

    .estrategia-tipo {
        display: inline-block;
        padding: 5px 10px;
        border-radius: 20px;
        font-size: 11px;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        color: white;
        min-width: 40px;
        text-align: center;
    }

    .btn-seleccionar {
        padding: 7px 14px;
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 12px;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 6px;
        transition: all 0.3s;
    }

    .btn-seleccionar:hover {
        background: linear-gradient(135deg, #059669 0%, #10b981 100%);
        transform: scale(1.05);
    }

    /* Informaci√≥n de estrategia seleccionada */
    .estrategia-seleccionada-info {
        margin-left: auto;
        text-align: right;
    }

    .estrategia-header {
        display: flex;
        flex-direction: column;
        align-items: flex-end;
        gap: 8px;
    }

    .estrategia-titulo {
        display: flex;
        align-items: center;
        gap: 12px;
        flex-wrap: wrap;
    }

    #nombre-eje-seleccionado {
        font-size: 16px;
        font-weight: 700;
        color: #0c2461;
        max-width: 300px;
        text-align: right;
        line-height: 1.4;
    }

    .badge-tipo {
        padding: 5px 12px;
        border-radius: 20px;
        font-size: 11px;
        font-weight: 700;
        text-transform: uppercase;
        color: white;
        letter-spacing: 0.5px;
    }

    .estrategia-metadata {
        display: flex;
        align-items: center;
        gap: 15px;
    }

    .metadata-chips {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
    }

    .chip {
        padding: 5px 10px;
        background: #f1f5f9;
        border-radius: 20px;
        font-size: 11px;
        color: #475569;
        display: flex;
        align-items: center;
        gap: 5px;
        font-weight: 500;
    }

    .chip i {
        color: #64748b;
    }

    /* Contenido de estrategia */
    .estrategia-detalle {
        flex: 1;
        display: flex;
        flex-direction: column;
        overflow: hidden;
    }

    .estrategia-vacia {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100%;
        padding: 40px 20px;
        text-align: center;
    }

    .vacia-illustration {
        width: 100px;
        height: 100px;
        background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 20px;
    }

    .vacia-illustration i {
        font-size: 40px;
        color: #94a3b8;
    }

    .estrategia-vacia h3 {
        color: #0c2461;
        font-size: 18px;
        margin-bottom: 10px;
        font-weight: 700;
    }

    .estrategia-vacia p {
        color: #64748b;
        font-size: 14px;
        line-height: 1.6;
        max-width: 400px;
        margin-bottom: 20px;
    }

    .vacia-tips {
        display: flex;
        flex-direction: column;
        gap: 12px;
        max-width: 400px;
        width: 100%;
    }

    .tip {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 12px;
        background: #f8fafc;
        border-radius: 10px;
        border-left: 4px solid #3b82f6;
    }

    .tip i {
        color: #3b82f6;
        font-size: 16px;
    }

    .tip span {
        color: #475569;
        font-size: 13px;
        font-weight: 500;
    }

    .estrategia-contenido {
        height: 100%;
        padding: 20px;
        display: flex;
        flex-direction: column;
        gap: 20px;
        overflow: hidden;
    }

    /* Texto de estrategia */
    .estrategia-texto-container {
        background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
        border-radius: 12px;
        padding: 20px;
        border: 1px solid #e2e8f0;
        flex-shrink: 0;
    }

    .estrategia-texto-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
    }

    .estrategia-texto-header h3 {
        margin: 0;
        font-size: 15px;
        color: #0c2461;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .estrategia-len {
        font-size: 11px;
        color: #64748b;
        font-weight: 500;
        padding: 4px 8px;
        background: white;
        border-radius: 10px;
        border: 1px solid #e2e8f0;
    }

    .estrategia-texto {
        color: #334155;
        font-size: 14px;
        line-height: 1.6;
        white-space: pre-wrap;
        word-wrap: break-word;
        max-height: 200px;
        overflow-y: auto;
        padding: 15px;
        background: white;
        border-radius: 8px;
        border: 1px solid #e2e8f0;
        margin-top: 10px;
    }

    /* Contenedor principal para t√°cticas y actividades */
    .tacticas-actividades-container {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 20px;
        overflow: hidden;
        min-height: 0;
    }

    /* Formulario de t√°ctica expandido */
    .formulario-tactica {
        background: linear-gradient(135deg, #ffffff 0%, #fdfdfe 100%);
        border-radius: 12px;
        padding: 20px;
        border: 2px solid #e2e8f0;
        transition: all 0.3s;
        flex-shrink: 0;
        min-height: 250px;
        max-height: 300px;
        overflow-y: auto;
    }

    .formulario-tactica:hover {
        border-color: #dbeafe;
        box-shadow: 0 8px 25px rgba(12, 36, 97, 0.05);
    }

    .form-header {
        margin-bottom: 20px;
    }

    .form-header h3 {
        margin: 0 0 8px 0;
        font-size: 16px;
        color: #0c2461;
        font-weight: 700;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .form-subtitle {
        color: #64748b;
        font-size: 13px;
        margin: 0;
    }

    /* Formularios expandidos */
    .form-grid-expanded {
        display: flex;
        flex-direction: column;
        gap: 15px;
        margin-bottom: 20px;
    }

    .form-row-expanded {
        display: grid;
        grid-template-columns: 1fr;
        gap: 15px;
    }

    @media (min-width: 768px) {
        .form-row-expanded {
            grid-template-columns: repeat(3, 1fr);
        }
        
        .form-row-expanded .form-group-expanded:nth-child(2) {
            grid-column: span 2;
        }
    }

    .form-group-expanded {
        display: flex;
        flex-direction: column;
        min-height: 90px;
    }

    .form-label {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 8px;
        font-weight: 600;
        color: #475569;
        font-size: 13px;
    }

    .form-label i {
        color: #3b82f6;
    }

    .form-input-expanded, .form-textarea-expanded, .form-select-expanded {
        padding: 12px;
        border: 2px solid #e2e8f0;
        border-radius: 10px;
        font-size: 13px;
        transition: all 0.3s;
        background: white;
        font-family: inherit;
        flex: 1;
        min-height: 46px;
    }

    .form-input-expanded:focus, .form-textarea-expanded:focus, .form-select-expanded:focus {
        border-color: #3b82f6;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        outline: none;
    }

    .form-textarea-expanded {
        resize: vertical;
        min-height: 100px;
    }

    .form-hint {
        font-size: 11px;
        color: #94a3b8;
        margin-top: 5px;
        font-style: italic;
    }

    .btn-agregar-tactica {
        width: 100%;
        padding: 14px;
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        color: white;
        border: none;
        border-radius: 10px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: 0 4px 15px rgba(16, 185, 129, 0.2);
    }

    .btn-agregar-tactica:hover {
        background: linear-gradient(135deg, #059669 0%, #10b981 100%);
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(16, 185, 129, 0.3);
    }

    .btn-agregar-tactica:active {
        transform: translateY(0);
    }

    /* Lista de t√°cticas expandida */
    .lista-tacticas-expanded {
        flex: 1;
        display: flex;
        flex-direction: column;
        overflow: hidden;
        min-height: 300px;
    }

    .lista-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        position: sticky;
        top: 0;
        background: white;
        padding: 0 0 15px 0;
        border-bottom: 1px solid #e2e8f0;
        z-index: 5;
        flex-shrink: 0;
    }

    .lista-header h3 {
        margin: 0;
        font-size: 16px;
        color: #0c2461;
        font-weight: 700;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .lista-filtros {
        display: flex;
        gap: 8px;
    }

    .btn-filtro {
        padding: 7px 14px;
        background: #f1f5f9;
        border: 2px solid #e2e8f0;
        border-radius: 8px;
        color: #64748b;
        font-size: 12px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
    }

    .btn-filtro:hover {
        background: #e2e8f0;
    }

    .btn-filtro.activo {
        background: #0c2461;
        border-color: #0c2461;
        color: white;
    }

    .tacticas-container-expanded {
        flex: 1;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        gap: 15px;
        padding-right: 5px;
        min-height: 200px;
    }

    /* Elementos de t√°ctica */
    .tactica-item {
        background: white;
        border-radius: 12px;
        padding: 20px;
        border: 2px solid #e2e8f0;
        transition: all 0.3s;
        flex-shrink: 0;
    }

    .tactica-item:hover {
        border-color: #dbeafe;
        box-shadow: 0 8px 25px rgba(12, 36, 97, 0.08);
    }

    .tactica-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 15px;
    }

    .tactica-titulo {
        font-size: 15px;
        font-weight: 700;
        color: #0c2461;
        margin: 0;
        flex: 1;
        line-height: 1.5;
        min-height: 24px;
    }

    .tactica-acciones {
        display: flex;
        gap: 8px;
    }

    .btn-agregar-actividad, .btn-eliminar-tactica, .btn-expandir-tactica {
        padding: 8px 14px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 12px;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 5px;
        transition: all 0.3s;
    }

    .btn-agregar-actividad {
        background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
        color: white;
    }

    .btn-agregar-actividad:hover {
        background: linear-gradient(135deg, #1d4ed8 0%, #3b82f6 100%);
        transform: scale(1.05);
    }

    .btn-eliminar-tactica {
        background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        color: white;
    }

    .btn-eliminar-tactica:hover {
        background: linear-gradient(135deg, #dc2626 0%, #ef4444 100%);
        transform: scale(1.05);
    }

    .btn-expandir-tactica {
        background: #f1f5f9;
        color: #475569;
        border: 1px solid #e2e8f0;
    }

    .btn-expandir-tactica:hover {
        background: #e2e8f0;
    }

    .tactica-detalle {
        color: #64748b;
        font-size: 14px;
        line-height: 1.6;
        margin: 15px 0;
        padding: 15px;
        background: #f8fafc;
        border-radius: 8px;
        border-left: 4px solid #3b82f6;
        max-height: 150px;
        overflow-y: auto;
        min-height: 60px;
    }

    .tactica-metadata {
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
        margin-bottom: 15px;
    }

    .metadata-item {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 12px;
        color: #475569;
        padding: 6px 12px;
        background: #f1f5f9;
        border-radius: 20px;
        min-height: 32px;
    }

    .metadata-item i {
        color: #64748b;
    }

    .lista-actividades {
        margin-top: 15px;
        max-height: 250px;
        overflow-y: auto;
        border-top: 1px solid #e2e8f0;
        padding-top: 15px;
        min-height: 60px;
    }

    /* Actividades */
    .actividad-item {
        background: white;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 10px;
        border-left: 4px solid #10b981;
        border: 1px solid #e2e8f0;
        display: grid;
        grid-template-columns: 1fr auto;
        gap: 15px;
        align-items: start;
        transition: all 0.3s;
        min-height: 100px;
    }

    .actividad-item:hover {
        transform: translateX(4px);
        border-color: #d1fae5;
    }

    .actividad-info {
        flex: 1;
    }

    .actividad-info h4 {
        margin: 0 0 8px 0;
        font-size: 14px;
        color: #334155;
        font-weight: 600;
        min-height: 20px;
    }

    .actividad-info p {
        margin: 0 0 10px 0;
        color: #64748b;
        font-size: 13px;
        line-height: 1.5;
        min-height: 40px;
    }

    .actividad-detalles {
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
        font-size: 11px;
        color: #94a3b8;
        min-height: 20px;
    }

    .actividad-estado {
        padding: 5px 10px;
        border-radius: 20px;
        font-size: 10px;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.3px;
        min-width: 90px;
        text-align: center;
        height: fit-content;
    }

    .actividad-estado.pendiente {
        background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
        color: #78350f;
    }

    .actividad-estado.en_progreso {
        background: linear-gradient(135deg, #60a5fa 0%, #3b82f6 100%);
        color: white;
    }

    .actividad-estado.completada {
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        color: white;
    }

    .actividad-estado.atrasada {
        background: linear-gradient(135deg, #f87171 0%, #ef4444 100%);
        color: white;
    }

    .contador-actividades {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 20px;
        height: 20px;
        background: #3b82f6;
        color: white;
        border-radius: 50%;
        font-size: 10px;
        font-weight: 600;
        margin-left: 8px;
    }

    /* Modal expandido */
    .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        z-index: 2000;
    }

    .modal.active {
        display: block;
    }

    .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(12, 36, 97, 0.7);
        backdrop-filter: blur(8px);
    }

    .modal-container-expanded {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        border-radius: 16px;
        width: 90%;
        max-width: 800px;
        max-height: 90vh;
        overflow: hidden;
        box-shadow: 0 25px 50px rgba(12, 36, 97, 0.2);
        animation: modalSlideIn 0.4s cubic-bezier(0.16, 1, 0.3, 1);
    }

    @keyframes modalSlideIn {
        from {
            opacity: 0;
            transform: translate(-50%, -60%);
        }
        to {
            opacity: 1;
            transform: translate(-50%, -50%);
        }
    }

    .modal-header {
        padding: 20px;
        border-bottom: 1px solid #f1f5f9;
        display: flex;
        align-items: center;
        gap: 15px;
        background: linear-gradient(135deg, #0c2461 0%, #1e3799 100%);
        color: white;
    }

    .modal-icon {
        width: 48px;
        height: 48px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
    }

    .modal-title h3 {
        margin: 0 0 5px 0;
        font-size: 18px;
        font-weight: 700;
    }

    .modal-subtitle {
        margin: 0;
        font-size: 13px;
        opacity: 0.9;
    }

    .modal-close {
        margin-left: auto;
        background: rgba(255, 255, 255, 0.2);
        border: none;
        color: white;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
        transition: all 0.3s;
    }

    .modal-close:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: rotate(90deg);
    }

    .modal-body-expanded {
        padding: 20px;
        max-height: calc(90vh - 180px);
        overflow-y: auto;
    }

    .form-grid-modal {
        display: flex;
        flex-direction: column;
        gap: 15px;
    }

    .modal-footer {
        padding: 20px;
        border-top: 1px solid #f1f5f9;
        display: flex;
        gap: 12px;
        justify-content: flex-end;
    }

    .btn {
        padding: 12px 24px;
        border: none;
        border-radius: 10px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
    }

    .btn-primary {
        background: linear-gradient(135deg, #0c2461 0%, #1e3799 100%);
        color: white;
    }

    .btn-primary:hover {
        background: linear-gradient(135deg, #1e3799 0%, #0c2461 100%);
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(12, 36, 97, 0.2);
    }

    .btn-secondary {
        background: #f1f5f9;
        color: #475569;
        border: 2px solid #e2e8f0;
    }

    .btn-secondary:hover {
        background: #e2e8f0;
    }

    /* Estados de expansi√≥n para t√°cticas */
    .tactica-item.expanded .tactica-detalle {
        max-height: none;
    }

    .tactica-item.expanded .lista-actividades {
        max-height: none;
    }

    /* Bot√≥n para expandir/contraer t√°ctica */
    .btn-expandir {
        background: none;
        border: none;
        color: #64748b;
        cursor: pointer;
        padding: 5px;
        font-size: 11px;
        display: flex;
        align-items: center;
        gap: 5px;
        margin-top: 5px;
    }

    .btn-expandir:hover {
        color: #0c2461;
    }

    /* Scrollbars personalizados */
    .tabla-container::-webkit-scrollbar,
    .tacticas-container-expanded::-webkit-scrollbar,
    .lista-actividades::-webkit-scrollbar,
    .estrategia-texto::-webkit-scrollbar,
    .formulario-tactica::-webkit-scrollbar,
    .modal-body-expanded::-webkit-scrollbar {
        width: 8px;
    }

    .tabla-container::-webkit-scrollbar-track,
    .tacticas-container-expanded::-webkit-scrollbar-track,
    .lista-actividades::-webkit-scrollbar-track,
    .estrategia-texto::-webkit-scrollbar-track,
    .formulario-tactica::-webkit-scrollbar-track,
    .modal-body-expanded::-webkit-scrollbar-track {
        background: #f1f5f9;
        border-radius: 4px;
    }

    .tabla-container::-webkit-scrollbar-thumb,
    .tacticas-container-expanded::-webkit-scrollbar-thumb,
    .lista-actividades::-webkit-scrollbar-thumb,
    .estrategia-texto::-webkit-scrollbar-thumb,
    .formulario-tactica::-webkit-scrollbar-thumb,
    .modal-body-expanded::-webkit-scrollbar-thumb {
        background: #cbd5e1;
        border-radius: 4px;
    }

    .tabla-container::-webkit-scrollbar-thumb:hover,
    .tacticas-container-expanded::-webkit-scrollbar-thumb:hover,
    .lista-actividades::-webkit-scrollbar-thumb:hover,
    .estrategia-texto::-webkit-scrollbar-thumb:hover,
    .formulario-tactica::-webkit-scrollbar-thumb:hover,
    .modal-body-expanded::-webkit-scrollbar-thumb:hover {
        background: #94a3b8;
    }

    /* Responsive Design */
    @media (max-width: 1200px) {
        .panel-superior, .panel-inferior {
            max-height: none;
        }
        
        .form-row-expanded {
            grid-template-columns: 1fr;
        }
    }

    @media (max-width: 768px) {
        .estrategias-main-container {
            padding: 15px;
        }
        
        .panel-header {
            flex-direction: column;
            gap: 15px;
            padding: 15px;
        }
        
        .panel-header-right {
            width: 100%;
            align-items: flex-start;
        }
        
        .estrategia-seleccionada-info {
            width: 100%;
            align-items: flex-start;
        }
        
        .filtros-panel {
            flex-direction: column;
            gap: 12px;
            padding: 15px;
        }
        
        .modal-container-expanded {
            width: 95%;
            border-radius: 12px;
        }
        
        .modal-header {
            flex-direction: column;
            text-align: center;
            gap: 12px;
            padding: 15px;
        }
        
        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
        }
        
        .lista-header {
            flex-direction: column;
            align-items: flex-start;
            gap: 10px;
        }
        
        .tactica-header {
            flex-direction: column;
            gap: 10px;
        }
        
        .tactica-acciones {
            width: 100%;
            justify-content: flex-start;
        }
    }

    /* Animaciones */
    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .tactica-item {
        animation: fadeIn 0.5s ease forwards;
    }

    .actividad-item {
        animation: fadeIn 0.3s ease forwards;
    }
</style>

<script>
    // Variables globales
    let estrategias = [];
    let estrategiasUnicas = []; // Almacenar√° las estrategias √∫nicas
    let estrategiaSeleccionadaId = null;
    let tacticaActualParaActividad = null;
    let tacticas = {};
    let actividadesCache = {};

    // Mapeo de ejes con emojis
    const mapEjes = {
        'educacion': 'üéì Educaci√≥n',
        'salud': 'üè• Salud', 
        'empleabilidad': 'üíº Empleabilidad',
        'desarrollo_economico': 'üìà Desarrollo Econ√≥mico',
        'sostenibilidad_ambiental': 'üíß Sostenibilidad Ambiental',
        'comunicacion': 'üì¢ Comunicaci√≥n',
        'institucional': 'üèõÔ∏è Institucional'
    };

    // Colores para tipos de estrategia
    const tipoColors = {
        'FO': '#2ecc71',
        'DO': '#3498db', 
        'FA': '#e67e22',
        'DA': '#9b59b6'
    };

    // Inicializar al cargar
    document.addEventListener('DOMContentLoaded', function() {
        cargarEstrategias();
        configurarFiltrosTacticas();
        configurarTextareasAutoexpansibles();
        
        // Ajustar altura inicial
        ajustarAlturasPaneles();
    });

    // Configurar textareas auto-expansibles
    function configurarTextareasAutoexpansibles() {
        document.querySelectorAll('.form-textarea-expanded').forEach(textarea => {
            textarea.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = (this.scrollHeight) + 'px';
            });
        });
    }

    // Configurar filtros de t√°cticas
    function configurarFiltrosTacticas() {
        document.querySelectorAll('.btn-filtro').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.btn-filtro').forEach(b => b.classList.remove('activo'));
                this.classList.add('activo');
                filtrarTacticas(this.dataset.filtro);
            });
        });
    }

    // Ajustar alturas de los paneles
    function ajustarAlturasPaneles() {
        const alturaVentana = window.innerHeight;
        const alturaDisponible = alturaVentana - 200; // Restar encabezados y m√°rgenes
        
        // Panel superior (40%)
        const panelSuperior = document.querySelector('.panel-superior');
        if (panelSuperior) {
            panelSuperior.style.minHeight = Math.max(300, alturaDisponible * 0.4) + 'px';
        }
        
        // Panel inferior (60%)
        const panelInferior = document.querySelector('.panel-inferior');
        if (panelInferior) {
            panelInferior.style.minHeight = Math.max(400, alturaDisponible * 0.6) + 'px';
        }
    }

    // Cargar estrategias desde la base de datos
    function cargarEstrategias() {
        const btnRefresh = document.querySelector('.btn-refresh');
        const originalHTML = btnRefresh.innerHTML;
        btnRefresh.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Cargando...';
        btnRefresh.disabled = true;

        fetch('/api/estrategias_foda_con_eje')
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    estrategias = data.estrategias;
                    
                    // Procesar estrategias para eliminar duplicados
                    procesarEstrategiasUnicas();
                    
                    actualizarTablaEstrategias();
                    actualizarEstadisticas();
                } else {
                    mostrarNotificacion('‚ùå Error al cargar estrategias', 'error');
                }
                
                btnRefresh.innerHTML = originalHTML;
                btnRefresh.disabled = false;
            })
            .catch(error => {
                console.error('Error:', error);
                mostrarNotificacion('‚ùå Error de conexi√≥n al servidor', 'error');
                btnRefresh.innerHTML = originalHTML;
                btnRefresh.disabled = false;
            });
    }

    // Procesar estrategias para eliminar duplicados
    function procesarEstrategiasUnicas() {
        // Usar un Map para agrupar por combinaci√≥n √∫nica de eje, tipo y texto de estrategia
        const estrategiasMap = new Map();
        
        estrategias.forEach(estrategia => {
            // Crear una clave √∫nica basada en eje_id, tipo_cruce y estrategia
            const clave = `${estrategia.eje_id}_${estrategia.tipo_cruce}_${estrategia.estrategia}`;
            
            if (!estrategiasMap.has(clave)) {
                // Si no existe, crear una nueva entrada con IDs relacionados
                estrategiasMap.set(clave, {
                    ...estrategia,
                    ids_relacionados: [estrategia.id],
                    // Para mostrar elementos FODA combinados
                    elementos_internos: [{
                        id: estrategia.elemento_interno_id,
                        tipo: estrategia.elemento_interno_tipo,
                        texto: estrategia.elemento_interno_texto
                    }],
                    elementos_externos: [{
                        id: estrategia.elemento_externo_id,
                        tipo: estrategia.elemento_externo_tipo,
                        texto: estrategia.elemento_externo_texto
                    }]
                });
            } else {
                // Si ya existe, agregar el ID a la lista de relacionados
                const existente = estrategiasMap.get(clave);
                existente.ids_relacionados.push(estrategia.id);
                
                // Agregar elementos √∫nicos a las listas
                const internoExiste = existente.elementos_internos.some(
                    e => e.id === estrategia.elemento_interno_id
                );
                if (!internoExiste) {
                    existente.elementos_internos.push({
                        id: estrategia.elemento_interno_id,
                        tipo: estrategia.elemento_interno_tipo,
                        texto: estrategia.elemento_interno_texto
                    });
                }
                
                const externoExiste = existente.elementos_externos.some(
                    e => e.id === estrategia.elemento_externo_id
                );
                if (!externoExiste) {
                    existente.elementos_externos.push({
                        id: estrategia.elemento_externo_id,
                        tipo: estrategia.elemento_externo_tipo,
                        texto: estrategia.elemento_externo_texto
                    });
                }
            }
        });
        
        // Convertir el Map a array y asignar a estrategiasUnicas
        estrategiasUnicas = Array.from(estrategiasMap.values());
    }

    // Actualizar estad√≠sticas
    function actualizarEstadisticas() {
        document.getElementById('total-estrategias').textContent = estrategiasUnicas.length;
        
        // Contar estrategias con t√°cticas
        let conTacticas = 0;
        Object.values(tacticas).forEach(t => {
            if (t && t.length > 0) conTacticas++;
        });
        document.getElementById('estrategias-con-tacticas').textContent = conTacticas;
    }

    // Actualizar la tabla de estrategias
    function actualizarTablaEstrategias() {
        const cuerpoTabla = document.getElementById('cuerpo-tabla-estrategias');
        cuerpoTabla.innerHTML = '';

        if (estrategiasUnicas.length === 0) {
            cuerpoTabla.innerHTML = `
                <tr>
                    <td colspan="4" style="text-align: center; padding: 50px;">
                        <div style="text-align: center; color: #94a3b8;">
                            <i class="fas fa-inbox" style="font-size: 48px; margin-bottom: 20px; opacity: 0.5;"></i>
                            <p style="font-size: 16px; font-weight: 600; margin-bottom: 10px;">No hay estrategias disponibles</p>
                            <p style="font-size: 14px;">Configure primero la matriz FODA para generar estrategias</p>
                        </div>
                    </td>
                </tr>
            `;
            return;
        }

        estrategiasUnicas.forEach(estrategia => {
            const fila = document.createElement('tr');
            // Usar el primer ID de los relacionados
            fila.dataset.id = estrategia.ids_relacionados[0];
            fila.onclick = () => seleccionarEstrategia(estrategia.ids_relacionados[0]);

            const tipoColor = tipoColors[estrategia.tipo_cruce] || '#0c2461';
            const ejeTexto = mapEjes[estrategia.eje_id] || estrategia.eje_id;

            fila.innerHTML = `
                <td>
                    <div class="eje-badge" style="background: ${tipoColor}15; border-color: ${tipoColor}30; color: ${tipoColor};">
                        ${ejeTexto}
                    </div>
                </td>
                <td>
                    <span class="estrategia-tipo" style="background: ${tipoColor}">
                        ${estrategia.tipo_cruce}
                    </span>
                </td>
                <td>
                    <div style="font-weight: 500; line-height: 1.5; color: #334155; font-size: 13px;">
                        ${estrategia.estrategia.substring(0, 120)}${estrategia.estrategia.length > 120 ? '...' : ''}
                        ${estrategia.ids_relacionados.length > 1 ? 
                          `<div style="margin-top: 5px; font-size: 11px; color: #64748b;">
                            <i class="fas fa-layer-group"></i> Combinada de ${estrategia.ids_relacionados.length} elementos FODA
                          </div>` : ''}
                    </div>
                </td>
                <td>
                    <button class="btn-seleccionar" onclick="seleccionarEstrategia(${estrategia.ids_relacionados[0]}); event.stopPropagation();">
                        <i class="fas fa-arrow-right"></i> Detalles
                    </button>
                </td>
            `;

            cuerpoTabla.appendChild(fila);
        });

        if (estrategiaSeleccionadaId) {
            const filaSeleccionada = document.querySelector(`tr[data-id="${estrategiaSeleccionadaId}"]`);
            if (filaSeleccionada) {
                seleccionarEstrategia(estrategiaSeleccionadaId);
            }
        }
    }

    // Filtrar estrategias en la tabla
    function filtrarEstrategiasTabla() {
        const filtroEje = document.getElementById('filtro-eje').value;
        const filtroTipo = document.getElementById('filtro-tipo').value;
        const filas = document.querySelectorAll('#cuerpo-tabla-estrategias tr');

        filas.forEach(fila => {
            if (fila.dataset.id) {
                // Buscar la estrategia √∫nica que contiene este ID
                const estrategia = estrategiasUnicas.find(e => 
                    e.ids_relacionados.includes(parseInt(fila.dataset.id))
                );
                if (!estrategia) return;

                const pasaEje = filtroEje === 'all' || estrategia.eje_id === filtroEje;
                const pasaTipo = filtroTipo === 'all' || estrategia.tipo_cruce === filtroTipo;

                fila.style.display = (pasaEje && pasaTipo) ? '' : 'none';
            }
        });
    }

    // Buscar estrategia por ID en las estrategias √∫nicas
    function buscarEstrategiaPorId(id) {
        return estrategiasUnicas.find(e => e.ids_relacionados.includes(parseInt(id)));
    }

    // Seleccionar una estrategia
    function seleccionarEstrategia(id) {
        estrategiaSeleccionadaId = id;
        const estrategia = buscarEstrategiaPorId(id);

        if (!estrategia) return;

        // Actualizar UI de selecci√≥n
        document.querySelectorAll('#cuerpo-tabla-estrategias tr').forEach(fila => {
            fila.classList.remove('selected');
        });
        const filaSeleccionada = document.querySelector(`tr[data-id="${id}"]`);
        if (filaSeleccionada) {
            filaSeleccionada.classList.add('selected');
        }

        // Mostrar informaci√≥n de la estrategia seleccionada
        const tipoColor = tipoColors[estrategia.tipo_cruce] || '#0c2461';
        document.getElementById('nombre-eje-seleccionado').textContent = 
            mapEjes[estrategia.eje_id] || estrategia.eje_id;
        document.getElementById('tipo-estrategia-seleccionada').textContent = estrategia.tipo_cruce;
        document.getElementById('tipo-estrategia-seleccionada').style.background = tipoColor;

        // Mostrar contenido de la estrategia
        document.getElementById('estrategia-vacia').style.display = 'none';
        document.getElementById('estrategia-contenido').style.display = 'block';
        
        // Construir texto completo con elementos FODA
        let textoCompleto = estrategia.estrategia;
        
        // Agregar informaci√≥n de elementos FODA si hay m√∫ltiples
        if (estrategia.ids_relacionados.length > 1) {
            textoCompleto += "\n\n--- Elementos FODA relacionados ---\n";
            
            // Elementos internos
            if (estrategia.elementos_internos.length > 0) {
                textoCompleto += "\nüîç Elementos Internos:\n";
                estrategia.elementos_internos.forEach((elem, index) => {
                    textoCompleto += `‚Ä¢ ${elem.tipo === 'fortaleza' ? '‚úÖ' : '‚ö†Ô∏è'} ${elem.texto}\n`;
                });
            }
            
            // Elementos externos
            if (estrategia.elementos_externos.length > 0) {
                textoCompleto += "\nüåê Elementos Externos:\n";
                estrategia.elementos_externos.forEach((elem, index) => {
                    textoCompleto += `‚Ä¢ ${elem.tipo === 'oportunidad' ? 'üéØ' : '‚ö†Ô∏è'} ${elem.texto}\n`;
                });
            }
        }
        
        document.getElementById('estrategia-texto').textContent = textoCompleto;
        document.getElementById('estrategia-len').textContent = `${estrategia.estrategia.length} caracteres`;

        // Cargar t√°cticas de esta estrategia (usar todos los IDs relacionados)
        cargarTacticasCombinadas(estrategia.ids_relacionados);
    }

    // Cargar t√°cticas combinadas para m√∫ltiples IDs de estrategia
    function cargarTacticasCombinadas(idsEstrategia) {
        // Crear un array de promesas para obtener t√°cticas de cada ID
        const promesasTacticas = idsEstrategia.map(id => 
            fetch(`/api/actividades_estrategia/${id}`)
                .then(response => response.json())
                .then(data => data.success ? data.actividades : [])
                .catch(error => {
                    console.error(`Error al cargar t√°cticas para estrategia ${id}:`, error);
                    return [];
                })
        );

        // Esperar a que todas las promesas se resuelvan
        Promise.all(promesasTacticas)
            .then(resultados => {
                // Combinar todas las t√°cticas en un solo array
                const todasTacticas = resultados.flat();
                
                // Filtrar duplicados (por nombre o ID)
                const tacticasUnicas = [];
                const tacticasVistas = new Set();
                
                todasTacticas.forEach(tactica => {
                    const clave = tactica.nombre.toLowerCase().trim();
                    if (!tacticasVistas.has(clave)) {
                        tacticasVistas.add(clave);
                        tacticasUnicas.push(tactica);
                    }
                });
                
                // Almacenar t√°cticas usando el primer ID como clave
                tacticas[idsEstrategia[0]] = tacticasUnicas;
                actualizarListaTacticas(idsEstrategia[0]);
                actualizarContadores(idsEstrategia[0]);
            })
            .catch(error => {
                console.error('Error al cargar t√°cticas combinadas:', error);
                tacticas[idsEstrategia[0]] = [];
                actualizarListaTacticas(idsEstrategia[0]);
                actualizarContadores(idsEstrategia[0]);
            });
    }

    // Actualizar contadores
    function actualizarContadores(estrategiaId) {
        const tacticasCount = tacticas[estrategiaId] ? tacticas[estrategiaId].length : 0;
        document.getElementById('contador-tacticas').textContent = tacticasCount;
        
        // Calcular total de actividades
        let actividadesCount = 0;
        if (tacticas[estrategiaId]) {
            tacticas[estrategiaId].forEach(t => {
                if (actividadesCache[t.id]) {
                    actividadesCount += actividadesCache[t.id].length;
                }
            });
        }
        document.getElementById('contador-actividades').textContent = actividadesCount;
    }

    // Actualizar lista de t√°cticas
    function actualizarListaTacticas(estrategiaId) {
        const container = document.getElementById('tacticas-container');
        container.innerHTML = '';

        if (!tacticas[estrategiaId] || tacticas[estrategiaId].length === 0) {
            container.innerHTML = `
                <div class="tactica-vacia" style="text-align: center; padding: 40px; color: #94a3b8;">
                    <i class="fas fa-project-diagram" style="font-size: 48px; margin-bottom: 20px; opacity: 0.5;"></i>
                    <h4 style="font-size: 16px; font-weight: 600; margin-bottom: 10px;">No hay t√°cticas definidas</h4>
                    <p style="font-size: 14px; max-width: 400px; margin: 0 auto;">Agregue la primera t√°ctica para comenzar el desglose operativo de esta estrategia.</p>
                </div>
            `;
            return;
        }

        tacticas[estrategiaId].forEach(tactica => {
            const tacticaDiv = document.createElement('div');
            tacticaDiv.className = 'tactica-item';
            tacticaDiv.dataset.id = tactica.id;
            tacticaDiv.innerHTML = actualizarHTMLTactica(tactica);

            container.appendChild(tacticaDiv);
            
            // Cargar actividades para esta t√°ctica
            cargarActividades(tactica.id);
        });
    }

    // Actualizar HTML de la t√°ctica
    function actualizarHTMLTactica(tactica) {
        const actividadesCount = actividadesCache[tactica.id] ? actividadesCache[tactica.id].length : 0;
        const fechaInicio = tactica.fecha_inicio ? 
            new Date(tactica.fecha_inicio).toLocaleDateString('es-ES', { day: 'numeric', month: 'short', year: 'numeric' }) : 
            'No definida';
        const fechaFin = tactica.fecha_fin ? 
            new Date(tactica.fecha_fin).toLocaleDateString('es-ES', { day: 'numeric', month: 'short', year: 'numeric' }) : 
            'No definida';

        return `
            <div class="tactica-header">
                <div style="flex: 1;">
                    <h3 class="tactica-titulo">
                        ${tactica.nombre}
                        ${actividadesCount > 0 ? 
                          `<span class="contador-actividades">${actividadesCount}</span>` : ''}
                    </h3>
                    <button class="btn-expandir" onclick="toggleExpandirTactica(${tactica.id})">
                        <i class="fas fa-chevron-down"></i>
                        <span>${actividadesCount} actividades</span>
                    </button>
                </div>
                <div class="tactica-acciones">
                    <button class="btn-agregar-actividad" onclick="abrirModalActividad(${tactica.id})">
                        <i class="fas fa-plus"></i> Actividad
                    </button>
                    <button class="btn-eliminar-tactica" onclick="eliminarTactica(${tactica.id})">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </div>
            <div class="tactica-detalle">
                ${tactica.descripcion || '<em>Sin descripci√≥n detallada</em>'}
            </div>
            <div class="tactica-metadata">
                <div class="metadata-item">
                    <i class="fas fa-user-tie"></i>
                    <span>${tactica.responsable || 'Sin responsable'}</span>
                </div>
                <div class="metadata-item">
                    <i class="fas fa-calendar-alt"></i>
                    <span>${fechaInicio} ‚Üí ${fechaFin}</span>
                </div>
            </div>
            <div class="lista-actividades" id="actividades-tactica-${tactica.id}">
                <!-- Las actividades se cargar√°n aqu√≠ din√°micamente -->
            </div>
        `;
    }

    // Toggle expandir/contraer t√°ctica
    function toggleExpandirTactica(tacticaId) {
        const tacticaItem = document.querySelector(`.tactica-item[data-id="${tacticaId}"]`);
        if (tacticaItem) {
            tacticaItem.classList.toggle('expanded');
            const btn = tacticaItem.querySelector('.btn-expandir i');
            if (btn) {
                if (tacticaItem.classList.contains('expanded')) {
                    btn.className = 'fas fa-chevron-up';
                } else {
                    btn.className = 'fas fa-chevron-down';
                }
            }
        }
    }

    // Filtrar t√°cticas
    function filtrarTacticas(filtro) {
        const tacticasItems = document.querySelectorAll('.tactica-item');
        
        tacticasItems.forEach(item => {
            if (filtro === 'todas') {
                item.style.display = 'flex';
                item.style.flexDirection = 'column';
            } else {
                // Implementar l√≥gica de filtrado seg√∫n estado
                item.style.display = 'flex';
                item.style.flexDirection = 'column';
            }
        });
    }

    // Agregar nueva t√°ctica
    function agregarTactica() {
        if (!estrategiaSeleccionadaId) {
            mostrarNotificacion('‚ùå Primero seleccione una estrategia', 'error');
            return;
        }

        const nombre = document.getElementById('tactica-nombre').value.trim();
        const descripcion = document.getElementById('tactica-descripcion').value.trim();
        const responsable = document.getElementById('tactica-responsable').value.trim();
        const fechaInicio = document.getElementById('tactica-fecha-inicio').value;
        const fechaFin = document.getElementById('tactica-fecha-fin').value;

        if (!nombre) {
            mostrarNotificacion('‚ùå El nombre de la t√°ctica es obligatorio', 'error');
            return;
        }

        // Encontrar la estrategia para obtener todos los IDs relacionados
        const estrategia = buscarEstrategiaPorId(estrategiaSeleccionadaId);
        if (!estrategia) {
            mostrarNotificacion('‚ùå Error: Estrategia no encontrada', 'error');
            return;
        }

        // Crear t√°ctica para el primer ID de estrategia
        const tactica = {
            estrategia_id: estrategia.ids_relacionados[0], // Usar el primer ID
            nombre: nombre,
            descripcion: descripcion,
            responsable: responsable,
            fecha_inicio: fechaInicio,
            fecha_fin: fechaFin
        };

        fetch('/api/agregar_actividad', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-Requested-With': 'XMLHttpRequest'
            },
            body: JSON.stringify(tactica)
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                mostrarNotificacion('‚úÖ T√°ctica agregada correctamente', 'success');
                
                // Limpiar formulario
                document.getElementById('tactica-nombre').value = '';
                document.getElementById('tactica-descripcion').value = '';
                document.getElementById('tactica-responsable').value = '';
                document.getElementById('tactica-fecha-inicio').value = '';
                document.getElementById('tactica-fecha-fin').value = '';
                
                // Recargar t√°cticas
                cargarTacticasCombinadas(estrategia.ids_relacionados);
                actualizarEstadisticas();
            } else {
                mostrarNotificacion('‚ùå Error: ' + data.message, 'error');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            mostrarNotificacion('‚ùå Error de conexi√≥n al servidor', 'error');
        });
    }

    // Eliminar t√°ctica
    function eliminarTactica(tacticaId) {
        if (!confirm('¬øEst√° seguro de eliminar esta t√°ctica y todas sus actividades?')) {
            return;
        }

        fetch(`/api/eliminar_actividad/${tacticaId}`, {
            method: 'DELETE',
            headers: {
                'X-Requested-With': 'XMLHttpRequest'
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                mostrarNotificacion('‚úÖ T√°ctica eliminada correctamente', 'success');
                
                // Encontrar la estrategia para recargar
                const estrategia = buscarEstrategiaPorId(estrategiaSeleccionadaId);
                if (estrategia) {
                    cargarTacticasCombinadas(estrategia.ids_relacionados);
                    actualizarEstadisticas();
                }
            } else {
                mostrarNotificacion('‚ùå Error: ' + data.message, 'error');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            mostrarNotificacion('‚ùå Error de conexi√≥n al servidor', 'error');
        });
    }

    // Abrir modal para agregar actividad
    function abrirModalActividad(tacticaId) {
        tacticaActualParaActividad = tacticaId;
        document.getElementById('modal-actividad').classList.add('active');
        document.body.style.overflow = 'hidden';
        
        // Ajustar altura del textarea
        setTimeout(() => {
            const textareaDesc = document.getElementById('actividad-descripcion');
            if (textareaDesc) {
                textareaDesc.style.height = 'auto';
                textareaDesc.style.height = (textareaDesc.scrollHeight) + 'px';
            }
        }, 100);
    }

    function cerrarModalActividad() {
        document.getElementById('modal-actividad').classList.remove('active');
        document.body.style.overflow = 'auto';
        
        // Limpiar formulario
        document.getElementById('actividad-nombre').value = '';
        document.getElementById('actividad-descripcion').value = '';
        document.getElementById('actividad-responsable').value = '';
        document.getElementById('actividad-fecha-inicio').value = '';
        document.getElementById('actividad-fecha-fin').value = '';
        document.getElementById('actividad-estado').value = 'pendiente';
        document.getElementById('actividad-recursos').value = '';
    }

    // Guardar actividad
    function guardarActividad() {
        if (!tacticaActualParaActividad) {
            mostrarNotificacion('‚ùå No hay t√°ctica seleccionada', 'error');
            return;
        }

        const nombre = document.getElementById('actividad-nombre').value.trim();
        const descripcion = document.getElementById('actividad-descripcion').value.trim();
        const responsable = document.getElementById('actividad-responsable').value.trim();
        const fechaInicio = document.getElementById('actividad-fecha-inicio').value;
        const fechaFin = document.getElementById('actividad-fecha-fin').value;
        const estado = document.getElementById('actividad-estado').value.split(' ')[0]; // Tomar solo el valor
        const recursos = document.getElementById('actividad-recursos').value.trim();

        if (!nombre) {
            mostrarNotificacion('‚ùå El nombre de la actividad es obligatorio', 'error');
            return;
        }

        const actividad = {
            actividad_id: tacticaActualParaActividad,
            nombre: nombre,
            descripcion: descripcion,
            responsable: responsable,
            fecha_inicio: fechaInicio,
            fecha_fin: fechaFin,
            estado: estado,
            recursos: recursos
        };

        fetch('/api/agregar_tarea', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-Requested-With': 'XMLHttpRequest'
            },
            body: JSON.stringify(actividad)
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                mostrarNotificacion('‚úÖ Actividad agregada correctamente', 'success');
                cerrarModalActividad();
                cargarActividades(tacticaActualParaActividad);
                actualizarContadores(estrategiaSeleccionadaId);
            } else {
                mostrarNotificacion('‚ùå Error: ' + data.message, 'error');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            mostrarNotificacion('‚ùå Error de conexi√≥n al servidor', 'error');
        });
    }

    // Cargar actividades para una t√°ctica
    function cargarActividades(tacticaId) {
        fetch(`/api/tareas_actividad/${tacticaId}`)
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    actividadesCache[tacticaId] = data.tareas;
                    actualizarListaActividades(tacticaId);
                    actualizarContadores(estrategiaSeleccionadaId);
                    
                    // Actualizar HTML de la t√°ctica para mostrar contador
                    const tacticaItem = document.querySelector(`.tactica-item[data-id="${tacticaId}"]`);
                    if (tacticaItem) {
                        // Buscar la t√°ctica en las t√°cticas almacenadas
                        const estrategia = buscarEstrategiaPorId(estrategiaSeleccionadaId);
                        if (estrategia && tacticas[estrategia.ids_relacionados[0]]) {
                            const tactica = tacticas[estrategia.ids_relacionados[0]].find(t => t.id == tacticaId);
                            if (tactica) {
                                tacticaItem.innerHTML = actualizarHTMLTactica(tactica);
                            }
                        }
                    }
                }
            })
            .catch(error => {
                console.error('Error al cargar actividades:', error);
                actividadesCache[tacticaId] = [];
                actualizarListaActividades(tacticaId);
            });
    }

    // Actualizar lista de actividades
    function actualizarListaActividades(tacticaId) {
        const container = document.getElementById(`actividades-tactica-${tacticaId}`);
        if (!container) return;

        container.innerHTML = '';

        if (!actividadesCache[tacticaId] || actividadesCache[tacticaId].length === 0) {
            container.innerHTML = `
                <div class="actividad-vacia" style="text-align: center; padding: 20px; color: #94a3b8; font-size: 13px;">
                    <i class="fas fa-tasks" style="margin-right: 8px;"></i> No hay actividades registradas
                </div>
            `;
            return;
        }

        actividadesCache[tacticaId].forEach(actividad => {
            const actividadDiv = document.createElement('div');
            actividadDiv.className = 'actividad-item';

            // Formatear fechas
            const fechaInicio = actividad.fecha_inicio ? 
                new Date(actividad.fecha_inicio).toLocaleDateString('es-ES', { day: 'numeric', month: 'short', year: 'numeric' }) : 
                'No definida';
            const fechaFin = actividad.fecha_fin ? 
                new Date(actividad.fecha_fin).toLocaleDateString('es-ES', { day: 'numeric', month: 'short', year: 'numeric' }) : 
                'No definida';

            // Texto del estado
            let estadoTexto = '';
            switch(actividad.estado) {
                case 'pendiente': estadoTexto = 'üü° Pendiente'; break;
                case 'en_progreso': estadoTexto = 'üîµ En Progreso'; break;
                case 'completada': estadoTexto = 'üü¢ Completada'; break;
                case 'atrasada': estadoTexto = 'üî¥ Atrasada'; break;
                default: estadoTexto = 'üü° Pendiente';
            }

            actividadDiv.innerHTML = `
                <div class="actividad-info">
                    <h4>${actividad.nombre}</h4>
                    <p>${actividad.descripcion || 'Sin descripci√≥n detallada'}</p>
                    <div class="actividad-detalles">
                        <span><i class="fas fa-user-check"></i> ${actividad.responsable || 'Sin responsable'}</span>
                        <span><i class="fas fa-calendar"></i> ${fechaInicio} - ${fechaFin}</span>
                        ${actividad.recursos ? `<span><i class="fas fa-toolbox"></i> Recursos</span>` : ''}
                    </div>
                </div>
                <div class="actividad-estado ${actividad.estado}">${estadoTexto}</div>
            `;

            container.appendChild(actividadDiv);
        });
    }

    // Funci√≥n para mostrar notificaciones mejoradas
    function mostrarNotificacion(mensaje, tipo) {
        let alerta = document.getElementById('alerta-flotante');
        
        if (!alerta) {
            alerta = document.createElement('div');
            alerta.id = 'alerta-flotante';
            alerta.style.cssText = `
                position: fixed;
                top: 30px;
                right: 30px;
                padding: 18px 24px;
                border-radius: 14px;
                color: white;
                font-weight: 600;
                z-index: 10000;
                box-shadow: 0 10px 30px rgba(0,0,0,0.2);
                transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
                transform: translateX(100%);
                opacity: 0;
                max-width: 400px;
                backdrop-filter: blur(10px);
                border-left: 6px solid;
                display: flex;
                align-items: center;
                gap: 15px;
            `;
            document.body.appendChild(alerta);
        }
        
        let background = '';
        let borderColor = '';
        
        if (tipo === 'success') {
            background = 'linear-gradient(135deg, rgba(16, 185, 129, 0.95) 0%, rgba(5, 150, 105, 0.95) 100%)';
            borderColor = '#059669';
        } else if (tipo === 'error') {
            background = 'linear-gradient(135deg, rgba(239, 68, 68, 0.95) 0%, rgba(220, 38, 38, 0.95) 100%)';
            borderColor = '#dc2626';
        } else if (tipo === 'warning') {
            background = 'linear-gradient(135deg, rgba(245, 158, 11, 0.95) 0%, rgba(217, 119, 6, 0.95) 100%)';
            borderColor = '#d97706';
        } else if (tipo === 'info') {
            background = 'linear-gradient(135deg, rgba(59, 130, 246, 0.95) 0%, rgba(29, 78, 216, 0.95) 100%)';
            borderColor = '#1d4ed8';
        } else {
            background = 'linear-gradient(135deg, rgba(12, 36, 97, 0.95) 0%, rgba(30, 55, 153, 0.95) 100%)';
            borderColor = '#0c2461';
        }
        
        alerta.style.background = background;
        alerta.style.borderLeftColor = borderColor;
        
        const icon = tipo === 'success' ? 'check-circle' : 
                    tipo === 'error' ? 'exclamation-circle' : 
                    tipo === 'warning' ? 'exclamation-triangle' : 'info-circle';
        
        alerta.innerHTML = `
            <i class="fas fa-${icon}" style="font-size: 24px;"></i>
            <div style="flex: 1;">${mensaje}</div>
        `;
        
        setTimeout(() => {
            alerta.style.transform = 'translateX(0)';
            alerta.style.opacity = '1';
        }, 10);
        
        setTimeout(() => {
            alerta.style.transform = 'translateX(100%)';
            alerta.style.opacity = '0';
        }, 4000);
    }

    // Escuchar cambios de tama√±o de ventana
    window.addEventListener('resize', ajustarAlturasPaneles);
</script>
{% endblock %}
