{% extends "inicio.html" %}

{% block content %}
<!-- Barra de Navegación Contextual -->
<!-- Contenido principal -->
<div class="foda-cruzado-main-container">
    <!-- Token CSRF para Flask -->
    <meta name="csrf-token" content="{{ csrf_token() }}">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
    
    <div class="header-container">
        <div class="header-content">
            <h1 class="content-title">
                <i class="fas fa-project-diagram"></i> Análisis FODA Cruzado
                <span class="title-badge">Modo Combinación Múltiple</span>
            </h1>
            <p class="content-subtitle">Combine múltiples elementos FODA para generar estrategias integrales y sinérgicas</p>
        </div>
        <div class="header-actions">
            <button class="btn-help" onclick="mostrarAyuda()">
                <i class="fas fa-question-circle"></i> Ayuda
            </button>
            <button class="btn-export" onclick="exportarEstrategias()">
                <i class="fas fa-file-export"></i> Exportar
            </button>
        </div>
    </div>
    
    <!-- Matriz FODA -->
    <div class="matriz-foda-section">
        <div class="section-header">
            <div class="section-title">
                <h2><i class="fas fa-th-large"></i> Matriz FODA</h2>
                <p class="section-description">Seleccione múltiples elementos de cada categoría para combinarlos</p>
            </div>
            <div class="section-actions">
                <div class="selection-counter">
                    <span class="counter-item">
                        <i class="fas fa-home" style="color: #3498db;"></i>
                        <span id="total-internos">0</span> internos
                    </span>
                    <span class="counter-item">
                        <i class="fas fa-external-link-alt" style="color: #2ecc71;"></i>
                        <span id="total-externos">0</span> externos
                    </span>
                </div>
            </div>
        </div>
        
        <div class="matriz-container">
            <div class="matriz-grid">
                <!-- Fortalezas -->
                <div class="foda-celda fortalezas">
                    <div class="celda-header">
                        <div class="celda-title">
                            <i class="fas fa-shield-alt"></i>
                            <h3>Fortalezas</h3>
                        </div>
                        <div class="celda-actions">
                            <button class="btn-select-all" onclick="seleccionarTodos('fortalezas')" title="Seleccionar todas">
                                <i class="fas fa-check-double"></i>
                            </button>
                            <button class="btn-clear-all" onclick="deseleccionarTodos('fortalezas')" title="Limpiar selección">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                    <div class="celda-body" id="lista-fortalezas">
                        {% for aspecto in aspectos_foda_int if aspecto.tipo == 'Positivo' %}
                        <div class="elemento-foda" data-id="{{ aspecto.id }}" data-tipo="fortaleza">
                            <div class="elemento-check">
                                <input type="checkbox" id="fortaleza-{{ aspecto.id }}" 
                                       onchange="toggleElementoSeleccionado('fortaleza', {{ aspecto.id }}, `{{ aspecto.actividad|replace('"', '\\"')|replace("'", "\\'") }}`)">
                                <label for="fortaleza-{{ aspecto.id }}"></label>
                            </div>
                            <div class="elemento-content" onclick="toggleCheckbox('fortaleza-{{ aspecto.id }}')">
                                <span class="elemento-text">{{ aspecto.actividad }}</span>
                            </div>
                            <div class="elemento-action">
                                <button class="btn-add" onclick="seleccionarParaCruce('fortaleza', {{ aspecto.id }}, `{{ aspecto.actividad|replace('"', '\\"')|replace("'", "\\'") }}`)">
                                    <i class="fas fa-plus-circle"></i>
                                </button>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    <div class="celda-footer">
                        <span class="counter-selected" id="fortalezas-seleccionadas">0 seleccionadas</span>
                    </div>
                </div>
                
                <!-- Oportunidades -->
                <div class="foda-celda oportunidades">
                    <div class="celda-header">
                        <div class="celda-title">
                            <i class="fas fa-bullseye"></i>
                            <h3>Oportunidades</h3>
                        </div>
                        <div class="celda-actions">
                            <button class="btn-select-all" onclick="seleccionarTodos('oportunidades')" title="Seleccionar todas">
                                <i class="fas fa-check-double"></i>
                            </button>
                            <button class="btn-clear-all" onclick="deseleccionarTodos('oportunidades')" title="Limpiar selección">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                    <div class="celda-body" id="lista-oportunidades">
                        {% for aspecto in aspectos_foda_ext if aspecto.tipo == 'Positivo' %}
                        <div class="elemento-foda" data-id="{{ aspecto.id }}" data-tipo="oportunidad">
                            <div class="elemento-check">
                                <input type="checkbox" id="oportunidad-{{ aspecto.id }}" 
                                       onchange="toggleElementoSeleccionado('oportunidad', {{ aspecto.id }}, `{{ aspecto.actividad|replace('"', '\\"')|replace("'", "\\'") }}`)">
                                <label for="oportunidad-{{ aspecto.id }}"></label>
                            </div>
                            <div class="elemento-content" onclick="toggleCheckbox('oportunidad-{{ aspecto.id }}')">
                                <span class="elemento-text">{{ aspecto.actividad }}</span>
                            </div>
                            <div class="elemento-action">
                                <button class="btn-add" onclick="seleccionarParaCruce('oportunidad', {{ aspecto.id }}, `{{ aspecto.actividad|replace('"', '\\"')|replace("'", "\\'") }}`)">
                                    <i class="fas fa-plus-circle"></i>
                                </button>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    <div class="celda-footer">
                        <span class="counter-selected" id="oportunidades-seleccionadas">0 seleccionadas</span>
                    </div>
                </div>
                
                <!-- Debilidades -->
                <div class="foda-celda debilidades">
                    <div class="celda-header">
                        <div class="celda-title">
                            <i class="fas fa-exclamation-triangle"></i>
                            <h3>Debilidades</h3>
                        </div>
                        <div class="celda-actions">
                            <button class="btn-select-all" onclick="seleccionarTodos('debilidades')" title="Seleccionar todas">
                                <i class="fas fa-check-double"></i>
                            </button>
                            <button class="btn-clear-all" onclick="deseleccionarTodos('debilidades')" title="Limpiar selección">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                    <div class="celda-body" id="lista-debilidades">
                        {% for aspecto in aspectos_foda_int if aspecto.tipo == 'Negativo' %}
                        <div class="elemento-foda" data-id="{{ aspecto.id }}" data-tipo="debilidad">
                            <div class="elemento-check">
                                <input type="checkbox" id="debilidad-{{ aspecto.id }}" 
                                       onchange="toggleElementoSeleccionado('debilidad', {{ aspecto.id }}, `{{ aspecto.actividad|replace('"', '\\"')|replace("'", "\\'") }}`)">
                                <label for="debilidad-{{ aspecto.id }}"></label>
                            </div>
                            <div class="elemento-content" onclick="toggleCheckbox('debilidad-{{ aspecto.id }}')">
                                <span class="elemento-text">{{ aspecto.actividad }}</span>
                            </div>
                            <div class="elemento-action">
                                <button class="btn-add" onclick="seleccionarParaCruce('debilidad', {{ aspecto.id }}, `{{ aspecto.actividad|replace('"', '\\"')|replace("'", "\\'") }}`)">
                                    <i class="fas fa-plus-circle"></i>
                                </button>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    <div class="celda-footer">
                        <span class="counter-selected" id="debilidades-seleccionadas">0 seleccionadas</span>
                    </div>
                </div>
                
                <!-- Amenazas -->
                <div class="foda-celda amenazas">
                    <div class="celda-header">
                        <div class="celda-title">
                            <i class="fas fa-skull-crossbones"></i>
                            <h3>Amenazas</h3>
                        </div>
                        <div class="celda-actions">
                            <button class="btn-select-all" onclick="seleccionarTodos('amenazas')" title="Seleccionar todas">
                                <i class="fas fa-check-double"></i>
                            </button>
                            <button class="btn-clear-all" onclick="deseleccionarTodos('amenazas')" title="Limpiar selección">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                    <div class="celda-body" id="lista-amenazas">
                        {% for aspecto in aspectos_foda_ext if aspecto.tipo == 'Negativo' %}
                        <div class="elemento-foda" data-id="{{ aspecto.id }}" data-tipo="amenaza">
                            <div class="elemento-check">
                                <input type="checkbox" id="amenaza-{{ aspecto.id }}" 
                                       onchange="toggleElementoSeleccionado('amenaza', {{ aspecto.id }}, `{{ aspecto.actividad|replace('"', '\\"')|replace("'", "\\'") }}`)">
                                <label for="amenaza-{{ aspecto.id }}"></label>
                            </div>
                            <div class="elemento-content" onclick="toggleCheckbox('amenaza-{{ aspecto.id }}')">
                                <span class="elemento-text">{{ aspecto.actividad }}</span>
                            </div>
                            <div class="elemento-action">
                                <button class="btn-add" onclick="seleccionarParaCruce('amenaza', {{ aspecto.id }}, `{{ aspecto.actividad|replace('"', '\\"')|replace("'", "\\'") }}`)">
                                    <i class="fas fa-plus-circle"></i>
                                </button>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    <div class="celda-footer">
                        <span class="counter-selected" id="amenazas-seleccionadas">0 seleccionadas</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Panel de Combinación -->
    <div class="combinacion-panel">
        <div class="panel-header">
            <div class="panel-title">
                <h2><i class="fas fa-sliders-h"></i> Panel de Combinación</h2>
                <p class="panel-description">Configure y combine los elementos seleccionados</p>
            </div>
            <div class="panel-stats">
                <div class="stat-item">
                    <i class="fas fa-calculator"></i>
                    <div class="stat-info">
                        <span class="stat-value" id="combinaciones-posibles">0</span>
                        <span class="stat-label">Combinaciones</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="panel-body">
            <div class="panel-left">
                <!-- Selector de Tipo de Cruce -->
                <div class="selector-tipo">
                    <h3><i class="fas fa-random"></i> Tipo de Cruce</h3>
                    <div class="tipo-grid">
                        <div class="tipo-item active" data-tipo="fo" onclick="seleccionarTipoCruce('fo')">
                            <div class="tipo-icon">
                                <i class="fas fa-plus-circle"></i>
                            </div>
                            <div class="tipo-info">
                                <span class="tipo-label">FO</span>
                                <span class="tipo-desc">Fortalezas + Oportunidades</span>
                            </div>
                        </div>
                        <div class="tipo-item" data-tipo="do" onclick="seleccionarTipoCruce('do')">
                            <div class="tipo-icon">
                                <i class="fas fa-arrow-circle-up"></i>
                            </div>
                            <div class="tipo-info">
                                <span class="tipo-label">DO</span>
                                <span class="tipo-desc">Debilidades + Oportunidades</span>
                            </div>
                        </div>
                        <div class="tipo-item" data-tipo="fa" onclick="seleccionarTipoCruce('fa')">
                            <div class="tipo-icon">
                                <i class="fas fa-shield-alt"></i>
                            </div>
                            <div class="tipo-info">
                                <span class="tipo-label">FA</span>
                                <span class="tipo-desc">Fortalezas + Amenazas</span>
                            </div>
                        </div>
                        <div class="tipo-item" data-tipo="da" onclick="seleccionarTipoCruce('da')">
                            <div class="tipo-icon">
                                <i class="fas fa-exclamation-triangle"></i>
                            </div>
                            <div class="tipo-info">
                                <span class="tipo-label">DA</span>
                                <span class="tipo-desc">Debilidades + Amenazas</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Elementos Seleccionados -->
                <div class="elementos-seleccionados">
                    <h3><i class="fas fa-check-circle"></i> Elementos Seleccionados</h3>
                    <div class="elementos-grid">
                        <div class="elementos-columna">
                            <div class="columna-header">
                                <i class="fas fa-home"></i>
                                <h4>Internos</h4>
                                <span class="columna-count" id="contador-internos">0</span>
                            </div>
                            <div class="elementos-list" id="panel-internos">
                                <div class="empty-state">
                                    <i class="fas fa-info-circle"></i>
                                    <p>No hay elementos seleccionados</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="elementos-columna">
                            <div class="columna-header">
                                <i class="fas fa-external-link-alt"></i>
                                <h4>Externos</h4>
                                <span class="columna-count" id="contador-externos">0</span>
                            </div>
                            <div class="elementos-list" id="panel-externos">
                                <div class="empty-state">
                                    <i class="fas fa-info-circle"></i>
                                    <p>No hay elementos seleccionados</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="panel-right">
                <!-- Formulario de Estrategia -->
                <div class="formulario-estrategia">
                    <div class="form-header">
                        <h3><i class="fas fa-lightbulb"></i> Generar Estrategia</h3>
                        <div class="form-subtitle">Complete los detalles para crear una nueva estrategia</div>
                    </div>
                    
                    <div class="form-body">
                        <!-- Eje Estratégico -->
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-bullseye"></i> Eje Estratégico
                            </label>
                            <div class="eje-selector">
                                <select id="eje-estrategico" class="form-control" onchange="actualizarEjeSeleccionado()">
                                    <option value="">Seleccione un eje estratégico</option>
                                    <option value="educacion">EDUCACIÓN</option>
                                    <option value="salud">SALUD</option>
                                    <option value="empleabilidad">EMPLEABILIDAD</option>
                                    <option value="desarrollo_economico">DESARROLLO ECONÓMICO</option>
                                    <option value="sostenibilidad_ambiental">SOSTENIBILIDAD AMBIENTAL (AGUA)</option>
                                    <option value="comunicacion">COMUNICACIÓN</option>
                                    <option value="institucional">INSTITUCIONAL</option>
                                </select>
                                <div class="eje-actions">
                                    <button type="button" class="btn-eje-action" onclick="seleccionarEjeActual()" title="Usar eje actual">
                                        <i class="fas fa-bolt"></i>
                                    </button>
                                    <button type="button" class="btn-eje-action" onclick="limpiarEjeSeleccionado()" title="Limpiar selección">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="eje-selected" id="eje-seleccionado-info">
                                <div class="eje-badge" id="badge-eje">
                                    <i class="fas fa-layer-group"></i>
                                    <span id="eje-texto">No se ha seleccionado ningún eje</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Opciones de Combinación -->
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-cogs"></i> Opciones de Combinación
                            </label>
                            <div class="opciones-combinacion">
                                <div class="opcion-item">
                                    <input type="checkbox" id="generar-todas-combinaciones" checked>
                                    <label for="generar-todas-combinaciones">
                                        <span class="opcion-title">Generar todas las combinaciones</span>
                                        <span class="opcion-desc">Crea estrategias para cada combinación posible</span>
                                    </label>
                                </div>
                                <div class="opcion-item">
                                    <input type="checkbox" id="estrategia-global" checked>
                                    <label for="estrategia-global">
                                        <span class="opcion-title">Estrategia global única</span>
                                        <span class="opcion-desc">Combina todos los elementos en una sola estrategia</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Descripción de la Estrategia -->
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-edit"></i> Estrategia Resultante
                            </label>
                            <div class="estrategia-guia">
                                <i class="fas fa-info-circle"></i>
                                <span id="texto-guia">¿Cómo usar las fortalezas para aprovechar las oportunidades?</span>
                            </div>
                            <textarea id="estrategia" class="form-control textarea-estrategia" 
                                      placeholder="Describa la estrategia resultante de la combinación de elementos seleccionados..."
                                      rows="6"></textarea>
                            <div class="textarea-actions">
                                <button class="btn-text-action" onclick="generarEstrategiaAutomatica()">
                                    <i class="fas fa-robot"></i> Sugerir estrategia
                                </button>
                                <button class="btn-text-action" onclick="limpiarEstrategia()">
                                    <i class="fas fa-eraser"></i> Limpiar
                                </button>
                            </div>
                        </div>
                        
                        <!-- Acciones -->
                        <div class="form-actions">
                            <button class="btn-primary" onclick="guardarEstrategiaMultiple()">
                                <i class="fas fa-save"></i>
                                <span>Guardar Estrategia</span>
                            </button>
                            <button class="btn-secondary" onclick="limpiarSelecciones()">
                                <i class="fas fa-redo"></i>
                                <span>Limpiar Todo</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Estrategias Generadas -->
    <div class="estrategias-section">
        <div class="section-header">
            <div class="section-title">
                <h2><i class="fas fa-list-check"></i> Estrategias Generadas</h2>
                <p class="section-description">Revise y gestione todas las estrategias creadas</p>
            </div>
            <div class="section-filters">
                <div class="filter-group">
                    <select id="filtro-tipo-estrategia" class="filter-select" onchange="filtrarEstrategias()">
                        <option value="all">Todos los tipos</option>
                        <option value="FO">FO - Fortalezas + Oportunidades</option>
                        <option value="DO">DO - Debilidades + Oportunidades</option>
                        <option value="FA">FA - Fortalezas + Amenazas</option>
                        <option value="DA">DA - Debilidades + Amenazas</option>
                    </select>
                    <select id="filtro-eje-estrategia" class="filter-select" onchange="filtrarEstrategias()">
                        <option value="all">Todos los ejes</option>
                        <option value="educacion">EDUCACIÓN</option>
                        <option value="salud">SALUD</option>
                        <option value="empleabilidad">EMPLEABILIDAD</option>
                        <option value="desarrollo_economico">DESARROLLO ECONÓMICO</option>
                        <option value="sostenibilidad_ambiental">SOSTENIBILIDAD AMBIENTAL</option>
                        <option value="comunicacion">COMUNICACIÓN</option>
                        <option value="institucional">INSTITUCIONAL</option>
                    </select>
                    <select id="filtro-combinacion" class="filter-select" onchange="filtrarEstrategias()">
                        <option value="all">Todas las combinaciones</option>
                        <option value="simple">Combinaciones simples</option>
                        <option value="multiple">Combinaciones múltiples</option>
                    </select>
                </div>
                <div class="filter-stats">
                    <span class="stat-total" id="total-estrategias">0</span> estrategias
                </div>
            </div>
        </div>
        
        <div class="estrategias-container">
            <div class="estrategias-list" id="lista-estrategias">
                <div class="empty-state">
                    <div class="empty-icon">
                        <i class="fas fa-inbox"></i>
                    </div>
                    <div class="empty-content">
                        <h3>No hay estrategias guardadas</h3>
                        <p>Comience a crear estrategias utilizando el panel de combinación</p>
                        <button class="btn-empty-action" onclick="scrollToCombinacion()">
                            <i class="fas fa-plus-circle"></i> Crear primera estrategia
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Dashboard de Métricas -->
    <div class="metrics-dashboard">
        <h2><i class="fas fa-chart-line"></i> Dashboard de Métricas</h2>
        <div class="metrics-grid">
            <div class="metric-card">
                <div class="metric-header">
                    <div class="metric-icon" style="background: linear-gradient(135deg, #4CAF50 0%, #2e7d32 100%);">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <div class="metric-info">
                        <span class="metric-title">Fortalezas</span>
                        <span class="metric-value">{{ aspectos_foda_int|selectattr('tipo', 'equalto', 'Positivo')|list|length }}</span>
                    </div>
                </div>
                <div class="metric-body">
                    <div class="metric-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" id="progress-fortalezas" style="width: 0%"></div>
                        </div>
                        <span class="progress-text" id="text-fortalezas">0 seleccionadas</span>
                    </div>
                </div>
            </div>
            
            <div class="metric-card">
                <div class="metric-header">
                    <div class="metric-icon" style="background: linear-gradient(135deg, #ff6b6b 0%, #c62828 100%);">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="metric-info">
                        <span class="metric-title">Debilidades</span>
                        <span class="metric-value">{{ aspectos_foda_int|selectattr('tipo', 'equalto', 'Negativo')|list|length }}</span>
                    </div>
                </div>
                <div class="metric-body">
                    <div class="metric-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" id="progress-debilidades" style="width: 0%"></div>
                        </div>
                        <span class="progress-text" id="text-debilidades">0 seleccionadas</span>
                    </div>
                </div>
            </div>
            
            <div class="metric-card">
                <div class="metric-header">
                    <div class="metric-icon" style="background: linear-gradient(135deg, #2196F3 0%, #0d47a1 100%);">
                        <i class="fas fa-bullseye"></i>
                    </div>
                    <div class="metric-info">
                        <span class="metric-title">Oportunidades</span>
                        <span class="metric-value">{{ aspectos_foda_ext|selectattr('tipo', 'equalto', 'Positivo')|list|length }}</span>
                    </div>
                </div>
                <div class="metric-body">
                    <div class="metric-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" id="progress-oportunidades" style="width: 0%"></div>
                        </div>
                        <span class="progress-text" id="text-oportunidades">0 seleccionadas</span>
                    </div>
                </div>
            </div>
            
            <div class="metric-card">
                <div class="metric-header">
                    <div class="metric-icon" style="background: linear-gradient(135deg, #9C27B0 0%, #6a1b9a 100%);">
                        <i class="fas fa-skull-crossbones"></i>
                    </div>
                    <div class="metric-info">
                        <span class="metric-title">Amenazas</span>
                        <span class="metric-value">{{ aspectos_foda_ext|selectattr('tipo', 'equalto', 'Negativo')|list|length }}</span>
                    </div>
                </div>
                <div class="metric-body">
                    <div class="metric-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" id="progress-amenazas" style="width: 0%"></div>
                        </div>
                        <span class="progress-text" id="text-amenazas">0 seleccionadas</span>
                    </div>
                </div>
            </div>
            
            <div class="metric-card highlight">
                <div class="metric-header">
                    <div class="metric-icon" style="background: linear-gradient(135deg, #FF9800 0%, #f57c00 100%);">
                        <i class="fas fa-project-diagram"></i>
                    </div>
                    <div class="metric-info">
                        <span class="metric-title">Combinaciones Activas</span>
                        <span class="metric-value" id="metric-combinaciones">0</span>
                    </div>
                </div>
                <div class="metric-body">
                    <div class="metric-relation">
                        <span class="relation-value" id="relacion-activa">0x0</span>
                        <span class="relation-label">Internos x Externos</span>
                    </div>
                </div>
            </div>
            
            <div class="metric-card highlight">
                <div class="metric-header">
                    <div class="metric-icon" style="background: linear-gradient(135deg, #00bcd4 0%, #0097a7 100%);">
                        <i class="fas fa-chess-board"></i>
                    </div>
                    <div class="metric-info">
                        <span class="metric-title">Estrategias Totales</span>
                        <span class="metric-value" id="metric-estrategias">0</span>
                    </div>
                </div>
                <div class="metric-body">
                    <div class="metric-breakdown">
                        <span class="breakdown-item">
                            <span class="breakdown-value" id="estrategias-multiples">0</span>
                            <span class="breakdown-label">Múltiples</span>
                        </span>
                        <span class="breakdown-item">
                            <span class="breakdown-value" id="estrategias-simples">0</span>
                            <span class="breakdown-label">Simples</span>
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    /* Variables CSS */
    :root {
        --primary-color: #3498db;
        --secondary-color: #2ecc71;
        --accent-color: #9b59b6;
        --warning-color: #f39c12;
        --danger-color: #e74c3c;
        --success-color: #27ae60;
        --dark-color: #2c3e50;
        --light-color: #ecf0f1;
        --gray-light: #95a5a6;
        --border-radius: 10px;
        --box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        --transition: all 0.3s ease;
    }
    
    /* Contenedor principal */
    .foda-cruzado-main-container {
        padding: 30px;
        background: linear-gradient(135deg, #f5f7fa 0%, #e4e8f0 100%);
        min-height: 100vh;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    /* Header */
    .header-container {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 30px;
    }
    
    .header-content {
        flex: 1;
    }
    
    .content-title {
        font-size: 32px;
        font-weight: 700;
        color: var(--dark-color);
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        gap: 15px;
    }
    
    .content-title i {
        color: var(--primary-color);
        font-size: 36px;
    }
    
    .title-badge {
        background: linear-gradient(135deg, var(--accent-color) 0%, #8e44ad 100%);
        color: white;
        padding: 6px 15px;
        border-radius: 20px;
        font-size: 14px;
        font-weight: 600;
        margin-left: 10px;
    }
    
    .content-subtitle {
        color: var(--gray-light);
        font-size: 16px;
        margin-bottom: 0;
    }
    
    .header-actions {
        display: flex;
        gap: 10px;
    }
    
    .btn-help, .btn-export {
        padding: 10px 20px;
        border: none;
        border-radius: var(--border-radius);
        font-weight: 600;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 8px;
        transition: var(--transition);
        font-size: 14px;
    }
    
    .btn-help {
        background: white;
        color: var(--dark-color);
        border: 2px solid var(--light-color);
    }
    
    .btn-help:hover {
        background: var(--light-color);
        border-color: var(--primary-color);
        transform: translateY(-2px);
    }
    
    .btn-export {
        background: linear-gradient(135deg, var(--success-color) 0%, #229954 100%);
        color: white;
    }
    
    .btn-export:hover {
        background: linear-gradient(135deg, #229954 0%, var(--success-color) 100%);
        transform: translateY(-2px);
        box-shadow: 0 6px 15px rgba(39, 174, 96, 0.2);
    }
    
    /* Secciones */
    .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 25px;
    }
    
    .section-title h2 {
        font-size: 24px;
        font-weight: 600;
        color: var(--dark-color);
        margin-bottom: 5px;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .section-title h2 i {
        color: var(--primary-color);
    }
    
    .section-description {
        color: var(--gray-light);
        font-size: 14px;
        margin: 0;
    }
    
    .selection-counter {
        display: flex;
        gap: 20px;
        background: white;
        padding: 12px 20px;
        border-radius: var(--border-radius);
        border: 2px solid var(--light-color);
    }
    
    .counter-item {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 14px;
        font-weight: 600;
        color: var(--dark-color);
    }
    
    .counter-item i {
        font-size: 16px;
    }
    
    /* Matriz FODA */
    .matriz-container {
        background: white;
        border-radius: var(--border-radius);
        padding: 25px;
        box-shadow: var(--box-shadow);
        margin-bottom: 30px;
    }
    
    .matriz-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 25px;
    }
    
    @media (max-width: 1200px) {
        .matriz-grid {
            grid-template-columns: 1fr;
        }
    }
    
    .foda-celda {
        border-radius: var(--border-radius);
        overflow: hidden;
        border: 1px solid rgba(0, 0, 0, 0.1);
        transition: var(--transition);
        background: white;
    }
    
    .foda-celda:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    }
    
    .foda-celda.fortalezas {
        border-top: 4px solid #4CAF50;
    }
    
    .foda-celda.oportunidades {
        border-top: 4px solid #2196F3;
    }
    
    .foda-celda.debilidades {
        border-top: 4px solid #ff6b6b;
    }
    
    .foda-celda.amenazas {
        border-top: 4px solid #9C27B0;
    }
    
    .celda-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px;
        background: rgba(0, 0, 0, 0.02);
        border-bottom: 1px solid rgba(0, 0, 0, 0.05);
    }
    
    .celda-title {
        display: flex;
        align-items: center;
        gap: 12px;
    }
    
    .celda-title i {
        font-size: 24px;
        width: 48px;
        height: 48px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 12px;
        color: white;
    }
    
    .foda-celda.fortalezas .celda-title i {
        background: linear-gradient(135deg, #4CAF50 0%, #2e7d32 100%);
    }
    
    .foda-celda.oportunidades .celda-title i {
        background: linear-gradient(135deg, #2196F3 0%, #0d47a1 100%);
    }
    
    .foda-celda.debilidades .celda-title i {
        background: linear-gradient(135deg, #ff6b6b 0%, #c62828 100%);
    }
    
    .foda-celda.amenazas .celda-title i {
        background: linear-gradient(135deg, #9C27B0 0%, #6a1b9a 100%);
    }
    
    .celda-title h3 {
        margin: 0;
        font-size: 18px;
        font-weight: 600;
        color: var(--dark-color);
    }
    
    .celda-actions {
        display: flex;
        gap: 10px;
    }
    
    .btn-select-all, .btn-clear-all {
        width: 40px;
        height: 40px;
        border: none;
        border-radius: 8px;
        background: var(--light-color);
        color: var(--dark-color);
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: var(--transition);
        font-size: 16px;
    }
    
    .btn-select-all:hover {
        background: var(--success-color);
        color: white;
        transform: scale(1.1);
    }
    
    .btn-clear-all:hover {
        background: var(--danger-color);
        color: white;
        transform: scale(1.1);
    }
    
    .celda-body {
        padding: 20px;
        max-height: 300px;
        overflow-y: auto;
    }
    
    .elemento-foda {
        display: flex;
        align-items: center;
        padding: 12px;
        border-radius: 8px;
        margin-bottom: 10px;
        background: white;
        border: 1px solid rgba(0, 0, 0, 0.05);
        transition: var(--transition);
    }
    
    .elemento-foda:hover {
        background: rgba(0, 0, 0, 0.02);
        transform: translateX(5px);
    }
    
    .elemento-foda.selected {
        background: rgba(52, 152, 219, 0.1);
        border-color: var(--primary-color);
    }
    
    .elemento-check {
        margin-right: 12px;
        position: relative;
    }
    
    .elemento-check input[type="checkbox"] {
        position: absolute;
        opacity: 0;
        cursor: pointer;
        height: 0;
        width: 0;
    }
    
    .elemento-check label {
        position: relative;
        cursor: pointer;
        width: 22px;
        height: 22px;
        border-radius: 6px;
        border: 2px solid var(--light-color);
        display: block;
        transition: var(--transition);
    }
    
    .elemento-check input:checked ~ label {
        background: var(--primary-color);
        border-color: var(--primary-color);
    }
    
    .elemento-check input:checked ~ label::after {
        content: '✓';
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: white;
        font-weight: bold;
        font-size: 14px;
    }
    
    .elemento-content {
        flex: 1;
        cursor: pointer;
    }
    
    .elemento-text {
        font-size: 14px;
        color: var(--dark-color);
        line-height: 1.5;
    }
    
    .elemento-action {
        margin-left: 10px;
    }
    
    .btn-add {
        width: 36px;
        height: 36px;
        border: none;
        border-radius: 50%;
        background: var(--light-color);
        color: var(--dark-color);
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: var(--transition);
        font-size: 14px;
    }
    
    .btn-add:hover {
        background: var(--primary-color);
        color: white;
        transform: scale(1.1);
    }
    
    .celda-footer {
        padding: 15px 20px;
        border-top: 1px solid rgba(0, 0, 0, 0.05);
        background: rgba(0, 0, 0, 0.02);
    }
    
    .counter-selected {
        font-size: 13px;
        color: var(--gray-light);
        font-weight: 600;
    }
    
    /* Panel de Combinación */
    .combinacion-panel {
        background: white;
        border-radius: var(--border-radius);
        box-shadow: var(--box-shadow);
        margin-bottom: 30px;
        overflow: hidden;
    }
    
    .panel-header {
        padding: 25px;
        background: linear-gradient(135deg, var(--dark-color) 0%, #34495e 100%);
        color: white;
    }
    
    .panel-title h2 {
        font-size: 24px;
        font-weight: 600;
        margin-bottom: 5px;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .panel-title h2 i {
        color: var(--accent-color);
    }
    
    .panel-description {
        color: rgba(255, 255, 255, 0.8);
        font-size: 14px;
        margin: 0;
    }
    
    .panel-stats {
        margin-top: 20px;
    }
    
    .stat-item {
        display: inline-flex;
        align-items: center;
        gap: 15px;
        background: rgba(255, 255, 255, 0.1);
        padding: 15px 25px;
        border-radius: var(--border-radius);
        backdrop-filter: blur(10px);
    }
    
    .stat-item i {
        font-size: 28px;
        color: var(--accent-color);
    }
    
    .stat-info {
        display: flex;
        flex-direction: column;
    }
    
    .stat-value {
        font-size: 32px;
        font-weight: 700;
        line-height: 1;
    }
    
    .stat-label {
        font-size: 13px;
        color: rgba(255, 255, 255, 0.7);
        text-transform: uppercase;
        letter-spacing: 1px;
    }
    
    .panel-body {
        display: grid;
        grid-template-columns: 2fr 3fr;
        gap: 0;
    }
    
    @media (max-width: 1200px) {
        .panel-body {
            grid-template-columns: 1fr;
        }
    }
    
    .panel-left {
        padding: 30px;
        border-right: 1px solid rgba(0, 0, 0, 0.05);
        background: rgba(0, 0, 0, 0.01);
    }
    
    .panel-right {
        padding: 30px;
    }
    
    /* Selector de Tipo */
    .selector-tipo {
        margin-bottom: 30px;
    }
    
    .selector-tipo h3 {
        font-size: 18px;
        font-weight: 600;
        color: var(--dark-color);
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .tipo-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 15px;
    }
    
    @media (max-width: 768px) {
        .tipo-grid {
            grid-template-columns: 1fr;
        }
    }
    
    .tipo-item {
        background: white;
        border: 2px solid var(--light-color);
        border-radius: var(--border-radius);
        padding: 20px;
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        align-items: center;
        gap: 15px;
    }
    
    .tipo-item:hover {
        border-color: var(--primary-color);
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }
    
    .tipo-item.active {
        border-color: var(--primary-color);
        background: linear-gradient(135deg, rgba(52, 152, 219, 0.1) 0%, rgba(52, 152, 219, 0.05) 100%);
    }
    
    .tipo-icon {
        width: 50px;
        height: 50px;
        border-radius: 12px;
        background: var(--light-color);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
        color: var(--dark-color);
        flex-shrink: 0;
    }
    
    .tipo-item.active .tipo-icon {
        background: linear-gradient(135deg, var(--primary-color) 0%, #2980b9 100%);
        color: white;
    }
    
    .tipo-info {
        flex: 1;
    }
    
    .tipo-label {
        display: block;
        font-size: 24px;
        font-weight: 700;
        color: var(--dark-color);
        line-height: 1;
        margin-bottom: 5px;
    }
    
    .tipo-item.active .tipo-label {
        color: var(--primary-color);
    }
    
    .tipo-desc {
        display: block;
        font-size: 12px;
        color: var(--gray-light);
        line-height: 1.3;
    }
    
    /* Elementos Seleccionados */
    .elementos-seleccionados h3 {
        font-size: 18px;
        font-weight: 600;
        color: var(--dark-color);
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .elementos-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 20px;
    }
    
    @media (max-width: 768px) {
        .elementos-grid {
            grid-template-columns: 1fr;
        }
    }
    
    .elementos-columna {
        background: white;
        border-radius: var(--border-radius);
        border: 1px solid rgba(0, 0, 0, 0.05);
        overflow: hidden;
    }
    
    .columna-header {
        padding: 15px;
        background: rgba(0, 0, 0, 0.02);
        border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .columna-header i {
        font-size: 18px;
        color: var(--primary-color);
    }
    
    .columna-header h4 {
        margin: 0;
        font-size: 16px;
        font-weight: 600;
        color: var(--dark-color);
        flex: 1;
    }
    
    .columna-count {
        background: var(--primary-color);
        color: white;
        width: 24px;
        height: 24px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 12px;
        font-weight: 600;
    }
    
    .elementos-list {
        max-height: 200px;
        overflow-y: auto;
        padding: 15px;
    }
    
    .elemento-seleccionado {
        display: flex;
        align-items: center;
        padding: 10px;
        border-radius: 8px;
        margin-bottom: 8px;
        background: white;
        border: 1px solid rgba(0, 0, 0, 0.05);
        transition: var(--transition);
    }
    
    .elemento-seleccionado:hover {
        background: rgba(0, 0, 0, 0.02);
    }
    
    .elemento-texto {
        flex: 1;
        font-size: 13px;
        color: var(--dark-color);
        line-height: 1.4;
        padding-right: 10px;
    }
    
    .elemento-remover {
        width: 24px;
        height: 24px;
        border: none;
        border-radius: 50%;
        background: var(--light-color);
        color: var(--dark-color);
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 10px;
        transition: var(--transition);
        flex-shrink: 0;
    }
    
    .elemento-remover:hover {
        background: var(--danger-color);
        color: white;
        transform: rotate(90deg);
    }
    
    .empty-state {
        text-align: center;
        padding: 40px 20px;
        color: var(--gray-light);
    }
    
    .empty-state i {
        font-size: 36px;
        margin-bottom: 15px;
        color: var(--light-color);
    }
    
    .empty-state p {
        margin: 0;
        font-size: 14px;
    }
    
    /* Formulario de Estrategia */
    .formulario-estrategia {
        height: 100%;
    }
    
    .form-header {
        margin-bottom: 25px;
    }
    
    .form-header h3 {
        font-size: 20px;
        font-weight: 600;
        color: var(--dark-color);
        margin-bottom: 5px;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .form-subtitle {
        color: var(--gray-light);
        font-size: 14px;
        margin: 0;
    }
    
    .form-body {
        display: flex;
        flex-direction: column;
        gap: 25px;
    }
    
    .form-group {
        margin-bottom: 0;
    }
    
    .form-label {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 14px;
        font-weight: 600;
        color: var(--dark-color);
        margin-bottom: 10px;
    }
    
    .form-label i {
        color: var(--primary-color);
    }
    
    .eje-selector {
        display: flex;
        gap: 10px;
    }
    
    .form-control {
        width: 100%;
        padding: 12px 15px;
        border: 2px solid var(--light-color);
        border-radius: 8px;
        font-size: 14px;
        background: white;
        transition: var(--transition);
        flex: 1;
    }
    
    .form-control:focus {
        border-color: var(--primary-color);
        outline: none;
        box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
    }
    
    .eje-actions {
        display: flex;
        gap: 5px;
    }
    
    .btn-eje-action {
        width: 44px;
        height: 44px;
        border: none;
        border-radius: 8px;
        background: var(--light-color);
        color: var(--dark-color);
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: var(--transition);
        font-size: 16px;
    }
    
    .btn-eje-action:hover {
        background: var(--primary-color);
        color: white;
        transform: scale(1.05);
    }
    
    .eje-selected {
        margin-top: 15px;
        display: none;
    }
    
    .eje-selected.active {
        display: block;
    }
    
    .eje-badge {
        display: inline-flex;
        align-items: center;
        gap: 10px;
        padding: 10px 20px;
        background: linear-gradient(135deg, rgba(52, 152, 219, 0.1) 0%, rgba(52, 152, 219, 0.05) 100%);
        border-radius: 20px;
        color: var(--primary-color);
        font-weight: 600;
        font-size: 14px;
        border: 1px solid rgba(52, 152, 219, 0.2);
    }
    
    .eje-badge i {
        color: var(--primary-color);
    }
    
    /* Opciones de Combinación */
    .opciones-combinacion {
        background: rgba(0, 0, 0, 0.02);
        padding: 20px;
        border-radius: var(--border-radius);
        border: 1px solid rgba(0, 0, 0, 0.05);
    }
    
    .opcion-item {
        display: flex;
        align-items: flex-start;
        gap: 15px;
        margin-bottom: 15px;
    }
    
    .opcion-item:last-child {
        margin-bottom: 0;
    }
    
    .opcion-item input[type="checkbox"] {
        width: 20px;
        height: 20px;
        cursor: pointer;
        accent-color: var(--primary-color);
        margin-top: 3px;
    }
    
    .opcion-item label {
        flex: 1;
        cursor: pointer;
    }
    
    .opcion-title {
        display: block;
        font-size: 14px;
        font-weight: 600;
        color: var(--dark-color);
        margin-bottom: 3px;
    }
    
    .opcion-desc {
        display: block;
        font-size: 13px;
        color: var(--gray-light);
        line-height: 1.4;
    }
    
    /* Textarea Estrategia */
    .estrategia-guia {
        display: flex;
        align-items: flex-start;
        gap: 10px;
        padding: 15px;
        background: linear-gradient(135deg, #fff9db 0%, #fff3cd 100%);
        border-radius: 8px;
        margin-bottom: 15px;
        border-left: 4px solid #ffd43b;
    }
    
    .estrategia-guia i {
        color: #f39c12;
        font-size: 18px;
        margin-top: 2px;
    }
    
    .estrategia-guia span {
        font-size: 13px;
        color: #856404;
        line-height: 1.5;
        flex: 1;
    }
    
    .textarea-estrategia {
        min-height: 150px;
        resize: vertical;
        font-family: inherit;
    }
    
    .textarea-actions {
        display: flex;
        gap: 10px;
        margin-top: 10px;
    }
    
    .btn-text-action {
        padding: 8px 15px;
        border: 2px solid var(--light-color);
        background: white;
        border-radius: 6px;
        font-size: 13px;
        font-weight: 600;
        color: var(--dark-color);
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 8px;
        transition: var(--transition);
    }
    
    .btn-text-action:hover {
        border-color: var(--primary-color);
        background: rgba(52, 152, 219, 0.1);
    }
    
    /* Botones de Acción */
    .form-actions {
        display: flex;
        gap: 15px;
        margin-top: 20px;
    }
    
    .btn-primary, .btn-secondary {
        padding: 15px 25px;
        border: none;
        border-radius: var(--border-radius);
        font-weight: 600;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 10px;
        transition: var(--transition);
        font-size: 15px;
        flex: 1;
        justify-content: center;
    }
    
    .btn-primary {
        background: linear-gradient(135deg, var(--primary-color) 0%, #2980b9 100%);
        color: white;
        box-shadow: 0 4px 15px rgba(52, 152, 219, 0.2);
    }
    
    .btn-primary:hover {
        background: linear-gradient(135deg, #2980b9 0%, var(--primary-color) 100%);
        transform: translateY(-3px);
        box-shadow: 0 6px 20px rgba(52, 152, 219, 0.3);
    }
    
    .btn-secondary {
        background: white;
        color: var(--dark-color);
        border: 2px solid var(--light-color);
    }
    
    .btn-secondary:hover {
        border-color: var(--danger-color);
        background: rgba(231, 76, 60, 0.1);
        transform: translateY(-3px);
    }
    
    /* Estrategias Generadas */
    .estrategias-section {
        background: white;
        border-radius: var(--border-radius);
        padding: 30px;
        box-shadow: var(--box-shadow);
        margin-bottom: 30px;
    }
    
    .section-filters {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 20px;
    }
    
    .filter-group {
        display: flex;
        gap: 15px;
        flex: 1;
    }
    
    .filter-select {
        padding: 10px 15px;
        border: 2px solid var(--light-color);
        border-radius: 8px;
        font-size: 14px;
        background: white;
        color: var(--dark-color);
        cursor: pointer;
        min-width: 200px;
        transition: var(--transition);
    }
    
    .filter-select:focus {
        border-color: var(--primary-color);
        outline: none;
    }
    
    .filter-stats {
        font-size: 14px;
        color: var(--gray-light);
    }
    
    .stat-total {
        font-size: 24px;
        font-weight: 700;
        color: var(--primary-color);
        margin-right: 5px;
    }
    
    .estrategias-container {
        margin-top: 25px;
    }
    
    .estrategias-list {
        display: flex;
        flex-direction: column;
        gap: 15px;
    }
    
    .estrategia-card {
        background: white;
        border-radius: var(--border-radius);
        border: 1px solid rgba(0, 0, 0, 0.05);
        overflow: hidden;
        transition: var(--transition);
    }
    
    .estrategia-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
    }
    
    .estrategia-card.multiple {
        border-left: 6px solid var(--accent-color);
    }
    
    .estrategia-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px;
        background: rgba(0, 0, 0, 0.02);
        border-bottom: 1px solid rgba(0, 0, 0, 0.05);
    }
    
    .estrategia-meta {
        display: flex;
        align-items: center;
        gap: 15px;
    }
    
    .estrategia-tipo {
        padding: 6px 15px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 700;
        letter-spacing: 0.5px;
        text-transform: uppercase;
    }
    
    .estrategia-tipo.fo {
        background: linear-gradient(135deg, #4CAF50 0%, #2e7d32 100%);
        color: white;
    }
    
    .estrategia-tipo.do {
        background: linear-gradient(135deg, #2196F3 0%, #0d47a1 100%);
        color: white;
    }
    
    .estrategia-tipo.fa {
        background: linear-gradient(135deg, #FF9800 0%, #f57c00 100%);
        color: white;
    }
    
    .estrategia-tipo.da {
        background: linear-gradient(135deg, #9C27B0 0%, #6a1b9a 100%);
        color: white;
    }
    
    .estrategia-fecha {
        font-size: 12px;
        color: var(--gray-light);
    }
    
    .estrategia-badges {
        display: flex;
        gap: 8px;
    }
    
    .badge-multiple {
        background: linear-gradient(135deg, var(--accent-color) 0%, #8e44ad 100%);
        color: white;
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 11px;
        font-weight: 600;
    }
    
    .badge-eje {
        background: rgba(52, 152, 219, 0.1);
        color: var(--primary-color);
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 11px;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 5px;
    }
    
    .estrategia-body {
        padding: 25px;
    }
    
    .estrategia-texto {
        font-size: 15px;
        color: var(--dark-color);
        line-height: 1.6;
        margin-bottom: 20px;
    }
    
    .estrategia-elementos {
        display: flex;
        flex-direction: column;
        gap: 15px;
    }
    
    .elementos-grupo {
        margin-bottom: 10px;
    }
    
    .grupo-titulo {
        font-size: 13px;
        font-weight: 600;
        color: var(--gray-light);
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 8px;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .grupo-items {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
    }
    
    .elemento-badge {
        padding: 6px 12px;
        border-radius: 6px;
        font-size: 12px;
        font-weight: 600;
        display: inline-flex;
        align-items: center;
        gap: 6px;
    }
    
    .badge-fortaleza {
        background: rgba(76, 175, 80, 0.1);
        color: #2e7d32;
        border: 1px solid rgba(76, 175, 80, 0.3);
    }
    
    .badge-debilidad {
        background: rgba(255, 107, 107, 0.1);
        color: #c62828;
        border: 1px solid rgba(255, 107, 107, 0.3);
    }
    
    .badge-oportunidad {
        background: rgba(33, 150, 243, 0.1);
        color: #0d47a1;
        border: 1px solid rgba(33, 150, 243, 0.3);
    }
    
    .badge-amenaza {
        background: rgba(156, 39, 176, 0.1);
        color: #6a1b9a;
        border: 1px solid rgba(156, 39, 176, 0.3);
    }
    
    .estrategia-footer {
        padding: 15px 25px;
        border-top: 1px solid rgba(0, 0, 0, 0.05);
        background: rgba(0, 0, 0, 0.02);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .estrategia-stats {
        display: flex;
        gap: 20px;
    }
    
    .stat-combinacion {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 13px;
        color: var(--gray-light);
    }
    
    .stat-combinacion i {
        color: var(--accent-color);
    }
    
    .estrategia-actions {
        display: flex;
        gap: 10px;
    }
    
    .btn-accion {
        padding: 8px 15px;
        border: none;
        border-radius: 6px;
        font-size: 13px;
        font-weight: 600;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 8px;
        transition: var(--transition);
    }
    
    .btn-accion.edit {
        background: rgba(52, 152, 219, 0.1);
        color: var(--primary-color);
    }
    
    .btn-accion.edit:hover {
        background: var(--primary-color);
        color: white;
    }
    
    .btn-accion.delete {
        background: rgba(231, 76, 60, 0.1);
        color: var(--danger-color);
    }
    
    .btn-accion.delete:hover {
        background: var(--danger-color);
        color: white;
    }
    
    .btn-empty-action {
        margin-top: 20px;
        padding: 12px 25px;
        border: none;
        border-radius: var(--border-radius);
        background: linear-gradient(135deg, var(--primary-color) 0%, #2980b9 100%);
        color: white;
        font-weight: 600;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 10px;
        transition: var(--transition);
    }
    
    .btn-empty-action:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 15px rgba(52, 152, 219, 0.2);
    }
    
    /* Dashboard de Métricas */
    .metrics-dashboard {
        background: white;
        border-radius: var(--border-radius);
        padding: 30px;
        box-shadow: var(--box-shadow);
    }
    
    .metrics-dashboard h2 {
        font-size: 24px;
        font-weight: 600;
        color: var(--dark-color);
        margin-bottom: 25px;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .metrics-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 25px;
    }
    
    @media (max-width: 1200px) {
        .metrics-grid {
            grid-template-columns: repeat(2, 1fr);
        }
    }
    
    @media (max-width: 768px) {
        .metrics-grid {
            grid-template-columns: 1fr;
        }
    }
    
    .metric-card {
        background: white;
        border-radius: var(--border-radius);
        padding: 25px;
        border: 1px solid rgba(0, 0, 0, 0.05);
        transition: var(--transition);
    }
    
    .metric-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
    }
    
    .metric-card.highlight {
        border: 2px solid var(--primary-color);
        background: linear-gradient(135deg, rgba(52, 152, 219, 0.02) 0%, rgba(52, 152, 219, 0.01) 100%);
    }
    
    .metric-header {
        display: flex;
        align-items: center;
        gap: 20px;
        margin-bottom: 20px;
    }
    
    .metric-icon {
        width: 60px;
        height: 60px;
        border-radius: 15px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        color: white;
        flex-shrink: 0;
    }
    
    .metric-info {
        flex: 1;
    }
    
    .metric-title {
        display: block;
        font-size: 14px;
        color: var(--gray-light);
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 5px;
    }
    
    .metric-value {
        display: block;
        font-size: 32px;
        font-weight: 700;
        color: var(--dark-color);
        line-height: 1;
    }
    
    .metric-body {
        margin-top: 15px;
    }
    
    .metric-progress {
        margin-bottom: 10px;
    }
    
    .progress-bar {
        height: 8px;
        background: var(--light-color);
        border-radius: 4px;
        overflow: hidden;
        margin-bottom: 8px;
    }
    
    .progress-fill {
        height: 100%;
        border-radius: 4px;
        transition: width 0.5s ease;
    }
    
    .progress-text {
        font-size: 12px;
        color: var(--gray-light);
        font-weight: 600;
    }
    
    .metric-relation {
        text-align: center;
        padding: 15px;
        background: rgba(0, 0, 0, 0.02);
        border-radius: var(--border-radius);
    }
    
    .relation-value {
        display: block;
        font-size: 28px;
        font-weight: 700;
        color: var(--primary-color);
        margin-bottom: 5px;
    }
    
    .relation-label {
        font-size: 12px;
        color: var(--gray-light);
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    .metric-breakdown {
        display: flex;
        justify-content: space-around;
        padding: 15px;
        background: rgba(0, 0, 0, 0.02);
        border-radius: var(--border-radius);
    }
    
    .breakdown-item {
        text-align: center;
    }
    
    .breakdown-value {
        display: block;
        font-size: 24px;
        font-weight: 700;
        color: var(--dark-color);
        margin-bottom: 3px;
    }
    
    .breakdown-label {
        font-size: 12px;
        color: var(--gray-light);
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    /* Responsive */
    @media (max-width: 768px) {
        .foda-cruzado-main-container {
            padding: 15px;
        }
        
        .header-container {
            flex-direction: column;
            gap: 15px;
        }
        
        .header-actions {
            width: 100%;
        }
        
        .btn-help, .btn-export {
            flex: 1;
        }
        
        .section-header {
            flex-direction: column;
            align-items: flex-start;
            gap: 15px;
        }
        
        .filter-group {
            flex-direction: column;
        }
        
        .filter-select {
            min-width: 100%;
        }
        
        .form-actions {
            flex-direction: column;
        }
    }
    
    /* Scrollbar personalizada */
    .celda-body::-webkit-scrollbar,
    .elementos-list::-webkit-scrollbar,
    .estrategias-list::-webkit-scrollbar {
        width: 6px;
    }
    
    .celda-body::-webkit-scrollbar-track,
    .elementos-list::-webkit-scrollbar-track,
    .estrategias-list::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 3px;
    }
    
    .celda-body::-webkit-scrollbar-thumb,
    .elementos-list::-webkit-scrollbar-thumb,
    .estrategias-list::-webkit-scrollbar-thumb {
        background: #c1c1c1;
        border-radius: 3px;
    }
    
    .celda-body::-webkit-scrollbar-thumb:hover,
    .elementos-list::-webkit-scrollbar-thumb:hover,
    .estrategias-list::-webkit-scrollbar-thumb:hover {
        background: #a1a1a1;
    }
    
    /* Animaciones */
    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    .elemento-foda {
        animation: fadeIn 0.3s ease forwards;
        opacity: 0;
    }
    
    .elemento-foda:nth-child(1) { animation-delay: 0.1s; }
    .elemento-foda:nth-child(2) { animation-delay: 0.2s; }
    .elemento-foda:nth-child(3) { animation-delay: 0.3s; }
    .elemento-foda:nth-child(4) { animation-delay: 0.4s; }
    .elemento-foda:nth-child(5) { animation-delay: 0.5s; }
    .elemento-foda:nth-child(6) { animation-delay: 0.6s; }
    
    /* Notificaciones */
    .notification-container {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 10000;
        max-width: 400px;
    }
    
    .notification {
        background: white;
        border-radius: var(--border-radius);
        padding: 20px;
        margin-bottom: 15px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        border-left: 4px solid var(--primary-color);
        transform: translateX(100%);
        transition: transform 0.3s ease;
        display: flex;
        align-items: flex-start;
        gap: 15px;
    }
    
    .notification.show {
        transform: translateX(0);
    }
    
    .notification-icon {
        font-size: 24px;
        margin-top: 2px;
    }
    
    .notification.success .notification-icon {
        color: var(--success-color);
    }
    
    .notification.error .notification-icon {
        color: var(--danger-color);
    }
    
    .notification.warning .notification-icon {
        color: var(--warning-color);
    }
    
    .notification.info .notification-icon {
        color: var(--primary-color);
    }
    
    .notification-content {
        flex: 1;
    }
    
    .notification-title {
        font-weight: 600;
        margin-bottom: 5px;
        color: var(--dark-color);
    }
    
    .notification-message {
        font-size: 14px;
        color: var(--gray-light);
        line-height: 1.5;
    }
</style>

<script>
    // Variables globales
    let tipoCruceActual = 'fo';
    let elementosInternos = [];
    let elementosExternos = [];
    let estrategiasGuardadas = [];
    let ejeSeleccionado = null;
    let ejeSeleccionadoTexto = '';
    let ejeActivo = null;
    
    // Inicializar al cargar
    document.addEventListener('DOMContentLoaded', function() {
        inicializarUI();
        cargarEstrategias();  // Cargar estrategias desde la base de datos
        actualizarEstadisticas();
        actualizarEjeSeleccionado();
        
        // Cargar eje activo desde localStorage
        const ejeGuardado = localStorage.getItem('ejeActivo');
        if (ejeGuardado) {
            try {
                ejeActivo = JSON.parse(ejeGuardado);
            } catch (e) {
                console.error('Error al cargar eje activo:', e);
            }
        }
    });
    
    function inicializarUI() {
        // Inicializar contadores
        actualizarContadores();
        
        // Configurar tooltips
        inicializarTooltips();
        
        // Configurar eventos
        configurarEventos();
    }
    
    function configurarEventos() {
        // Evento para limpiar todo con Escape
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                limpiarSelecciones();
            }
            
            // Atajo para generar estrategia automática
            if (e.ctrlKey && e.key === 'Enter') {
                e.preventDefault();
                generarEstrategiaAutomatica();
            }
        });
    }
    
    function inicializarTooltips() {
        // Inicializar tooltips si se usa una librería
        // Por ahora, usaremos atributos title nativos
    }
    
    // Funciones de selección múltiple
    function toggleCheckbox(id) {
        const checkbox = document.getElementById(id);
        if (checkbox) {
            checkbox.checked = !checkbox.checked;
            checkbox.dispatchEvent(new Event('change'));
        }
    }
    
    function toggleElementoSeleccionado(tipo, id, texto) {
        const checkbox = document.getElementById(`${tipo}-${id}`);
        const elementoDiv = checkbox.closest('.elemento-foda');
        
        if (checkbox.checked) {
            agregarElementoSeleccionado(tipo, id, texto, elementoDiv);
        } else {
            removerElementoSeleccionado(tipo, id, elementoDiv);
        }
        
        actualizarContadores();
        actualizarPanelesSeleccion();
        actualizarEstadisticas();
    }
    
    function agregarElementoSeleccionado(tipo, id, texto, elementoDiv) {
        const elemento = { id, tipo, texto };
        
        if (tipo === 'fortaleza' || tipo === 'debilidad') {
            if (!elementosInternos.some(e => e.id === id)) {
                elementosInternos.push(elemento);
                elementoDiv.classList.add('selected');
            }
        } else {
            if (!elementosExternos.some(e => e.id === id)) {
                elementosExternos.push(elemento);
                elementoDiv.classList.add('selected');
            }
        }
        
        mostrarNotificacion('success', 'Elemento agregado', `${texto.substring(0, 50)}... agregado a la selección`);
    }
    
    function removerElementoSeleccionado(tipo, id, elementoDiv) {
        if (tipo === 'fortaleza' || tipo === 'debilidad') {
            elementosInternos = elementosInternos.filter(e => e.id !== id);
        } else {
            elementosExternos = elementosExternos.filter(e => e.id !== id);
        }
        
        elementoDiv.classList.remove('selected');
    }
    
    function seleccionarParaCruce(tipo, id, texto) {
        const checkbox = document.getElementById(`${tipo}-${id}`);
        if (!checkbox.checked) {
            checkbox.checked = true;
            toggleElementoSeleccionado(tipo, id, texto);
        }
    }
    
    function seleccionarTodos(tipo) {
        let selector;
        let tipoElemento;
        
        switch(tipo) {
            case 'fortalezas':
                selector = '#lista-fortalezas input[type="checkbox"]';
                tipoElemento = 'fortaleza';
                break;
            case 'debilidades':
                selector = '#lista-debilidades input[type="checkbox"]';
                tipoElemento = 'debilidad';
                break;
            case 'oportunidades':
                selector = '#lista-oportunidades input[type="checkbox"]';
                tipoElemento = 'oportunidad';
                break;
            case 'amenazas':
                selector = '#lista-amenazas input[type="checkbox"]';
                tipoElemento = 'amenaza';
                break;
        }
        
        const checkboxes = document.querySelectorAll(selector);
        checkboxes.forEach(checkbox => {
            if (!checkbox.checked) {
                checkbox.checked = true;
                const id = checkbox.id.split('-')[1];
                const elementoDiv = checkbox.closest('.elemento-foda');
                const texto = elementoDiv.querySelector('.elemento-text').textContent;
                
                agregarElementoSeleccionado(tipoElemento, parseInt(id), texto, elementoDiv);
            }
        });
        
        mostrarNotificacion('success', 'Selección completa', `Todos los elementos de ${tipo} han sido seleccionados`);
    }
    
    function deseleccionarTodos(tipo) {
        let selector;
        let tipoElemento;
        
        switch(tipo) {
            case 'fortalezas':
                selector = '#lista-fortalezas input[type="checkbox"]';
                tipoElemento = 'fortaleza';
                break;
            case 'debilidades':
                selector = '#lista-debilidades input[type="checkbox"]';
                tipoElemento = 'debilidad';
                break;
            case 'oportunidades':
                selector = '#lista-oportunidades input[type="checkbox"]';
                tipoElemento = 'oportunidad';
                break;
            case 'amenazas':
                selector = '#lista-amenazas input[type="checkbox"]';
                tipoElemento = 'amenaza';
                break;
        }
        
        const checkboxes = document.querySelectorAll(selector);
        checkboxes.forEach(checkbox => {
            if (checkbox.checked) {
                checkbox.checked = false;
                const id = checkbox.id.split('-')[1];
                const elementoDiv = checkbox.closest('.elemento-foda');
                removerElementoSeleccionado(tipoElemento, parseInt(id), elementoDiv);
            }
        });
        
        mostrarNotificacion('info', 'Selección limpiada', `Todos los elementos de ${tipo} han sido deseleccionados`);
    }
    
    function actualizarContadores() {
        // Contadores generales
        document.getElementById('total-internos').textContent = elementosInternos.length;
        document.getElementById('total-externos').textContent = elementosExternos.length;
        
        // Contadores por categoría
        document.getElementById('fortalezas-seleccionadas').textContent = 
            `${elementosInternos.filter(e => e.tipo === 'fortaleza').length} seleccionadas`;
        
        document.getElementById('debilidades-seleccionadas').textContent = 
            `${elementosInternos.filter(e => e.tipo === 'debilidad').length} seleccionadas`;
        
        document.getElementById('oportunidades-seleccionadas').textContent = 
            `${elementosExternos.filter(e => e.tipo === 'oportunidad').length} seleccionadas`;
        
        document.getElementById('amenazas-seleccionadas').textContent = 
            `${elementosExternos.filter(e => e.tipo === 'amenaza').length} seleccionadas`;
        
        // Contadores de paneles
        document.getElementById('contador-internos').textContent = elementosInternos.length;
        document.getElementById('contador-externos').textContent = elementosExternos.length;
    }
    
    function actualizarPanelesSeleccion() {
        const panelInternos = document.getElementById('panel-internos');
        const panelExternos = document.getElementById('panel-externos');
        
        // Actualizar panel internos
        if (elementosInternos.length === 0) {
            panelInternos.innerHTML = `
                <div class="empty-state">
                    <i class="fas fa-info-circle"></i>
                    <p>No hay elementos seleccionados</p>
                </div>
            `;
        } else {
            panelInternos.innerHTML = '';
            elementosInternos.forEach((elemento, index) => {
                const div = document.createElement('div');
                div.className = 'elemento-seleccionado';
                div.innerHTML = `
                    <div class="elemento-texto">${index + 1}. ${elemento.texto.substring(0, 80)}${elemento.texto.length > 80 ? '...' : ''}</div>
                    <button class="elemento-remover" onclick="removerElementoDelPanel('interno', ${elemento.id})">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                panelInternos.appendChild(div);
            });
        }
        
        // Actualizar panel externos
        if (elementosExternos.length === 0) {
            panelExternos.innerHTML = `
                <div class="empty-state">
                    <i class="fas fa-info-circle"></i>
                    <p>No hay elementos seleccionados</p>
                </div>
            `;
        } else {
            panelExternos.innerHTML = '';
            elementosExternos.forEach((elemento, index) => {
                const div = document.createElement('div');
                div.className = 'elemento-seleccionado';
                div.innerHTML = `
                    <div class="elemento-texto">${index + 1}. ${elemento.texto.substring(0, 80)}${elemento.texto.length > 80 ? '...' : ''}</div>
                    <button class="elemento-remover" onclick="removerElementoDelPanel('externo', ${elemento.id})">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                panelExternos.appendChild(div);
            });
        }
    }
    
    function removerElementoDelPanel(tipo, id) {
        if (tipo === 'interno') {
            elementosInternos = elementosInternos.filter(e => e.id !== id);
            const checkbox = document.getElementById(`fortaleza-${id}`) || document.getElementById(`debilidad-${id}`);
            if (checkbox) {
                checkbox.checked = false;
                checkbox.closest('.elemento-foda').classList.remove('selected');
            }
        } else {
            elementosExternos = elementosExternos.filter(e => e.id !== id);
            const checkbox = document.getElementById(`oportunidad-${id}`) || document.getElementById(`amenaza-${id}`);
            if (checkbox) {
                checkbox.checked = false;
                checkbox.closest('.elemento-foda').classList.remove('selected');
            }
        }
        
        actualizarContadores();
        actualizarPanelesSeleccion();
        actualizarEstadisticas();
    }
    
    function actualizarEstadisticas() {
        // Calcular combinaciones posibles
        const combinaciones = elementosInternos.length * elementosExternos.length;
        document.getElementById('combinaciones-posibles').textContent = combinaciones;
        document.getElementById('metric-combinaciones').textContent = combinaciones;
        document.getElementById('relacion-activa').textContent = `${elementosInternos.length}x${elementosExternos.length}`;
        
        // Actualizar barras de progreso
        actualizarBarrasProgreso();
        
        // Validar selecciones según tipo de cruce
        validarSelecciones();
    }
    
    function actualizarBarrasProgreso() {
        const totalFortalezas = {{ aspectos_foda_int|selectattr('tipo', 'equalto', 'Positivo')|list|length }};
        const totalDebilidades = {{ aspectos_foda_int|selectattr('tipo', 'equalto', 'Negativo')|list|length }};
        const totalOportunidades = {{ aspectos_foda_ext|selectattr('tipo', 'equalto', 'Positivo')|list|length }};
        const totalAmenazas = {{ aspectos_foda_ext|selectattr('tipo', 'equalto', 'Negativo')|list|length }};
        
        // Calcular porcentajes
        const fortalezasSeleccionadas = elementosInternos.filter(e => e.tipo === 'fortaleza').length;
        const debilidadesSeleccionadas = elementosInternos.filter(e => e.tipo === 'debilidad').length;
        const oportunidadesSeleccionadas = elementosExternos.filter(e => e.tipo === 'oportunidad').length;
        const amenazasSeleccionadas = elementosExternos.filter(e => e.tipo === 'amenaza').length;
        
        const porcentajeFortalezas = totalFortalezas > 0 ? (fortalezasSeleccionadas / totalFortalezas) * 100 : 0;
        const porcentajeDebilidades = totalDebilidades > 0 ? (debilidadesSeleccionadas / totalDebilidades) * 100 : 0;
        const porcentajeOportunidades = totalOportunidades > 0 ? (oportunidadesSeleccionadas / totalOportunidades) * 100 : 0;
        const porcentajeAmenazas = totalAmenazas > 0 ? (amenazasSeleccionadas / totalAmenazas) * 100 : 0;
        
        // Actualizar barras
        document.getElementById('progress-fortalezas').style.width = `${porcentajeFortalezas}%`;
        document.getElementById('progress-debilidades').style.width = `${porcentajeDebilidades}%`;
        document.getElementById('progress-oportunidades').style.width = `${porcentajeOportunidades}%`;
        document.getElementById('progress-amenazas').style.width = `${porcentajeAmenazas}%`;
        
        // Actualizar textos
        document.getElementById('text-fortalezas').textContent = 
            `${fortalezasSeleccionadas} de ${totalFortalezas} seleccionadas`;
        
        document.getElementById('text-debilidades').textContent = 
            `${debilidadesSeleccionadas} de ${totalDebilidades} seleccionadas`;
        
        document.getElementById('text-oportunidades').textContent = 
            `${oportunidadesSeleccionadas} de ${totalOportunidades} seleccionadas`;
        
        document.getElementById('text-amenazas').textContent = 
            `${amenazasSeleccionadas} de ${totalAmenazas} seleccionadas`;
    }
    
    // Funciones para manejar ejes
    function seleccionarEjeFormulario(ejeId, ejeNombre) {
        document.getElementById('eje-estrategico').value = ejeId;
        actualizarEjeSeleccionado();
        mostrarNotificacion('success', 'Eje seleccionado', `Eje "${ejeNombre}" seleccionado`);
        cerrarEjesTab();
    }
    
    function actualizarEjeSeleccionado() {
        const select = document.getElementById('eje-estrategico');
        const badge = document.getElementById('eje-seleccionado-info');
        const textoEje = document.getElementById('eje-texto');
        
        if (select.value) {
            ejeSeleccionado = select.value;
            ejeSeleccionadoTexto = select.options[select.selectedIndex].text;
            textoEje.textContent = ejeSeleccionadoTexto;
            badge.classList.add('active');
        } else {
            ejeSeleccionado = null;
            ejeSeleccionadoTexto = '';
            textoEje.textContent = 'No se ha seleccionado ningún eje';
            badge.classList.remove('active');
        }
    }
    
    function seleccionarEjeActual() {
        if (ejeActivo) {
            document.getElementById('eje-estrategico').value = ejeActivo.id;
            actualizarEjeSeleccionado();
            mostrarNotificacion('success', 'Eje activo seleccionado', `Eje "${ejeActivo.nombre}" seleccionado`);
        } else {
            mostrarNotificacion('warning', 'Sin eje activo', 'No hay ningún eje activo seleccionado');
        }
    }
    
    function limpiarEjeSeleccionado() {
        document.getElementById('eje-estrategico').value = '';
        actualizarEjeSeleccionado();
        mostrarNotificacion('info', 'Eje limpiado', 'Se ha limpiado la selección de eje');
    }
    
    // Funciones del FODA
    function seleccionarTipoCruce(tipo) {
        tipoCruceActual = tipo;
        
        // Actualizar UI
        document.querySelectorAll('.tipo-item').forEach(item => {
            item.classList.remove('active');
        });
        document.querySelector(`.tipo-item[data-tipo="${tipo}"]`).classList.add('active');
        
        // Actualizar guía
        actualizarGuiaEstrategia();
        
        // Validar selecciones
        validarSelecciones();
        
        mostrarNotificacion('info', 'Tipo de cruce cambiado', `Modo ${tipo.toUpperCase()} activado`);
    }
    
    function actualizarGuiaEstrategia() {
        const guia = document.getElementById('texto-guia');
        switch(tipoCruceActual) {
            case 'fo':
                guia.textContent = '¿Cómo usar las fortalezas para aprovechar las oportunidades?';
                break;
            case 'do':
                guia.textContent = '¿Cómo superar las debilidades para aprovechar las oportunidades?';
                break;
            case 'fa':
                guia.textContent = '¿Cómo usar las fortalezas para minimizar las amenazas?';
                break;
            case 'da':
                guia.textContent = '¿Cómo superar las debilidades para evitar las amenazas?';
                break;
        }
    }
    
    function validarSelecciones() {
        const tiposPermitidosInterno = tipoCruceActual === 'fo' || tipoCruceActual === 'fa' ? 
            ['fortaleza'] : ['debilidad'];
        
        const tiposPermitidosExterno = tipoCruceActual === 'fo' || tipoCruceActual === 'do' ? 
            ['oportunidad'] : ['amenaza'];
        
        // Filtrar elementos no permitidos
        elementosInternos = elementosInternos.filter(e => tiposPermitidosInterno.includes(e.tipo));
        elementosExternos = elementosExternos.filter(e => tiposPermitidosExterno.includes(e.tipo));
        
        // Actualizar checkboxes
        document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
            const id = checkbox.id;
            const tipo = id.split('-')[0];
            const elementoDiv = checkbox.closest('.elemento-foda');
            
            if ((tiposPermitidosInterno.includes(tipo) || tiposPermitidosExterno.includes(tipo))) {
                checkbox.disabled = false;
                elementoDiv.style.opacity = '1';
            } else {
                checkbox.disabled = true;
                checkbox.checked = false;
                elementoDiv.style.opacity = '0.5';
                elementoDiv.classList.remove('selected');
            }
        });
        
        actualizarContadores();
        actualizarPanelesSeleccion();
    }
    
    // Función para cargar estrategias desde el backend
    function cargarEstrategias() {
        fetch('/api/estrategias_foda_con_eje')
            .then(response => {
                if (!response.ok) {
                    throw new Error(`Error HTTP: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                if (data.success && data.estrategias) {
                    estrategiasGuardadas = data.estrategias;
                    actualizarListaEstrategias();
                    actualizarDashboard();
                    
                    if (data.estrategias.length > 0) {
                        mostrarNotificacion('success', 'Estrategias cargadas', 
                            `Se cargaron ${data.estrategias.length} estrategias de la base de datos`);
                    }
                } else {
                    throw new Error(data.message || 'Error en los datos recibidos');
                }
            })
            .catch(error => {
                console.error('Error al cargar estrategias:', error);
                // No mostrar notificación de error para no molestar al usuario
            });
    }
    
    function actualizarListaEstrategias() {
        const lista = document.getElementById('lista-estrategias');
        
        // Limpiar lista
        lista.innerHTML = '';
        
        if (!estrategiasGuardadas || estrategiasGuardadas.length === 0) {
            lista.innerHTML = `
                <div class="empty-state">
                    <div class="empty-icon">
                        <i class="fas fa-inbox"></i>
                    </div>
                    <div class="empty-content">
                        <h3>No hay estrategias guardadas</h3>
                        <p>Comience a crear estrategias utilizando el panel de combinación</p>
                        <button class="btn-empty-action" onclick="scrollToCombinacion()">
                            <i class="fas fa-plus-circle"></i> Crear primera estrategia
                        </button>
                    </div>
                </div>
            `;
            return;
        }
        
        // Ordenar por fecha (más reciente primero)
        estrategiasGuardadas.sort((a, b) => {
            const fechaA = a.fecha_creacion ? new Date(a.fecha_creacion) : new Date(0);
            const fechaB = b.fecha_creacion ? new Date(b.fecha_creacion) : new Date(0);
            return fechaB - fechaA;
        });
        
        // Agregar cada estrategia
        estrategiasGuardadas.forEach(estrategia => {
            agregarEstrategiaRealALista(estrategia);
        });
    }
    
    function agregarEstrategiaRealALista(estrategia) {
        const lista = document.getElementById('lista-estrategias');
        
        // Remover estado vacío si existe
        const emptyState = lista.querySelector('.empty-state');
        if (emptyState) {
            emptyState.remove();
        }
        
        const estrategiaCard = document.createElement('div');
        estrategiaCard.className = 'estrategia-card';
        estrategiaCard.dataset.id = estrategia.id;
        
        // Formatear fecha
        let fechaFormateada = 'Fecha no disponible';
        if (estrategia.fecha_creacion) {
            const fecha = new Date(estrategia.fecha_creacion);
            fechaFormateada = fecha.toLocaleDateString('es-ES', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }
        
        estrategiaCard.innerHTML = `
            <div class="estrategia-header">
                <div class="estrategia-meta">
                    <span class="estrategia-tipo ${estrategia.tipo_cruce ? estrategia.tipo_cruce.toLowerCase() : 'fo'}">
                        ${estrategia.tipo_cruce || 'FO'}
                    </span>
                    <span class="estrategia-fecha">${fechaFormateada}</span>
                </div>
                <div class="estrategia-badges">
                    ${estrategia.eje_texto ? `
                        <span class="badge-eje">
                            <i class="fas fa-bullseye"></i> ${estrategia.eje_texto}
                        </span>
                    ` : ''}
                    ${estrategia.creador ? `
                        <span class="badge-creador">
                            <i class="fas fa-user"></i> ${estrategia.creador}
                        </span>
                    ` : ''}
                </div>
            </div>
            <div class="estrategia-body">
                <div class="estrategia-texto">${estrategia.estrategia || 'Sin descripción'}</div>
                <div class="estrategia-elementos">
                    <div class="elementos-grupo">
                        <div class="grupo-titulo">
                            <i class="fas fa-home"></i>
                            Elemento Interno
                        </div>
                        <div class="grupo-items">
                            <span class="elemento-badge badge-${estrategia.elemento_interno_tipo || 'fortaleza'}">
                                <i class="fas fa-${estrategia.elemento_interno_tipo === 'fortaleza' ? 'shield-alt' : 
                                              estrategia.elemento_interno_tipo === 'debilidad' ? 'exclamation-triangle' : 
                                              'question-circle'}"></i>
                                ${estrategia.elemento_interno_texto ? 
                                    (estrategia.elemento_interno_texto.substring(0, 60) + 
                                    (estrategia.elemento_interno_texto.length > 60 ? '...' : '')) : 
                                    'Sin texto'}
                            </span>
                        </div>
                    </div>
                    <div class="elementos-grupo">
                        <div class="grupo-titulo">
                            <i class="fas fa-external-link-alt"></i>
                            Elemento Externo
                        </div>
                        <div class="grupo-items">
                            <span class="elemento-badge badge-${estrategia.elemento_externo_tipo || 'oportunidad'}">
                                <i class="fas fa-${estrategia.elemento_externo_tipo === 'oportunidad' ? 'bullseye' : 
                                              estrategia.elemento_externo_tipo === 'amenaza' ? 'skull-crossbones' : 
                                              'question-circle'}"></i>
                                ${estrategia.elemento_externo_texto ? 
                                    (estrategia.elemento_externo_texto.substring(0, 60) + 
                                    (estrategia.elemento_externo_texto.length > 60 ? '...' : '')) : 
                                    'Sin texto'}
                            </span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="estrategia-footer">
                <div class="estrategia-stats">
                    <div class="stat-combinacion">
                        <i class="fas fa-info-circle"></i>
                        Combinación simple
                    </div>
                </div>
                <div class="estrategia-actions">
                    <button class="btn-accion edit" onclick="editarEstrategia(this)">
                        <i class="fas fa-edit"></i> Editar
                    </button>
                    <button class="btn-accion delete" onclick="eliminarEstrategiaReal(this, ${estrategia.id})">
                        <i class="fas fa-trash"></i> Eliminar
                    </button>
                </div>
            </div>
        `;
        
        lista.appendChild(estrategiaCard);
    }
    
    function guardarEstrategiaMultiple() {
        const estrategiaTexto = document.getElementById('estrategia').value.trim();
        const generarTodas = document.getElementById('generar-todas-combinaciones').checked;
        const estrategiaGlobal = document.getElementById('estrategia-global').checked;
        
        // Validaciones
        if (elementosInternos.length === 0 || elementosExternos.length === 0) {
            mostrarNotificacion('error', 'Selección incompleta', 'Debe seleccionar al menos un elemento interno y uno externo');
            return;
        }
        
        if (!ejeSeleccionado) {
            mostrarNotificacion('error', 'Eje no seleccionado', 'Debe seleccionar un eje estratégico');
            return;
        }
        
        if (!estrategiaTexto) {
            mostrarNotificacion('error', 'Estrategia vacía', 'Debe escribir una estrategia');
            document.getElementById('estrategia').focus();
            return;
        }
        
        const btnGuardar = document.querySelector('.btn-primary');
        const originalHTML = btnGuardar.innerHTML;
        btnGuardar.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Guardando...';
        btnGuardar.disabled = true;
        
        // Preparar datos - para múltiples elementos, guardamos una estrategia por combinación
        const promises = [];
        
        if (generarTodas) {
            // Crear una estrategia para cada combinación
            elementosInternos.forEach(interno => {
                elementosExternos.forEach(externo => {
                    const estrategiaData = {
                        tipo_cruce: tipoCruceActual.toUpperCase(),
                        elemento_interno_id: interno.id,
                        elemento_interno_tipo: interno.tipo,
                        elemento_interno_texto: interno.texto,
                        elemento_externo_id: externo.id,
                        elemento_externo_tipo: externo.tipo,
                        elemento_externo_texto: externo.texto,
                        estrategia: estrategiaTexto,
                        eje_id: ejeSeleccionado,
                        eje_texto: ejeSeleccionadoTexto
                    };
                    
                    promises.push(guardarEstrategiaIndividual(estrategiaData));
                });
            });
        } else {
            // Guardar solo una estrategia (tomar el primer elemento de cada array)
            const estrategiaData = {
                tipo_cruce: tipoCruceActual.toUpperCase(),
                elemento_interno_id: elementosInternos[0].id,
                elemento_interno_tipo: elementosInternos[0].tipo,
                elemento_interno_texto: estrategiaGlobal ? 
                    `Múltiples: ${elementosInternos.map(e => e.texto.substring(0, 30)).join(', ')}...` : 
                    elementosInternos[0].texto,
                elemento_externo_id: elementosExternos[0].id,
                elemento_externo_tipo: elementosExternos[0].tipo,
                elemento_externo_texto: estrategiaGlobal ? 
                    `Múltiples: ${elementosExternos.map(e => e.texto.substring(0, 30)).join(', ')}...` : 
                    elementosExternos[0].texto,
                estrategia: estrategiaTexto,
                eje_id: ejeSeleccionado,
                eje_texto: ejeSeleccionadoTexto
            };
            
            promises.push(guardarEstrategiaIndividual(estrategiaData));
        }
        
        // Ejecutar todas las promesas
        Promise.all(promises)
            .then(results => {
                const exitosas = results.filter(r => r.success).length;
                const fallidas = results.filter(r => !r.success).length;
                
                if (exitosas > 0) {
                    // Recargar estrategias después de guardar
                    cargarEstrategias();
                    
                    mostrarNotificacion('success', 'Estrategias guardadas', 
                        `Se guardaron ${exitosas} estrategias exitosamente${fallidas > 0 ? `, ${fallidas} fallaron` : ''}`);
                    limpiarSelecciones();
                } else {
                    mostrarNotificacion('error', 'Error al guardar', 
                        'No se pudo guardar ninguna estrategia. Por favor, intente nuevamente.');
                }
            })
            .catch(error => {
                console.error('Error al guardar estrategias:', error);
                mostrarNotificacion('error', 'Error de conexión', 
                    'No se pudo conectar con el servidor. Por favor, verifique su conexión.');
            })
            .finally(() => {
                btnGuardar.innerHTML = originalHTML;
                btnGuardar.disabled = false;
            });
    }
    
    function guardarEstrategiaIndividual(data) {
        return fetch('/guardar_estrategia_foda_con_eje', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCSRFToken()
            },
            body: JSON.stringify(data)
        })
        .then(response => response.json())
        .catch(error => {
            console.error('Error en fetch:', error);
            return { success: false, message: 'Error de red' };
        });
    }
    
    function eliminarEstrategiaReal(button, id) {
        if (!confirm('¿Está seguro de que desea eliminar esta estrategia?')) {
            return;
        }
        
        fetch(`/eliminar_estrategia_foda/${id}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCSRFToken()
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                const card = button.closest('.estrategia-card');
                card.style.opacity = '0.5';
                
                setTimeout(() => {
                    card.remove();
                    mostrarNotificacion('success', 'Estrategia eliminada', 
                        'La estrategia ha sido eliminada correctamente');
                    
                    // Actualizar dashboard
                    estrategiasGuardadas = estrategiasGuardadas.filter(e => e.id !== id);
                    actualizarDashboard();
                    
                    // Si no quedan estrategias, mostrar estado vacío
                    const lista = document.getElementById('lista-estrategias');
                    if (lista.children.length === 0) {
                        lista.innerHTML = `
                            <div class="empty-state">
                                <div class="empty-icon">
                                    <i class="fas fa-inbox"></i>
                                </div>
                                <div class="empty-content">
                                    <h3>No hay estrategias guardadas</h3>
                                    <p>Comience a crear estrategias utilizando el panel de combinación</p>
                                    <button class="btn-empty-action" onclick="scrollToCombinacion()">
                                        <i class="fas fa-plus-circle"></i> Crear primera estrategia
                                    </button>
                                </div>
                            </div>
                        `;
                    }
                }, 300);
            } else {
                mostrarNotificacion('error', 'Error al eliminar', data.message || 'No se pudo eliminar la estrategia');
            }
        })
        .catch(error => {
            console.error('Error al eliminar estrategia:', error);
            mostrarNotificacion('error', 'Error de conexión', 'No se pudo conectar con el servidor');
        });
    }
    
    function actualizarDashboard() {
        const totalEstrategias = estrategiasGuardadas.length;
        const estrategiasMultiples = 0; // Tu base de datos actual no soporta múltiples
        const estrategiasSimples = totalEstrategias;
        
        document.getElementById('total-estrategias').textContent = totalEstrategias;
        document.getElementById('metric-estrategias').textContent = totalEstrategias;
        document.getElementById('estrategias-multiples').textContent = estrategiasMultiples;
        document.getElementById('estrategias-simples').textContent = estrategiasSimples;
    }
    
    function filtrarEstrategias() {
        const tipoSeleccionado = document.getElementById('filtro-tipo-estrategia').value;
        const ejeSeleccionado = document.getElementById('filtro-eje-estrategia').value;
        const combinacionSeleccionada = document.getElementById('filtro-combinacion').value;
        
        const estrategias = document.querySelectorAll('.estrategia-card');
        let visibles = 0;
        
        estrategias.forEach(card => {
            const tipo = card.querySelector('.estrategia-tipo').textContent.trim();
            const eje = card.querySelector('.badge-eje') ? card.querySelector('.badge-eje').textContent.trim() : '';
            
            let mostrar = true;
            
            // Filtrar por tipo
            if (tipoSeleccionado !== 'all' && tipo !== tipoSeleccionado) {
                mostrar = false;
            }
            
            // Filtrar por eje
            if (ejeSeleccionado !== 'all') {
                const ejeId = getEjeIdFromText(eje);
                if (ejeId !== ejeSeleccionado) {
                    mostrar = false;
                }
            }
            
            // Filtrar por combinación (simple/múltiple)
            if (combinacionSeleccionada !== 'all') {
                const esMultiple = card.querySelector('.stat-combinacion').textContent.includes('múltiple');
                if (combinacionSeleccionada === 'multiple' && !esMultiple) {
                    mostrar = false;
                }
                if (combinacionSeleccionada === 'simple' && esMultiple) {
                    mostrar = false;
                }
            }
            
            if (mostrar) {
                card.style.display = 'block';
                visibles++;
            } else {
                card.style.display = 'none';
            }
        });
        
        // Actualizar contador
        document.getElementById('total-estrategias').textContent = visibles;
    }
    
    function getEjeIdFromText(ejeTexto) {
        // Mapear texto del eje a su ID
        const ejes = {
            'EDUCACIÓN': 'educacion',
            'SALUD': 'salud',
            'EMPLEABILIDAD': 'empleabilidad',
            'DESARROLLO ECONÓMICO': 'desarrollo_economico',
            'SOSTENIBILIDAD AMBIENTAL (AGUA)': 'sostenibilidad_ambiental',
            'COMUNICACIÓN': 'comunicacion',
            'INSTITUCIONAL': 'institucional'
        };
        
        return ejes[ejeTexto] || '';
    }
    
    function limpiarSelecciones() {
        // Limpiar checkboxes
        document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
            checkbox.checked = false;
        });
        
        // Limpiar clases selected
        document.querySelectorAll('.elemento-foda').forEach(item => {
            item.classList.remove('selected');
            item.style.opacity = '1';
        });
        
        // Limpiar arrays
        elementosInternos = [];
        elementosExternos = [];
        
        // Limpiar textarea
        document.getElementById('estrategia').value = '';
        
        // Actualizar UI
        actualizarContadores();
        actualizarPanelesSeleccion();
        actualizarEstadisticas();
        
        mostrarNotificacion('info', 'Selecciones limpiadas', 'Todas las selecciones han sido limpiadas');
    }
    
    function limpiarEstrategia() {
        document.getElementById('estrategia').value = '';
        document.getElementById('estrategia').focus();
    }
    
    function generarEstrategiaAutomatica() {
        if (elementosInternos.length === 0 || elementosExternos.length === 0) {
            mostrarNotificacion('warning', 'Selección incompleta', 'Debe seleccionar elementos primero');
            return;
        }
        
        const estrategiasBase = {
            'fo': [
                'Aprovechar las fortalezas seleccionadas para maximizar las oportunidades identificadas, creando sinergias entre los diferentes elementos.',
                'Combinar estratégicamente las capacidades internas con las oportunidades externas para generar ventajas competitivas sostenibles.',
                'Utilizar las fortalezas como palanca para capitalizar las oportunidades, generando un efecto multiplicador en los resultados.'
            ],
            'do': [
                'Transformar las debilidades identificadas mediante el aprovechamiento de las oportunidades, superando limitaciones mediante alianzas estratégicas.',
                'Utilizar las oportunidades externas como catalizadores para mejorar las áreas de debilidad, fortaleciendo las capacidades internas.',
                'Alinear los esfuerzos de mejora con las oportunidades del entorno, convirtiendo debilidades en fortalezas progresivas.'
            ],
            'fa': [
                'Utilizar las fortalezas como barrera protectora frente a las amenazas, creando capacidades de resiliencia y adaptación.',
                'Convertir las amenazas en desafíos manejables mediante el despliegue estratégico de las fortalezas disponibles.',
                'Establecer mecanismos de prevención basados en las fortalezas para neutralizar o minimizar el impacto de las amenazas.'
            ],
            'da': [
                'Implementar acciones defensivas coordinadas para proteger las áreas vulnerables frente a las amenazas identificadas.',
                'Desarrollar planes de contingencia que aborden simultáneamente debilidades internas y amenazas externas.',
                'Establecer alianzas y colaboraciones para compensar debilidades y distribuir riesgos frente a amenazas comunes.'
            ]
        };
        
        const estrategias = estrategiasBase[tipoCruceActual] || estrategiasBase['fo'];
        const estrategiaAleatoria = estrategias[Math.floor(Math.random() * estrategias.length)];
        
        const numInternos = elementosInternos.length;
        const numExternos = elementosExternos.length;
        const ejeNombre = ejeSeleccionadoTexto || 'el eje estratégico seleccionado';
        
        const estrategiaPersonalizada = `Considerando los ${numInternos} elementos internos y ${numExternos} elementos externos seleccionados, ${estrategiaAleatoria} Esta estrategia se enmarca en ${ejeNombre} y busca crear valor a través de la combinación múltiple de factores.`;
        
        document.getElementById('estrategia').value = estrategiaPersonalizada;
        
        mostrarNotificacion('success', 'Estrategia generada', 'Se ha generado una estrategia automáticamente');
    }
    
    function editarEstrategia(button) {
        const card = button.closest('.estrategia-card');
        mostrarNotificacion('info', 'Función en desarrollo', 'La edición de estrategias estará disponible pronto');
    }
    
    function scrollToCombinacion() {
        document.querySelector('.combinacion-panel').scrollIntoView({ 
            behavior: 'smooth',
            block: 'start'
        });
    }
    
    function mostrarAyuda() {
        mostrarNotificacion('info', 'Modo Combinación Múltiple', 
            'Seleccione múltiples elementos de cada categoría FODA y combínelos para generar estrategias integrales. ' +
            'Puede seleccionar todos los elementos de una categoría usando los botones de la matriz.');
    }
    
    function exportarEstrategias() {
        if (estrategiasGuardadas.length === 0) {
            mostrarNotificacion('warning', 'Sin datos', 'No hay estrategias para exportar');
            return;
        }
        
        mostrarNotificacion('success', 'Exportación iniciada', 
            `Exportando ${estrategiasGuardadas.length} estrategias...`);
        
        // Simular exportación
        setTimeout(() => {
            mostrarNotificacion('success', 'Exportación completada', 
                'Las estrategias se han exportado correctamente');
        }, 2000);
    }
    
    // Sistema de notificaciones
    function mostrarNotificacion(tipo, titulo, mensaje) {
        const container = document.querySelector('.notification-container');
        if (!container) {
            const newContainer = document.createElement('div');
            newContainer.className = 'notification-container';
            document.body.appendChild(newContainer);
        }
        
        const notification = document.createElement('div');
        notification.className = `notification ${tipo}`;
        notification.innerHTML = `
            <div class="notification-icon">
                <i class="fas fa-${tipo === 'success' ? 'check-circle' : 
                                   tipo === 'error' ? 'exclamation-circle' : 
                                   tipo === 'warning' ? 'exclamation-triangle' : 
                                   'info-circle'}"></i>
            </div>
            <div class="notification-content">
                <div class="notification-title">${titulo}</div>
                <div class="notification-message">${mensaje}</div>
            </div>
        `;
        
        document.querySelector('.notification-container').appendChild(notification);
        
        // Mostrar con animación
        setTimeout(() => {
            notification.classList.add('show');
        }, 10);
        
        // Ocultar después de 5 segundos
        setTimeout(() => {
            notification.classList.remove('show');
            setTimeout(() => {
                notification.remove();
            }, 300);
        }, 5000);
    }
    
    // Función auxiliar para obtener el token CSRF
    function getCSRFToken() {
        // Buscar token en meta tag
        const metaTag = document.querySelector('meta[name="csrf-token"]');
        if (metaTag) {
            return metaTag.getAttribute('content');
        }
        
        // Buscar token en cookie
        const cookieMatch = document.cookie.match(/(?:^|;)\s*csrf_token\s*=\s*([^;]+)/);
        if (cookieMatch) {
            return cookieMatch[1];
        }
        
        // Buscar token en formularios
        const formToken = document.querySelector('input[name="csrf_token"]');
        if (formToken) {
            return formToken.value;
        }
        
        console.warn('Token CSRF no encontrado');
        return '';
    }
</script>
{% endblock %}
