{% extends "inicio.html" %}

{% block content %}
<!-- Mapa Neuronal Estratégico - Versión Mejorada -->
<div class="mapa-neuronal-container" id="mapaFullscreen">
    <!-- Controles flotantes -->
    <div class="mapa-controls-flotantes">
        <button class="control-btn" onclick="toggleFullscreen()" title="Pantalla completa">
            <i class="fas fa-expand"></i>
        </button>
        <button class="control-btn" onclick="resetView()" title="Reiniciar vista">
            <i class="fas fa-sync-alt"></i>
        </button>
        <button class="control-btn" onclick="toggleAnimations()" title="Animaciones">
            <i class="fas fa-play" id="animacionIcon"></i>
        </button>
        <button class="control-btn" onclick="exportMap()" title="Exportar">
            <i class="fas fa-download"></i>
        </button>
        <div class="control-group">
            <select id="filtro-nivel" onchange="filtrarNodos()">
                <option value="all">Todos los niveles</option>
                <option value="objetivo">Objetivo Central</option>
                <option value="ejes">Ejes Estratégicos</option>
                <option value="estrategias">Estrategias</option>
                <option value="actividades">Actividades</option>
                <option value="tareas">Tareas</option>
            </select>
        </div>
        <div class="control-group">
            <input type="range" id="zoomSlider" min="0.5" max="3" step="0.1" value="1" oninput="zoomSliderChange(this.value)">
        </div>
    </div>
    
    <!-- Cabecera del mapa -->
    <div class="mapa-header-glass">
        <div class="header-content">
            <h1 class="mapa-title-glow">
                <i class="fas fa-project-diagram"></i>
                <span class="title-text">MAPA NEURONAL ESTRATÉGICO</span>
                <span class="subtitle">Proyecto El Domo</span>
            </h1>
            <div class="header-stats">
                <div class="stat-badge">
                    <i class="fas fa-bullseye"></i>
                    <span>1 Objetivo</span>
                </div>
                <div class="stat-badge">
                    <i class="fas fa-layer-group"></i>
                    <span>7 Ejes</span>
                </div>
                <div class="stat-badge">
                    <i class="fas fa-chess-board"></i>
                    <span id="total-estrategias">0 Estrategias</span>
                </div>
                <div class="stat-badge">
                    <i class="fas fa-network-wired"></i>
                    <span id="total-conexiones">0 Conexiones</span>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Canvas principal -->
    <div class="mapa-canvas-fullscreen" id="mapaCanvas">
        <!-- Fondo con partículas -->
        <div class="particles-container" id="particlesContainer"></div>
        
        <!-- SVG para conexiones -->
        <svg class="conexiones-svg" id="conexionesSvg">
            <defs>
                <linearGradient id="gradient-eje" x1="0%" y1="0%" x2="100%" y2="0%">
                    <stop offset="0%" stop-color="#3498db" stop-opacity="0.7" />
                    <stop offset="100%" stop-color="#9b59b6" stop-opacity="0.7" />
                </linearGradient>
                <linearGradient id="gradient-estrategia" x1="0%" y1="0%" x2="100%" y2="0%">
                    <stop offset="0%" stop-color="#2ecc71" stop-opacity="0.7" />
                    <stop offset="100%" stop-color="#3498db" stop-opacity="0.7" />
                </linearGradient>
                <filter id="glow">
                    <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
                    <feMerge>
                        <feMergeNode in="coloredBlur"/>
                        <feMergeNode in="SourceGraphic"/>
                    </feMerge>
                </filter>
                <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                    <polygon points="0 0, 10 3.5, 0 7" fill="#3498db"/>
                </marker>
            </defs>
        </svg>
        
        <!-- Contenedor de nodos -->
        <div class="nodos-container" id="nodosContainer">
            <!-- Nodo Central -->
            <div class="nodo nodo-central" id="nodo-objetivo">
                <div class="nodo-glow"></div>
                <div class="nodo-orb"></div>
                <div class="nodo-content">
                    <div class="nodo-icon-pulse">
                        <i class="fas fa-brain"></i>
                    </div>
                    <div class="nodo-title-glow">OBJETIVO ESTRATÉGICO</div>
                    <div class="nodo-desc-scroll">
                        Consolidar la viabilidad y el respaldo social del Proyecto El Domo mediante un modelo de gestión integral que garantice la integridad y disponibilidad del recurso hídrico local...
                    </div>
                    <button class="btn-ver-mas" onclick="mostrarDetalleObjetivo()">
                        <i class="fas fa-eye"></i> Ver completo
                    </button>
                    <div class="nodo-stats-grid">
                        <div class="stat-item">
                            <div class="stat-value">7</div>
                            <div class="stat-label">Ejes</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="contador-estrategias">0</div>
                            <div class="stat-label">Estrategias</div>
                        </div>
                    </div>
                </div>
                <div class="nodo-actions">
                    <button class="nodo-action-btn" onclick="expandirTodo()" title="Expandir todo">
                        <i class="fas fa-expand"></i>
                    </button>
                </div>
            </div>
            
            <!-- Nodos de Ejes (se posicionan dinámicamente) -->
            <div class="ejes-container" id="ejesContainer">
                <!-- Los nodos de ejes se generan dinámicamente -->
            </div>
            
            <!-- Contenedores para niveles jerárquicos -->
            <div class="estrategias-container" id="estrategiasContainer"></div>
            <div class="actividades-container" id="actividadesContainer"></div>
            <div class="tareas-container" id="tareasContainer"></div>
        </div>
        
        <!-- Mini mapa de navegación -->
        <div class="minimap" id="minimap">
            <div class="minimap-viewport" id="minimapViewport"></div>
        </div>
    </div>
    
    <!-- Leyenda flotante -->
    <div class="leyenda-flotante">
        <div class="leyenda-header">
            <i class="fas fa-key"></i> Leyenda
        </div>
        <div class="leyenda-content">
            <div class="leyenda-item">
                <div class="leyenda-icon nodo-central-color">
                    <i class="fas fa-brain"></i>
                </div>
                <span>Objetivo Central</span>
            </div>
            <div class="leyenda-item">
                <div class="leyenda-icon nodo-eje-color">
                    <i class="fas fa-layer-group"></i>
                </div>
                <span>Ejes Estratégicos</span>
            </div>
            <div class="leyenda-item">
                <div class="leyenda-icon nodo-estrategia-color">
                    <i class="fas fa-chess-board"></i>
                </div>
                <span>Estrategias</span>
            </div>
            <div class="leyenda-item">
                <div class="leyenda-icon nodo-actividad-color">
                    <i class="fas fa-tasks"></i>
                </div>
                <span>Actividades</span>
            </div>
            <div class="leyenda-item">
                <div class="leyenda-icon nodo-tarea-color">
                    <i class="fas fa-check-circle"></i>
                </div>
                <span>Tareas</span>
            </div>
        </div>
    </div>
    
    <!-- Panel de detalles -->
    <div class="panel-detalles" id="panelDetalles">
        <div class="panel-header">
            <h3 id="detalleTitulo"><i class="fas fa-info-circle"></i> Detalles</h3>
            <button class="panel-close" onclick="cerrarPanel()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="panel-body" id="detalleContenido">
            <!-- Contenido dinámico -->
        </div>
    </div>
    
    <!-- Modal objetivo -->
    <div class="modal-glass" id="modalObjetivo">
        <div class="modal-glass-content">
            <div class="modal-header-glow">
                <h3><i class="fas fa-brain"></i> OBJETIVO ESTRATÉGICO COMPLETO</h3>
                <button class="modal-close-glow" onclick="cerrarModal('modalObjetivo')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body-scroll">
                <div class="objetivo-content">
                    <div class="objetivo-icon">
                        <i class="fas fa-bullseye"></i>
                    </div>
                    <p>Consolidar la viabilidad y el respaldo social del Proyecto El Domo mediante un modelo de gestión integral que garantice la integridad y disponibilidad del recurso hídrico local, asegurando su no afectación por las actividades mineras, a través de la repotenciación de sistemas comunitarios y el monitoreo estricto de su calidad; este compromiso se complementa con la mejora de equipamiento en salud, la intervención en infraestructura sanitaria y lúdica de 4 unidades educativas, la reubicación estratégica de al menos el 60% del personal local hacia nuevos departamentos, y una cooperación técnica con los GADs y niveles distritales, todo dinamizado por un sistema de comunicación comunitaria que transparente la propuesta de valor y los beneficios del proyecto en el AID y AII.</p>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    /* Reset y configuración base */
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }
    
    /* Contenedor principal fullscreen */
    .mapa-neuronal-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: linear-gradient(135deg, #0c0e2a 0%, #1a1b3a 50%, #0c2461 100%);
        overflow: hidden;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    /* Controles flotantes */
    .mapa-controls-flotantes {
        position: fixed;
        top: 20px;
        right: 20px;
        display: flex;
        gap: 10px;
        z-index: 1000;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(20px);
        border-radius: 20px;
        padding: 12px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .control-btn {
        width: 45px;
        height: 45px;
        border-radius: 50%;
        background: linear-gradient(135deg, rgba(52, 152, 219, 0.8), rgba(155, 89, 182, 0.8));
        border: none;
        color: white;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(52, 152, 219, 0.4);
    }
    
    .control-btn:hover {
        transform: translateY(-3px) scale(1.1);
        box-shadow: 0 6px 20px rgba(52, 152, 219, 0.6);
    }
    
    .control-group {
        display: flex;
        align-items: center;
        margin-left: 10px;
    }
    
    .control-group select, .control-group input {
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        color: white;
        padding: 8px 15px;
        border-radius: 10px;
        backdrop-filter: blur(10px);
        min-width: 150px;
    }
    
    .control-group option {
        background: #0c0e2a;
        color: white;
    }
    
    .control-group input[type="range"] {
        min-width: 100px;
    }
    
    /* Cabecera glassmorphism */
    .mapa-header-glass {
        position: fixed;
        top: 20px;
        left: 20px;
        right: 280px;
        z-index: 1000;
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(20px);
        border-radius: 20px;
        padding: 15px 25px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .header-content {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .mapa-title-glow {
        color: white;
        font-size: 20px;
        font-weight: 700;
        display: flex;
        flex-direction: column;
        gap: 5px;
        text-shadow: 0 0 10px rgba(52, 152, 219, 0.7);
    }
    
    .title-text {
        font-size: 24px;
        letter-spacing: 1px;
    }
    
    .subtitle {
        font-size: 14px;
        opacity: 0.8;
        font-weight: 400;
    }
    
    .header-stats {
        display: flex;
        gap: 15px;
    }
    
    .stat-badge {
        background: rgba(255, 255, 255, 0.1);
        padding: 8px 15px;
        border-radius: 15px;
        display: flex;
        align-items: center;
        gap: 8px;
        color: white;
        font-size: 14px;
        border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    /* Canvas fullscreen */
    .mapa-canvas-fullscreen {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
        cursor: grab;
    }
    
    .mapa-canvas-fullscreen:active {
        cursor: grabbing;
    }
    
    /* Partículas de fondo */
    .particles-container {
        position: absolute;
        width: 100%;
        height: 100%;
        pointer-events: none;
    }
    
    .particle {
        position: absolute;
        width: 2px;
        height: 2px;
        background: rgba(52, 152, 219, 0.5);
        border-radius: 50%;
        pointer-events: none;
    }
    
    /* SVG de conexiones */
    .conexiones-svg {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 1;
    }
    
    .conexion {
        stroke-width: 2;
        fill: none;
        filter: url(#glow);
        stroke-dasharray: 1000;
        stroke-dashoffset: 1000;
    }
    
    .conexion.eje {
        stroke: url(#gradient-eje);
        animation: drawLine 3s ease-in-out forwards;
    }
    
    .conexion.estrategia {
        stroke: url(#gradient-estrategia);
        animation: drawLine 2s ease-in-out forwards;
    }
    
    .conexion.activa {
        stroke-width: 3;
        animation: pulseLine 2s infinite;
    }
    
    @keyframes drawLine {
        to {
            stroke-dashoffset: 0;
        }
    }
    
    @keyframes pulseLine {
        0% {
            stroke-opacity: 0.3;
        }
        50% {
            stroke-opacity: 1;
        }
        100% {
            stroke-opacity: 0.3;
        }
    }
    
    /* Contenedor de nodos */
    .nodos-container {
        position: absolute;
        width: 100%;
        height: 100%;
        z-index: 2;
        transform-origin: center;
        transition: transform 0.3s ease;
    }
    
    /* Nodos generales */
    .nodo {
        position: absolute;
        cursor: pointer;
        transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        transform-origin: center;
    }
    
    .nodo:hover {
        transform: scale(1.05);
        z-index: 100;
    }
    
    /* Nodo central */
    .nodo-central {
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 10;
        width: 350px;
        height: 350px;
    }
    
    .nodo-glow {
        position: absolute;
        width: 100%;
        height: 100%;
        border-radius: 50%;
        background: radial-gradient(circle, rgba(156, 39, 176, 0.4) 0%, rgba(156, 39, 176, 0) 70%);
        animation: pulseGlow 3s infinite;
        filter: blur(20px);
    }
    
    .nodo-orb {
        position: absolute;
        width: 100%;
        height: 100%;
        border-radius: 50%;
        background: conic-gradient(from 0deg, #9C27B0, #E91E63, #9C27B0);
        animation: rotateOrb 20s linear infinite;
        opacity: 0.1;
        filter: blur(40px);
    }
    
    .nodo-central .nodo-content {
        position: relative;
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(20px);
        border-radius: 25px;
        padding: 30px;
        width: 100%;
        height: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-align: center;
        border: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3),
                    inset 0 1px 0 rgba(255, 255, 255, 0.1);
        z-index: 2;
    }
    
    .nodo-icon-pulse {
        width: 80px;
        height: 80px;
        background: linear-gradient(135deg, #9C27B0, #E91E63);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 20px;
        font-size: 32px;
        color: white;
        animation: pulseIcon 2s infinite;
        box-shadow: 0 0 30px rgba(156, 39, 176, 0.5);
    }
    
    .nodo-title-glow {
        font-size: 18px;
        font-weight: 700;
        color: white;
        margin-bottom: 15px;
        text-transform: uppercase;
        letter-spacing: 2px;
        text-shadow: 0 0 10px rgba(156, 39, 176, 0.7);
    }
    
    .nodo-desc-scroll {
        font-size: 14px;
        color: rgba(255, 255, 255, 0.8);
        line-height: 1.5;
        margin-bottom: 20px;
        max-height: 80px;
        overflow: hidden;
        text-overflow: ellipsis;
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
    }
    
    .btn-ver-mas {
        background: linear-gradient(135deg, #3498db, #9b59b6);
        border: none;
        color: white;
        padding: 10px 20px;
        border-radius: 25px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 8px;
        font-weight: 600;
        transition: all 0.3s ease;
        margin-bottom: 20px;
    }
    
    .btn-ver-mas:hover {
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
    }
    
    .nodo-stats-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
        width: 100%;
    }
    
    .stat-item {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 15px;
        padding: 10px;
        text-align: center;
    }
    
    .stat-value {
        font-size: 24px;
        font-weight: 700;
        color: white;
        margin-bottom: 5px;
    }
    
    .stat-label {
        font-size: 12px;
        color: rgba(255, 255, 255, 0.7);
        text-transform: uppercase;
        letter-spacing: 1px;
    }
    
    .nodo-actions {
        position: absolute;
        bottom: -20px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        gap: 10px;
    }
    
    .nodo-action-btn {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: linear-gradient(135deg, #3498db, #9b59b6);
        border: none;
        color: white;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 16px;
        transition: all 0.3s ease;
    }
    
    .nodo-action-btn:hover {
        transform: scale(1.1);
    }
    
    /* Nodos de ejes */
    .nodo-eje {
        width: 180px;
        height: 180px;
    }
    
    .nodo-eje .nodo-content {
        position: relative;
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(20px);
        border-radius: 20px;
        padding: 20px;
        width: 100%;
        height: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-align: center;
        border: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        transition: all 0.3s ease;
    }
    
    .nodo-eje:hover .nodo-content {
        transform: translateY(-5px);
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
    }
    
    .nodo-eje .nodo-icon {
        width: 60px;
        height: 60px;
        background: linear-gradient(135deg, #3498db, #2980b9);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 15px;
        font-size: 24px;
        color: white;
        box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
    }
    
    .nodo-eje .nodo-title {
        font-size: 16px;
        font-weight: 600;
        color: white;
        margin-bottom: 10px;
        text-align: center;
    }
    
    .nodo-eje .nodo-counter {
        font-size: 12px;
        color: rgba(255, 255, 255, 0.7);
        background: rgba(255, 255, 255, 0.1);
        padding: 4px 12px;
        border-radius: 15px;
    }
    
    /* Nodos de estrategias, actividades y tareas */
    .nodo-estrategia, .nodo-actividad, .nodo-tarea {
        width: 150px;
        height: 150px;
    }
    
    .nodo-estrategia .nodo-content {
        background: rgba(46, 204, 113, 0.1);
        border: 1px solid rgba(46, 204, 113, 0.2);
    }
    
    .nodo-actividad .nodo-content {
        background: rgba(231, 76, 60, 0.1);
        border: 1px solid rgba(231, 76, 60, 0.2);
    }
    
    .nodo-tarea .nodo-content {
        background: rgba(243, 156, 18, 0.1);
        border: 1px solid rgba(243, 156, 18, 0.2);
    }
    
    .nodo-estrategia .nodo-icon,
    .nodo-actividad .nodo-icon,
    .nodo-tarea .nodo-icon {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 10px;
        font-size: 20px;
        color: white;
    }
    
    .nodo-estrategia .nodo-icon {
        background: linear-gradient(135deg, #2ecc71, #27ae60);
    }
    
    .nodo-actividad .nodo-icon {
        background: linear-gradient(135deg, #e74c3c, #c0392b);
    }
    
    .nodo-tarea .nodo-icon {
        background: linear-gradient(135deg, #f39c12, #d35400);
    }
    
    /* Leyenda flotante */
    .leyenda-flotante {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(20px);
        border-radius: 15px;
        padding: 15px;
        width: 200px;
        z-index: 1000;
        border: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
    }
    
    .leyenda-header {
        color: white;
        font-weight: 600;
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .leyenda-content {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }
    
    .leyenda-item {
        display: flex;
        align-items: center;
        gap: 10px;
        color: rgba(255, 255, 255, 0.8);
        font-size: 12px;
    }
    
    .leyenda-icon {
        width: 25px;
        height: 25px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 12px;
        color: white;
        flex-shrink: 0;
    }
    
    .nodo-central-color {
        background: linear-gradient(135deg, #9C27B0, #E91E63);
    }
    
    .nodo-eje-color {
        background: linear-gradient(135deg, #3498db, #2980b9);
    }
    
    .nodo-estrategia-color {
        background: linear-gradient(135deg, #2ecc71, #27ae60);
    }
    
    .nodo-actividad-color {
        background: linear-gradient(135deg, #e74c3c, #c0392b);
    }
    
    .nodo-tarea-color {
        background: linear-gradient(135deg, #f39c12, #d35400);
    }
    
    /* Panel de detalles */
    .panel-detalles {
        position: fixed;
        top: 0;
        right: -400px;
        width: 380px;
        height: 100%;
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(30px);
        border-left: 1px solid rgba(255, 255, 255, 0.1);
        z-index: 2000;
        transition: right 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        overflow-y: auto;
    }
    
    .panel-detalles.open {
        right: 0;
    }
    
    .panel-header {
        padding: 25px;
        background: rgba(12, 36, 97, 0.5);
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .panel-header h3 {
        color: white;
        font-size: 18px;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .panel-close {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.1);
        border: none;
        color: white;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
    }
    
    .panel-close:hover {
        background: rgba(255, 255, 255, 0.2);
        transform: rotate(90deg);
    }
    
    .panel-body {
        padding: 25px;
        color: rgba(255, 255, 255, 0.9);
    }
    
    /* Modal glass */
    .modal-glass {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 3000;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
        backdrop-filter: blur(10px);
    }
    
    .modal-glass.active {
        opacity: 1;
        visibility: visible;
    }
    
    .modal-glass-content {
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(40px);
        border-radius: 25px;
        width: 90%;
        max-width: 800px;
        max-height: 80vh;
        overflow: hidden;
        border: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
        transform: translateY(30px);
        transition: transform 0.3s ease;
    }
    
    .modal-glass.active .modal-glass-content {
        transform: translateY(0);
    }
    
    .modal-header-glow {
        padding: 25px;
        background: linear-gradient(135deg, rgba(156, 39, 176, 0.2), rgba(233, 30, 99, 0.2));
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .modal-header-glow h3 {
        color: white;
        font-size: 20px;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .modal-close-glow {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.1);
        border: none;
        color: white;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
    }
    
    .modal-close-glow:hover {
        background: rgba(255, 255, 255, 0.2);
        transform: rotate(90deg);
    }
    
    .modal-body-scroll {
        padding: 30px;
        max-height: calc(80vh - 90px);
        overflow-y: auto;
    }
    
    .objetivo-content {
        text-align: center;
    }
    
    .objetivo-icon {
        width: 80px;
        height: 80px;
        background: linear-gradient(135deg, #9C27B0, #E91E63);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 20px;
        font-size: 32px;
        color: white;
        box-shadow: 0 0 30px rgba(156, 39, 176, 0.5);
    }
    
    .objetivo-content p {
        color: rgba(255, 255, 255, 0.9);
        line-height: 1.8;
        font-size: 16px;
        text-align: justify;
    }
    
    /* Mini mapa */
    .minimap {
        position: fixed;
        bottom: 20px;
        left: 20px;
        width: 150px;
        height: 150px;
        background: rgba(0, 0, 0, 0.5);
        border-radius: 10px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        overflow: hidden;
        z-index: 1000;
    }
    
    .minimap-viewport {
        position: absolute;
        border: 2px solid rgba(52, 152, 219, 0.8);
        background: rgba(52, 152, 219, 0.1);
    }
    
    /* Animaciones */
    @keyframes pulseGlow {
        0%, 100% {
            opacity: 0.5;
            transform: scale(1);
        }
        50% {
            opacity: 0.8;
            transform: scale(1.05);
        }
    }
    
    @keyframes rotateOrb {
        from {
            transform: rotate(0deg);
        }
        to {
            transform: rotate(360deg);
        }
    }
    
    @keyframes pulseIcon {
        0%, 100% {
            box-shadow: 0 0 30px rgba(156, 39, 176, 0.5);
        }
        50% {
            box-shadow: 0 0 50px rgba(156, 39, 176, 0.8);
        }
    }
    
    @keyframes aparecerNodo {
        from {
            opacity: 0;
            transform: translateY(50px) scale(0.5);
        }
        to {
            opacity: 1;
            transform: translateY(0) scale(1);
        }
    }
    
    .nodo-aparecer {
        animation: aparecerNodo 0.6s ease forwards;
    }
    
    /* Efectos de selección */
    .nodo-seleccionado {
        box-shadow: 0 0 30px rgba(52, 152, 219, 0.8);
        border-color: rgba(52, 152, 219, 0.5);
        transform: scale(1.05);
        z-index: 1000;
    }
    
    /* Efecto de partículas en hover */
    .particulas-hover {
        position: absolute;
        pointer-events: none;
        z-index: -1;
    }
    
    /* Scrollbar personalizado */
    ::-webkit-scrollbar {
        width: 8px;
    }
    
    ::-webkit-scrollbar-track {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 10px;
    }
    
    ::-webkit-scrollbar-thumb {
        background: linear-gradient(135deg, #3498db, #9b59b6);
        border-radius: 10px;
    }
    
    /* Responsive */
    @media (max-width: 1200px) {
        .mapa-header-glass {
            right: 180px;
        }
        
        .panel-detalles {
            width: 320px;
        }
    }
    
    @media (max-width: 768px) {
        .mapa-controls-flotantes {
            flex-direction: column;
            right: 10px;
        }
        
        .mapa-header-glass {
            right: 10px;
            left: 10px;
        }
        
        .header-content {
            flex-direction: column;
            gap: 10px;
            text-align: center;
        }
        
        .header-stats {
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .panel-detalles {
            width: 100%;
            right: -100%;
        }
        
        .nodo-central {
            width: 280px;
            height: 280px;
        }
    }
</style>

<script>
    // Variables globales
    let nodos = {
        ejes: [
            { id: 'educacion', nombre: 'EDUCACIÓN', icono: 'graduation-cap', color: '#3498db' },
            { id: 'salud', nombre: 'SALUD', icono: 'heartbeat', color: '#e74c3c' },
            { id: 'empleabilidad', nombre: 'EMPLEABILIDAD', icono: 'briefcase', color: '#2ecc71' },
            { id: 'desarrollo', nombre: 'DESARROLLO ECONÓMICO', icono: 'chart-line', color: '#9b59b6' },
            { id: 'agua', nombre: 'SOSTENIBILIDAD AMBIENTAL', icono: 'tint', color: '#1abc9c' },
            { id: 'comunicacion', nombre: 'COMUNICACIÓN', icono: 'bullhorn', color: '#f1c40f' },
            { id: 'institucional', nombre: 'INSTITUCIONAL', icono: 'landmark', color: '#e67e22' }
        ],
        estrategias: [],
        actividades: [],
        tareas: []
    };
    
    let conexiones = [];
    let animacionesActivas = true;
    let zoomLevel = 1;
    let panning = false;
    let startX, startY;
    let translateX = 0, translateY = 0;
    let nodoSeleccionado = null;
    let particulas = [];
    
    // Inicialización
    document.addEventListener('DOMContentLoaded', function() {
        inicializarMapa();
        crearParticulas();
        cargarDatos();
        inicializarEventos();
        animarEntrada();
        
        // Actualizar estadísticas iniciales
        actualizarEstadisticas();
    });
    
    function inicializarMapa() {
        // Configurar canvas para pan y zoom
        const canvas = document.getElementById('mapaCanvas');
        const nodosContainer = document.getElementById('nodosContainer');
        
        // Crear nodos de ejes
        crearNodosEjes();
        
        // Aplicar transformación inicial
        actualizarTransformacion();
    }
    
    function inicializarEventos() {
        const canvas = document.getElementById('mapaCanvas');
        const nodosContainer = document.getElementById('nodosContainer');
        
        // Eventos de mouse para pan
        canvas.addEventListener('mousedown', startPan);
        canvas.addEventListener('mousemove', pan);
        canvas.addEventListener('mouseup', endPan);
        canvas.addEventListener('mouseleave', endPan);
        
        // Eventos táctiles
        canvas.addEventListener('touchstart', startPanTouch);
        canvas.addEventListener('touchmove', panTouch);
        canvas.addEventListener('touchend', endPan);
        
        // Evento de rueda para zoom
        canvas.addEventListener('wheel', zoomWheel);
        
        // Evento de redimensionamiento
        window.addEventListener('resize', recalcularPosiciones);
        
        // Evento para cerrar panel al hacer clic fuera
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.panel-detalles') && !e.target.closest('.nodo')) {
                cerrarPanel();
            }
        });
    }
    
    // Funciones de pan y zoom
    function startPan(e) {
        panning = true;
        startX = e.clientX - translateX;
        startY = e.clientY - translateY;
        document.getElementById('mapaCanvas').style.cursor = 'grabbing';
    }
    
    function pan(e) {
        if (!panning) return;
        e.preventDefault();
        translateX = e.clientX - startX;
        translateY = e.clientY - startY;
        actualizarTransformacion();
    }
    
    function endPan() {
        panning = false;
        document.getElementById('mapaCanvas').style.cursor = 'grab';
    }
    
    function startPanTouch(e) {
        if (e.touches.length === 1) {
            panning = true;
            startX = e.touches[0].clientX - translateX;
            startY = e.touches[0].clientY - translateY;
        }
    }
    
    function panTouch(e) {
        if (!panning || e.touches.length !== 1) return;
        e.preventDefault();
        translateX = e.touches[0].clientX - startX;
        translateY = e.touches[0].clientY - startY;
        actualizarTransformacion();
    }
    
    function zoomWheel(e) {
        e.preventDefault();
        const zoomIntensity = 0.1;
        const oldZoom = zoomLevel;
        
        // Determinar dirección del zoom
        zoomLevel += e.deltaY < 0 ? zoomIntensity : -zoomIntensity;
        zoomLevel = Math.min(Math.max(0.5, zoomLevel), 3);
        
        // Actualizar slider
        document.getElementById('zoomSlider').value = zoomLevel;
        
        // Centrar zoom en posición del mouse
        const rect = e.target.getBoundingClientRect();
        const mouseX = e.clientX - rect.left;
        const mouseY = e.clientY - rect.top;
        
        // Ajustar traslación para mantener el punto bajo el mouse
        translateX = mouseX - (mouseX - translateX) * (zoomLevel / oldZoom);
        translateY = mouseY - (mouseY - translateY) * (zoomLevel / oldZoom);
        
        actualizarTransformacion();
    }
    
    function zoomSliderChange(value) {
        const oldZoom = zoomLevel;
        zoomLevel = parseFloat(value);
        
        // Centrar zoom
        const canvas = document.getElementById('mapaCanvas');
        const rect = canvas.getBoundingClientRect();
        const centerX = rect.width / 2;
        const centerY = rect.height / 2;
        
        translateX = centerX - (centerX - translateX) * (zoomLevel / oldZoom);
        translateY = centerY - (centerY - translateY) * (zoomLevel / oldZoom);
        
        actualizarTransformacion();
    }
    
    function actualizarTransformacion() {
        const nodosContainer = document.getElementById('nodosContainer');
        nodosContainer.style.transform = `translate(${translateX}px, ${translateY}px) scale(${zoomLevel})`;
        
        // Actualizar mini mapa
        actualizarMinimap();
    }
    
    // Crear partículas de fondo
    function crearParticulas() {
        const container = document.getElementById('particlesContainer');
        const particulaCount = 100;
        
        for (let i = 0; i < particulaCount; i++) {
            const particula = document.createElement('div');
            particula.className = 'particle';
            
            // Posición aleatoria
            const x = Math.random() * 100;
            const y = Math.random() * 100;
            const size = Math.random() * 3 + 1;
            const duration = Math.random() * 20 + 10;
            const delay = Math.random() * 5;
            
            particula.style.left = `${x}%`;
            particula.style.top = `${y}%`;
            particula.style.width = `${size}px`;
            particula.style.height = `${size}px`;
            particula.style.animation = `float ${duration}s infinite ${delay}s`;
            particula.style.opacity = Math.random() * 0.5 + 0.2;
            
            container.appendChild(particula);
            particulas.push(particula);
        }
        
        // Agregar animación de flotar
        const style = document.createElement('style');
        style.textContent = `
            @keyframes float {
                0%, 100% { transform: translate(0, 0); }
                25% { transform: translate(${Math.random() * 20 - 10}px, ${Math.random() * 20 - 10}px); }
                50% { transform: translate(${Math.random() * 20 - 10}px, ${Math.random() * 20 - 10}px); }
                75% { transform: translate(${Math.random() * 20 - 10}px, ${Math.random() * 20 - 10}px); }
            }
        `;
        document.head.appendChild(style);
    }
    
    // Crear nodos de ejes
    function crearNodosEjes() {
        const ejesContainer = document.getElementById('ejesContainer');
        ejesContainer.innerHTML = '';
        
        const canvas = document.getElementById('mapaCanvas');
        const width = canvas.offsetWidth;
        const height = canvas.offsetHeight;
        const centroX = width / 2;
        const centroY = height / 2;
        const radio = Math.min(width, height) * 0.35;
        
        nodos.ejes.forEach((eje, index) => {
            const angulo = (2 * Math.PI / nodos.ejes.length) * index;
            const x = centroX + radio * Math.cos(angulo);
            const y = centroY + radio * Math.sin(angulo);
            
            const nodoDiv = document.createElement('div');
            nodoDiv.className = 'nodo nodo-eje nodo-aparecer';
            nodoDiv.id = `nodo-${eje.id}`;
            nodoDiv.dataset.ejeId = eje.id;
            nodoDiv.style.left = `${x}px`;
            nodoDiv.style.top = `${y}px`;
            nodoDiv.style.transform = 'translate(-50%, -50%)';
            nodoDiv.style.animationDelay = `${index * 0.1}s`;
            
            nodoDiv.innerHTML = `
                <div class="nodo-content">
                    <div class="nodo-icon" style="background: linear-gradient(135deg, ${eje.color}, ${oscurecerColor(eje.color, 20)})">
                        <i class="fas fa-${eje.icono}"></i>
                    </div>
                    <div class="nodo-title">${eje.nombre}</div>
                    <div class="nodo-counter" id="counter-${eje.id}">0 estrategias</div>
                </div>
            `;
            
            ejesContainer.appendChild(nodoDiv);
            
            // Crear conexión con el nodo central
            crearConexion(centroX, centroY, x, y, 'eje', eje.color);
            
            // Agregar evento de clic
            nodoDiv.addEventListener('click', function(e) {
                e.stopPropagation();
                seleccionarNodo(this.id);
                mostrarEstrategias(eje.id);
            });
        });
        
        // Dibujar conexiones después de un retraso
        setTimeout(dibujarConexiones, nodos.ejes.length * 100);
    }
    
    function oscurecerColor(color, percent) {
        let num = parseInt(color.replace("#", ""), 16),
            amt = Math.round(2.55 * percent),
            R = (num >> 16) - amt,
            G = (num >> 8 & 0x00FF) - amt,
            B = (num & 0x0000FF) - amt;
        
        return "#" + (0x1000000 + (R < 255 ? R < 1 ? 0 : R : 255) * 0x10000 +
            (G < 255 ? G < 1 ? 0 : G : 255) * 0x100 +
            (B < 255 ? B < 1 ? 0 : B : 255)).toString(16).slice(1);
    }
    
    // Cargar datos del backend
    function cargarDatos() {
        // Simular carga de datos
        setTimeout(() => {
            // Datos de ejemplo para estrategias
            nodos.estrategias = [
                { id: 1, eje_id: 'educacion', nombre: 'Capacitación docente', tipo: 'FO' },
                { id: 2, eje_id: 'educacion', nombre: 'Infraestructura educativa', tipo: 'DA' },
                { id: 3, eje_id: 'salud', nombre: 'Equipamiento médico', tipo: 'FO' },
                { id: 4, eje_id: 'empleabilidad', nombre: 'Formación técnica', tipo: 'FA' },
                { id: 5, eje_id: 'agua', nombre: 'Monitoreo calidad', tipo: 'DO' }
            ];
            
            actualizarContadoresEjes();
            actualizarEstadisticas();
        }, 1000);
    }
    
    function actualizarContadoresEjes() {
        nodos.ejes.forEach(eje => {
            const count = nodos.estrategias.filter(e => e.eje_id === eje.id).length;
            const counterElement = document.getElementById(`counter-${eje.id}`);
            if (counterElement) {
                counterElement.textContent = `${count} estrategias`;
            }
        });
    }
    
    function actualizarEstadisticas() {
        document.getElementById('total-estrategias').textContent = `${nodos.estrategias.length} Estrategias`;
        document.getElementById('contador-estrategias').textContent = nodos.estrategias.length;
        document.getElementById('total-conexiones').textContent = `${conexiones.length} Conexiones`;
    }
    
    // Funciones de animación y visualización
    function animarEntrada() {
        const todosNodos = document.querySelectorAll('.nodo');
        todosNodos.forEach((nodo, index) => {
            nodo.classList.add('nodo-aparecer');
            nodo.style.animationDelay = `${index * 0.05}s`;
        });
        
        // Efecto de onda desde el centro
        setTimeout(crearOndaCentro, 500);
    }
    
    function crearOndaCentro() {
        const canvas = document.getElementById('mapaCanvas');
        const onda = document.createElement('div');
        onda.style.cssText = `
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 10px;
            height: 10px;
            border-radius: 50%;
            border: 2px solid rgba(52, 152, 219, 0.5);
            z-index: 0;
            pointer-events: none;
        `;
        
        canvas.appendChild(onda);
        
        let size = 10;
        const animacion = setInterval(() => {
            size += 20;
            onda.style.width = `${size}px`;
            onda.style.height = `${size}px`;
            onda.style.opacity = 1 - (size / 500);
            
            if (size > 500) {
                clearInterval(animacion);
                onda.remove();
            }
        }, 20);
    }
    
    function seleccionarNodo(nodoId) {
        // Remover selección anterior
        if (nodoSeleccionado) {
            nodoSeleccionado.classList.remove('nodo-seleccionado');
        }
        
        // Agregar nueva selección
        nodoSeleccionado = document.getElementById(nodoId);
        if (nodoSeleccionado) {
            nodoSeleccionado.classList.add('nodo-seleccionado');
            
            // Efecto de partículas
            crearParticulasHover(nodoId);
        }
    }
    
    function crearParticulasHover(nodoId) {
        const nodo = document.getElementById(nodoId);
        if (!nodo) return;
        
        const rect = nodo.getBoundingClientRect();
        const x = rect.left + rect.width / 2;
        const y = rect.top + rect.height / 2;
        
        for (let i = 0; i < 10; i++) {
            const particula = document.createElement('div');
            particula.className = 'particle';
            particula.style.position = 'fixed';
            particula.style.left = `${x}px`;
            particula.style.top = `${y}px`;
            particula.style.zIndex = '9999';
            
            const angle = Math.random() * Math.PI * 2;
            const speed = Math.random() * 50 + 50;
            const size = Math.random() * 4 + 2;
            
            particula.style.width = `${size}px`;
            particula.style.height = `${size}px`;
            
            document.body.appendChild(particula);
            
            let progress = 0;
            const animacion = setInterval(() => {
                progress += 0.02;
                const currentX = x + Math.cos(angle) * speed * progress;
                const currentY = y + Math.sin(angle) * speed * progress;
                
                particula.style.left = `${currentX}px`;
                particula.style.top = `${currentY}px`;
                particula.style.opacity = 1 - progress;
                
                if (progress >= 1) {
                    clearInterval(animacion);
                    particula.remove();
                }
            }, 16);
        }
    }
    
    // Funciones de conexiones
    function crearConexion(x1, y1, x2, y2, tipo, color) {
        conexiones.push({ x1, y1, x2, y2, tipo, color });
    }
    
    function dibujarConexiones() {
        const svg = document.getElementById('conexionesSvg');
        
        // Limpiar conexiones existentes
        const existingLines = svg.querySelectorAll('.conexion');
        existingLines.forEach(line => line.remove());
        
        // Dibujar nuevas conexiones
        conexiones.forEach((conexion, index) => {
            const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
            line.setAttribute('x1', conexion.x1);
            line.setAttribute('y1', conexion.y1);
            line.setAttribute('x2', conexion.x2);
            line.setAttribute('y2', conexion.y2);
            line.setAttribute('class', `conexion ${conexion.tipo}`);
            line.style.animationDelay = `${index * 0.1}s`;
            
            if (conexion.color) {
                line.style.stroke = conexion.color;
            }
            
            svg.appendChild(line);
        });
        
        actualizarEstadisticas();
    }
    
    // Funciones de UI
    function mostrarEstrategias(ejeId) {
        // Implementar lógica para mostrar estrategias
        mostrarPanelDetalles(ejeId);
    }
    
    function mostrarPanelDetalles(ejeId) {
        const panel = document.getElementById('panelDetalles');
        const titulo = document.getElementById('detalleTitulo');
        const contenido = document.getElementById('detalleContenido');
        
        const eje = nodos.ejes.find(e => e.id === ejeId);
        if (!eje) return;
        
        const estrategiasEje = nodos.estrategias.filter(e => e.eje_id === ejeId);
        
        titulo.innerHTML = `<i class="fas fa-${eje.icono}"></i> ${eje.nombre}`;
        
        contenido.innerHTML = `
            <div class="detalle-eje">
                <div class="eje-header" style="background: linear-gradient(135deg, ${eje.color}, ${oscurecerColor(eje.color, 20)}); padding: 20px; border-radius: 15px; margin-bottom: 20px;">
                    <div class="eje-icon-grande">
                        <i class="fas fa-${eje.icono}"></i>
                    </div>
                    <h4 style="color: white; margin-top: 10px;">${eje.nombre}</h4>
                </div>
                
                <div class="eje-estadisticas">
                    <div class="estadistica">
                        <div class="estadistica-valor">${estrategiasEje.length}</div>
                        <div class="estadistica-label">Estrategias</div>
                    </div>
                    <div class="estadistica">
                        <div class="estadistica-valor">${conexiones.filter(c => c.tipo === 'eje').length}</div>
                        <div class="estadistica-label">Conexiones</div>
                    </div>
                </div>
                
                ${estrategiasEje.length > 0 ? `
                    <div class="estrategias-lista">
                        <h5 style="color: white; margin-bottom: 15px;">Estrategias:</h5>
                        ${estrategiasEje.map(estrategia => `
                            <div class="estrategia-item" style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 10px; margin-bottom: 10px; border-left: 4px solid ${eje.color};">
                                <div class="estrategia-tipo" style="background: ${eje.color}; color: white; padding: 2px 8px; border-radius: 4px; font-size: 12px; display: inline-block; margin-bottom: 5px;">
                                    ${estrategia.tipo}
                                </div>
                                <div style="color: rgba(255,255,255,0.9);">${estrategia.nombre}</div>
                            </div>
                        `).join('')}
                    </div>
                ` : '<p style="color: rgba(255,255,255,0.7); text-align: center; padding: 20px;">No hay estrategias asignadas a este eje aún.</p>'}
            </div>
        `;
        
        panel.classList.add('open');
    }
    
    function cerrarPanel() {
        document.getElementById('panelDetalles').classList.remove('open');
        if (nodoSeleccionado) {
            nodoSeleccionado.classList.remove('nodo-seleccionado');
            nodoSeleccionado = null;
        }
    }
    
    // Funciones de control
    function toggleFullscreen() {
        const container = document.getElementById('mapaFullscreen');
        
        if (!document.fullscreenElement) {
            if (container.requestFullscreen) {
                container.requestFullscreen();
            } else if (container.webkitRequestFullscreen) {
                container.webkitRequestFullscreen();
            } else if (container.msRequestFullscreen) {
                container.msRequestFullscreen();
            }
        } else {
            if (document.exitFullscreen) {
                document.exitFullscreen();
            } else if (document.webkitExitFullscreen) {
                document.webkitExitFullscreen();
            } else if (document.msExitFullscreen) {
                document.msExitFullscreen();
            }
        }
    }
    
    function resetView() {
        zoomLevel = 1;
        translateX = 0;
        translateY = 0;
        document.getElementById('zoomSlider').value = 1;
        actualizarTransformacion();
        mostrarNotificacion('Vista reiniciada', 'success');
    }
    
    function toggleAnimations() {
        animacionesActivas = !animacionesActivas;
        const icon = document.getElementById('animacionIcon');
        
        if (animacionesActivas) {
            icon.className = 'fas fa-pause';
            document.querySelectorAll('.conexion').forEach(line => {
                line.style.animationPlayState = 'running';
            });
        } else {
            icon.className = 'fas fa-play';
            document.querySelectorAll('.conexion').forEach(line => {
                line.style.animationPlayState = 'paused';
            });
        }
        
        mostrarNotificacion(`Animaciones ${animacionesActivas ? 'activadas' : 'pausadas'}`, 'info');
    }
    
    function exportMap() {
        // Implementar exportación
        mostrarNotificacion('Exportando mapa como imagen...', 'success');
    }
    
    function filtrarNodos() {
        const nivel = document.getElementById('filtro-nivel').value;
        const todosNodos = document.querySelectorAll('.nodo');
        
        todosNodos.forEach(nodo => {
            if (nivel === 'all') {
                nodo.style.display = 'block';
            } else if (nivel === 'objetivo' && nodo.classList.contains('nodo-central')) {
                nodo.style.display = 'block';
            } else if (nivel === 'ejes' && nodo.classList.contains('nodo-eje')) {
                nodo.style.display = 'block';
            } else if (nivel === 'estrategias' && nodo.classList.contains('nodo-estrategia')) {
                nodo.style.display = 'block';
            } else if (nivel === 'actividades' && nodo.classList.contains('nodo-actividad')) {
                nodo.style.display = 'block';
            } else if (nivel === 'tareas' && nodo.classList.contains('nodo-tarea')) {
                nodo.style.display = 'block';
            } else {
                nodo.style.display = 'none';
            }
        });
        
        mostrarNotificacion(`Mostrando nivel: ${nivel}`, 'info');
    }
    
    function expandirTodo() {
        // Implementar expansión de todos los nodos
        mostrarNotificacion('Expandir todas las conexiones', 'info');
    }
    
    function mostrarDetalleObjetivo() {
        document.getElementById('modalObjetivo').classList.add('active');
    }
    
    function cerrarModal(modalId) {
        document.getElementById(modalId).classList.remove('active');
    }
    
    function recalcularPosiciones() {
        const ejes = document.querySelectorAll('.nodo-eje');
        const canvas = document.getElementById('mapaCanvas');
        const width = canvas.offsetWidth;
        const height = canvas.offsetHeight;
        const centroX = width / 2;
        const centroY = height / 2;
        const radio = Math.min(width, height) * 0.35;
        
        ejes.forEach((eje, index) => {
            const angulo = (2 * Math.PI / ejes.length) * index;
            const x = centroX + radio * Math.cos(angulo);
            const y = centroY + radio * Math.sin(angulo);
            
            eje.style.left = `${x}px`;
            eje.style.top = `${y}px`;
        });
        
        // Redibujar conexiones
        conexiones = [];
        ejes.forEach((eje, index) => {
            const rect = eje.getBoundingClientRect();
            crearConexion(centroX, centroY, rect.left + rect.width/2, rect.top + rect.height/2, 'eje');
        });
        
        dibujarConexiones();
    }
    
    function actualizarMinimap() {
        const minimap = document.getElementById('minimapViewport');
        if (!minimap) return;
        
        const scale = 0.1;
        const viewportWidth = 150 * (1/zoomLevel);
        const viewportHeight = 150 * (1/zoomLevel);
        const viewportX = -translateX * scale;
        const viewportY = -translateY * scale;
        
        minimap.style.width = `${viewportWidth}px`;
        minimap.style.height = `${viewportHeight}px`;
        minimap.style.left = `${viewportX + 75}px`;
        minimap.style.top = `${viewportY + 75}px`;
    }
    
    function mostrarNotificacion(mensaje, tipo) {
        const notificacion = document.createElement('div');
        notificacion.className = 'notificacion';
        notificacion.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            background: ${tipo === 'success' ? 'rgba(46, 204, 113, 0.9)' : tipo === 'info' ? 'rgba(52, 152, 219, 0.9)' : 'rgba(241, 196, 15, 0.9)'};
            color: white;
            border-radius: 10px;
            font-weight: 600;
            z-index: 4000;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            transform: translateX(150%);
            transition: transform 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        `;
        
        notificacion.innerHTML = `
            <i class="fas fa-${tipo === 'success' ? 'check-circle' : 'info-circle'}"></i>
            ${mensaje}
        `;
        
        document.body.appendChild(notificacion);
        
        setTimeout(() => {
            notificacion.style.transform = 'translateX(0)';
        }, 10);
        
        setTimeout(() => {
            notificacion.style.transform = 'translateX(150%)';
            setTimeout(() => {
                notificacion.remove();
            }, 300);
        }, 3000);
    }
    
    // Detectar cambios en fullscreen
    document.addEventListener('fullscreenchange', recalcularPosiciones);
    document.addEventListener('webkitfullscreenchange', recalcularPosiciones);
    document.addEventListener('mozfullscreenchange', recalcularPosiciones);
    document.addEventListener('MSFullscreenChange', recalcularPosiciones);
</script>
{% endblock %}
