{% extends "inicio.html" %}

{% block content %}
<!-- Mapa Neuronal Estratégico - Sistema Solar Mejorado -->
<div class="mapa-neuronal-container" id="mapaFullscreen">
    <!-- Cabecera principal -->
    <div class="mapa-header-glass">
        <div class="header-content">
            <h1 class="mapa-title-glow">
                <i class="fas fa-solar-system"></i>
                <span class="title-text">SISTEMA SOLAR ESTRATÉGICO</span>
                <span class="subtitle">Proyecto El Domo</span>
            </h1>
            <div class="header-stats">
                <div class="stat-badge">
                    <i class="fas fa-sun"></i>
                    <span>1 Sol</span>
                </div>
                <div class="stat-badge">
                    <i class="fas fa-globe"></i>
                    <span id="total-ejes">7 Ejes</span>
                </div>
                <div class="stat-badge">
                    <i class="fas fa-moon"></i>
                    <span id="total-estrategias">0 Lunas</span>
                </div>
                <div class="stat-badge">
                    <i class="fas fa-satellite"></i>
                    <span id="total-tacticas">0 Satélites</span>
                </div>
                <div class="stat-badge">
                    <i class="fas fa-meteor"></i>
                    <span id="total-actividades">0 Asteroides</span>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Panel de controles organizado -->
    <div class="panel-controles">
        <div class="grupo-controles">
            <h4><i class="fas fa-cogs"></i> Controles del Sistema</h4>
            <div class="controles-grid">
                <button class="control-btn tooltip" onclick="toggleFullscreen()" data-tooltip="Pantalla completa">
                    <i class="fas fa-expand"></i>
                </button>
                <button class="control-btn tooltip" onclick="resetView()" data-tooltip="Reiniciar vista">
                    <i class="fas fa-sync-alt"></i>
                </button>
                <button class="control-btn tooltip" onclick="toggleAnimaciones()" data-tooltip="Animaciones">
                    <i class="fas fa-play" id="animacionIcon"></i>
                </button>
                <button class="control-btn tooltip" onclick="optimizarDistribucion()" data-tooltip="Optimizar distribución">
                    <i class="fas fa-solar-system"></i>
                </button>
                <button class="control-btn tooltip" onclick="exportMap()" data-tooltip="Exportar">
                    <i class="fas fa-download"></i>
                </button>
            </div>
        </div>
        
        <div class="grupo-controles">
            <h4><i class="fas fa-filter"></i> Filtros</h4>
            <select id="filtro-nivel" onchange="aplicarFiltro()" class="filtro-select">
                <option value="todos">Todos los elementos</option>
                <option value="sol">Sol Central</option>
                <option value="ejes">Ejes (Planetas)</option>
                <option value="estrategias">Estrategias (Lunas)</option>
                <option value="tacticas">Tácticas (Satélites)</option>
                <option value="actividades">Actividades (Asteroides)</option>
            </select>
            
            <select id="filtro-eje" onchange="filtrarPorEje()" class="filtro-select">
                <option value="todos">Todos los ejes</option>
                <option value="educacion">Educación</option>
                <option value="salud">Salud</option>
                <option value="empleabilidad">Empleabilidad</option>
                <option value="desarrollo_economico">Desarrollo Económico</option>
                <option value="sostenibilidad_ambiental">Sostenibilidad Ambiental</option>
                <option value="comunicacion">Comunicación</option>
                <option value="institucional">Institucional</option>
            </select>
            
            <div class="filtro-checkbox">
                <label>
                    <input type="checkbox" id="mostrar-anillos" checked onchange="toggleAnillos()">
                    <span>Mostrar anillos orbitales</span>
                </label>
                <label>
                    <input type="checkbox" id="mostrar-nombres" checked onchange="toggleNombres()">
                    <span>Mostrar nombres</span>
                </label>
            </div>
        </div>
        
        <div class="grupo-controles">
            <h4><i class="fas fa-search"></i> Zoom</h4>
            <div class="zoom-controls">
                <button class="zoom-btn" onclick="zoomOut()">-</button>
                <input type="range" id="zoomSlider" min="0.3" max="3" step="0.1" value="1" 
                       oninput="zoomSliderChange(this.value)">
                <button class="zoom-btn" onclick="zoomIn()">+</button>
                <div class="zoom-value" id="zoomValue">100%</div>
            </div>
        </div>
    </div>
    
    <!-- Canvas principal -->
    <div class="mapa-canvas-fullscreen" id="mapaCanvas">
        <!-- Fondo con estrellas -->
        <div class="estrellas-container" id="estrellasContainer"></div>
        
        <!-- Anillos orbitales -->
        <div class="anillos-container" id="anillosContainer"></div>
        
        <!-- Conexiones orbitales -->
        <svg class="conexiones-svg" id="conexionesSvg"></svg>
        
        <!-- Contenedor de nodos -->
        <div class="nodos-container" id="nodosContainer">
            <!-- Sol Central (Objetivo) -->
            <div class="nodo nodo-sol" id="nodo-objetivo">
                <div class="nodo-glow-sol"></div>
                <div class="nodo-content">
                    <div class="nodo-icon-pulse-sol">
                        <i class="fas fa-sun"></i>
                    </div>
                    <div class="nodo-title-glow">OBJETIVO ESTRATÉGICO</div>
                    <div class="nodo-desc-scroll">
                        Consolidar la viabilidad y el respaldo social del Proyecto El Domo...
                    </div>
                    <button class="btn-ver-mas" onclick="mostrarDetalleObjetivo()">
                        <i class="fas fa-eye"></i> Ver completo
                    </button>
                </div>
            </div>
            
            <!-- Ejes (Planetas) -->
            <div class="ejes-container" id="ejesContainer"></div>
            
            <!-- Estrategias (Lunas) -->
            <div class="estrategias-container" id="estrategiasContainer"></div>
            
            <!-- Tácticas (Satélites) -->
            <div class="tacticas-container" id="tacticasContainer"></div>
            
            <!-- Actividades (Asteroides) -->
            <div class="actividades-container" id="actividadesContainer"></div>
        </div>
        
        <!-- Leyenda flotante -->
        <div class="leyenda-flotante">
            <div class="leyenda-header">
                <i class="fas fa-star"></i> Leyenda del Sistema
            </div>
            <div class="leyenda-content">
                <div class="leyenda-item">
                    <div class="leyenda-icon nodo-sol-color"></div>
                    <span>Sol (Objetivo)</span>
                </div>
                <div class="leyenda-item">
                    <div class="leyenda-icon nodo-eje-color"></div>
                    <span>Ejes (Planetas)</span>
                </div>
                <div class="leyenda-item">
                    <div class="leyenda-icon nodo-estrategia-color"></div>
                    <span>Estrategias (Lunas)</span>
                </div>
                <div class="leyenda-item">
                    <div class="leyenda-icon nodo-tactica-color"></div>
                    <span>Tácticas (Satélites)</span>
                </div>
                <div class="leyenda-item">
                    <div class="leyenda-icon nodo-actividad-color"></div>
                    <span>Actividades (Asteroides)</span>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Panel de detalles -->
    <div class="panel-detalles" id="panelDetalles">
        <div class="panel-header">
            <h3 id="detalleTitulo"><i class="fas fa-info-circle"></i> Detalles del Elemento</h3>
            <button class="panel-close" onclick="cerrarPanel()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="panel-body" id="detalleContenido">
            <div class="cargando-detalles">
                <i class="fas fa-spinner fa-spin"></i> Cargando detalles...
            </div>
        </div>
    </div>
</div>

<style>
    /* ================================
       ESTILOS PRINCIPALES - SISTEMA SOLAR
    ================================ */
    
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }
    
    .mapa-neuronal-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: linear-gradient(135deg, #000428 0%, #000e3b 50%, #001f5c 100%);
        overflow: hidden;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    /* Cabecera */
    .mapa-header-glass {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 80px;
        background: rgba(0, 0, 0, 0.3);
        backdrop-filter: blur(20px);
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        padding: 0 20px;
        z-index: 1000;
        display: flex;
        align-items: center;
    }
    
    .header-content {
        width: 100%;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .mapa-title-glow {
        color: white;
        display: flex;
        flex-direction: column;
        gap: 5px;
    }
    
    .title-text {
        font-size: 22px;
        font-weight: 700;
        letter-spacing: 1px;
        text-shadow: 0 0 15px rgba(255, 215, 0, 0.7);
    }
    
    .subtitle {
        font-size: 14px;
        opacity: 0.8;
        font-weight: 400;
        color: rgba(255, 255, 255, 0.9);
    }
    
    .header-stats {
        display: flex;
        gap: 15px;
    }
    
    .stat-badge {
        background: rgba(255, 255, 255, 0.1);
        padding: 8px 15px;
        border-radius: 15px;
        display: flex;
        align-items: center;
        gap: 8px;
        color: white;
        font-size: 14px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        transition: all 0.3s ease;
    }
    
    .stat-badge:hover {
        background: rgba(255, 255, 255, 0.15);
        transform: translateY(-2px);
    }
    
    /* Panel de controles */
    .panel-controles {
        position: absolute;
        top: 90px;
        right: 20px;
        width: 350px;
        background: rgba(0, 0, 0, 0.3);
        backdrop-filter: blur(20px);
        border-radius: 15px;
        padding: 20px;
        z-index: 1000;
        border: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        display: flex;
        flex-direction: column;
        gap: 20px;
    }
    
    .grupo-controles {
        padding-bottom: 15px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .grupo-controles:last-child {
        border-bottom: none;
    }
    
    .grupo-controles h4 {
        color: white;
        font-size: 14px;
        font-weight: 600;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .controles-grid {
        display: grid;
        grid-template-columns: repeat(5, 1fr);
        gap: 8px;
    }
    
    .control-btn {
        width: 40px;
        height: 40px;
        border-radius: 10px;
        background: rgba(255, 215, 0, 0.2);
        border: 1px solid rgba(255, 215, 0, 0.3);
        color: white;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 16px;
        transition: all 0.3s ease;
    }
    
    .control-btn:hover {
        background: rgba(255, 215, 0, 0.4);
        transform: translateY(-2px);
        box-shadow: 0 0 15px rgba(255, 215, 0, 0.5);
    }
    
    .tooltip {
        position: relative;
    }
    
    .tooltip::after {
        content: attr(data-tooltip);
        position: absolute;
        bottom: 100%;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 6px 12px;
        border-radius: 6px;
        font-size: 12px;
        white-space: nowrap;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
        pointer-events: none;
    }
    
    .tooltip:hover::after {
        opacity: 1;
        visibility: visible;
        bottom: 120%;
    }
    
    .filtro-select {
        width: 100%;
        padding: 10px;
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        color: white;
        border-radius: 8px;
        font-size: 14px;
        margin-bottom: 10px;
    }
    
    .filtro-select option {
        background: #000428;
        color: white;
    }
    
    .filtro-checkbox {
        display: flex;
        flex-direction: column;
        gap: 8px;
        color: rgba(255, 255, 255, 0.9);
        font-size: 14px;
    }
    
    .filtro-checkbox label {
        display: flex;
        align-items: center;
        gap: 8px;
        cursor: pointer;
    }
    
    .filtro-checkbox input {
        accent-color: #FFD700;
    }
    
    .zoom-controls {
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .zoom-btn {
        width: 35px;
        height: 35px;
        border-radius: 8px;
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        color: white;
        cursor: pointer;
        font-weight: bold;
        transition: all 0.3s ease;
    }
    
    .zoom-btn:hover {
        background: rgba(255, 255, 255, 0.2);
    }
    
    .zoom-controls input[type="range"] {
        flex: 1;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 8px;
        height: 6px;
        outline: none;
        -webkit-appearance: none;
    }
    
    .zoom-controls input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: #FFD700;
        cursor: pointer;
        box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
    }
    
    .zoom-value {
        min-width: 45px;
        text-align: center;
        color: white;
        font-size: 12px;
        background: rgba(255, 255, 255, 0.1);
        padding: 5px;
        border-radius: 6px;
    }
    
    /* Canvas principal */
    .mapa-canvas-fullscreen {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
        cursor: grab;
        z-index: 1;
    }
    
    .mapa-canvas-fullscreen:active {
        cursor: grabbing;
    }
    
    /* Estrellas de fondo */
    .estrellas-container {
        position: absolute;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 1;
    }
    
    .estrella {
        position: absolute;
        background: white;
        border-radius: 50%;
        animation: twinkle 3s infinite;
    }
    
    @keyframes twinkle {
        0%, 100% { opacity: 0.3; }
        50% { opacity: 1; }
    }
    
    /* Anillos orbitales */
    .anillos-container {
        position: absolute;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 2;
    }
    
    .anillo-orbital {
        position: absolute;
        border-radius: 50%;
        border: 1px solid rgba(255, 255, 255, 0.15);
        transform: translate(-50%, -50%);
    }
    
    /* Conexiones */
    .conexiones-svg {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 3;
    }
    
    .conexion-orbital {
        stroke-width: 1;
        fill: none;
        stroke-dasharray: 5,5;
        animation: dashMove 20s linear infinite;
    }
    
    @keyframes dashMove {
        to {
            stroke-dashoffset: -100;
        }
    }
    
    /* Contenedor de nodos */
    .nodos-container {
        position: absolute;
        width: 100%;
        height: 100%;
        z-index: 10;
        transform-origin: center;
        transition: transform 0.3s ease;
    }
    
    /* Sol Central */
    .nodo-sol {
        position: absolute;
        width: 300px;
        height: 300px;
        z-index: 100;
        transform: translate(-50%, -50%);
    }
    
    .nodo-glow-sol {
        position: absolute;
        width: 100%;
        height: 100%;
        border-radius: 50%;
        background: radial-gradient(circle, 
            rgba(255, 215, 0, 0.6) 0%, 
            rgba(255, 140, 0, 0.3) 30%, 
            rgba(255, 140, 0, 0) 70%);
        animation: pulseSol 3s infinite;
        filter: blur(30px);
        z-index: -1;
    }
    
    .nodo-sol .nodo-content {
        position: relative;
        width: 100%;
        height: 100%;
        background: radial-gradient(circle, #FFD700, #FF8C00);
        border-radius: 50%;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-align: center;
        padding: 40px;
        border: 4px solid rgba(255, 255, 255, 0.3);
        box-shadow: 0 0 60px rgba(255, 215, 0, 0.7),
                    inset 0 0 40px rgba(255, 255, 255, 0.2);
    }
    
    .nodo-icon-pulse-sol {
        width: 100px;
        height: 100px;
        background: rgba(255, 255, 255, 0.9);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 20px;
        font-size: 48px;
        color: #FF8C00;
        animation: pulseSolIcon 2s infinite;
        box-shadow: 0 0 40px rgba(255, 215, 0, 0.8);
    }
    
    .nodo-title-glow {
        font-size: 18px;
        font-weight: 700;
        color: white;
        margin-bottom: 10px;
        text-transform: uppercase;
        letter-spacing: 1px;
        text-shadow: 0 0 10px rgba(255, 215, 0, 0.7);
    }
    
    .nodo-desc-scroll {
        font-size: 13px;
        color: rgba(255, 255, 255, 0.9);
        line-height: 1.4;
        margin-bottom: 15px;
        max-height: 60px;
        overflow: hidden;
        text-overflow: ellipsis;
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
    }
    
    .btn-ver-mas {
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(255, 215, 0, 0.8));
        border: none;
        color: #000;
        padding: 10px 20px;
        border-radius: 25px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 14px;
        font-weight: 600;
        transition: all 0.3s ease;
    }
    
    .btn-ver-mas:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 20px rgba(255, 215, 0, 0.4);
    }
    
    /* Ejes (Planetas) */
    .nodo-eje {
        position: absolute;
        width: 180px;
        height: 180px;
        z-index: 90;
        transform: translate(-50%, -50%);
        animation: orbitEje linear infinite;
    }
    
    .nodo-eje .nodo-content {
        position: relative;
        width: 100%;
        height: 100%;
        border-radius: 50%;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-align: center;
        padding: 25px;
        border: 3px solid rgba(255, 255, 255, 0.3);
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3),
                    inset 0 0 20px rgba(255, 255, 255, 0.1);
        transition: all 0.3s ease;
    }
    
    .nodo-eje:hover .nodo-content {
        transform: scale(1.1);
        box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4),
                    inset 0 0 30px rgba(255, 255, 255, 0.2);
    }
    
    .nodo-eje .nodo-icon {
        width: 70px;
        height: 70px;
        background: rgba(255, 255, 255, 0.9);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 15px;
        font-size: 28px;
        color: #2980b9;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
    }
    
    .nodo-eje .nodo-title {
        font-size: 15px;
        font-weight: 600;
        color: white;
        margin-bottom: 5px;
        text-align: center;
        line-height: 1.2;
    }
    
    /* Estrategias (Lunas) */
    .nodo-estrategia {
        position: absolute;
        width: 140px;
        height: 140px;
        z-index: 80;
        transform: translate(-50%, -50%);
    }
    
    .nodo-estrategia .nodo-content {
        background: radial-gradient(circle, rgba(46, 204, 113, 0.9), rgba(39, 174, 96, 0.8));
        border: 2px solid rgba(255, 255, 255, 0.3);
        padding: 20px;
    }
    
    .nodo-estrategia .nodo-icon {
        width: 50px;
        height: 50px;
        background: rgba(255, 255, 255, 0.9);
        color: #27ae60;
    }
    
    /* Tácticas (Satélites) */
    .nodo-tactica {
        position: absolute;
        width: 110px;
        height: 110px;
        z-index: 70;
        transform: translate(-50%, -50%);
    }
    
    .nodo-tactica .nodo-content {
        background: radial-gradient(circle, rgba(231, 76, 60, 0.9), rgba(192, 57, 43, 0.8));
        border: 2px solid rgba(255, 255, 255, 0.3);
        padding: 15px;
    }
    
    .nodo-tactica .nodo-icon {
        width: 40px;
        height: 40px;
        background: rgba(255, 255, 255, 0.9);
        color: #c0392b;
    }
    
    /* Actividades (Asteroides) */
    .nodo-actividad {
        position: absolute;
        width: 80px;
        height: 80px;
        z-index: 60;
        transform: translate(-50%, -50%);
        animation: floatAsteroid 3s ease-in-out infinite;
    }
    
    .nodo-actividad .nodo-content {
        background: radial-gradient(circle, rgba(243, 156, 18, 0.9), rgba(211, 84, 0, 0.8));
        border: 1px solid rgba(255, 255, 255, 0.3);
        border-radius: 20px !important;
        padding: 15px;
    }
    
    .nodo-actividad .nodo-icon {
        width: 30px;
        height: 30px;
        background: rgba(255, 255, 255, 0.9);
        color: #d35400;
        border-radius: 40%;
    }
    
    /* Leyenda */
    .leyenda-flotante {
        position: absolute;
        bottom: 20px;
        left: 20px;
        background: rgba(0, 0, 0, 0.3);
        backdrop-filter: blur(20px);
        border-radius: 15px;
        padding: 15px;
        width: 220px;
        z-index: 1000;
        border: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
    }
    
    .leyenda-header {
        color: white;
        font-weight: 600;
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .leyenda-content {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }
    
    .leyenda-item {
        display: flex;
        align-items: center;
        gap: 10px;
        color: rgba(255, 255, 255, 0.9);
        font-size: 13px;
    }
    
    .leyenda-icon {
        width: 20px;
        height: 20px;
        border-radius: 50%;
        flex-shrink: 0;
    }
    
    .nodo-sol-color {
        background: radial-gradient(circle, #FFD700, #FF8C00);
        box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
    }
    
    .nodo-eje-color {
        background: radial-gradient(circle, #3498db, #2980b9);
    }
    
    .nodo-estrategia-color {
        background: radial-gradient(circle, #2ecc71, #27ae60);
    }
    
    .nodo-tactica-color {
        background: radial-gradient(circle, #e74c3c, #c0392b);
    }
    
    .nodo-actividad-color {
        background: radial-gradient(circle, #f39c12, #d35400);
    }
    
    /* Panel de detalles */
    .panel-detalles {
        position: fixed;
        top: 0;
        right: -400px;
        width: 380px;
        height: 100%;
        background: rgba(0, 0, 0, 0.3);
        backdrop-filter: blur(30px);
        border-left: 1px solid rgba(255, 255, 255, 0.1);
        z-index: 2000;
        transition: right 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        overflow-y: auto;
    }
    
    .panel-detalles.open {
        right: 0;
    }
    
    .panel-header {
        padding: 25px;
        background: rgba(0, 20, 60, 0.5);
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .panel-header h3 {
        color: white;
        font-size: 18px;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .panel-close {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.1);
        border: none;
        color: white;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
    }
    
    .panel-close:hover {
        background: rgba(255, 255, 255, 0.2);
        transform: rotate(90deg);
    }
    
    .panel-body {
        padding: 25px;
        color: rgba(255, 255, 255, 0.9);
    }
    
    /* Animaciones */
    @keyframes pulseSol {
        0%, 100% {
            opacity: 0.6;
            transform: scale(1);
        }
        50% {
            opacity: 0.8;
            transform: scale(1.05);
        }
    }
    
    @keyframes pulseSolIcon {
        0%, 100% {
            box-shadow: 0 0 40px rgba(255, 215, 0, 0.8);
        }
        50% {
            box-shadow: 0 0 60px rgba(255, 215, 0, 1);
        }
    }
    
    @keyframes orbitEje {
        from { transform: translate(-50%, -50%) rotate(0deg) translateX(var(--orbita-radio)) rotate(0deg); }
        to { transform: translate(-50%, -50%) rotate(360deg) translateX(var(--orbita-radio)) rotate(-360deg); }
    }
    
    @keyframes floatAsteroid {
        0%, 100% { transform: translate(-50%, -50%) rotate(0deg) translateY(0); }
        50% { transform: translate(-50%, -50%) rotate(10deg) translateY(-10px); }
    }
    
    /* Colores específicos para cada eje */
    .eje-educacion .nodo-content { background: radial-gradient(circle, #3498db, #2980b9) !important; }
    .eje-salud .nodo-content { background: radial-gradient(circle, #e74c3c, #c0392b) !important; }
    .eje-empleabilidad .nodo-content { background: radial-gradient(circle, #2ecc71, #27ae60) !important; }
    .eje-desarrollo_economico .nodo-content { background: radial-gradient(circle, #9b59b6, #8e44ad) !important; }
    .eje-sostenibilidad_ambiental .nodo-content { background: radial-gradient(circle, #1abc9c, #16a085) !important; }
    .eje-comunicacion .nodo-content { background: radial-gradient(circle, #f1c40f, #f39c12) !important; }
    .eje-institucional .nodo-content { background: radial-gradient(circle, #e67e22, #d35400) !important; }
    
    /* Iconos por eje */
    .eje-educacion .nodo-icon { color: #2980b9 !important; }
    .eje-salud .nodo-icon { color: #c0392b !important; }
    .eje-empleabilidad .nodo-icon { color: #27ae60 !important; }
    .eje-desarrollo_economico .nodo-icon { color: #8e44ad !important; }
    .eje-sostenibilidad_ambiental .nodo-icon { color: #16a085 !important; }
    .eje-comunicacion .nodo-icon { color: #f39c12 !important; }
    .eje-institucional .nodo-icon { color: #d35400 !important; }
</style>

<script>
// ================================
// SISTEMA SOLAR ESTRATÉGICO - CONFIGURACIÓN
// ================================

const CONFIG = {
    animacionesActivas: true,
    mostrarAnillos: true,
    mostrarNombres: true,
    zoom: 1,
    translateX: 0,
    translateY: 0,
    panning: false
};

const SISTEMA_SOLAR = {
    ejes: [],
    estrategias: [],
    tacticas: [],
    actividades: [],
    conexiones: []
};

// ================================
// INICIALIZACIÓN
// ================================

document.addEventListener('DOMContentLoaded', function() {
    inicializarSistemaSolar();
    crearEstrellas();
    crearAnillosOrbitales();
    inicializarEventos();
    cargarDatosEjemplo();
});

function inicializarSistemaSolar() {
    const canvas = document.getElementById('mapaCanvas');
    const canvasRect = canvas.getBoundingClientRect();
    
    // Posicionar sol central
    const sol = document.getElementById('nodo-objetivo');
    sol.style.left = `${canvasRect.width / 2}px`;
    sol.style.top = `${canvasRect.height / 2}px`;
    
    // Definir ejes estratégicos con órbitas escalonadas
    SISTEMA_SOLAR.ejes = [
        {
            id: 'educacion',
            nombre: 'EDUCACIÓN',
            icono: 'graduation-cap',
            color: '#3498db',
            descripcion: 'Mejora de infraestructura educativa y capacitación docente',
            radioOrbita: 350,  // Cada eje tiene su propio radio
            anguloInicial: 0
        },
        {
            id: 'salud',
            nombre: 'SALUD',
            icono: 'heartbeat',
            color: '#e74c3c',
            descripcion: 'Equipamiento médico y mejoras en servicios de salud',
            radioOrbita: 430,
            anguloInicial: 51.4
        },
        {
            id: 'empleabilidad',
            nombre: 'EMPLEABILIDAD',
            icono: 'briefcase',
            color: '#2ecc71',
            descripcion: 'Formación técnica y oportunidades de empleo local',
            radioOrbita: 510,
            anguloInicial: 102.8
        },
        {
            id: 'desarrollo_economico',
            nombre: 'DESARROLLO ECONÓMICO',
            icono: 'chart-line',
            color: '#9b59b6',
            descripcion: 'Impulso al desarrollo económico comunitario',
            radioOrbita: 590,
            anguloInicial: 154.2
        },
        {
            id: 'sostenibilidad_ambiental',
            nombre: 'SOSTENIBILIDAD AMBIENTAL',
            icono: 'tint',
            color: '#1abc9c',
            descripcion: 'Gestión sostenible del recurso hídrico y monitoreo ambiental',
            radioOrbita: 670,
            anguloInicial: 205.6
        },
        {
            id: 'comunicacion',
            nombre: 'COMUNICACIÓN',
            icono: 'bullhorn',
            color: '#f1c40f',
            descripcion: 'Sistema de comunicación comunitaria y transparencia',
            radioOrbita: 750,
            anguloInicial: 257
        },
        {
            id: 'institucional',
            nombre: 'INSTITUCIONAL',
            icono: 'landmark',
            color: '#e67e22',
            descripcion: 'Cooperación técnica con GADs y niveles distritales',
            radioOrbita: 830,
            anguloInicial: 308.4
        }
    ];
    
    // Crear ejes (planetas)
    crearEjes();
}

function crearEstrellas() {
    const container = document.getElementById('estrellasContainer');
    const cantidad = 200;
    
    for (let i = 0; i < cantidad; i++) {
        const estrella = document.createElement('div');
        estrella.className = 'estrella';
        
        const x = Math.random() * 100;
        const y = Math.random() * 100;
        const size = Math.random() * 2 + 1;
        const duracion = Math.random() * 5 + 2;
        const delay = Math.random() * 5;
        const opacidad = Math.random() * 0.5 + 0.3;
        
        estrella.style.left = `${x}%`;
        estrella.style.top = `${y}%`;
        estrella.style.width = `${size}px`;
        estrella.style.height = `${size}px`;
        estrella.style.animation = `twinkle ${duracion}s infinite ${delay}s`;
        estrella.style.opacity = opacidad;
        
        // Algunas estrellas de colores
        if (Math.random() > 0.8) {
            const colores = ['#FFD700', '#1E90FF', '#98FB98', '#FF69B4'];
            estrella.style.backgroundColor = colores[Math.floor(Math.random() * colores.length)];
        }
        
        container.appendChild(estrella);
    }
}

function crearAnillosOrbitales() {
    const container = document.getElementById('anillosContainer');
    container.innerHTML = '';
    
    const canvas = document.getElementById('mapaCanvas');
    const canvasRect = canvas.getBoundingClientRect();
    const centroX = canvasRect.width / 2;
    const centroY = canvasRect.height / 2;
    
    // Crear anillos para cada órbita de eje
    SISTEMA_SOLAR.ejes.forEach((eje, index) => {
        const anillo = document.createElement('div');
        anillo.className = 'anillo-orbital';
        
        // Cada anillo más grande que el anterior con más espacio
        const radio = eje.radioOrbita;
        
        anillo.style.cssText = `
            top: ${centroY}px;
            left: ${centroX}px;
            width: ${radio * 2}px;
            height: ${radio * 2}px;
            border: 1px solid rgba(255, 255, 255, ${0.15 - (index * 0.02)});
            z-index: 2;
        `;
        
        container.appendChild(anillo);
    });
}

function crearEjes() {
    const container = document.getElementById('ejesContainer');
    container.innerHTML = '';
    
    const canvas = document.getElementById('mapaCanvas');
    const canvasRect = canvas.getBoundingClientRect();
    const centroX = canvasRect.width / 2;
    const centroY = canvasRect.height / 2;
    
    SISTEMA_SOLAR.ejes.forEach((eje, index) => {
        // Convertir ángulo a radianes
        const anguloRad = (eje.anguloInicial * Math.PI) / 180;
        
        // Calcular posición en la órbita
        const x = centroX + eje.radioOrbita * Math.cos(anguloRad);
        const y = centroY + eje.radioOrbita * Math.sin(anguloRad);
        
        const ejeDiv = document.createElement('div');
        ejeDiv.className = `nodo nodo-eje eje-${eje.id}`;
        ejeDiv.id = `eje-${eje.id}`;
        ejeDiv.dataset.ejeId = eje.id;
        ejeDiv.dataset.tipo = 'eje';
        ejeDiv.style.left = `${x}px`;
        ejeDiv.style.top = `${y}px`;
        ejeDiv.style.setProperty('--orbita-radio', `${eje.radioOrbita}px`);
        
        // Configurar animación orbital
        const duracionOrbita = 60 + (index * 10); // Cada eje más lento
        ejeDiv.style.animationDuration = `${duracionOrbita}s`;
        
        ejeDiv.innerHTML = `
            <div class="nodo-content">
                <div class="nodo-icon">
                    <i class="fas fa-${eje.icono}"></i>
                </div>
                <div class="nodo-title">${eje.nombre}</div>
                <div class="nodo-counter">0 estrategias</div>
            </div>
        `;
        
        container.appendChild(ejeDiv);
        
        // Eventos
        ejeDiv.addEventListener('click', function(e) {
            e.stopPropagation();
            seleccionarNodo(this.id);
            mostrarDetallesEje(eje.id);
        });
        
        // Crear conexión con el sol
        SISTEMA_SOLAR.conexiones.push({
            id: `conexion-sol-${eje.id}`,
            sourceId: 'nodo-objetivo',
            targetId: `eje-${eje.id}`,
            color: eje.color
        });
    });
    
    dibujarConexiones();
}

// ================================
// FUNCIONES DE DATOS
// ================================

function cargarDatosEjemplo() {
    // Estrategias de ejemplo
    SISTEMA_SOLAR.estrategias = [
        { id: 1, eje_id: 'educacion', nombre: 'Capacitación docente', tipo: 'FO' },
        { id: 2, eje_id: 'educacion', nombre: 'Infraestructura educativa', tipo: 'DO' },
        { id: 3, eje_id: 'salud', nombre: 'Equipamiento médico', tipo: 'FO' },
        { id: 4, eje_id: 'empleabilidad', nombre: 'Formación técnica', tipo: 'FA' },
        { id: 5, eje_id: 'sostenibilidad_ambiental', nombre: 'Monitoreo ambiental', tipo: 'DO' }
    ];
    
    // Tácticas de ejemplo
    SISTEMA_SOLAR.tacticas = [
        { id: 1, estrategia_id: 1, nombre: 'Talleres de capacitación' },
        { id: 2, estrategia_id: 1, nombre: 'Actualización curricular' },
        { id: 3, estrategia_id: 2, nombre: 'Construcción de aulas' },
        { id: 4, estrategia_id: 3, nombre: 'Adquisición de equipos' },
        { id: 5, estrategia_id: 4, nombre: 'Cursos técnicos' }
    ];
    
    // Actividades de ejemplo
    SISTEMA_SOLAR.actividades = [
        { id: 1, tactica_id: 1, nombre: 'Organizar taller', estado: 'completada' },
        { id: 2, tactica_id: 1, nombre: 'Evaluar participantes', estado: 'en_progreso' },
        { id: 3, tactica_id: 2, nombre: 'Revisar currículo', estado: 'pendiente' },
        { id: 4, tactica_id: 3, nombre: 'Elaborar planos', estado: 'completada' },
        { id: 5, tactica_id: 4, nombre: 'Cotizar equipos', estado: 'en_progreso' }
    ];
    
    crearEstrategias();
}

function crearEstrategias() {
    const container = document.getElementById('estrategiasContainer');
    container.innerHTML = '';
    
    SISTEMA_SOLAR.estrategias.forEach((estrategia, index) => {
        const eje = SISTEMA_SOLAR.ejes.find(e => e.id === estrategia.eje_id);
        if (!eje) return;
        
        const ejeElement = document.getElementById(`eje-${eje.id}`);
        if (!ejeElement) return;
        
        // Obtener posición del eje
        const ejeX = parseFloat(ejeElement.style.left);
        const ejeY = parseFloat(ejeElement.style.top);
        
        // Calcular posición orbital para la luna (estrategia)
        const estrategiasDelEje = SISTEMA_SOLAR.estrategias.filter(e => e.eje_id === estrategia.eje_id);
        const indice = estrategiasDelEje.findIndex(e => e.id === estrategia.id);
        const total = estrategiasDelEje.length;
        
        const angulo = (2 * Math.PI / total) * indice;
        const radioOrbitaLuna = 100; // Radio para lunas
        
        const x = ejeX + radioOrbitaLuna * Math.cos(angulo);
        const y = ejeY + radioOrbitaLuna * Math.sin(angulo);
        
        const estrategiaDiv = document.createElement('div');
        estrategiaDiv.className = 'nodo nodo-estrategia';
        estrategiaDiv.id = `estrategia-${estrategia.id}`;
        estrategiaDiv.dataset.estrategiaId = estrategia.id;
        estrategiaDiv.dataset.ejeId = estrategia.eje_id;
        estrategiaDiv.dataset.tipo = 'estrategia';
        estrategiaDiv.style.left = `${x}px`;
        estrategiaDiv.style.top = `${y}px`;
        
        estrategiaDiv.innerHTML = `
            <div class="nodo-content">
                <div class="nodo-icon">
                    <i class="fas fa-moon"></i>
                </div>
                <div class="nodo-title">${estrategia.tipo}: ${estrategia.nombre.substring(0, 20)}</div>
            </div>
        `;
        
        container.appendChild(estrategiaDiv);
        
        // Eventos
        estrategiaDiv.addEventListener('click', function(e) {
            e.stopPropagation();
            seleccionarNodo(this.id);
            mostrarDetallesEstrategia(estrategia.id);
        });
        
        // Crear conexión con el eje
        SISTEMA_SOLAR.conexiones.push({
            id: `conexion-eje-${eje.id}-estrategia-${estrategia.id}`,
            sourceId: `eje-${eje.id}`,
            targetId: `estrategia-${estrategia.id}`,
            color: '#2ecc71'
        });
    });
    
    crearTacticas();
}

function crearTacticas() {
    const container = document.getElementById('tacticasContainer');
    container.innerHTML = '';
    
    SISTEMA_SOLAR.tacticas.forEach((tactica, index) => {
        const estrategia = SISTEMA_SOLAR.estrategias.find(e => e.id === tactica.estrategia_id);
        if (!estrategia) return;
        
        const estrategiaElement = document.getElementById(`estrategia-${estrategia.id}`);
        if (!estrategiaElement) return;
        
        // Obtener posición de la estrategia
        const estrategiaX = parseFloat(estrategiaElement.style.left);
        const estrategiaY = parseFloat(estrategiaElement.style.top);
        
        // Calcular posición orbital para el satélite (táctica)
        const tacticasDeEstrategia = SISTEMA_SOLAR.tacticas.filter(t => t.estrategia_id === tactica.estrategia_id);
        const indice = tacticasDeEstrategia.findIndex(t => t.id === tactica.id);
        const total = tacticasDeEstrategia.length;
        
        const angulo = (2 * Math.PI / total) * indice;
        const radioOrbitaSatelite = 60; // Radio para satélites
        
        const x = estrategiaX + radioOrbitaSatelite * Math.cos(angulo);
        const y = estrategiaY + radioOrbitaSatelite * Math.sin(angulo);
        
        const tacticaDiv = document.createElement('div');
        tacticaDiv.className = 'nodo nodo-tactica';
        tacticaDiv.id = `tactica-${tactica.id}`;
        tacticaDiv.dataset.tacticaId = tactica.id;
        tacticaDiv.dataset.estrategiaId = tactica.estrategia_id;
        tacticaDiv.dataset.tipo = 'tactica';
        tacticaDiv.style.left = `${x}px`;
        tacticaDiv.style.top = `${y}px`;
        
        tacticaDiv.innerHTML = `
            <div class="nodo-content">
                <div class="nodo-icon">
                    <i class="fas fa-satellite"></i>
                </div>
                <div class="nodo-title">${tactica.nombre.substring(0, 15)}</div>
            </div>
        `;
        
        container.appendChild(tacticaDiv);
        
        // Eventos
        tacticaDiv.addEventListener('click', function(e) {
            e.stopPropagation();
            seleccionarNodo(this.id);
            mostrarDetallesTactica(tactica.id);
        });
        
        // Crear conexión con la estrategia
        SISTEMA_SOLAR.conexiones.push({
            id: `conexion-estrategia-${estrategia.id}-tactica-${tactica.id}`,
            sourceId: `estrategia-${estrategia.id}`,
            targetId: `tactica-${tactica.id}`,
            color: '#e74c3c'
        });
    });
    
    crearActividades();
}

function crearActividades() {
    const container = document.getElementById('actividadesContainer');
    container.innerHTML = '';
    
    SISTEMA_SOLAR.actividades.forEach((actividad, index) => {
        const tactica = SISTEMA_SOLAR.tacticas.find(t => t.id === actividad.tactica_id);
        if (!tactica) return;
        
        const tacticaElement = document.getElementById(`tactica-${tactica.id}`);
        if (!tacticaElement) return;
        
        // Obtener posición de la táctica
        const tacticaX = parseFloat(tacticaElement.style.left);
        const tacticaY = parseFloat(tacticaElement.style.top);
        
        // Calcular posición orbital para el asteroide (actividad)
        const actividadesDeTactica = SISTEMA_SOLAR.actividades.filter(a => a.tactica_id === actividad.tactica_id);
        const indice = actividadesDeTactica.findIndex(a => a.id === actividad.id);
        const total = actividadesDeTactica.length;
        
        const angulo = (2 * Math.PI / total) * indice;
        const radioOrbitaAsteroide = 40; // Radio para asteroides
        
        const x = tacticaX + radioOrbitaAsteroide * Math.cos(angulo);
        const y = tacticaY + radioOrbitaAsteroide * Math.sin(angulo);
        
        let estadoIcono = 'fa-clock';
        let estadoColor = '#f39c12';
        switch(actividad.estado) {
            case 'completada':
                estadoIcono = 'fa-check-circle';
                estadoColor = '#2ecc71';
                break;
            case 'en_progreso':
                estadoIcono = 'fa-spinner';
                estadoColor = '#3498db';
                break;
        }
        
        const actividadDiv = document.createElement('div');
        actividadDiv.className = 'nodo nodo-actividad';
        actividadDiv.id = `actividad-${actividad.id}`;
        actividadDiv.dataset.actividadId = actividad.id;
        actividadDiv.dataset.tacticaId = actividad.tactica_id;
        actividadDiv.dataset.tipo = 'actividad';
        actividadDiv.style.left = `${x}px`;
        actividadDiv.style.top = `${y}px`;
        
        actividadDiv.innerHTML = `
            <div class="nodo-content">
                <div class="nodo-icon" style="background: linear-gradient(135deg, ${estadoColor}, #d35400)">
                    <i class="fas ${estadoIcono}"></i>
                </div>
                <div class="nodo-title">${actividad.nombre.substring(0, 12)}</div>
            </div>
        `;
        
        container.appendChild(actividadDiv);
        
        // Eventos
        actividadDiv.addEventListener('click', function(e) {
            e.stopPropagation();
            seleccionarNodo(this.id);
            mostrarDetallesActividad(actividad.id);
        });
        
        // Crear conexión con la táctica
        SISTEMA_SOLAR.conexiones.push({
            id: `conexion-tactica-${tactica.id}-actividad-${actividad.id}`,
            sourceId: `tactica-${tactica.id}`,
            targetId: `actividad-${actividad.id}`,
            color: estadoColor
        });
    });
    
    dibujarConexiones();
    actualizarEstadisticas();
}

// ================================
// FUNCIONES DE VISUALIZACIÓN
// ================================

function dibujarConexiones() {
    const svg = document.getElementById('conexionesSvg');
    svg.innerHTML = '';
    
    // Definir gradientes
    const defs = document.createElementNS('http://www.w3.org/2000/svg', 'defs');
    
    // Gradiente para conexiones sol-eje
    const gradientSol = document.createElementNS('http://www.w3.org/2000/svg', 'linearGradient');
    gradientSol.setAttribute('id', 'gradient-sol');
    gradientSol.setAttribute('x1', '0%');
    gradientSol.setAttribute('y1', '0%');
    gradientSol.setAttribute('x2', '100%');
    gradientSol.setAttribute('y2', '0%');
    
    const stop1 = document.createElementNS('http://www.w3.org/2000/svg', 'stop');
    stop1.setAttribute('offset', '0%');
    stop1.setAttribute('stop-color', '#FFD700');
    stop1.setAttribute('stop-opacity', '0.4');
    
    const stop2 = document.createElementNS('http://www.w3.org/2000/svg', 'stop');
    stop2.setAttribute('offset', '100%');
    stop2.setAttribute('stop-color', '#FF8C00');
    stop2.setAttribute('stop-opacity', '0.4');
    
    gradientSol.appendChild(stop1);
    gradientSol.appendChild(stop2);
    defs.appendChild(gradientSol);
    
    // Gradientes para cada tipo de conexión
    const tiposGradientes = {
        'estrategia': ['#2ecc71', '#27ae60'],
        'tactica': ['#e74c3c', '#c0392b'],
        'actividad': ['#f39c12', '#d35400']
    };
    
    Object.entries(tiposGradientes).forEach(([tipo, colores]) => {
        const gradient = document.createElementNS('http://www.w3.org/2000/svg', 'linearGradient');
        gradient.setAttribute('id', `gradient-${tipo}`);
        gradient.setAttribute('x1', '0%');
        gradient.setAttribute('y1', '0%');
        gradient.setAttribute('x2', '100%');
        gradient.setAttribute('y2', '0%');
        
        const stop1 = document.createElementNS('http://www.w3.org/2000/svg', 'stop');
        stop1.setAttribute('offset', '0%');
        stop1.setAttribute('stop-color', colores[0]);
        stop1.setAttribute('stop-opacity', '0.4');
        
        const stop2 = document.createElementNS('http://www.w3.org/2000/svg', 'stop');
        stop2.setAttribute('offset', '100%');
        stop2.setAttribute('stop-color', colores[1]);
        stop2.setAttribute('stop-opacity', '0.4');
        
        gradient.appendChild(stop1);
        gradient.appendChild(stop2);
        defs.appendChild(gradient);
    });
    
    svg.appendChild(defs);
    
    // Dibujar conexiones
    SISTEMA_SOLAR.conexiones.forEach(conexion => {
        const source = document.getElementById(conexion.sourceId);
        const target = document.getElementById(conexion.targetId);
        
        if (!source || !target) return;
        
        const sourceRect = source.getBoundingClientRect();
        const targetRect = target.getBoundingClientRect();
        const canvasRect = document.getElementById('mapaCanvas').getBoundingClientRect();
        
        const sourceX = sourceRect.left + sourceRect.width / 2 - canvasRect.left;
        const sourceY = sourceRect.top + sourceRect.height / 2 - canvasRect.top;
        const targetX = targetRect.left + targetRect.width / 2 - canvasRect.left;
        const targetY = targetRect.top + targetRect.height / 2 - canvasRect.top;
        
        // Determinar tipo de gradiente
        let gradientId = 'gradient-sol';
        if (conexion.sourceId.includes('estrategia')) {
            gradientId = 'gradient-estrategia';
        } else if (conexion.sourceId.includes('tactica')) {
            gradientId = 'gradient-tactica';
        } else if (conexion.sourceId.includes('actividad')) {
            gradientId = 'gradient-actividad';
        }
        
        // Crear línea curva
        const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
        const dx = targetX - sourceX;
        const dy = targetY - sourceY;
        const distancia = Math.sqrt(dx * dx + dy * dy);
        const offset = Math.min(distancia * 0.2, 50);
        
        const midX = (sourceX + targetX) / 2;
        const midY = (sourceY + targetY) / 2;
        
        path.setAttribute('d', `M ${sourceX},${sourceY} Q ${midX + offset},${midY - offset} ${targetX},${targetY}`);
        path.setAttribute('class', 'conexion-orbital');
        path.setAttribute('stroke', `url(#${gradientId})`);
        path.setAttribute('stroke-width', '1.5');
        
        svg.appendChild(path);
    });
}

function actualizarEstadisticas() {
    const totalEjes = SISTEMA_SOLAR.ejes.length;
    const totalEstrategias = SISTEMA_SOLAR.estrategias.length;
    const totalTacticas = SISTEMA_SOLAR.tacticas.length;
    const totalActividades = SISTEMA_SOLAR.actividades.length;
    
    document.getElementById('total-ejes').textContent = `${totalEjes} Ejes`;
    document.getElementById('total-estrategias').textContent = `${totalEstrategias} Lunas`;
    document.getElementById('total-tacticas').textContent = `${totalTacticas} Satélites`;
    document.getElementById('total-actividades').textContent = `${totalActividades} Asteroides`;
}

// ================================
// FUNCIONES DE INTERACCIÓN
// ================================

function inicializarEventos() {
    const canvas = document.getElementById('mapaCanvas');
    
    // Eventos para panning
    canvas.addEventListener('mousedown', startPan);
    canvas.addEventListener('mousemove', pan);
    canvas.addEventListener('mouseup', endPan);
    canvas.addEventListener('mouseleave', endPan);
    
    // Eventos táctiles
    canvas.addEventListener('touchstart', startPanTouch);
    canvas.addEventListener('touchmove', panTouch);
    canvas.addEventListener('touchend', endPan);
    
    // Evento de zoom con rueda
    canvas.addEventListener('wheel', zoomWheel, { passive: false });
    
    // Evento de redimensionamiento
    window.addEventListener('resize', recalcularPosiciones);
    
    // Evento al sol
    const sol = document.getElementById('nodo-objetivo');
    sol.addEventListener('click', function(e) {
        e.stopPropagation();
        seleccionarNodo('nodo-objetivo');
        mostrarDetallesSol();
    });
}

function startPan(e) {
    CONFIG.panning = true;
    CONFIG.startX = e.clientX - CONFIG.translateX;
    CONFIG.startY = e.clientY - CONFIG.translateY;
    document.getElementById('mapaCanvas').style.cursor = 'grabbing';
}

function pan(e) {
    if (!CONFIG.panning) return;
    e.preventDefault();
    CONFIG.translateX = e.clientX - CONFIG.startX;
    CONFIG.translateY = e.clientY - CONFIG.startY;
    actualizarTransformacion();
}

function endPan() {
    CONFIG.panning = false;
    document.getElementById('mapaCanvas').style.cursor = 'grab';
}

function startPanTouch(e) {
    if (e.touches.length !== 1) return;
    CONFIG.panning = true;
    CONFIG.startX = e.touches[0].clientX - CONFIG.translateX;
    CONFIG.startY = e.touches[0].clientY - CONFIG.translateY;
}

function panTouch(e) {
    if (!CONFIG.panning || e.touches.length !== 1) return;
    e.preventDefault();
    CONFIG.translateX = e.touches[0].clientX - CONFIG.startX;
    CONFIG.translateY = e.touches[0].clientY - CONFIG.startY;
    actualizarTransformacion();
}

function zoomWheel(e) {
    e.preventDefault();
    const zoomIntensity = 0.1;
    const oldZoom = CONFIG.zoom;
    
    CONFIG.zoom += e.deltaY < 0 ? zoomIntensity : -zoomIntensity;
    CONFIG.zoom = Math.min(Math.max(0.3, CONFIG.zoom), 3);
    
    document.getElementById('zoomSlider').value = CONFIG.zoom;
    document.getElementById('zoomValue').textContent = `${Math.round(CONFIG.zoom * 100)}%`;
    
    const rect = e.target.getBoundingClientRect();
    const mouseX = e.clientX - rect.left;
    const mouseY = e.clientY - rect.top;
    
    CONFIG.translateX = mouseX - (mouseX - CONFIG.translateX) * (CONFIG.zoom / oldZoom);
    CONFIG.translateY = mouseY - (mouseY - CONFIG.translateY) * (CONFIG.zoom / oldZoom);
    
    actualizarTransformacion();
}

function zoomSliderChange(value) {
    const oldZoom = CONFIG.zoom;
    CONFIG.zoom = parseFloat(value);
    
    document.getElementById('zoomValue').textContent = `${Math.round(CONFIG.zoom * 100)}%`;
    
    const canvas = document.getElementById('mapaCanvas');
    const rect = canvas.getBoundingClientRect();
    const centerX = rect.width / 2;
    const centerY = rect.height / 2;
    
    CONFIG.translateX = centerX - (centerX - CONFIG.translateX) * (CONFIG.zoom / oldZoom);
    CONFIG.translateY = centerY - (centerY - CONFIG.translateY) * (CONFIG.zoom / oldZoom);
    
    actualizarTransformacion();
}

function zoomIn() {
    zoomSliderChange(Math.min(CONFIG.zoom + 0.1, 3));
}

function zoomOut() {
    zoomSliderChange(Math.max(CONFIG.zoom - 0.1, 0.3));
}

function actualizarTransformacion() {
    const nodosContainer = document.getElementById('nodosContainer');
    nodosContainer.style.transform = `translate(${CONFIG.translateX}px, ${CONFIG.translateY}px) scale(${CONFIG.zoom})`;
    dibujarConexiones();
}

function toggleAnillos() {
    CONFIG.mostrarAnillos = document.getElementById('mostrar-anillos').checked;
    const anillosContainer = document.getElementById('anillosContainer');
    anillosContainer.style.opacity = CONFIG.mostrarAnillos ? '1' : '0';
}

function toggleNombres() {
    CONFIG.mostrarNombres = document.getElementById('mostrar-nombres').checked;
    document.querySelectorAll('.nodo-title').forEach(titulo => {
        titulo.style.display = CONFIG.mostrarNombres ? 'block' : 'none';
    });
}

function toggleAnimaciones() {
    CONFIG.animacionesActivas = !CONFIG.animacionesActivas;
    const icon = document.getElementById('animacionIcon');
    
    if (CONFIG.animacionesActivas) {
        icon.className = 'fas fa-pause';
        document.querySelectorAll('.nodo-eje, .nodo-actividad').forEach(nodo => {
            nodo.style.animationPlayState = 'running';
        });
    } else {
        icon.className = 'fas fa-play';
        document.querySelectorAll('.nodo-eje, .nodo-actividad').forEach(nodo => {
            nodo.style.animationPlayState = 'paused';
        });
    }
}

function seleccionarNodo(nodoId) {
    // Remover selección anterior
    document.querySelectorAll('.nodo').forEach(nodo => {
        nodo.classList.remove('seleccionado');
    });
    
    // Seleccionar nuevo nodo
    const nodo = document.getElementById(nodoId);
    if (nodo) {
        nodo.classList.add('seleccionado');
    }
}

// ================================
// FUNCIONES DE DETALLES
// ================================

function mostrarDetallesSol() {
    const panel = document.getElementById('panelDetalles');
    const titulo = document.getElementById('detalleTitulo');
    const contenido = document.getElementById('detalleContenido');
    
    titulo.innerHTML = `<i class="fas fa-sun"></i> Objetivo Estratégico`;
    
    contenido.innerHTML = `
        <div class="detalle-sol">
            <div class="encabezado-detalle" style="background: linear-gradient(135deg, #FFD700, #FF8C00);">
                <div class="icono-grande">
                    <i class="fas fa-sun"></i>
                </div>
                <h3>OBJETIVO ESTRATÉGICO</h3>
                <p>Centro del Sistema Solar Estratégico</p>
            </div>
            
            <div class="descripcion-objetivo">
                <p><strong>Objetivo Principal:</strong> Consolidar la viabilidad y el respaldo social del Proyecto El Domo mediante un modelo de gestión integral que garantice la integridad y disponibilidad del recurso hídrico local.</p>
                
                <div class="estadisticas-detalle">
                    <div class="estadistica-item">
                        <div class="estadistica-valor">${SISTEMA_SOLAR.ejes.length}</div>
                        <div class="estadistica-label">Ejes Estratégicos</div>
                    </div>
                    <div class="estadistica-item">
                        <div class="estadistica-valor">${SISTEMA_SOLAR.estrategias.length}</div>
                        <div class="estadistica-label">Estrategias</div>
                    </div>
                    <div class="estadistica-item">
                        <div class="estadistica-valor">${SISTEMA_SOLAR.tacticas.length}</div>
                        <div class="estadistica-label">Tácticas</div>
                    </div>
                </div>
                
                <h4><i class="fas fa-satellite"></i> Sistema Orbital</h4>
                <ul>
                    <li><strong>Sol Central:</strong> Objetivo Estratégico</li>
                    <li><strong>Planetas:</strong> 7 Ejes Estratégicos con órbitas únicas</li>
                    <li><strong>Lunas:</strong> Estrategias orbitando cada planeta</li>
                    <li><strong>Satélites:</strong> Tácticas orbitando las lunas</li>
                    <li><strong>Asteroides:</strong> Actividades en órbita cercana</li>
                </ul>
            </div>
        </div>
        
        <style>
            .encabezado-detalle {
                padding: 30px;
                border-radius: 15px;
                margin-bottom: 20px;
                text-align: center;
                color: white;
            }
            
            .icono-grande {
                width: 80px;
                height: 80px;
                background: rgba(255,255,255,0.2);
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                margin: 0 auto 15px;
                font-size: 32px;
            }
            
            .encabezado-detalle h3 {
                font-size: 24px;
                margin-bottom: 10px;
            }
            
            .encabezado-detalle p {
                opacity: 0.9;
                font-size: 14px;
            }
            
            .descripcion-objetivo {
                line-height: 1.6;
                color: rgba(255,255,255,0.9);
            }
            
            .descripcion-objetivo p {
                margin-bottom: 20px;
            }
            
            .estadisticas-detalle {
                display: grid;
                grid-template-columns: repeat(3, 1fr);
                gap: 15px;
                margin: 20px 0;
            }
            
            .estadistica-item {
                background: rgba(255,255,255,0.05);
                border-radius: 10px;
                padding: 15px;
                text-align: center;
            }
            
            .estadistica-valor {
                font-size: 28px;
                font-weight: bold;
                color: white;
                margin-bottom: 5px;
            }
            
            .estadistica-label {
                font-size: 12px;
                color: rgba(255,255,255,0.7);
                text-transform: uppercase;
                letter-spacing: 0.5px;
            }
            
            .descripcion-objetivo h4 {
                color: white;
                margin: 25px 0 15px;
                display: flex;
                align-items: center;
                gap: 10px;
            }
            
            .descripcion-objetivo ul {
                padding-left: 20px;
                color: rgba(255,255,255,0.8);
            }
            
            .descripcion-objetivo li {
                margin-bottom: 8px;
            }
        </style>
    `;
    
    panel.classList.add('open');
}

function mostrarDetalleObjetivo() {
    mostrarDetallesSol();
}

function mostrarDetallesEje(ejeId) {
    const eje = SISTEMA_SOLAR.ejes.find(e => e.id === ejeId);
    if (!eje) return;
    
    const panel = document.getElementById('panelDetalles');
    const titulo = document.getElementById('detalleTitulo');
    const contenido = document.getElementById('detalleContenido');
    
    const estrategiasDelEje = SISTEMA_SOLAR.estrategias.filter(e => e.eje_id === ejeId);
    
    titulo.innerHTML = `<i class="fas fa-${eje.icono}"></i> ${eje.nombre}`;
    
    contenido.innerHTML = `
        <div class="detalle-eje">
            <div class="encabezado-detalle" style="background: linear-gradient(135deg, ${eje.color}, ${oscurecerColor(eje.color, 20)});">
                <div class="icono-grande">
                    <i class="fas fa-${eje.icono}"></i>
                </div>
                <h3>${eje.nombre}</h3>
                <p>Eje Estratégico - Planeta del Sistema</p>
            </div>
            
            <div class="info-eje">
                <p><strong>Descripción:</strong> ${eje.descripcion}</p>
                
                <div class="estadisticas-detalle">
                    <div class="estadistica-item">
                        <div class="estadistica-valor">${estrategiasDelEje.length}</div>
                        <div class="estadistica-label">Estrategias</div>
                    </div>
                    <div class="estadistica-item">
                        <div class="estadistica-valor">${SISTEMA_SOLAR.tacticas.filter(t => estrategiasDelEje.find(e => e.id === t.estrategia_id)).length}</div>
                        <div class="estadistica-label">Tácticas</div>
                    </div>
                    <div class="estadistica-item">
                        <div class="estadistica-valor">${SISTEMA_SOLAR.actividades.filter(a => SISTEMA_SOLAR.tacticas.find(t => t.id === a.tactica_id && estrategiasDelEje.find(e => e.id === t.estrategia_id))).length}</div>
                        <div class="estadistica-label">Actividades</div>
                    </div>
                </div>
                
                <h4><i class="fas fa-moon"></i> Órbita Planetaria</h4>
                <ul>
                    <li><strong>Radio Orbital:</strong> ${eje.radioOrbita}px desde el Sol</li>
                    <li><strong>Posición Angular:</strong> ${eje.anguloInicial.toFixed(1)}°</li>
                    <li><strong>Período Orbital:</strong> 60 segundos</li>
                </ul>
                
                ${estrategiasDelEje.length > 0 ? `
                    <h4><i class="fas fa-satellite"></i> Estrategias (Lunas)</h4>
                    <div class="lista-elementos">
                        ${estrategiasDelEje.map(estrategia => `
                            <div class="item-elemento" onclick="mostrarDetallesEstrategia(${estrategia.id})">
                                <div class="item-icono" style="background: #2ecc71">
                                    <i class="fas fa-moon"></i>
                                </div>
                                <div class="item-info">
                                    <div class="item-titulo">${estrategia.nombre}</div>
                                    <div class="item-subtitulo">Tipo: ${estrategia.tipo}</div>
                                </div>
                                <i class="fas fa-chevron-right"></i>
                            </div>
                        `).join('')}
                    </div>
                ` : ''}
            </div>
        </div>
        
        <style>
            .info-eje {
                line-height: 1.6;
                color: rgba(255,255,255,0.9);
            }
            
            .info-eje p {
                margin-bottom: 20px;
            }
            
            .info-eje h4 {
                color: white;
                margin: 25px 0 15px;
                display: flex;
                align-items: center;
                gap: 10px;
            }
            
            .info-eje ul {
                padding-left: 20px;
                color: rgba(255,255,255,0.8);
                margin-bottom: 20px;
            }
            
            .lista-elementos {
                margin-top: 10px;
            }
            
            .item-elemento {
                background: rgba(255,255,255,0.05);
                border-radius: 10px;
                padding: 15px;
                margin-bottom: 10px;
                display: flex;
                align-items: center;
                gap: 15px;
                cursor: pointer;
                transition: all 0.3s ease;
            }
            
            .item-elemento:hover {
                background: rgba(255,255,255,0.1);
                transform: translateX(5px);
            }
            
            .item-icono {
                width: 40px;
                height: 40px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                color: white;
                font-size: 18px;
            }
            
            .item-info {
                flex: 1;
            }
            
            .item-titulo {
                font-weight: 600;
                color: white;
                font-size: 14px;
            }
            
            .item-subtitulo {
                font-size: 12px;
                color: rgba(255,255,255,0.7);
                margin-top: 2px;
            }
            
            .item-elemento .fa-chevron-right {
                color: rgba(255,255,255,0.5);
                font-size: 12px;
            }
        </style>
    `;
    
    panel.classList.add('open');
}

function mostrarDetallesEstrategia(estrategiaId) {
    const estrategia = SISTEMA_SOLAR.estrategias.find(e => e.id === estrategiaId);
    if (!estrategia) return;
    
    const eje = SISTEMA_SOLAR.ejes.find(e => e.id === estrategia.eje_id);
    const tacticasDeEstrategia = SISTEMA_SOLAR.tacticas.filter(t => t.estrategia_id === estrategiaId);
    
    const panel = document.getElementById('panelDetalles');
    const titulo = document.getElementById('detalleTitulo');
    const contenido = document.getElementById('detalleContenido');
    
    titulo.innerHTML = `<i class="fas fa-moon"></i> Estrategia: ${estrategia.nombre}`;
    
    contenido.innerHTML = `
        <div class="detalle-estrategia">
            <div class="encabezado-detalle" style="background: linear-gradient(135deg, #2ecc71, #27ae60);">
                <div class="icono-grande">
                    <i class="fas fa-moon"></i>
                </div>
                <h3>${estrategia.tipo}: ${estrategia.nombre}</h3>
                <p>Estrategia - Luna del Sistema</p>
                <div class="badge-eje" style="background: ${eje ? eje.color : '#3498db'}">
                    ${eje ? eje.nombre : 'EJE'}
                </div>
            </div>
            
            <div class="info-estrategia">
                <div class="estadisticas-detalle">
                    <div class="estadistica-item">
                        <div class="estadistica-valor">${tacticasDeEstrategia.length}</div>
                        <div class="estadistica-label">Tácticas</div>
                    </div>
                    <div class="estadistica-item">
                        <div class="estadistica-valor">${SISTEMA_SOLAR.actividades.filter(a => tacticasDeEstrategia.find(t => t.id === a.tactica_id)).length}</div>
                        <div class="estadistica-label">Actividades</div>
                    </div>
                    <div class="estadistica-item">
                        <div class="estadistica-valor">${SISTEMA_SOLAR.actividades.filter(a => tacticasDeEstrategia.find(t => t.id === a.tactica_id) && a.estado === 'completada').length}</div>
                        <div class="estadistica-label">Completadas</div>
                    </div>
                </div>
                
                ${tacticasDeEstrategia.length > 0 ? `
                    <h4><i class="fas fa-satellite"></i> Tácticas (Satélites)</h4>
                    <div class="lista-elementos">
                        ${tacticasDeEstrategia.map(tactica => `
                            <div class="item-elemento" onclick="mostrarDetallesTactica(${tactica.id})">
                                <div class="item-icono" style="background: #e74c3c">
                                    <i class="fas fa-satellite"></i>
                                </div>
                                <div class="item-info">
                                    <div class="item-titulo">${tactica.nombre}</div>
                                </div>
                                <i class="fas fa-chevron-right"></i>
                            </div>
                        `).join('')}
                    </div>
                ` : ''}
                
                <button class="btn-navegar" onclick="seleccionarNodo('eje-${estrategia.eje_id}')">
                    <i class="fas fa-arrow-up"></i> Navegar al Eje Padre
                </button>
            </div>
        </div>
        
        <style>
            .badge-eje {
                display: inline-block;
                padding: 5px 15px;
                color: white;
                border-radius: 20px;
                font-size: 12px;
                font-weight: bold;
                margin-top: 10px;
            }
            
            .info-estrategia {
                line-height: 1.6;
                color: rgba(255,255,255,0.9);
            }
            
            .btn-navegar {
                width: 100%;
                padding: 12px;
                background: rgba(255,255,255,0.1);
                border: 1px solid rgba(255,255,255,0.2);
                color: white;
                border-radius: 10px;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 10px;
                font-size: 14px;
                transition: all 0.3s ease;
                margin-top: 20px;
            }
            
            .btn-navegar:hover {
                background: rgba(255,255,255,0.2);
                transform: translateY(-2px);
            }
        </style>
    `;
    
    panel.classList.add('open');
}

function mostrarDetallesTactica(tacticaId) {
    // Similar a las funciones anteriores
    console.log('Mostrando táctica:', tacticaId);
}

function mostrarDetallesActividad(actividadId) {
    // Similar a las funciones anteriores
    console.log('Mostrando actividad:', actividadId);
}

function cerrarPanel() {
    document.getElementById('panelDetalles').classList.remove('open');
    document.querySelectorAll('.nodo').forEach(nodo => {
        nodo.classList.remove('seleccionado');
    });
}

// ================================
// FUNCIONES DE CONTROL
// ================================

function toggleFullscreen() {
    const container = document.getElementById('mapaFullscreen');
    
    if (!document.fullscreenElement) {
        container.requestFullscreen().catch(err => {
            console.log(`Error al activar pantalla completa: ${err.message}`);
        });
    } else {
        document.exitFullscreen();
    }
}

function resetView() {
    CONFIG.zoom = 1;
    CONFIG.translateX = 0;
    CONFIG.translateY = 0;
    document.getElementById('zoomSlider').value = 1;
    document.getElementById('zoomValue').textContent = '100%';
    actualizarTransformacion();
}

function optimizarDistribucion() {
    // Reorganizar las posiciones para evitar colisiones
    const canvas = document.getElementById('mapaCanvas');
    const canvasRect = canvas.getBoundingClientRect();
    const centroX = canvasRect.width / 2;
    const centroY = canvasRect.height / 2;
    
    // Aumentar espacio entre órbitas
    SISTEMA_SOLAR.ejes.forEach((eje, index) => {
        // Incrementar radios para más espacio
        const nuevoRadio = 350 + (index * 90); // Más espacio entre órbitas
        SISTEMA_SOLAR.ejes[index].radioOrbita = nuevoRadio;
        
        // Recalcular ángulos para distribución uniforme
        const nuevoAngulo = (360 / SISTEMA_SOLAR.ejes.length) * index;
        SISTEMA_SOLAR.ejes[index].anguloInicial = nuevoAngulo;
        
        // Actualizar posición del eje
        const ejeElement = document.getElementById(`eje-${eje.id}`);
        if (ejeElement) {
            const anguloRad = (nuevoAngulo * Math.PI) / 180;
            const x = centroX + nuevoRadio * Math.cos(anguloRad);
            const y = centroY + nuevoRadio * Math.sin(anguloRad);
            
            ejeElement.style.left = `${x}px`;
            ejeElement.style.top = `${y}px`;
            ejeElement.style.setProperty('--orbita-radio', `${nuevoRadio}px`);
        }
    });
    
    // Recrear anillos con nuevos radios
    crearAnillosOrbitales();
    
    // Recalcular posiciones de estrategias, tácticas y actividades
    setTimeout(() => {
        crearEstrategias();
    }, 100);
}

function exportMap() {
    // Función para exportar el mapa
    alert('Funcionalidad de exportación en desarrollo');
}

function recalcularPosiciones() {
    // Recalcular todas las posiciones al redimensionar
    const canvas = document.getElementById('mapaCanvas');
    const canvasRect = canvas.getBoundingClientRect();
    const centroX = canvasRect.width / 2;
    const centroY = canvasRect.height / 2;
    
    // Reposicionar sol
    const sol = document.getElementById('nodo-objetivo');
    sol.style.left = `${centroX}px`;
    sol.style.top = `${centroY}px`;
    
    // Reposicionar ejes
    SISTEMA_SOLAR.ejes.forEach(eje => {
        const ejeElement = document.getElementById(`eje-${eje.id}`);
        if (ejeElement) {
            const anguloRad = (eje.anguloInicial * Math.PI) / 180;
            const x = centroX + eje.radioOrbita * Math.cos(anguloRad);
            const y = centroY + eje.radioOrbita * Math.sin(anguloRad);
            
            ejeElement.style.left = `${x}px`;
            ejeElement.style.top = `${y}px`;
        }
    });
    
    // Recrear anillos
    crearAnillosOrbitales();
    
    // Redibujar conexiones
    dibujarConexiones();
}

// ================================
// FUNCIONES AUXILIARES
// ================================

function oscurecerColor(color, percent) {
    // Convertir color hex a RGB
    let r = parseInt(color.substr(1, 2), 16);
    let g = parseInt(color.substr(3, 2), 16);
    let b = parseInt(color.substr(5, 2), 16);
    
    // Oscurecer
    r = Math.max(0, Math.floor(r * (100 - percent) / 100));
    g = Math.max(0, Math.floor(g * (100 - percent) / 100));
    b = Math.max(0, Math.floor(b * (100 - percent) / 100));
    
    // Convertir de vuelta a hex
    return `#${r.toString(16).padStart(2, '0')}${g.toString(16).padStart(2, '0')}${b.toString(16).padStart(2, '0')}`;
}

// ================================
// FUNCIONES DE FILTRADO
// ================================

function aplicarFiltro() {
    const filtro = document.getElementById('filtro-nivel').value;
    
    // Ocultar/mostrar según filtro
    const todosNodos = document.querySelectorAll('.nodo');
    
    todosNodos.forEach(nodo => {
        const tipo = nodo.dataset.tipo || (nodo.id === 'nodo-objetivo' ? 'sol' : '');
        
        if (filtro === 'todos' || tipo === filtro || 
            (filtro === 'sol' && nodo.id === 'nodo-objetivo')) {
            nodo.style.display = 'block';
            nodo.style.opacity = '1';
        } else {
            nodo.style.display = 'block';
            nodo.style.opacity = '0.2';
        }
    });
    
    // Aplicar filtro de eje si está activo
    const filtroEje = document.getElementById('filtro-eje').value;
    if (filtroEje !== 'todos') {
        filtrarPorEje();
    }
}

function filtrarPorEje() {
    const ejeId = document.getElementById('filtro-eje').value;
    
    if (ejeId === 'todos') {
        aplicarFiltro();
        return;
    }
    
    const todosNodos = document.querySelectorAll('.nodo');
    
    todosNodos.forEach(nodo => {
        const nodoEjeId = nodo.dataset.ejeId;
        
        if (nodo.id === 'nodo-objetivo') {
            // El sol siempre visible
            nodo.style.opacity = '1';
        } else if (nodoEjeId === ejeId) {
            // Mostrar nodos del eje seleccionado
            nodo.style.opacity = '1';
        } else if (nodo.classList.contains('nodo-eje') && nodo.id === `eje-${ejeId}`) {
            // Mostrar el eje seleccionado
            nodo.style.opacity = '1';
        } else {
            // Ocultar otros nodos
            nodo.style.opacity = '0.1';
        }
    });
    
    // Seleccionar el eje
    const ejeElement = document.getElementById(`eje-${ejeId}`);
    if (ejeElement) {
        seleccionarNodo(ejeElement.id);
    }
}
</script>
{% endblock %}
