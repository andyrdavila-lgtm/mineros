{% extends "inicio.html" %}

{% block content %}
<!-- Mapa Neuronal Estratégico - Versión Mejorada -->
<div class="mapa-neuronal-container" id="mapaFullscreen">
    <!-- Cabecera principal -->
    <div class="mapa-header-glass">
        <div class="header-content">
            <h1 class="mapa-title-glow">
                <i class="fas fa-project-diagram"></i>
                <span class="title-text">MAPA NEURONAL ESTRATÉGICO</span>
                <span class="subtitle">Proyecto El Domo</span>
            </h1>
            <div class="header-stats">
                <div class="stat-badge">
                    <i class="fas fa-bullseye"></i>
                    <span>1 Objetivo</span>
                </div>
                <div class="stat-badge">
                    <i class="fas fa-layer-group"></i>
                    <span>7 Ejes</span>
                </div>
                <div class="stat-badge">
                    <i class="fas fa-chess-board"></i>
                    <span id="total-estrategias">0 Estrategias</span>
                </div>
                <div class="stat-badge">
                    <i class="fas fa-network-wired"></i>
                    <span id="total-conexiones">0 Conexiones</span>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Panel de controles organizado -->
    <div class="panel-controles">
        <div class="grupo-controles">
            <h4><i class="fas fa-sliders-h"></i> Controles</h4>
            <div class="controles-grid">
                <button class="control-btn tooltip" onclick="toggleFullscreen()" data-tooltip="Pantalla completa">
                    <i class="fas fa-expand"></i>
                </button>
                <button class="control-btn tooltip" onclick="resetView()" data-tooltip="Reiniciar vista">
                    <i class="fas fa-sync-alt"></i>
                </button>
                <button class="control-btn tooltip" onclick="toggleAnimations()" data-tooltip="Animaciones">
                    <i class="fas fa-play" id="animacionIcon"></i>
                </button>
                <button class="control-btn tooltip" onclick="exportMap()" data-tooltip="Exportar">
                    <i class="fas fa-download"></i>
                </button>
            </div>
        </div>
        
        <div class="grupo-controles">
            <h4><i class="fas fa-filter"></i> Filtros</h4>
            <select id="filtro-nivel" onchange="filtrarNodos()" class="filtro-select">
                <option value="all">Todos los niveles</option>
                <option value="objetivo">Objetivo Central</option>
                <option value="ejes">Ejes Estratégicos</option>
                <option value="estrategias">Estrategias</option>
                <option value="actividades">Actividades</option>
                <option value="tareas">Tareas</option>
            </select>
            
            <div class="filtro-checkbox">
                <label>
                    <input type="checkbox" id="mostrar-conexiones" checked onchange="toggleConexiones()">
                    <span>Mostrar conexiones</span>
                </label>
            </div>
        </div>
        
        <div class="grupo-controles">
            <h4><i class="fas fa-search"></i> Zoom</h4>
            <div class="zoom-controls">
                <button class="zoom-btn" onclick="zoomOut()">-</button>
                <input type="range" id="zoomSlider" min="0.3" max="3" step="0.1" value="1" 
                       oninput="zoomSliderChange(this.value)">
                <button class="zoom-btn" onclick="zoomIn()">+</button>
                <div class="zoom-value" id="zoomValue">100%</div>
            </div>
        </div>
    </div>
    
    <!-- Canvas principal -->
    <div class="mapa-canvas-fullscreen" id="mapaCanvas">
        <!-- Fondo con partículas -->
        <div class="particles-container" id="particlesContainer"></div>
        
        <!-- SVG para conexiones dinámicas -->
        <svg class="conexiones-svg" id="conexionesSvg">
            <defs>
                <linearGradient id="gradient-central" x1="0%" y1="0%" x2="100%" y2="0%">
                    <stop offset="0%" stop-color="#9C27B0" stop-opacity="0.8" />
                    <stop offset="100%" stop-color="#E91E63" stop-opacity="0.8" />
                </linearGradient>
                <linearGradient id="gradient-eje" x1="0%" y1="0%" x2="100%" y2="0%">
                    <stop offset="0%" stop-color="#3498db" stop-opacity="0.7" />
                    <stop offset="100%" stop-color="#2980b9" stop-opacity="0.7" />
                </linearGradient>
                <linearGradient id="gradient-estrategia" x1="0%" y1="0%" x2="100%" y2="0%">
                    <stop offset="0%" stop-color="#2ecc71" stop-opacity="0.7" />
                    <stop offset="100%" stop-color="#27ae60" stop-opacity="0.7" />
                </linearGradient>
                <filter id="glow">
                    <feGaussianBlur stdDeviation="2.5" result="coloredBlur"/>
                    <feMerge>
                        <feMergeNode in="coloredBlur"/>
                        <feMergeNode in="SourceGraphic"/>
                    </feMerge>
                </filter>
            </defs>
        </svg>
        
        <!-- Contenedor de nodos -->
        <div class="nodos-container" id="nodosContainer">
            <!-- Nodo Central -->
            <div class="nodo nodo-central" id="nodo-objetivo">
                <div class="nodo-glow"></div>
                <div class="nodo-content">
                    <div class="nodo-icon-pulse">
                        <i class="fas fa-brain"></i>
                    </div>
                    <div class="nodo-title-glow">OBJETIVO ESTRATÉGICO</div>
                    <div class="nodo-desc-scroll">
                        Consolidar la viabilidad y el respaldo social del Proyecto El Domo mediante un modelo de gestión integral...
                    </div>
                    <button class="btn-ver-mas" onclick="mostrarDetalleObjetivo()">
                        <i class="fas fa-eye"></i> Ver completo
                    </button>
                    <div class="nodo-stats-grid">
                        <div class="stat-item">
                            <div class="stat-value">7</div>
                            <div class="stat-label">Ejes</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="contador-estrategias">0</div>
                            <div class="stat-label">Estrategias</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Los nodos de ejes se generan dinámicamente aquí -->
            <div class="ejes-container" id="ejesContainer"></div>
            
            <!-- Contenedores para niveles jerárquicos -->
            <div class="estrategias-container" id="estrategiasContainer"></div>
            <div class="actividades-container" id="actividadesContainer"></div>
            <div class="tareas-container" id="tareasContainer"></div>
        </div>
    </div>
    
    <!-- Leyenda flotante -->
    <div class="leyenda-flotante">
        <div class="leyenda-header">
            <i class="fas fa-key"></i> Leyenda
        </div>
        <div class="leyenda-content">
            <div class="leyenda-item">
                <div class="leyenda-icon nodo-central-color"></div>
                <span>Objetivo Central</span>
            </div>
            <div class="leyenda-item">
                <div class="leyenda-icon nodo-eje-color"></div>
                <span>Ejes Estratégicos</span>
            </div>
            <div class="leyenda-item">
                <div class="leyenda-icon nodo-estrategia-color"></div>
                <span>Estrategias</span>
            </div>
            <div class="leyenda-item">
                <div class="leyenda-icon nodo-actividad-color"></div>
                <span>Actividades</span>
            </div>
            <div class="leyenda-item">
                <div class="leyenda-icon nodo-tarea-color"></div>
                <span>Tareas</span>
            </div>
        </div>
    </div>
    
    <!-- Panel de detalles -->
    <div class="panel-detalles" id="panelDetalles">
        <div class="panel-header">
            <h3 id="detalleTitulo"><i class="fas fa-info-circle"></i> Detalles</h3>
            <button class="panel-close" onclick="cerrarPanel()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="panel-body" id="detalleContenido">
            <!-- Contenido dinámico -->
        </div>
    </div>
</div>

<style>
    /* Reset y configuración base */
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }
    
    /* Contenedor principal fullscreen */
    .mapa-neuronal-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: linear-gradient(135deg, #0c0e2a 0%, #1a1b3a 50%, #0c2461 100%);
        overflow: hidden;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    /* Cabecera glassmorphism */
    .mapa-header-glass {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 80px;
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(20px);
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        padding: 0 20px;
        z-index: 1000;
        display: flex;
        align-items: center;
    }
    
    .header-content {
        width: 100%;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .mapa-title-glow {
        color: white;
        display: flex;
        flex-direction: column;
        gap: 5px;
    }
    
    .title-text {
        font-size: 22px;
        font-weight: 700;
        letter-spacing: 1px;
        text-shadow: 0 0 10px rgba(52, 152, 219, 0.7);
    }
    
    .subtitle {
        font-size: 14px;
        opacity: 0.8;
        font-weight: 400;
        color: rgba(255, 255, 255, 0.9);
    }
    
    .header-stats {
        display: flex;
        gap: 15px;
    }
    
    .stat-badge {
        background: rgba(255, 255, 255, 0.1);
        padding: 8px 15px;
        border-radius: 15px;
        display: flex;
        align-items: center;
        gap: 8px;
        color: white;
        font-size: 14px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        transition: all 0.3s ease;
    }
    
    .stat-badge:hover {
        background: rgba(255, 255, 255, 0.15);
        transform: translateY(-2px);
    }
    
    /* Panel de controles organizado */
    .panel-controles {
        position: absolute;
        top: 90px;
        right: 20px;
        width: 320px;
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(20px);
        border-radius: 15px;
        padding: 20px;
        z-index: 1000;
        border: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        display: flex;
        flex-direction: column;
        gap: 20px;
    }
    
    .grupo-controles {
        padding-bottom: 15px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .grupo-controles:last-child {
        border-bottom: none;
    }
    
    .grupo-controles h4 {
        color: white;
        font-size: 14px;
        font-weight: 600;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .controles-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 8px;
    }
    
    .control-btn {
        width: 40px;
        height: 40px;
        border-radius: 10px;
        background: rgba(52, 152, 219, 0.2);
        border: 1px solid rgba(52, 152, 219, 0.3);
        color: white;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 16px;
        transition: all 0.3s ease;
    }
    
    .control-btn:hover {
        background: rgba(52, 152, 219, 0.4);
        transform: translateY(-2px);
    }
    
    .tooltip {
        position: relative;
    }
    
    .tooltip::after {
        content: attr(data-tooltip);
        position: absolute;
        bottom: 100%;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 6px 12px;
        border-radius: 6px;
        font-size: 12px;
        white-space: nowrap;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
        pointer-events: none;
        z-index: 10000;
    }
    
    .tooltip:hover::after {
        opacity: 1;
        visibility: visible;
        bottom: 120%;
    }
    
    .filtro-select {
        width: 100%;
        padding: 10px;
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        color: white;
        border-radius: 8px;
        font-size: 14px;
        margin-bottom: 10px;
    }
    
    .filtro-select option {
        background: #0c0e2a;
        color: white;
    }
    
    .filtro-checkbox {
        display: flex;
        align-items: center;
        gap: 8px;
        color: rgba(255, 255, 255, 0.9);
        font-size: 14px;
    }
    
    .filtro-checkbox input {
        accent-color: #3498db;
    }
    
    .zoom-controls {
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .zoom-btn {
        width: 35px;
        height: 35px;
        border-radius: 8px;
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        color: white;
        cursor: pointer;
        font-weight: bold;
        transition: all 0.3s ease;
    }
    
    .zoom-btn:hover {
        background: rgba(255, 255, 255, 0.2);
    }
    
    .zoom-controls input[type="range"] {
        flex: 1;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 8px;
        height: 6px;
        outline: none;
    }
    
    .zoom-value {
        min-width: 45px;
        text-align: center;
        color: white;
        font-size: 12px;
        background: rgba(255, 255, 255, 0.1);
        padding: 5px;
        border-radius: 6px;
    }
    
    /* Canvas principal */
    .mapa-canvas-fullscreen {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
        cursor: grab;
        z-index: 1;
    }
    
    .mapa-canvas-fullscreen:active {
        cursor: grabbing;
    }
    
    /* Partículas de fondo */
    .particles-container {
        position: absolute;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 1;
    }
    
    /* SVG para conexiones */
    .conexiones-svg {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 2;
    }
    
    .conexion {
        stroke-width: 2;
        fill: none;
        filter: url(#glow);
    }
    
    .conexion-central {
        stroke: url(#gradient-central);
        stroke-dasharray: 5, 5;
        animation: dashMove 20s linear infinite;
    }
    
    .conexion-eje {
        stroke: url(#gradient-eje);
        stroke-dasharray: 1000;
        stroke-dashoffset: 1000;
        animation: drawLine 2s ease-out forwards;
    }
    
    .conexion-estrategia {
        stroke: url(#gradient-estrategia);
        stroke-dasharray: 1000;
        stroke-dashoffset: 1000;
        animation: drawLine 1.5s ease-out forwards;
    }
    
    @keyframes drawLine {
        to {
            stroke-dashoffset: 0;
        }
    }
    
    @keyframes dashMove {
        to {
            stroke-dashoffset: -100;
        }
    }
    
    /* Contenedor de nodos */
    .nodos-container {
        position: absolute;
        width: 100%;
        height: 100%;
        z-index: 3;
        transform-origin: center;
        transition: transform 0.3s ease;
        will-change: transform;
    }
    
    /* Nodos generales */
    .nodo {
        position: absolute;
        cursor: pointer;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        transform-origin: center;
        z-index: 10;
    }
    
    .nodo:hover {
        z-index: 1000;
    }
    
    /* Nodo central */
    .nodo-central {
        width: 300px;
        height: 300px;
        z-index: 100;
    }
    
    .nodo-glow {
        position: absolute;
        width: 100%;
        height: 100%;
        border-radius: 50%;
        background: radial-gradient(circle, rgba(156, 39, 176, 0.4) 0%, rgba(156, 39, 176, 0) 70%);
        animation: pulseGlow 3s infinite;
        filter: blur(20px);
        z-index: -1;
    }
    
    .nodo-central .nodo-content {
        position: relative;
        width: 100%;
        height: 100%;
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(20px);
        border-radius: 50%;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-align: center;
        padding: 30px;
        border: 2px solid rgba(156, 39, 176, 0.3);
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3),
                    inset 0 1px 0 rgba(255, 255, 255, 0.1);
    }
    
    .nodo-icon-pulse {
        width: 70px;
        height: 70px;
        background: linear-gradient(135deg, #9C27B0, #E91E63);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 20px;
        font-size: 28px;
        color: white;
        animation: pulseIcon 2s infinite;
        box-shadow: 0 0 30px rgba(156, 39, 176, 0.5);
    }
    
    .nodo-title-glow {
        font-size: 16px;
        font-weight: 700;
        color: white;
        margin-bottom: 10px;
        text-transform: uppercase;
        letter-spacing: 1px;
        text-shadow: 0 0 10px rgba(156, 39, 176, 0.7);
    }
    
    .nodo-desc-scroll {
        font-size: 12px;
        color: rgba(255, 255, 255, 0.8);
        line-height: 1.4;
        margin-bottom: 15px;
        max-height: 60px;
        overflow: hidden;
        text-overflow: ellipsis;
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
    }
    
    .btn-ver-mas {
        background: linear-gradient(135deg, #3498db, #9b59b6);
        border: none;
        color: white;
        padding: 8px 16px;
        border-radius: 20px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 6px;
        font-size: 12px;
        font-weight: 600;
        transition: all 0.3s ease;
        margin-bottom: 15px;
    }
    
    .btn-ver-mas:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
    }
    
    .nodo-stats-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
        width: 80%;
    }
    
    .stat-item {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 10px;
        padding: 8px;
        text-align: center;
    }
    
    .stat-value {
        font-size: 20px;
        font-weight: 700;
        color: white;
        margin-bottom: 2px;
    }
    
    .stat-label {
        font-size: 10px;
        color: rgba(255, 255, 255, 0.7);
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    /* Nodos de ejes */
    .nodo-eje {
        width: 160px;
        height: 160px;
        z-index: 90;
    }
    
    .nodo-eje .nodo-content {
        position: relative;
        width: 100%;
        height: 100%;
        background: rgba(52, 152, 219, 0.1);
        backdrop-filter: blur(15px);
        border-radius: 20px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-align: center;
        padding: 20px;
        border: 2px solid rgba(52, 152, 219, 0.3);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        transition: all 0.3s ease;
    }
    
    .nodo-eje:hover .nodo-content {
        transform: translateY(-5px);
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
        border-color: rgba(52, 152, 219, 0.5);
    }
    
    .nodo-eje .nodo-icon {
        width: 50px;
        height: 50px;
        background: linear-gradient(135deg, #3498db, #2980b9);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 10px;
        font-size: 20px;
        color: white;
        box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
    }
    
    .nodo-eje .nodo-title {
        font-size: 14px;
        font-weight: 600;
        color: white;
        margin-bottom: 5px;
        text-align: center;
        line-height: 1.2;
    }
    
    .nodo-eje .nodo-counter {
        font-size: 11px;
        color: rgba(255, 255, 255, 0.7);
        background: rgba(255, 255, 255, 0.1);
        padding: 3px 10px;
        border-radius: 12px;
    }
    
    /* Nodos de estrategias */
    .nodo-estrategia {
        width: 140px;
        height: 140px;
        z-index: 80;
    }
    
    .nodo-estrategia .nodo-content {
        background: rgba(46, 204, 113, 0.1);
        border: 2px solid rgba(46, 204, 113, 0.3);
    }
    
    .nodo-estrategia .nodo-icon {
        background: linear-gradient(135deg, #2ecc71, #27ae60);
    }
    
    /* Nodos de actividades */
    .nodo-actividad {
        width: 120px;
        height: 120px;
        z-index: 70;
    }
    
    .nodo-actividad .nodo-content {
        background: rgba(231, 76, 60, 0.1);
        border: 2px solid rgba(231, 76, 60, 0.3);
    }
    
    .nodo-actividad .nodo-icon {
        background: linear-gradient(135deg, #e74c3c, #c0392b);
    }
    
    /* Nodos de tareas */
    .nodo-tarea {
        width: 100px;
        height: 100px;
        z-index: 60;
    }
    
    .nodo-tarea .nodo-content {
        background: rgba(243, 156, 18, 0.1);
        border: 2px solid rgba(243, 156, 18, 0.3);
    }
    
    .nodo-tarea .nodo-icon {
        background: linear-gradient(135deg, #f39c12, #d35400);
    }
    
    /* Estilos comunes para nodos hijos */
    .nodo-estrategia .nodo-content,
    .nodo-actividad .nodo-content,
    .nodo-tarea .nodo-content {
        position: relative;
        width: 100%;
        height: 100%;
        backdrop-filter: blur(10px);
        border-radius: 15px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-align: center;
        padding: 15px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        transition: all 0.3s ease;
    }
    
    .nodo-estrategia .nodo-icon,
    .nodo-actividad .nodo-icon,
    .nodo-tarea .nodo-icon {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 8px;
        font-size: 16px;
        color: white;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
    }
    
    .nodo-estrategia .nodo-title,
    .nodo-actividad .nodo-title,
    .nodo-tarea .nodo-title {
        font-size: 12px;
        font-weight: 600;
        color: white;
        text-align: center;
        line-height: 1.2;
    }
    
    /* Leyenda flotante */
    .leyenda-flotante {
        position: absolute;
        bottom: 20px;
        left: 20px;
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(20px);
        border-radius: 15px;
        padding: 15px;
        width: 200px;
        z-index: 1000;
        border: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
    }
    
    .leyenda-header {
        color: white;
        font-weight: 600;
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .leyenda-content {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }
    
    .leyenda-item {
        display: flex;
        align-items: center;
        gap: 10px;
        color: rgba(255, 255, 255, 0.8);
        font-size: 12px;
    }
    
    .leyenda-icon {
        width: 20px;
        height: 20px;
        border-radius: 50%;
        flex-shrink: 0;
    }
    
    .nodo-central-color {
        background: linear-gradient(135deg, #9C27B0, #E91E63);
    }
    
    .nodo-eje-color {
        background: linear-gradient(135deg, #3498db, #2980b9);
    }
    
    .nodo-estrategia-color {
        background: linear-gradient(135deg, #2ecc71, #27ae60);
    }
    
    .nodo-actividad-color {
        background: linear-gradient(135deg, #e74c3c, #c0392b);
    }
    
    .nodo-tarea-color {
        background: linear-gradient(135deg, #f39c12, #d35400);
    }
    
    /* Panel de detalles */
    .panel-detalles {
        position: fixed;
        top: 0;
        right: -400px;
        width: 380px;
        height: 100%;
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(30px);
        border-left: 1px solid rgba(255, 255, 255, 0.1);
        z-index: 2000;
        transition: right 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        overflow-y: auto;
    }
    
    .panel-detalles.open {
        right: 0;
    }
    
    .panel-header {
        padding: 25px;
        background: rgba(12, 36, 97, 0.5);
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .panel-header h3 {
        color: white;
        font-size: 18px;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .panel-close {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.1);
        border: none;
        color: white;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
    }
    
    .panel-close:hover {
        background: rgba(255, 255, 255, 0.2);
        transform: rotate(90deg);
    }
    
    .panel-body {
        padding: 25px;
        color: rgba(255, 255, 255, 0.9);
    }
    
    /* Animaciones */
    @keyframes pulseGlow {
        0%, 100% {
            opacity: 0.5;
            transform: scale(1);
        }
        50% {
            opacity: 0.8;
            transform: scale(1.05);
        }
    }
    
    @keyframes pulseIcon {
        0%, 100% {
            box-shadow: 0 0 30px rgba(156, 39, 176, 0.5);
        }
        50% {
            box-shadow: 0 0 50px rgba(156, 39, 176, 0.8);
        }
    }
    
    @keyframes aparecerNodo {
        from {
            opacity: 0;
            transform: translateY(50px) scale(0.5);
        }
        to {
            opacity: 1;
            transform: translateY(0) scale(1);
        }
    }
    
    .nodo-aparecer {
        animation: aparecerNodo 0.6s ease forwards;
    }
    
    /* Scrollbar personalizado */
    ::-webkit-scrollbar {
        width: 8px;
    }
    
    ::-webkit-scrollbar-track {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 10px;
    }
    
    ::-webkit-scrollbar-thumb {
        background: linear-gradient(135deg, #3498db, #9b59b6);
        border-radius: 10px;
    }
    
    /* Responsive */
    @media (max-width: 1200px) {
        .panel-controles {
            width: 280px;
            top: 90px;
            right: 10px;
        }
        
        .panel-detalles {
            width: 320px;
        }
        
        .leyenda-flotante {
            width: 180px;
        }
    }
    
    @media (max-width: 768px) {
        .mapa-header-glass {
            height: 70px;
            padding: 0 10px;
        }
        
        .header-content {
            flex-direction: column;
            align-items: flex-start;
            gap: 5px;
        }
        
        .header-stats {
            width: 100%;
            overflow-x: auto;
            padding-bottom: 5px;
        }
        
        .panel-controles {
            width: calc(100% - 20px);
            right: 10px;
            flex-direction: row;
            flex-wrap: wrap;
            top: 80px;
        }
        
        .grupo-controles {
            flex: 1;
            min-width: 200px;
            border-bottom: none;
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            padding-right: 15px;
            margin-right: 15px;
        }
        
        .grupo-controles:last-child {
            border-right: none;
        }
        
        .panel-detalles {
            width: 100%;
            right: -100%;
        }
        
        .leyenda-flotante {
            display: none;
        }
        
        .nodo-central {
            width: 250px;
            height: 250px;
        }
        
        .nodo-eje {
            width: 140px;
            height: 140px;
        }
    }
</style>

<script>
    // Variables globales
    let nodos = {
        ejes: [
            { id: 'educacion', nombre: 'EDUCACIÓN', icono: 'graduation-cap', color: '#3498db' },
            { id: 'salud', nombre: 'SALUD', icono: 'heartbeat', color: '#e74c3c' },
            { id: 'empleabilidad', nombre: 'EMPLEABILIDAD', icono: 'briefcase', color: '#2ecc71' },
            { id: 'desarrollo', nombre: 'DESARROLLO ECONÓMICO', icono: 'chart-line', color: '#9b59b6' },
            { id: 'agua', nombre: 'SOSTENIBILIDAD AMBIENTAL', icono: 'tint', color: '#1abc9c' },
            { id: 'comunicacion', nombre: 'COMUNICACIÓN', icono: 'bullhorn', color: '#f1c40f' },
            { id: 'institucional', nombre: 'INSTITUCIONAL', icono: 'landmark', color: '#e67e22' }
        ],
        estrategias: [],
        actividades: [],
        tareas: []
    };
    
    let conexiones = [];
    let animacionesActivas = true;
    let zoomLevel = 1;
    let panning = false;
    let startX, startY;
    let translateX = 0, translateY = 0;
    let nodoSeleccionado = null;
    let particulas = [];
    let intervaloConexiones;
    let mostrarConexiones = true;
    
    // Inicialización
    document.addEventListener('DOMContentLoaded', function() {
        inicializarMapa();
        crearParticulas();
        cargarDatos();
        inicializarEventos();
        animarEntrada();
        
        // Iniciar actualización continua de conexiones
        intervaloConexiones = setInterval(actualizarConexiones, 100);
    });
    
    function inicializarMapa() {
        // Configurar canvas para pan y zoom
        const canvas = document.getElementById('mapaCanvas');
        const nodosContainer = document.getElementById('nodosContainer');
        
        // Posicionar nodo central
        const objetivo = document.getElementById('nodo-objetivo');
        const canvasRect = canvas.getBoundingClientRect();
        objetivo.style.left = '50%';
        objetivo.style.top = '50%';
        
        // Crear nodos de ejes
        crearNodosEjes();
        
        // Aplicar transformación inicial
        actualizarTransformacion();
    }
    
    function crearNodosEjes() {
        const ejesContainer = document.getElementById('ejesContainer');
        ejesContainer.innerHTML = '';
        
        const objetivo = document.getElementById('nodo-objetivo');
        const objetivoRect = objetivo.getBoundingClientRect();
        const canvasRect = document.getElementById('mapaCanvas').getBoundingClientRect();
        
        const centroX = canvasRect.width / 2;
        const centroY = canvasRect.height / 2;
        const radio = Math.min(canvasRect.width, canvasRect.height) * 0.35;
        
        nodos.ejes.forEach((eje, index) => {
            const angulo = (2 * Math.PI / nodos.ejes.length) * index;
            const x = centroX + radio * Math.cos(angulo);
            const y = centroY + radio * Math.sin(angulo);
            
            const nodoDiv = document.createElement('div');
            nodoDiv.className = 'nodo nodo-eje nodo-aparecer';
            nodoDiv.id = `nodo-${eje.id}`;
            nodoDiv.dataset.ejeId = eje.id;
            nodoDiv.style.left = `${x}px`;
            nodoDiv.style.top = `${y}px`;
            nodoDiv.style.transform = 'translate(-50%, -50%)';
            nodoDiv.style.animationDelay = `${index * 0.1}s`;
            
            nodoDiv.innerHTML = `
                <div class="nodo-content">
                    <div class="nodo-icon">
                        <i class="fas fa-${eje.icono}"></i>
                    </div>
                    <div class="nodo-title">${eje.nombre}</div>
                    <div class="nodo-counter" id="counter-${eje.id}">0 estrategias</div>
                </div>
            `;
            
            ejesContainer.appendChild(nodoDiv);
            
            // Agregar evento de clic
            nodoDiv.addEventListener('click', function(e) {
                e.stopPropagation();
                seleccionarNodo(this.id);
                mostrarDetallesEje(eje.id);
            });
            
            // Agregar conexión con el objetivo
            conexiones.push({
                tipo: 'central',
                sourceId: 'nodo-objetivo',
                targetId: `nodo-${eje.id}`,
                color: eje.color
            });
        });
        
        // Actualizar conexiones
        dibujarConexiones();
    }
    
    function inicializarEventos() {
        const canvas = document.getElementById('mapaCanvas');
        const nodosContainer = document.getElementById('nodosContainer');
        
        // Eventos de mouse para pan
        canvas.addEventListener('mousedown', startPan);
        canvas.addEventListener('mousemove', pan);
        canvas.addEventListener('mouseup', endPan);
        canvas.addEventListener('mouseleave', endPan);
        
        // Eventos táctiles
        canvas.addEventListener('touchstart', startPanTouch);
        canvas.addEventListener('touchmove', panTouch);
        canvas.addEventListener('touchend', endPan);
        
        // Evento de rueda para zoom
        canvas.addEventListener('wheel', zoomWheel);
        
        // Evento de redimensionamiento
        window.addEventListener('resize', recalcularPosiciones);
        
        // Evento para cerrar panel al hacer clic fuera
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.panel-detalles') && !e.target.closest('.nodo')) {
                cerrarPanel();
            }
        });
    }
    
    // Funciones de pan y zoom
    function startPan(e) {
        panning = true;
        startX = e.clientX - translateX;
        startY = e.clientY - translateY;
        document.getElementById('mapaCanvas').style.cursor = 'grabbing';
    }
    
    function pan(e) {
        if (!panning) return;
        e.preventDefault();
        translateX = e.clientX - startX;
        translateY = e.clientY - startY;
        actualizarTransformacion();
    }
    
    function endPan() {
        panning = false;
        document.getElementById('mapaCanvas').style.cursor = 'grab';
    }
    
    function startPanTouch(e) {
        if (e.touches.length === 1) {
            panning = true;
            startX = e.touches[0].clientX - translateX;
            startY = e.touches[0].clientY - translateY;
        }
    }
    
    function panTouch(e) {
        if (!panning || e.touches.length !== 1) return;
        e.preventDefault();
        translateX = e.touches[0].clientX - startX;
        translateY = e.touches[0].clientY - startY;
        actualizarTransformacion();
    }
    
    function zoomWheel(e) {
        e.preventDefault();
        const zoomIntensity = 0.1;
        const oldZoom = zoomLevel;
        
        zoomLevel += e.deltaY < 0 ? zoomIntensity : -zoomIntensity;
        zoomLevel = Math.min(Math.max(0.3, zoomLevel), 3);
        
        document.getElementById('zoomSlider').value = zoomLevel;
        document.getElementById('zoomValue').textContent = `${Math.round(zoomLevel * 100)}%`;
        
        const rect = e.target.getBoundingClientRect();
        const mouseX = e.clientX - rect.left;
        const mouseY = e.clientY - rect.top;
        
        translateX = mouseX - (mouseX - translateX) * (zoomLevel / oldZoom);
        translateY = mouseY - (mouseY - translateY) * (zoomLevel / oldZoom);
        
        actualizarTransformacion();
    }
    
    function zoomSliderChange(value) {
        const oldZoom = zoomLevel;
        zoomLevel = parseFloat(value);
        
        document.getElementById('zoomValue').textContent = `${Math.round(zoomLevel * 100)}%`;
        
        const canvas = document.getElementById('mapaCanvas');
        const rect = canvas.getBoundingClientRect();
        const centerX = rect.width / 2;
        const centerY = rect.height / 2;
        
        translateX = centerX - (centerX - translateX) * (zoomLevel / oldZoom);
        translateY = centerY - (centerY - translateY) * (zoomLevel / oldZoom);
        
        actualizarTransformacion();
    }
    
    function zoomIn() {
        zoomSliderChange(Math.min(zoomLevel + 0.1, 3));
    }
    
    function zoomOut() {
        zoomSliderChange(Math.max(zoomLevel - 0.1, 0.3));
    }
    
    function actualizarTransformacion() {
        const nodosContainer = document.getElementById('nodosContainer');
        nodosContainer.style.transform = `translate(${translateX}px, ${translateY}px) scale(${zoomLevel})`;
    }
    
    // Funciones de conexiones dinámicas
    function obtenerPosicionNodo(nodoId) {
        const nodo = document.getElementById(nodoId);
        if (!nodo) return null;
        
        const rect = nodo.getBoundingClientRect();
        const canvasRect = document.getElementById('mapaCanvas').getBoundingClientRect();
        
        // Calcular posición relativa al canvas considerando el zoom y pan
        const x = (rect.left + rect.width / 2 - canvasRect.left - translateX) / zoomLevel;
        const y = (rect.top + rect.height / 2 - canvasRect.top - translateY) / zoomLevel;
        
        return { x, y };
    }
    
    function dibujarConexiones() {
        if (!mostrarConexiones) {
            document.getElementById('conexionesSvg').innerHTML = '';
            return;
        }
        
        const svg = document.getElementById('conexionesSvg');
        svg.innerHTML = '<defs><linearGradient id="gradient-central" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="#9C27B0" stop-opacity="0.8" /><stop offset="100%" stop-color="#E91E63" stop-opacity="0.8" /></linearGradient><linearGradient id="gradient-eje" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="#3498db" stop-opacity="0.7" /><stop offset="100%" stop-color="#2980b9" stop-opacity="0.7" /></linearGradient><linearGradient id="gradient-estrategia" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="#2ecc71" stop-opacity="0.7" /><stop offset="100%" stop-color="#27ae60" stop-opacity="0.7" /></linearGradient><filter id="glow"><feGaussianBlur stdDeviation="2.5" result="coloredBlur"/><feMerge><feMergeNode in="coloredBlur"/><feMergeNode in="SourceGraphic"/></feMerge></filter></defs>';
        
        conexiones.forEach((conexion, index) => {
            const sourcePos = obtenerPosicionNodo(conexion.sourceId);
            const targetPos = obtenerPosicionNodo(conexion.targetId);
            
            if (!sourcePos || !targetPos) return;
            
            const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
            line.setAttribute('x1', sourcePos.x);
            line.setAttribute('y1', sourcePos.y);
            line.setAttribute('x2', targetPos.x);
            line.setAttribute('y2', targetPos.y);
            
            let claseConexion = 'conexion';
            switch(conexion.tipo) {
                case 'central':
                    claseConexion += ' conexion-central';
                    line.setAttribute('stroke', 'url(#gradient-central)');
                    break;
                case 'eje':
                    claseConexion += ' conexion-eje';
                    line.setAttribute('stroke', conexion.color || 'url(#gradient-eje)');
                    break;
                case 'estrategia':
                    claseConexion += ' conexion-estrategia';
                    line.setAttribute('stroke', conexion.color || 'url(#gradient-estrategia)');
                    break;
            }
            
            line.setAttribute('class', claseConexion);
            line.setAttribute('stroke-width', '2');
            line.style.animationDelay = `${index * 0.05}s`;
            
            svg.appendChild(line);
        });
    }
    
    function actualizarConexiones() {
        dibujarConexiones();
    }
    
    function toggleConexiones() {
        mostrarConexiones = !mostrarConexiones;
        dibujarConexiones();
    }
    
    // Crear partículas de fondo
    function crearParticulas() {
        const container = document.getElementById('particlesContainer');
        const particulaCount = 80;
        
        for (let i = 0; i < particulaCount; i++) {
            const particula = document.createElement('div');
            particula.className = 'particle';
            
            const x = Math.random() * 100;
            const y = Math.random() * 100;
            const size = Math.random() * 2 + 1;
            const duration = Math.random() * 15 + 10;
            const delay = Math.random() * 5;
            
            particula.style.left = `${x}%`;
            particula.style.top = `${y}%`;
            particula.style.width = `${size}px`;
            particula.style.height = `${size}px`;
            particula.style.animation = `float ${duration}s infinite ${delay}s linear`;
            particula.style.opacity = Math.random() * 0.3 + 0.1;
            particula.style.backgroundColor = `rgba(52, 152, 219, ${Math.random() * 0.5})`;
            
            container.appendChild(particula);
            particulas.push(particula);
        }
        
        // Agregar animación de flotar
        const style = document.createElement('style');
        style.textContent = `
            @keyframes float {
                0%, 100% { transform: translate(0, 0) rotate(0deg); }
                25% { transform: translate(${Math.random() * 20 - 10}px, ${Math.random() * 20 - 10}px) rotate(90deg); }
                50% { transform: translate(${Math.random() * 20 - 10}px, ${Math.random() * 20 - 10}px) rotate(180deg); }
                75% { transform: translate(${Math.random() * 20 - 10}px, ${Math.random() * 20 - 10}px) rotate(270deg); }
            }
        `;
        document.head.appendChild(style);
    }
    
    // Cargar datos del backend
    function cargarDatos() {
        // Simular carga de datos
        setTimeout(() => {
            // Datos de ejemplo para estrategias
            nodos.estrategias = [
                { id: 1, eje_id: 'educacion', nombre: 'Capacitación docente', tipo: 'FO' },
                { id: 2, eje_id: 'educacion', nombre: 'Infraestructura educativa', tipo: 'DA' },
                { id: 3, eje_id: 'salud', nombre: 'Equipamiento médico', tipo: 'FO' },
                { id: 4, eje_id: 'empleabilidad', nombre: 'Formación técnica', tipo: 'FA' },
                { id: 5, eje_id: 'agua', nombre: 'Monitoreo calidad', tipo: 'DO' }
            ];
            
            actualizarContadoresEjes();
            actualizarEstadisticas();
        }, 1000);
    }
    
    function actualizarContadoresEjes() {
        nodos.ejes.forEach(eje => {
            const count = nodos.estrategias.filter(e => e.eje_id === eje.id).length;
            const counterElement = document.getElementById(`counter-${eje.id}`);
            if (counterElement) {
                counterElement.textContent = `${count} estrategias`;
            }
        });
    }
    
    function actualizarEstadisticas() {
        const totalEstrategias = nodos.estrategias.length;
        const totalConexiones = conexiones.length;
        
        document.getElementById('total-estrategias').textContent = `${totalEstrategias} Estrategias`;
        document.getElementById('contador-estrategias').textContent = totalEstrategias;
        document.getElementById('total-conexiones').textContent = `${totalConexiones} Conexiones`;
    }
    
    // Funciones de animación y visualización
    function animarEntrada() {
        const todosNodos = document.querySelectorAll('.nodo');
        todosNodos.forEach((nodo, index) => {
            nodo.classList.add('nodo-aparecer');
            nodo.style.animationDelay = `${index * 0.05}s`;
        });
        
        // Efecto de onda desde el centro
        setTimeout(crearOndaCentro, 500);
    }
    
    function crearOndaCentro() {
        const canvas = document.getElementById('mapaCanvas');
        const onda = document.createElement('div');
        onda.style.cssText = `
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 10px;
            height: 10px;
            border-radius: 50%;
            border: 2px solid rgba(52, 152, 219, 0.5);
            z-index: 0;
            pointer-events: none;
        `;
        
        canvas.appendChild(onda);
        
        let size = 10;
        const animacion = setInterval(() => {
            size += 20;
            onda.style.width = `${size}px`;
            onda.style.height = `${size}px`;
            onda.style.opacity = 1 - (size / 500);
            
            if (size > 500) {
                clearInterval(animacion);
                onda.remove();
            }
        }, 20);
    }
    
    function seleccionarNodo(nodoId) {
        if (nodoSeleccionado) {
            nodoSeleccionado.classList.remove('nodo-seleccionado');
        }
        
        nodoSeleccionado = document.getElementById(nodoId);
        if (nodoSeleccionado) {
            nodoSeleccionado.classList.add('nodo-seleccionado');
            nodoSeleccionado.style.zIndex = '1000';
        }
    }
    
    // Funciones de UI
    function mostrarDetallesEje(ejeId) {
        const panel = document.getElementById('panelDetalles');
        const titulo = document.getElementById('detalleTitulo');
        const contenido = document.getElementById('detalleContenido');
        
        const eje = nodos.ejes.find(e => e.id === ejeId);
        if (!eje) return;
        
        const estrategiasEje = nodos.estrategias.filter(e => e.eje_id === ejeId);
        
        titulo.innerHTML = `<i class="fas fa-${eje.icono}"></i> ${eje.nombre}`;
        
        contenido.innerHTML = `
            <div class="detalle-eje">
                <div class="eje-header" style="background: linear-gradient(135deg, ${eje.color}, ${oscurecerColor(eje.color, 20)}); padding: 20px; border-radius: 15px; margin-bottom: 20px;">
                    <div style="width: 60px; height: 60px; background: rgba(255,255,255,0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto;">
                        <i class="fas fa-${eje.icono}" style="font-size: 28px; color: white;"></i>
                    </div>
                    <h4 style="color: white; margin-top: 10px; text-align: center;">${eje.nombre}</h4>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                    <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 10px; text-align: center;">
                        <div style="font-size: 24px; font-weight: bold; color: white;">${estrategiasEje.length}</div>
                        <div style="font-size: 12px; color: rgba(255,255,255,0.7);">Estrategias</div>
                    </div>
                    <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 10px; text-align: center;">
                        <div style="font-size: 24px; font-weight: bold; color: white;">${conexiones.length}</div>
                        <div style="font-size: 12px; color: rgba(255,255,255,0.7);">Conexiones</div>
                    </div>
                </div>
                
                ${estrategiasEje.length > 0 ? `
                    <div class="estrategias-lista">
                        <h5 style="color: white; margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-chess-board"></i> Estrategias relacionadas:
                        </h5>
                        ${estrategiasEje.map(estrategia => `
                            <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 10px; margin-bottom: 10px; border-left: 4px solid ${eje.color};">
                                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                                    <div style="background: ${eje.color}; color: white; padding: 3px 10px; border-radius: 15px; font-size: 11px; font-weight: bold;">
                                        ${estrategia.tipo}
                                    </div>
                                    <div style="font-size: 12px; color: rgba(255,255,255,0.7);">Estrategia #${estrategia.id}</div>
                                </div>
                                <div style="color: rgba(255,255,255,0.9); font-size: 14px;">${estrategia.nombre}</div>
                            </div>
                        `).join('')}
                    </div>
                ` : '<div style="text-align: center; padding: 30px; color: rgba(255,255,255,0.7);"><i class="fas fa-inbox" style="font-size: 40px; margin-bottom: 10px; opacity: 0.5;"></i><p>No hay estrategias asignadas a este eje aún.</p></div>'}
            </div>
        `;
        
        panel.classList.add('open');
    }
    
    function oscurecerColor(color, percent) {
        let num = parseInt(color.replace("#", ""), 16),
            amt = Math.round(2.55 * percent),
            R = (num >> 16) - amt,
            G = (num >> 8 & 0x00FF) - amt,
            B = (num & 0x0000FF) - amt;
        
        return "#" + (0x1000000 + (R < 255 ? R < 1 ? 0 : R : 255) * 0x10000 +
            (G < 255 ? G < 1 ? 0 : G : 255) * 0x100 +
            (B < 255 ? B < 1 ? 0 : B : 255)).toString(16).slice(1);
    }
    
    function cerrarPanel() {
        document.getElementById('panelDetalles').classList.remove('open');
        if (nodoSeleccionado) {
            nodoSeleccionado.classList.remove('nodo-seleccionado');
            nodoSeleccionado = null;
        }
    }
    
    // Funciones de control
    function toggleFullscreen() {
        const container = document.getElementById('mapaFullscreen');
        
        if (!document.fullscreenElement) {
            container.requestFullscreen().catch(err => {
                console.log(`Error attempting to enable fullscreen: ${err.message}`);
            });
        } else {
            document.exitFullscreen();
        }
    }
    
    function resetView() {
        zoomLevel = 1;
        translateX = 0;
        translateY = 0;
        document.getElementById('zoomSlider').value = 1;
        document.getElementById('zoomValue').textContent = '100%';
        actualizarTransformacion();
        mostrarNotificacion('Vista reiniciada', 'success');
    }
    
    function toggleAnimations() {
        animacionesActivas = !animacionesActivas;
        const icon = document.getElementById('animacionIcon');
        
        if (animacionesActivas) {
            icon.className = 'fas fa-pause';
            document.querySelectorAll('.conexion').forEach(line => {
                line.style.animationPlayState = 'running';
            });
        } else {
            icon.className = 'fas fa-play';
            document.querySelectorAll('.conexion').forEach(line => {
                line.style.animationPlayState = 'paused';
            });
        }
        
        mostrarNotificacion(`Animaciones ${animacionesActivas ? 'activadas' : 'pausadas'}`, 'info');
    }
    
    function exportMap() {
        mostrarNotificacion('Preparando exportación del mapa...', 'success');
        setTimeout(() => {
            mostrarNotificacion('Mapa exportado exitosamente', 'success');
        }, 1500);
    }
    
    function filtrarNodos() {
        const nivel = document.getElementById('filtro-nivel').value;
        const todosNodos = document.querySelectorAll('.nodo');
        
        todosNodos.forEach(nodo => {
            if (nivel === 'all') {
                nodo.style.opacity = '1';
                nodo.style.pointerEvents = 'auto';
            } else if (nivel === 'objetivo' && nodo.classList.contains('nodo-central')) {
                nodo.style.opacity = '1';
                nodo.style.pointerEvents = 'auto';
            } else if (nivel === 'ejes' && nodo.classList.contains('nodo-eje')) {
                nodo.style.opacity = '1';
                nodo.style.pointerEvents = 'auto';
            } else if (nivel === 'estrategias' && nodo.classList.contains('nodo-estrategia')) {
                nodo.style.opacity = '1';
                nodo.style.pointerEvents = 'auto';
            } else if (nivel === 'actividades' && nodo.classList.contains('nodo-actividad')) {
                nodo.style.opacity = '1';
                nodo.style.pointerEvents = 'auto';
            } else if (nivel === 'tareas' && nodo.classList.contains('nodo-tarea')) {
                nodo.style.opacity = '1';
                nodo.style.pointerEvents = 'auto';
            } else {
                nodo.style.opacity = '0.2';
                nodo.style.pointerEvents = 'none';
            }
        });
        
        mostrarNotificacion(`Filtro aplicado: ${nivel}`, 'info');
    }
    
    function recalcularPosiciones() {
        const ejes = document.querySelectorAll('.nodo-eje');
        const canvas = document.getElementById('mapaCanvas');
        const canvasRect = canvas.getBoundingClientRect();
        
        const centroX = canvasRect.width / 2;
        const centroY = canvasRect.height / 2;
        const radio = Math.min(canvasRect.width, canvasRect.height) * 0.35;
        
        ejes.forEach((eje, index) => {
            const angulo = (2 * Math.PI / ejes.length) * index;
            const x = centroX + radio * Math.cos(angulo);
            const y = centroY + radio * Math.sin(angulo);
            
            eje.style.left = `${x}px`;
            eje.style.top = `${y}px`;
        });
        
        // Actualizar conexiones
        dibujarConexiones();
    }
    
    function mostrarNotificacion(mensaje, tipo) {
        const notificacion = document.createElement('div');
        notificacion.className = 'notificacion';
        notificacion.style.cssText = `
            position: fixed;
            top: 100px;
            right: 20px;
            padding: 15px 20px;
            background: ${tipo === 'success' ? 'rgba(46, 204, 113, 0.9)' : tipo === 'info' ? 'rgba(52, 152, 219, 0.9)' : 'rgba(241, 196, 15, 0.9)'};
            color: white;
            border-radius: 10px;
            font-weight: 600;
            z-index: 4000;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            transform: translateX(150%);
            transition: transform 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            max-width: 300px;
        `;
        
        notificacion.innerHTML = `
            <i class="fas fa-${tipo === 'success' ? 'check-circle' : 'info-circle'}"></i>
            ${mensaje}
        `;
        
        document.body.appendChild(notificacion);
        
        setTimeout(() => {
            notificacion.style.transform = 'translateX(0)';
        }, 10);
        
        setTimeout(() => {
            notificacion.style.transform = 'translateX(150%)';
            setTimeout(() => {
                notificacion.remove();
            }, 300);
        }, 3000);
    }
    
    // Detectar cambios en fullscreen
    document.addEventListener('fullscreenchange', recalcularPosiciones);
    document.addEventListener('webkitfullscreenchange', recalcularPosiciones);
    document.addEventListener('mozfullscreenchange', recalcularPosiciones);
    document.addEventListener('MSFullscreenChange', recalcularPosiciones);
    
    // Limpiar intervalo al salir
    window.addEventListener('beforeunload', function() {
        if (intervaloConexiones) {
            clearInterval(intervaloConexiones);
        }
    });
</script>
{% endblock %}
